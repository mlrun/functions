kind: job
metadata:
  name: feature-selection
  tag: ''
  hash: 4c9b5325447255eed325dadf25740fc8f8309f97
  project: fraud-demov4-alexz
spec:
  command: ''
  args: []
  image: mlrun/mlrun
  env: []
  default_handler: feature_selection
  entry_points:
    show_values_on_bars:
      name: show_values_on_bars
      doc: ''
      parameters:
      - name: axs
        default: ''
      - name: h_v
        default: v
      - name: space
        default: 0.4
      outputs:
      - default: ''
      lineno: 28
    plot_stat:
      name: plot_stat
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: stat_name
        default: ''
      - name: stat_df
        default: ''
      outputs:
      - default: ''
      lineno: 50
    feature_selection:
      name: feature_selection
      doc: 'Applies selected feature selection statistical functions

        or models on our ''df_artifact''.


        Each statistical function or model will vote for it''s best K selected features.

        If a feature has >= ''min_votes'' votes, it will be selected.'
      parameters:
      - name: context
        doc: the function context.
        default: ''
      - name: df_artifact
        default: ''
      - name: k
        type: int
        doc: 'number of top features to select from each statistical function or model. '
        default: 5
      - name: min_votes
        type: float
        doc: 'minimal number of votes (from a model or by statistical function) needed
          for a feature to be selected. Can be specified by percentage of votes or
          absolute number of votes. '
        default: 0.5
      - name: label_column
        type: str
        doc: ground-truth (y) labels.
        default: null
      - name: stat_filters
        type: list
        doc: 'statistical functions to apply to the features (from sklearn.feature_selection). '
        default:
        - f_classif
        - mutual_info_classif
        - chi2
        - f_regression
      - name: model_filters
        type: dict
        doc: 'models to use for feature evaluation, can be specified by model name
          (ex. LinearSVC), formalized json (contains ''CLASS'', ''FIT'', ''META'')
          or a path to such json file. '
        default:
          LinearSVC: LinearSVC
          LogisticRegression: LogisticRegression
          ExtraTreesClassifier: ExtraTreesClassifier
      - name: max_scaled_scores
        type: bool
        doc: produce feature scores table scaled with max_scaler.
        default: true
      - name: sample_ratio
        type: float
        doc: percentage of the dataset the user whishes to compute the feature selection
          process on.
        default: null
      - name: output_vector_name
        type: float
        doc: creates a new feature vector containing only the identifies features.
        default: null
      - name: ignore_type_errors
        type: bool
        doc: skips datatypes that are neither float or int within the feature vector.
        default: false
      - name: is_feature_vector
        type: bool
        doc: bool stating if the data is passed as a feature vector.
        default: false
      outputs:
      - default: ''
      lineno: 74
  description: ''
  build:
    functionSourceCode: aW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgbWF0cGxvdGxpYi5weXBsb3QgYXMgcGx0CmltcG9ydCBtbHJ1bi5mZWF0dXJlX3N0b3JlIGFzIGZzCmltcG9ydCBzZWFib3JuIGFzIHNucwppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCBtbHJ1bgoKIyBGZWF0dXJlIHNlbGVjdGlvbiBzdHJhdGVnaWVzCmZyb20gc2tsZWFybi5mZWF0dXJlX3NlbGVjdGlvbiBpbXBvcnQgU2VsZWN0S0Jlc3QKZnJvbSBza2xlYXJuLmZlYXR1cmVfc2VsZWN0aW9uIGltcG9ydCBTZWxlY3RGcm9tTW9kZWwKZnJvbSBza2xlYXJuLmxpbmVhcl9tb2RlbCBpbXBvcnQgTG9naXN0aWNSZWdyZXNzaW9uCgojIFNjYWxlIGZlYXR1cmUgc2NvcmVzCmZyb20gc2tsZWFybi5wcmVwcm9jZXNzaW5nIGltcG9ydCBNaW5NYXhTY2FsZXIKCiMgU0tMZWFybiBlc3RpbWF0b3JzIGxpc3QKZnJvbSBza2xlYXJuLnV0aWxzIGltcG9ydCBhbGxfZXN0aW1hdG9ycwoKIyBNTFJ1biB1dGlscwpmcm9tIG1scnVuLm1sdXRpbHMucGxvdHMgaW1wb3J0IGdjZl9jbGVhcgpmcm9tIG1scnVuLnV0aWxzLmhlbHBlcnMgaW1wb3J0IGNyZWF0ZV9jbGFzcwpmcm9tIG1scnVuLmFydGlmYWN0cyBpbXBvcnQgUGxvdEFydGlmYWN0CmZyb20gbWxydW4uZGF0YXN0b3JlLnRhcmdldHMgaW1wb3J0IFBhcnF1ZXRUYXJnZXQKCgpkZWYgc2hvd192YWx1ZXNfb25fYmFycyhheHMsIGhfdj0idiIsIHNwYWNlPTAuNCk6CiAgICBkZWYgX3Nob3dfb25fc2luZ2xlX3Bsb3QoYXgpOgogICAgICAgIGlmIGhfdiA9PSAidiI6CiAgICAgICAgICAgIGZvciBwIGluIGF4LnBhdGNoZXM6CiAgICAgICAgICAgICAgICBfeCA9IHAuZ2V0X3goKSArIHAuZ2V0X3dpZHRoKCkgLyAyCiAgICAgICAgICAgICAgICBfeSA9IHAuZ2V0X3koKSArIHAuZ2V0X2hlaWdodCgpCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGludChwLmdldF9oZWlnaHQoKSkKICAgICAgICAgICAgICAgIGF4LnRleHQoX3gsIF95LCB2YWx1ZSwgaGE9ImNlbnRlciIpCiAgICAgICAgZWxpZiBoX3YgPT0gImgiOgogICAgICAgICAgICBmb3IgcCBpbiBheC5wYXRjaGVzOgogICAgICAgICAgICAgICAgX3ggPSBwLmdldF94KCkgKyBwLmdldF93aWR0aCgpICsgZmxvYXQoc3BhY2UpCiAgICAgICAgICAgICAgICBfeSA9IHAuZ2V0X3koKSArIHAuZ2V0X2hlaWdodCgpCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGludChwLmdldF93aWR0aCgpKQogICAgICAgICAgICAgICAgYXgudGV4dChfeCwgX3ksIHZhbHVlLCBoYT0ibGVmdCIpCgogICAgaWYgaXNpbnN0YW5jZShheHMsIG5wLm5kYXJyYXkpOgogICAgICAgIGZvciBpZHgsIGF4IGluIG5wLm5kZW51bWVyYXRlKGF4cyk6CiAgICAgICAgICAgIF9zaG93X29uX3NpbmdsZV9wbG90KGF4KQogICAgZWxzZToKICAgICAgICBfc2hvd19vbl9zaW5nbGVfcGxvdChheHMpCgoKZGVmIHBsb3Rfc3RhdChjb250ZXh0LAogICAgICAgICAgICAgIHN0YXRfbmFtZSwKICAgICAgICAgICAgICBzdGF0X2RmKToKICAgIGdjZl9jbGVhcihwbHQpCgogICAgIyBBZGQgY2hhcnQKICAgIGF4ID0gcGx0LmF4ZXMoKQogICAgc3RhdF9jaGFydCA9IHNucy5iYXJwbG90KHg9c3RhdF9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk9J2luZGV4JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhPXN0YXRfZGYuc29ydF92YWx1ZXMoc3RhdF9uYW1lLCBhc2NlbmRpbmc9RmFsc2UpLnJlc2V0X2luZGV4KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXg9YXgpCiAgICBwbHQudGlnaHRfbGF5b3V0KCkKCiAgICBmb3IgcCBpbiBzdGF0X2NoYXJ0LnBhdGNoZXM6CiAgICAgICAgd2lkdGggPSBwLmdldF93aWR0aCgpCiAgICAgICAgcGx0LnRleHQoNSArIHAuZ2V0X3dpZHRoKCksIHAuZ2V0X3koKSArIDAuNTUgKiBwLmdldF9oZWlnaHQoKSwKICAgICAgICAgICAgICAgICAnezoxLjJmfScuZm9ybWF0KHdpZHRoKSwKICAgICAgICAgICAgICAgICBoYT0nY2VudGVyJywgdmE9J2NlbnRlcicpCgogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoUGxvdEFydGlmYWN0KGYne3N0YXRfbmFtZX0nLCBib2R5PXBsdC5nY2YoKSksCiAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9wYXRoPW9zLnBhdGguam9pbigncGxvdHMnLCAnZmVhdHVyZV9zZWxlY3Rpb24nLCBmJ3tzdGF0X25hbWV9Lmh0bWwnKSkKICAgIGdjZl9jbGVhcihwbHQpCgoKZGVmIGZlYXR1cmVfc2VsZWN0aW9uKGNvbnRleHQsCiAgICAgICAgICAgICAgICAgICAgICBkZl9hcnRpZmFjdCwKICAgICAgICAgICAgICAgICAgICAgIGs6IGludD01LAogICAgICAgICAgICAgICAgICAgICAgbWluX3ZvdGVzOiBmbG9hdD0wLjUsCiAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9jb2x1bW46IHN0cj1Ob25lLAogICAgICAgICAgICAgICAgICAgICAgc3RhdF9maWx0ZXJzOiBsaXN0PVsnZl9jbGFzc2lmJywgJ211dHVhbF9pbmZvX2NsYXNzaWYnLCAnY2hpMicsICdmX3JlZ3Jlc3Npb24nXSwKICAgICAgICAgICAgICAgICAgICAgIG1vZGVsX2ZpbHRlcnM6IGRpY3Q9eydMaW5lYXJTVkMnOiAnTGluZWFyU1ZDJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdMb2dpc3RpY1JlZ3Jlc3Npb24nOiAnTG9naXN0aWNSZWdyZXNzaW9uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdFeHRyYVRyZWVzQ2xhc3NpZmllcic6ICdFeHRyYVRyZWVzQ2xhc3NpZmllcid9LAogICAgICAgICAgICAgICAgICAgICAgbWF4X3NjYWxlZF9zY29yZXM6IGJvb2w9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgIHNhbXBsZV9yYXRpbzogZmxvYXQ9Tm9uZSwKICAgICAgICAgICAgICAgICAgICAgIG91dHB1dF92ZWN0b3JfbmFtZTogZmxvYXQ9Tm9uZSwKICAgICAgICAgICAgICAgICAgICAgIGlnbm9yZV90eXBlX2Vycm9yczogYm9vbD1GYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIGlzX2ZlYXR1cmVfdmVjdG9yOiBib29sPUZhbHNlKToKICAgIAogICAgIiIiQXBwbGllcyBzZWxlY3RlZCBmZWF0dXJlIHNlbGVjdGlvbiBzdGF0aXN0aWNhbCBmdW5jdGlvbnMKICAgIG9yIG1vZGVscyBvbiBvdXIgJ2RmX2FydGlmYWN0Jy4KCiAgICBFYWNoIHN0YXRpc3RpY2FsIGZ1bmN0aW9uIG9yIG1vZGVsIHdpbGwgdm90ZSBmb3IgaXQncyBiZXN0IEsgc2VsZWN0ZWQgZmVhdHVyZXMuCiAgICBJZiBhIGZlYXR1cmUgaGFzID49ICdtaW5fdm90ZXMnIHZvdGVzLCBpdCB3aWxsIGJlIHNlbGVjdGVkLgoKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgICAgdGhlIGZ1bmN0aW9uIGNvbnRleHQuCiAgICAKICAgIDpwYXJhbSBrOiAgICAgICAgICAgICAgICAgbnVtYmVyIG9mIHRvcCBmZWF0dXJlcyB0byBzZWxlY3QgZnJvbSBlYWNoIHN0YXRpc3RpY2FsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG9yIG1vZGVsLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgIDpwYXJhbSBtaW5fdm90ZXM6ICAgICAgICAgbWluaW1hbCBudW1iZXIgb2Ygdm90ZXMgKGZyb20gYSBtb2RlbCBvciBieSBzdGF0aXN0aWNhbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbikgbmVlZGVkIGZvciBhIGZlYXR1cmUgdG8gYmUgc2VsZWN0ZWQuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENhbiBiZSBzcGVjaWZpZWQgYnkgcGVyY2VudGFnZSBvZiB2b3RlcyBvciBhYnNvbHV0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXIgb2Ygdm90ZXMuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgOnBhcmFtIGxhYmVsX2NvbHVtbjogICAgICBncm91bmQtdHJ1dGggKHkpIGxhYmVscy4KICAgIAogICAgOnBhcmFtIHN0YXRfZmlsdGVyczogICAgICBzdGF0aXN0aWNhbCBmdW5jdGlvbnMgdG8gYXBwbHkgdG8gdGhlIGZlYXR1cmVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmcm9tIHNrbGVhcm4uZmVhdHVyZV9zZWxlY3Rpb24pLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgIDpwYXJhbSBtb2RlbF9maWx0ZXJzOiAgICAgbW9kZWxzIHRvIHVzZSBmb3IgZmVhdHVyZSBldmFsdWF0aW9uLCBjYW4gYmUgc3BlY2lmaWVkIGJ5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsIG5hbWUgKGV4LiBMaW5lYXJTVkMpLCBmb3JtYWxpemVkIGpzb24gKGNvbnRhaW5zICdDTEFTUycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGSVQnLCAnTUVUQScpIG9yIGEgcGF0aCB0byBzdWNoIGpzb24gZmlsZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICA6cGFyYW0gbWF4X3NjYWxlZF9zY29yZXM6IHByb2R1Y2UgZmVhdHVyZSBzY29yZXMgdGFibGUgc2NhbGVkIHdpdGggbWF4X3NjYWxlci4KCiAgICA6cGFyYW0gc2FtcGxlX3JhdGlvOiBwZXJjZW50YWdlIG9mIHRoZSBkYXRhc2V0IHRoZSB1c2VyIHdoaXNoZXMgdG8gY29tcHV0ZSB0aGUgZmVhdHVyZSBzZWxlY3Rpb24gcHJvY2VzcyBvbi4KICAgIAogICAgOnBhcmFtIG91dHB1dF92ZWN0b3JfbmFtZTogY3JlYXRlcyBhIG5ldyBmZWF0dXJlIHZlY3RvciBjb250YWluaW5nIG9ubHkgdGhlIGlkZW50aWZpZXMgZmVhdHVyZXMuCiAgICAKICAgIDpwYXJhbSBpZ25vcmVfdHlwZV9lcnJvcnM6IHNraXBzIGRhdGF0eXBlcyB0aGF0IGFyZSBuZWl0aGVyIGZsb2F0IG9yIGludCB3aXRoaW4gdGhlIGZlYXR1cmUgdmVjdG9yLgogICAgCiAgICA6cGFyYW0gaXNfZmVhdHVyZV92ZWN0b3I6IGJvb2wgc3RhdGluZyBpZiB0aGUgZGF0YSBpcyBwYXNzZWQgYXMgYSBmZWF0dXJlIHZlY3Rvci4KICAgICIiIgogICAgICAgIAogICAgIyBDaGVjayBpZiBkZi5tZXRhIGlzIHZhbGlkLCBpZiBpdCBpcywgbG9vayBmb3IgYSBmZWF0dXJlIHZlY3RvcgogICAgaWYgZGZfYXJ0aWZhY3QubWV0YToKICAgICAgICBpZiBkZl9hcnRpZmFjdC5tZXRhLmtpbmQgPT0gbWxydW4uYXBpLnNjaGVtYXMuT2JqZWN0S2luZC5mZWF0dXJlX3ZlY3RvcjoKICAgICAgICAgICAgaXNfZmVhdHVyZV92ZWN0b3IgPSBUcnVlCiAgICAKICAgICMgTG9vayBpbnNpZGUgbWV0YS5zcGVjLmxhYmVsX2ZlYXR1cmUgdG8gaWRlbnRpZnkgdGhlIGxhYmVsX2NvbHVtbiBpZiB0aGUgdXNlciBkaWQgbm90IHNwZWNpZnkgaXQKICAgIGlmIGxhYmVsX2NvbHVtbiBpcyBOb25lOgogICAgICAgIGlmIGlzX2ZlYXR1cmVfdmVjdG9yOgogICAgICAgICAgICBsYWJlbF9jb2x1bW4gPSBkZl9hcnRpZmFjdC5tZXRhLnNwZWMubGFiZWxfZmVhdHVyZS5zcGxpdCgnLicpWzFdCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcignTm8gbGFiZWxfY29sdW1uIHdhcyBnaXZlbiwgcGxlYXNlIGFkZCBhIGxhYmVsX2NvbHVtbi4nKQogICAgCiAgICAjIFVzZSB0aGUgZmVhdHVyZSB2ZWN0b3IgYXMgZGF0YWZyYW1lCiAgICBkZiA9IGRmX2FydGlmYWN0LmFzX2RmKCkKICAgIAogICAgIyBFbnN1cmUgayBpcyBub3QgYmlnZ2VyIHRoYW4gdGhlIHRoZSB0b3RhbCBudW1iZXIgb2YgZmVhdHVyZXMKICAgIGlmIGsgPiBkZi5zaGFwZVsxXToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGYnSyBjYW5ub3QgYmUgYmlnZ2VyIHRoYW4gdGhlIHRvdGFsIG51bWJlciBvZiBmZWF0dXJlcyAoe2RmLnNoYXBlWzFdfSkuIFBsZWFzZSBjaG9vc2UgYSBzbWFsbGVyIEsuJykKICAgIGVsaWYgayA8IDE6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmJ0sgY2Fubm90IGJlIHNtYWxsZXIgdGhhbiAxLiBQbGVhc2UgY2hvb3NlIGEgYmlnZ2VyIEsuJykKICAgICAgICAKICAgICMgQ3JlYXRlIGEgc2FtcGxlIGRhdGFmcmFtZSBvZiB0aGUgb3JpZ2luYWwgZmVhdHVyZSB2ZWN0b3IKICAgIGlmIHNhbXBsZV9yYXRpbzoKICAgICAgICBkZiA9IGRmLmdyb3VwYnkobGFiZWxfY29sdW1uKS5hcHBseShsYW1iZGEgeDogeC5zYW1wbGUoZnJhYz1zYW1wbGVfcmF0aW8pKS5yZXNldF9pbmRleChkcm9wPVRydWUpCiAgICAgICAgZGYgPSBkZi5kcm9wbmEoKQogICAgICAgIAogICAgIyBTZXQgZmVhdHVyZSB2ZWN0b3IgYW5kIGxhYmVscwogICAgeSA9IGRmLnBvcChsYWJlbF9jb2x1bW4pCiAgICBYID0gZGYKICAgIAogICAgaWYgbnAub2JqZWN0IGluIGxpc3QoWC5kdHlwZXMpIGFuZCBpZ25vcmVfdHlwZV9lcnJvcnMgaXMgRmFsc2U6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmImZlYXR1cmUgY29sdW1uKHMpIHtkZi5zZWxlY3RfZHR5cGVzKGluY2x1ZGU9WydvYmplY3QnXSkuY29sdW1ucy50b2xpc3QoKX0gbmVpdGhlciBmbG9hdCBvciBpbnQuIEZlYXR1cmUgc2VsZWN0aW9uIG5vdCBhcHBsaWNhYmxlLiAiKQogICAgICAgIAogICAgIyBDcmVhdGUgc2VsZWN0ZWQgc3RhdGlzdGljYWwgZXN0aW1hdG9ycwogICAgc3RhdF9mdW5jdGlvbnNfbGlzdCA9IHtzdGF0X25hbWU6IFNlbGVjdEtCZXN0KGNyZWF0ZV9jbGFzcyhmJ3NrbGVhcm4uZmVhdHVyZV9zZWxlY3Rpb24ue3N0YXRfbmFtZX0nKSwgaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHN0YXRfbmFtZSBpbiBzdGF0X2ZpbHRlcnN9CiAgICByZXF1aXJlc19hYnMgPSBbJ2NoaTInXQoKICAgICMgUnVuIHN0YXRpc3RpYyBmaWx0ZXJzCiAgICBzZWxlY3RlZF9mZWF0dXJlc19hZ2cgPSB7fQogICAgc3RhdHNfZGYgPSBwZC5EYXRhRnJhbWUoaW5kZXg9WC5jb2x1bW5zKS5kcm9wbmEoKQogICAgICAgICAgICAgICAgCiAgICBmb3Igc3RhdF9uYW1lLCBzdGF0X2Z1bmMgaW4gc3RhdF9mdW5jdGlvbnNfbGlzdC5pdGVtcygpOgogICAgICAgIHRyeToKICAgICAgICAgICAgcGFyYW1zID0gKFgsIHkpIGlmIHN0YXRfbmFtZSBpbiByZXF1aXJlc19hYnMgZWxzZSAoYWJzKFgpLCB5KQogICAgICAgICAgICBzdGF0ID0gc3RhdF9mdW5jLmZpdCgqcGFyYW1zKQoKICAgICAgICAgICAgIyBDb2xsZWN0IHN0YXQgZnVuY3Rpb24gcmVzdWx0cwogICAgICAgICAgICBzdGF0X2RmID0gcGQuRGF0YUZyYW1lKGluZGV4PVguY29sdW1ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5zPVtzdGF0X25hbWVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE9c3RhdC5zY29yZXNfKQogICAgICAgICAgICBwbG90X3N0YXQoY29udGV4dCwgc3RhdF9uYW1lLCBzdGF0X2RmKQogICAgICAgICAgICBzdGF0c19kZiA9IHN0YXRzX2RmLmpvaW4oc3RhdF9kZikKCiAgICAgICAgICAgICMgU2VsZWN0IEsgQmVzdCBmZWF0dXJlcwogICAgICAgICAgICBzZWxlY3RlZF9mZWF0dXJlcyA9IFguY29sdW1uc1tzdGF0X2Z1bmMuZ2V0X3N1cHBvcnQoKV0KICAgICAgICAgICAgc2VsZWN0ZWRfZmVhdHVyZXNfYWdnW3N0YXRfbmFtZV0gPSBzZWxlY3RlZF9mZWF0dXJlcwogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJDb3VsZG4ndCBjYWxjdWxhdGUge3N0YXRfbmFtZX0gYmVjYXVzZSBvZjoge2V9IikKCiAgICAjIENyZWF0ZSBtb2RlbHMgZnJvbSBjbGFzcyBuYW1lIC8ganNvbiBmaWxlIC8ganNvbiBwYXJhbXMKICAgIGFsbF9za2xlYXJuX2VzdGltYXRvcnMgPSBkaWN0KGFsbF9lc3RpbWF0b3JzKCkpIGlmIGxlbihtb2RlbF9maWx0ZXJzKSA+IDAgZWxzZSB7fQogICAgc2VsZWN0ZWRfbW9kZWxzID0ge30KICAgIGZvciBtb2RlbF9uYW1lLCBtb2RlbCBpbiBtb2RlbF9maWx0ZXJzLml0ZW1zKCk6CiAgICAgICAgaWYgJy5qc29uJyBpbiBtb2RlbDoKICAgICAgICAgICAgY3VycmVudF9tb2RlbCA9IGpzb24ubG9hZChvcGVuKG1vZGVsLCAncicpKQogICAgICAgICAgICBDbGFzc2lmaWVyQ2xhc3MgPSBjcmVhdGVfY2xhc3MoY3VycmVudF9tb2RlbFsiTUVUQSJdWyJjbGFzcyJdKQogICAgICAgICAgICBzZWxlY3RlZF9tb2RlbHNbbW9kZWxfbmFtZV0gPSBDbGFzc2lmaWVyQ2xhc3MoKipjdXJyZW50X21vZGVsWyJDTEFTUyJdKQogICAgICAgIGVsaWYgbW9kZWwgaW4gYWxsX3NrbGVhcm5fZXN0aW1hdG9yczoKICAgICAgICAgICAgc2VsZWN0ZWRfbW9kZWxzW21vZGVsX25hbWVdID0gYWxsX3NrbGVhcm5fZXN0aW1hdG9yc1ttb2RlbF9uYW1lXSgpCiAgICAgICAgICAgIAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGN1cnJlbnRfbW9kZWwgPSBqc29uLmxvYWRzKG1vZGVsKSBpZiBpc2luc3RhbmNlKG1vZGVsLCBzdHIpIGVsc2UgY3VycmVudF9tb2RlbAogICAgICAgICAgICAgICAgQ2xhc3NpZmllckNsYXNzID0gY3JlYXRlX2NsYXNzKGN1cnJlbnRfbW9kZWxbIk1FVEEiXVsiY2xhc3MiXSkKICAgICAgICAgICAgICAgIHNlbGVjdGVkX21vZGVsc1ttb2RlbF9uYW1lXSA9IENsYXNzaWZpZXJDbGFzcygqKmN1cnJlbnRfbW9kZWxbIkNMQVNTIl0pCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZid1bmFibGUgdG8gbG9hZCB7bW9kZWx9JykKCiAgICAjIFJ1biBtb2RlbCBmaWx0ZXJzCiAgICBtb2RlbHNfZGYgPSBwZC5EYXRhRnJhbWUoaW5kZXg9WC5jb2x1bW5zKQogICAgZm9yIG1vZGVsX25hbWUsIG1vZGVsIGluIHNlbGVjdGVkX21vZGVscy5pdGVtcygpOgogICAgICAgIAoKICAgICAgICBpZiBtb2RlbF9uYW1lID09ICdMb2dpc3RpY1JlZ3Jlc3Npb24nOgogICAgICAgICAgICBtb2RlbC5zZXRfcGFyYW1zKHNvbHZlcj0nbGlibGluZWFyJykKICAgICAgICAgICAgCiAgICAgICAgIyBUcmFpbiBtb2RlbCBhbmQgZ2V0IGZlYXR1cmUgaW1wb3J0YW5jZQogICAgICAgIHNlbGVjdF9mcm9tX21vZGVsID0gU2VsZWN0RnJvbU1vZGVsKG1vZGVsKS5maXQoWCwgeSkKICAgICAgICBmZWF0dXJlX2lkeCA9IHNlbGVjdF9mcm9tX21vZGVsLmdldF9zdXBwb3J0KCkKICAgICAgICBmZWF0dXJlX25hbWVzID0gWC5jb2x1bW5zW2ZlYXR1cmVfaWR4XQogICAgICAgIHNlbGVjdGVkX2ZlYXR1cmVzX2FnZ1ttb2RlbF9uYW1lXSA9IGZlYXR1cmVfbmFtZXMudG9saXN0KCkKCiAgICAgICAgIyBDb2xsZWN0IG1vZGVsIGZlYXR1cmUgaW1wb3J0YW5jZQogICAgICAgIGlmIGhhc2F0dHIoc2VsZWN0X2Zyb21fbW9kZWwuZXN0aW1hdG9yXywgJ2NvZWZfJyk6CiAgICAgICAgICAgIHN0YXRfZGYgPSBzZWxlY3RfZnJvbV9tb2RlbC5lc3RpbWF0b3JfLmNvZWZfCiAgICAgICAgZWxpZiBoYXNhdHRyKHNlbGVjdF9mcm9tX21vZGVsLmVzdGltYXRvcl8sICdmZWF0dXJlX2ltcG9ydGFuY2VzXycpOgogICAgICAgICAgICBzdGF0X2RmID0gc2VsZWN0X2Zyb21fbW9kZWwuZXN0aW1hdG9yXy5mZWF0dXJlX2ltcG9ydGFuY2VzXwoKICAgICAgICBzdGF0X2RmID0gcGQuRGF0YUZyYW1lKGluZGV4PVguY29sdW1ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbnM9W21vZGVsX25hbWVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YT1zdGF0X2RmWzBdKQogICAgICAgIG1vZGVsc19kZiA9IG1vZGVsc19kZi5qb2luKHN0YXRfZGYpCgogICAgICAgIHBsb3Rfc3RhdChjb250ZXh0LCBtb2RlbF9uYW1lLCBzdGF0X2RmKQoKICAgICMgQ3JlYXRlIGZlYXR1cmVfc2NvcmVzIERGIHdpdGggc3RhdCAmIG1vZGVsIGZpbHRlcnMgc2NvcmVzCiAgICByZXN1bHRfbWF0cml4X2RmID0gcGQuY29uY2F0KFtzdGF0c19kZiwgbW9kZWxzX2RmXSwgYXhpcz0xLCBzb3J0PUZhbHNlKQogICAgY29udGV4dC5sb2dfZGF0YXNldChrZXk9J2ZlYXR1cmVfc2NvcmVzJywKICAgICAgICAgICAgICAgICAgICAgICAgZGY9cmVzdWx0X21hdHJpeF9kZiwKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfcGF0aD0nZmVhdHVyZV9zY29yZXMucGFycXVldCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdD0ncGFycXVldCcpCiAgICBpZiBtYXhfc2NhbGVkX3Njb3JlczoKICAgICAgICBub3JtYWxpemVkX2RmID0gcmVzdWx0X21hdHJpeF9kZi5yZXBsYWNlKFtucC5pbmYsIC1ucC5pbmZdLCBucC5uYW4pLnZhbHVlcwogICAgICAgIG1pbl9tYXhfc2NhbGVyID0gTWluTWF4U2NhbGVyKCkKICAgICAgICBub3JtYWxpemVkX2RmID0gbWluX21heF9zY2FsZXIuZml0X3RyYW5zZm9ybShub3JtYWxpemVkX2RmKQogICAgICAgIG5vcm1hbGl6ZWRfZGYgPSBwZC5EYXRhRnJhbWUoZGF0YT1ub3JtYWxpemVkX2RmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1ucz1yZXN1bHRfbWF0cml4X2RmLmNvbHVtbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleD1yZXN1bHRfbWF0cml4X2RmLmluZGV4KQogICAgICAgIGNvbnRleHQubG9nX2RhdGFzZXQoa2V5PSdtYXhfc2NhbGVkX3Njb3Jlc19mZWF0dXJlX3Njb3JlcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZj1ub3JtYWxpemVkX2RmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfcGF0aD0nbWF4X3NjYWxlZF9zY29yZXNfZmVhdHVyZV9zY29yZXMucGFycXVldCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ9J3BhcnF1ZXQnKQoKICAgICMgQ3JlYXRlIGZlYXR1cmUgY291bnQgRGF0YUZyYW1lCiAgICBmb3IgdGVzdF9uYW1lIGluIHNlbGVjdGVkX2ZlYXR1cmVzX2FnZzoKICAgICAgICByZXN1bHRfbWF0cml4X2RmW3Rlc3RfbmFtZV0gPSBbMSBpZiB4IGluIHNlbGVjdGVkX2ZlYXR1cmVzX2FnZ1t0ZXN0X25hbWVdIGVsc2UgMCBmb3IgeCBpbiBYLmNvbHVtbnNdCiAgICByZXN1bHRfbWF0cml4X2RmLmxvY1s6LCAnbnVtX3ZvdGVzJ10gPSByZXN1bHRfbWF0cml4X2RmLnN1bShheGlzPTEpCiAgICBjb250ZXh0LmxvZ19kYXRhc2V0KGtleT0nc2VsZWN0ZWRfZmVhdHVyZXNfY291bnQnLAogICAgICAgICAgICAgICAgICAgICAgICBkZj1yZXN1bHRfbWF0cml4X2RmLAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9wYXRoPSdzZWxlY3RlZF9mZWF0dXJlc19jb3VudC5wYXJxdWV0JywKICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0PSdwYXJxdWV0JykKCiAgICAjIEhvdyBtYW55IHZvdGVzIGFyZSBuZWVkZWQgZm9yIGEgZmVhdHVyZSB0byBiZSBzZWxlY3RlZD8KICAgIGlmIGlzaW5zdGFuY2UobWluX3ZvdGVzLCBpbnQpOgogICAgICAgIHZvdGVzX25lZWRlZCA9IG1pbl92b3RlcwogICAgZWxzZToKICAgICAgICBudW1fZmlsdGVycyA9IGxlbihzdGF0X2ZpbHRlcnMpICsgbGVuKG1vZGVsX2ZpbHRlcnMpCiAgICAgICAgdm90ZXNfbmVlZGVkID0gaW50KG5wLmZsb29yKG51bV9maWx0ZXJzICogbWF4KG1pbihtaW5fdm90ZXMsIDEpLCAwKSkpCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYndm90ZXMgbmVlZGVkIHRvIGJlIHNlbGVjdGVkOiB7dm90ZXNfbmVlZGVkfScpCgogICAgIyBDcmVhdGUgZmluYWwgZmVhdHVyZSBkYXRhZnJhbWUKICAgIHNlbGVjdGVkX2ZlYXR1cmVzID0gcmVzdWx0X21hdHJpeF9kZltyZXN1bHRfbWF0cml4X2RmLm51bV92b3RlcyA+PSB2b3Rlc19uZWVkZWRdLmluZGV4LnRvbGlzdCgpCiAgICBnb29kX2ZlYXR1cmVfZGYgPSBkZi5sb2NbOiwgc2VsZWN0ZWRfZmVhdHVyZXNdCiAgICBmaW5hbF9kZiA9IHBkLmNvbmNhdChbZ29vZF9mZWF0dXJlX2RmLCB5XSwgYXhpcz0xKQogICAgY29udGV4dC5sb2dfZGF0YXNldChrZXk9J3NlbGVjdGVkX2ZlYXR1cmVzJywKICAgICAgICAgICAgICAgICAgICAgICAgZGY9ZmluYWxfZGYsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX3BhdGg9J3NlbGVjdGVkX2ZlYXR1cmVzLnBhcnF1ZXQnLAogICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ9J3BhcnF1ZXQnKQogICAgCiAgICAjIENyZWF0aW5nIGEgbmV3IGZlYXR1cmUgdmVjdG9yIGNvbnRhaW5pbmcgb25seSB0aGUgaWRlbnRpZmllZCB0b3AgZmVhdHVyZXMKICAgIGlmIGlzX2ZlYXR1cmVfdmVjdG9yIGFuZCBkZl9hcnRpZmFjdC5tZXRhLnNwZWMuZmVhdHVyZXMgYW5kIG91dHB1dF92ZWN0b3JfbmFtZToKCiAgICAgICAgIyBTZWxlY3RpbmcgdGhlIHRvcCBLIGZlYXR1cmVzIGZyb20gb3VyIHRvcCBmZWF0dXJlIGRhdGFmcmFtZQogICAgICAgIHNlbGVjdGVkX2ZlYXR1cmVzID0gcmVzdWx0X21hdHJpeF9kZi5oZWFkKGspLmluZGV4CgogICAgICAgICMgTWF0Y2ggdGhlIHNlbGVjdGVkIGZlYXR1cmUgbmFtZXMgdG8gdGhlIEZTIEZlYXR1cmUgYW5ub3RhdGlvbnMKICAgICAgICBtYXRjaGVkX3NlbGVjdGlvbnMgPSBbZmVhdHVyZSBmb3IgZmVhdHVyZSBpbiBsaXN0KGRmX2FydGlmYWN0Lm1ldGEuc3BlYy5mZWF0dXJlcykgZm9yIHNlbGVjdGVkIGluIGxpc3Qoc2VsZWN0ZWRfZmVhdHVyZXMpIGlmIGZlYXR1cmUuZW5kc3dpdGgoc2VsZWN0ZWQpXQoKICAgICAgICAjIERlZmluaW5nIG91ciBuZXcgZmVhdHVyZSB2ZWN0b3IKICAgICAgICB0b3BfZmVhdHVyZXNfZnYgPSBmcy5GZWF0dXJlVmVjdG9yKG91dHB1dF92ZWN0b3JfbmFtZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZWRfc2VsZWN0aW9ucywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX2ZlYXR1cmU9ImxhYmVscy5sYWJlbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uPSdmZWF0dXJlIHZlY3RvciBjb21wb3NlZCBzdHJpY3RseSBvZiBvdXIgdG9wIGZlYXR1cmVzJykKCiAgICAgICAgIyBTYXZpbmcKICAgICAgICB0b3BfZmVhdHVyZXNfZnYuc2F2ZSgpCiAgICAgICAgZnMuZ2V0X29mZmxpbmVfZmVhdHVyZXModG9wX2ZlYXR1cmVzX2Z2LCB0YXJnZXQ9UGFycXVldFRhcmdldCgpKQoKICAgICAgICAjIExvZ2dpbmcgb3VyIG5ldyBmZWF0dXJlIHZlY3RvciBVUkkKICAgICAgICBjb250ZXh0LmxvZ19yZXN1bHQoJ3RvcF9mZWF0dXJlc192ZWN0b3InLCB0b3BfZmVhdHVyZXNfZnYudXJpKQ==
    commands: []
    code_origin: feature_selection.py
    origin_filename: feature_selection.py
  mount_applied: false
  affinity: null
verbose: false

