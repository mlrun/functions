kind: job
metadata:
  name: sklearn-classifier
  tag: ''
  hash: be9e566b0f5bd148946399ec2ae927475418c815
  project: ''
  labels:
    author: yjb
    stage: development
  categories:
  - models
  - classifier
spec:
  command: ''
  args: []
  image: mlrun/ml-models:0.4.5
  env: []
  default_handler: train_model
  description: ''
  image_pull_policy: Always
  build:
    functionSourceCode: aW1wb3J0IGpzb24KaW1wb3J0IG9zCmZyb20gaW1wb3J0bGliIGltcG9ydCBpbXBvcnRfbW9kdWxlCmZyb20gaW5zcGVjdCBpbXBvcnQgZ2V0ZnVsbGFyZ3NwZWMsIEZ1bGxBcmdTcGVjCmZyb20gY2xvdWRwaWNrbGUgaW1wb3J0IGR1bXAsIGxvYWQKaW1wb3J0IGl0ZXJ0b29scwoKaW1wb3J0IHNrbGVhcm4KaW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgcHlhcnJvdyBhcyBwYQppbXBvcnQgcHlhcnJvdy5wYXJxdWV0IGFzIHBxCmltcG9ydCBudW1weSBhcyBucAppbXBvcnQgbWF0cGxvdGxpYi5weXBsb3QgYXMgcGx0CmltcG9ydCBzZWFib3JuIGFzIHNucwoKZnJvbSBza2xlYXJuLnV0aWxzLnRlc3RpbmcgaW1wb3J0IGFsbF9lc3RpbWF0b3JzCmZyb20gc2tsZWFybi5kYXRhc2V0cyBpbXBvcnQgbWFrZV9jbGFzc2lmaWNhdGlvbgpmcm9tIHNrbGVhcm4ucHJlcHJvY2Vzc2luZyBpbXBvcnQgbGFiZWxfYmluYXJpemUKZnJvbSBza2xlYXJuLm1vZGVsX3NlbGVjdGlvbiBpbXBvcnQgdHJhaW5fdGVzdF9zcGxpdApmcm9tIHNrbGVhcm4gaW1wb3J0IG1ldHJpY3MKCmZyb20gdHlwaW5nIGltcG9ydCBVbmlvbiwgTGlzdCwgQW55LCBPcHRpb25hbApmcm9tIG1scnVuLmV4ZWN1dGlvbiBpbXBvcnQgTUxDbGllbnRDdHgKZnJvbSBtbHJ1bi5kYXRhc3RvcmUgaW1wb3J0IERhdGFJdGVtCmZyb20gbWxydW4uYXJ0aWZhY3RzIGltcG9ydCBQbG90QXJ0aWZhY3QKCnNrdmVyc2lvbiA9IHNrbGVhcm4uX192ZXJzaW9uX18KCmltcG9ydCB3YXJuaW5ncwoKd2FybmluZ3Muc2ltcGxlZmlsdGVyKGFjdGlvbj0iaWdub3JlIiwgY2F0ZWdvcnk9RnV0dXJlV2FybmluZykKCgpkZWYgX2djZl9jbGVhcihwbHQpOgogICAgIiIiVXRpbGl0eSB0byBjbGVhciBtYXRwbG90bGliIGZpZ3VyZQoKICAgIFJ1biB0aGlzIGluc2lkZSBldmVyeSBwbG90IG1ldGhvZCBiZWZvcmUgY2FsbGluZyBhbnkgbWF0cGxvdGxpYgogICAgbWV0aG9kcwoKICAgIDpwYXJhbSBwbG90OiAgICBtYXRsb2JsaWIgZmlndXJlIG9iamVjdAogICAgIiIiCiAgICBwbHQuY2xhKCkKICAgIHBsdC5jbGYoKQogICAgcGx0LmNsb3NlKCkKCgpkZWYgX2NyZWF0ZV9jbGFzcyhwa2dfY2xhc3M6IHN0cik6CiAgICAiIiJDcmVhdGUgYSBjbGFzcyBmcm9tIGEgcGFja2FnZS5tb2R1bGUuY2xhc3Mgc3RyaW5nCgogICAgOnBhcmFtIHBrZ19jbGFzczogIGZ1bGwgY2xhc3MgbG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgZS5nLiAic2tsZWFybi5tb2RlbF9zZWxlY3Rpb24uR3JvdXBLRm9sZCIKICAgICIiIgogICAgc3BsaXRzID0gcGtnX2NsYXNzLnNwbGl0KCIuIikKICAgIGNsZmNsYXNzID0gc3BsaXRzWy0xXQogICAgcGtnX21vZHVsZSA9IHNwbGl0c1s6LTFdCiAgICBjbGFzc18gPSBnZXRhdHRyKGltcG9ydF9tb2R1bGUoIi4iLmpvaW4ocGtnX21vZHVsZSkpLCBjbGZjbGFzcykKICAgIHJldHVybiBjbGFzc18KCmRlZiBfY3JlYXRlX2Z1bmN0aW9uKHBrZ19mdW5jOiBsaXN0KToKICAgICIiIkNyZWF0ZSBhIGZ1bmN0aW9uIGZyb20gYSBwYWNrYWdlLm1vZHVsZS5mdW5jdGlvbiBzdHJpbmcKCiAgICA6cGFyYW0gcGtnX2Z1bmM6ICBmdWxsIGZ1bmN0aW9uIGxvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgZS5nLiAic2tsZWFybi5mZWF0dXJlX3NlbGVjdGlvbi5mX2NsYXNzaWYiCiAgICAiIiIKICAgIHNwbGl0cyA9IHBrZ19mdW5jLnNwbGl0KCIuIikKICAgIHBrZ19tb2R1bGUgPSAiLiIuam9pbihzcGxpdHNbOi0xXSkKICAgIGNiX2ZuYW1lID0gc3BsaXRzWy0xXQogICAgcGtnX21vZHVsZSA9IF9faW1wb3J0X18ocGtnX21vZHVsZSwgZnJvbWxpc3Q9W2NiX2ZuYW1lXSkKICAgIGZ1bmN0aW9uXyA9IGdldGF0dHIocGtnX21vZHVsZSwgY2JfZm5hbWUpCiAgICByZXR1cm4gZnVuY3Rpb25fCgpkZWYgZ2V0X21vZGVsX2NvbmZpZ3MoCiAgICBteV9tb2RlbHM6IFVuaW9uW3N0ciwgTGlzdFtzdHJdXSwKICAgIGNsYXNzX2tleSA9ICJDTEFTUyIsCiAgICBmaXRfa2V5ID0gIkZJVCIsCiAgICBtZXRhX2tleSA9ICJNRVRBIiwKKSAtPiBVbmlvbltkaWN0LCBMaXN0W2RpY3RdXToKICAgICIiImJ1aWxkIHNrbGVhcm4gbW9kZWwgY29uZmlndXJhdGlvbiBwYXJhbWV0ZXJzCiAgICAKICAgIFRha2UgKGZ1bGwpIGNsYXNzIG5hbWUgb2YgYW4gc2Npa2l0LWxlYXJuIG1vZGVsIAogICAgYW5kIHJldHJpZXZlIGl0cyBgY2xhc3NgIGFuZCBgZml0YCBwYXJhbWV0ZXJzIGFuZAogICAgdGhlaXIgZGVmYXVsdCB2YWx1ZXMuCiAgICAKICAgIEFsc28gcmV0dXJucyBzb21lIHVzZWZ1bCBtZXRhZGF0YSB2YWx1ZXMgZm9yIHRoZSBjbGFzcwogICAgIiIiCiAgICAjIGdldCBhIGxpc3Qgb2YgYWxsIHNrbGVhcm4gZXN0aW1hdG9ycwogICAgZXN0aW1hdG9ycyA9IGFsbF9lc3RpbWF0b3JzKCkKICAgIGRlZiBfZ2V0X2VzdGltYXRvcihwa2dfY2xhc3MpOgogICAgICAgICIiImZpbmQgYSBzcGVjaWZpYyBjbGFzcyBpbiBhIGxpc3Qgb2Ygc2tsZWFybiBlc3RpbWF0b3JzIiIiCiAgICAgICAgbXlfY2xhc3MgPSBwa2dfY2xhc3Muc3BsaXQoJy4nKVstMV0KICAgICAgICByZXR1cm4gbGlzdChmaWx0ZXIobGFtYmRhIHg6IHhbMF0gPT0gbXlfY2xhc3MsIGVzdGltYXRvcnMpKVswXQoKICAgICMgZmluZCBlc3RpbWF0b3JzIGNvcnJlc3BvbmRpbmcgdG8gbXlfbW9kZWxzIGxpc3QKICAgIG15X2VzdGltYXRvcnMgPSBbXQogICAgbXlfbW9kZWxzID0gW215X21vZGVsc10gaWYgaXNpbnN0YW5jZShteV9tb2RlbHMsIHN0cikgZWxzZSBteV9tb2RlbHMKICAgIGZvciBtb2RlbCBpbiBteV9tb2RlbHM6CiAgICAgICAgZXN0aW1hdG9yX25hbWUsIGVzdGltYXRvcl9jbGFzcyA9IF9nZXRfZXN0aW1hdG9yKG1vZGVsKQogICAgICAgIG15X2VzdGltYXRvcnMuYXBwZW5kKChlc3RpbWF0b3JfbmFtZSwgZXN0aW1hdG9yX2NsYXNzKSkKCiAgICAjIGdldCBjbGFzcyBhbmQgZml0IHNwZWNzCiAgICBlc3RpbWF0b3Jfc3BlY3MgPSBbXQogICAgZm9yIGFuX2VzdGltYXRvciBpbiBteV9lc3RpbWF0b3JzOgogICAgICAgIGVzdGltYXRvcl9zcGVjcy5hcHBlbmQoKGFuX2VzdGltYXRvclswXSwgIyBtb2RlbCBvbmx5IG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRmdWxsYXJnc3BlYyhhbl9lc3RpbWF0b3JbMV0pLCAjIGNsYXNzIHBhcmFtcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldGZ1bGxhcmdzcGVjKGFuX2VzdGltYXRvclsxXS5maXQpLCAjIGZpdCBwYXJhbXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbl9lc3RpbWF0b3JbMV0pKSAjIHBhY2thZ2UubW9kdWxlLm1vZGVsCgogICAgbW9kZWxfY29uZmlncyA9IFtdCgogICAgZm9yIGVzdGltYXRvciBpbiBlc3RpbWF0b3Jfc3BlY3M6CiAgICAgICAgbW9kZWxfanNvbiA9IHtjbGFzc19rZXk6IHt9LCBmaXRfa2V5OiB7fX0KICAgICAgICBmaXRfcGFyYW1zID0ge30KCiAgICAgICAgZm9yIGksIGtleSBpbiBlbnVtZXJhdGUobW9kZWxfanNvbi5rZXlzKCkpOgogICAgICAgICAgICBmID0gZXN0aW1hdG9yW2krMV0KICAgICAgICAgICAgYXJnc19wYWlyZWQgPSBbXQogICAgICAgICAgICBkZWZzX3BhaXJlZCA9IFtdCgogICAgICAgICAgICAjIHJldmVyc2UgdGhlIGFyZ3Mgc2luY2UgdGhlcmUgYXJlIGZld2VyIGRlZmF1bHRzIHRoYW4gYXJncwogICAgICAgICAgICBhcmdzID0gZi5hcmdzCiAgICAgICAgICAgIGFyZ3MucmV2ZXJzZSgpCiAgICAgICAgICAgIG5fYXJncyA9IGxlbihhcmdzKQoKICAgICAgICAgICAgZGVmcyA9IGYuZGVmYXVsdHMKICAgICAgICAgICAgaWYgZGVmcyBpcyBOb25lOgogICAgICAgICAgICAgICAgZGVmcyA9IFtkZWZzXQogICAgICAgICAgICBkZWZzID0gbGlzdChkZWZzKQogICAgICAgICAgICBkZWZzLnJldmVyc2UoKQogICAgICAgICAgICBuX2RlZnMgPSBsZW4oZGVmcykKCiAgICAgICAgICAgIG5fc21hbGxlc3QgPSBtaW4obl9hcmdzLCBuX2RlZnMpCiAgICAgICAgICAgIG5fbGFyZ2VzdCA9IG1heChuX2FyZ3MsIG5fZGVmcykKCiAgICAgICAgICAgICMgYnVpbGQgMiBsaXN0cyB0aGF0IGNhbiBiZSBjb25jYXRlbmF0ZWQKICAgICAgICAgICAgZm9yIGl4IGluIHJhbmdlKG5fc21hbGxlc3QpOgogICAgICAgICAgICAgICAgaWYgYXJnc1tpeF0gaXMgbm90ICJzZWxmIjoKICAgICAgICAgICAgICAgICAgICBhcmdzX3BhaXJlZC5hcHBlbmQoYXJnc1tpeF0pCiAgICAgICAgICAgICAgICAgICAgZGVmc19wYWlyZWQuYXBwZW5kKGRlZnNbaXhdKQoKICAgICAgICAgICAgZm9yIGl4IGluIHJhbmdlKG5fc21hbGxlc3QsIG5fbGFyZ2VzdCk6CiAgICAgICAgICAgICAgICBpZiBpeCBpcyBub3QgMCBhbmQgYXJnc1tpeF0gaXMgbm90ICJzZWxmIjoKICAgICAgICAgICAgICAgICAgICBhcmdzX3BhaXJlZC5hcHBlbmQoYXJnc1tpeF0pCiAgICAgICAgICAgICAgICAgICAgZGVmc19wYWlyZWQuYXBwZW5kKE5vbmUpCiAgICAgICAgICAgICAgICMgY29uY2F0ZW5hdGUgbGlzdHMgaW50byBhcHByb3ByaWF0ZSBzdHJ1Y3R1cmUKICAgICAgICAgICAgbW9kZWxfanNvbltrZXldID0gZGljdCh6aXAocmV2ZXJzZWQoYXJnc19wYWlyZWQpLCByZXZlcnNlZChkZWZzX3BhaXJlZCkpKQoKICAgICAgICBtb2RlbF9qc29uW21ldGFfa2V5XSA9IHt9CiAgICAgICAgbW9kZWxfanNvblttZXRhX2tleV1bJ3NrbGVhcm5fdmVyc2lvbiddID0gc2t2ZXJzaW9uCiAgICAgICAgbW9kZWxfanNvblttZXRhX2tleV1bJ2NsYXNzJ10gPSAnLicuam9pbihbZXN0aW1hdG9yWzNdLl9fbW9kdWxlX18sIGVzdGltYXRvclswXV0pCiAgICAgICAgbW9kZWxfY29uZmlncy5hcHBlbmQobW9kZWxfanNvbikKICAgIGlmIGxlbihtb2RlbF9jb25maWdzKSA9PSAxOgogICAgICAgICMgZG8gd2Ugd2FudCB0byBsb2cgdGhpcyBtb2RpZmllZCBtb2RlbCBhcyBhbiBhcnRpZmFjdD8KICAgICAgICByZXR1cm4gbW9kZWxfY29uZmlnc1swXQogICAgZWxzZToKICAgICAgICAjIGRvIHdlIHdhbnQgdG8gbG9nIHRoaXMgbW9kaWZpZWQgbW9kZWwgYXMgYW4gYXJ0aWZhY3Q/CiAgICAgICAgcmV0dXJuIG1vZGVsX2NvbmZpZ3MKCmRlZiB1cGRhdGVfbW9kZWxfY29uZmlnKAogICAgY29uZmlnOiBkaWN0LAogICAgbmV3X2NsYXNzOiBkaWN0LAogICAgbmV3X2ZpdDogZGljdCwKICAgIGNsYXNzX2tleTogc3RyID0gIkNMQVNTIiwKICAgIGZpdF9rZXk6IHN0ciA9ICJGSVQiCik6CiAgICAiIiJVcGRhdGUgbW9kZWwgY29uZmlnIGpzb24KICAgIAogICAgTm90IHVzZWQgdW50aWwgd2UgcmVmYWN0b3IgYXMgcGVyIHRoZSBUT0RPCiAgICAgICAgCiAgICBUaGlzIGZ1bmN0aW9uIGlzIGVzc2VudGlhbCBzaW5jZSB0aGVyZSBhcmUgbW9kaWZpY2F0aW9ucyBpbiBjbGFzcwogICAgYW5kIGZpdCBwYXJhbXMgdGhhdCBtdXN0IGJlIG1hZGUgKGNhbGxiYWNrcyBhcmUgYSBnb29kIGV4YW1wbGUsIHdpdGhvdXQKICAgIHdoaWNoIHRoZXJlIGlzIG5vIHRyYWluaW5nIGhpc3RvcnkgYXZhaWxhYmxlKQogICAgCiAgICBUT0RPOiAgY3VycmVudGx5IGEgbW9kZWwgY29uZmlnIGNvbnRhaW5zIDIga2V5cywgYnV0IHRoaXMgd2lsbCBsaWtlbHkKICAgIGV4cGFuZCB0byBpbmNsdWRlIG90aGVyIGZ1bmN0aW9ucyBiZXlvbmQgY2xhc3MgYW5kIGZpdC4gU28gbmVlZCB0byBleHBhbmQgCiAgICB0aGlzIHRvIGEgbGlzdCBvZiBUdXBsZShzdHIsIGRpY3QpLCB3aGVyZSBgc3RyYCBjb3JyZXNwb25kcyB0byBhIGtleQogICAgaW4gdGhlIG1vZGVsIGNvbmZpZyBhbmQgYGRpY3RgIGNvbnRhaW5zIHRoZSBwYXJhbXMgYW5kIHRoZWlyIG5ldyB2YWx1ZXMuCiAgICAKICAgIDpwYXJhbSBjb25maWc6ICAgICAgb3JpZ2luYWwgbW9kZWwgZGVmaW5pdGlvbiBjb250YWluaW5nIDIga2V5cywgQ0xBU1MgYW5kIEZJVAogICAgOnBhcmFtIG5ld19jbGFzczogICBuZXcgY2xhc3Mga2V5LXZhbHVlcwogICAgOnBhcmFtIG5ld19maXQ6ICAgICBuZXcgZml0IGtleS12YWx1ZXMKICAgICIiIgogICAgY29uZmlnW2NsYXNzX2tleV0udXBkYXRlKG5ld19jbGFzcykKICAgIGNvbmZpZ1tmaXRfa2V5XS51cGRhdGUobmV3X2ZpdCkKICAgIAogICAgcmV0dXJuIGNvbmZpZwoKZGVmIHRyYWluX21vZGVsKAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBtb2RlbF9wa2dfY2xhc3M6IHN0ciwKICAgIGRhdGFfa2V5OiBVbmlvbltEYXRhSXRlbSwgc3RyXSwKICAgIHNhbXBsZTogaW50LAogICAgbGFiZWxfY29sdW1uOiBzdHIsCiAgICBtb2RlbF9rZXk6IHN0ciA9ICJtb2RlbCIsCiAgICB0ZXN0X3NpemU6IGZsb2F0ID0gMC4wNSwKICAgIHRyYWluX3ZhbF9zcGxpdDogZmxvYXQgPSAwLjc1LAogICAgdGVzdF9zZXRfa2V5OiBzdHIgPSAidGVzdF9zZXQiLAogICAgcm5nOiBpbnQgPSAxLAogICAgbW9kZWxzX2Rpcjogc3RyID0gIm1vZGVscyIsCiAgICBwbG90c19kaXI6IHN0ciA9ICJwbG90cyIsCiAgICBzY29yZV9tZXRob2Q6IHN0ciA9ICJtaWNybyIsCiAgICBjbGFzc19wYXJhbXNfdXBkYXRlczogVW5pb25bRGF0YUl0ZW0sIGRpY3RdID0ge30sCiAgICBmaXRfcGFyYW1zX3VwZGF0ZXM6IFVuaW9uW0RhdGFJdGVtLCBkaWN0XSA9IHt9LAopIC0+IE5vbmU6CiAgICAiIiJ0cmFpbiBhIGNsYXNzaWZpZXIuCgogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgICB0aGUgZnVuY3Rpb24gY29udGV4dAogICAgOnBhcmFtIG1vZGVsX3BrZ19jbGFzczogICB0aGUgbW9kZWwgdG8gdHJhaW4sIGUuZywgJ3NrbGVhcm4ubmV1cmFsX25ldHdvcmtzLk1MUENsYXNzaWZpZXInCiAgICA6cGFyYW0gZGF0YV9rZXk6ICAgICAgICAgICgicmF3IikgbmFtZSBvZiByYXcgZGF0YSBmaWxlCiAgICA6cGFyYW0gc2FtcGxlOiAgICAgICAgICAgIFNlbGVjdHMgdGhlIGZpcnN0IG4gcm93cywgb3Igc2VsZWN0IGEgc2FtcGxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0aW5nIGZyb20gdGhlIGZpcnN0LiBJZiBuZWdhdGl2ZSA8LTEsIHNlbGVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhIHJhbmRvbSBzYW1wbGUKICAgIDpwYXJhbSBsYWJlbF9jb2x1bW46ICAgICAgZ3JvdW5kLXRydXRoICh5KSBsYWJlbHMKICAgIDpwYXJhbSBtb2RlbF9rZXk6ICAgICAgICAgKCdtb2RlbCcpIG5hbWUgb2YgbW9kZWwgaW4gYXJ0aWZhY3Qgc3RvcmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyB0byBhIGRpcmVjdG9yeQogICAgOnBhcmFtIHRlc3Rfc2l6ZTogICAgICAgICAoMC4wNSkgdGVzdCBzZXQgc2l6ZQogICAgOnBhcmFtIHRyYWluX3ZhbF9zcGxpdDogICAoMC43NSkgT25jZSB0aGUgdGVzdCBzZXQgaGFzIGJlZW4gcmVtb3ZlZCB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhaW5pbmcgc2V0IGdldHMgdGhpcyBwcm9wb3J0aW9uLgogICAgOnBhcmFtIHRlc3Rfc2V0X2tleTogICAgICBzdG9yZSB0aGUgdGVzdCBkYXRhIHNldCB1bmRlciB0aGlzIGtleSBpbiB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJ0aWZhY3Qgc3RvcmUKICAgIDpwYXJhbSBybmc6ICAgICAgICAgICAgICAgKDEpIHNrbGVhcm4gcm5nIHNlZWQKICAgIDpwYXJhbSBtb2RlbHNfZGlyOiAgICAgICAgbW9kZWxzIHN1YmZvbGRlciBvbiBhcnRpZmFjdCBwYXRoCiAgICA6cGFyYW0gcGxvdHNfZGlyOiAgICAgICAgIHBsb3Qgc3ViZm9sZGVyIG9uIGFydGlmYWN0IHBhdGgKICAgIDpwYXJhbSBzY29yZV9tZXRob2Q6ICAgICAgZm9yIG11bHRpY2xhc3MgY2xhc3NpZmljYXRpb24KICAgIDpwYXJhbSBjbGFzc191cGRhdGVzOiAgICAgdXBkYXRlIHRoZXNlIHNjaWtpdC1sZWFybiBjbGFzc2lmaWVyIHBhcmFtcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQgYXMgYSBkaWN0CiAgICA6cGFyYW0gZml0X3VwZGF0ZXM6ICAgICAgIHVwZGF0ZSBzY2lraXQtbGVhcm4gZml0IHBhcmFtZXRlcnMsIGlucHV0IGFzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgZGljdC4KICAgICIiIgogICAgYmFzZV9wYXRoID0gY29udGV4dC5hcnRpZmFjdF9wYXRoCiAgICBvcy5tYWtlZGlycyhiYXNlX3BhdGgsIGV4aXN0X29rPVRydWUpCiAgICBvcy5tYWtlZGlycyhvcy5wYXRoLmpvaW4oYmFzZV9wYXRoLCBwbG90c19kaXIpLCBleGlzdF9vaz1UcnVlKQogICAgb3MubWFrZWRpcnMob3MucGF0aC5qb2luKGJhc2VfcGF0aCwgbW9kZWxzX2RpciksIGV4aXN0X29rPVRydWUpCiAgICAKICAgICMgZXh0cmFjdCBmaWxlIG5hbWUgZnJvbSBEYXRhSXRlbQogICAgc3JjZmlsZXBhdGggPSBzdHIoZGF0YV9rZXkpCiAgICAKICAgICMgVE9ETzogdGhpcyBzaG91bGQgYmUgcGFydCBvZiBkYXRhJ3MgbWV0YWRhdGEgZGVhbHQgd2l0aCBpbiBhbm90aGVyIHN0ZXAgZ2V0IGEgZGF0YSBzZXQsIHNhbXBsZSwgZXRjLi4uCiAgICAjIGdldCBhbGwgZGF0YSBvciBhIHNhbXBsZQogICAgaWYgKHNhbXBsZSA9PSAtMSkgb3IgKHNhbXBsZSA+PSAxKToKICAgICAgICAjIGdldCBhbGwgcm93cywgb3IgY29udGlndW91cyBzYW1wbGUgc3RhcnRpbmcgYXQgcm93IDEuCiAgICAgICAgcmF3ID0gcHEucmVhZF90YWJsZShzcmNmaWxlcGF0aCkudG9fcGFuZGFzKCkuZHJvcG5hKCkKICAgICAgICBsYWJlbHMgPSByYXcucG9wKGxhYmVsX2NvbHVtbikKICAgICAgICByYXcgPSByYXcuaWxvY1s6c2FtcGxlLCA6XQogICAgICAgIGxhYmVscyA9IGxhYmVscy5pbG9jWzpzYW1wbGVdCiAgICBlbHNlOgogICAgICAgICMgZ3JhYiBhIHJhbmRvbSBzYW1wbGUKICAgICAgICByYXcgPSBwcS5yZWFkX3RhYmxlKHNyY2ZpbGVwYXRoKS50b19wYW5kYXMoKS5kcm9wbmEoKS5zYW1wbGUoc2FtcGxlICogLTEpCiAgICAgICAgbGFiZWxzID0gcmF3LnBvcChsYWJlbF9jb2x1bW4pCgogICAgIyBUT0RPOiB0aGlzIHNob3VsZCBiZSBwYXJ0IG9mIGRhdGEncyBtZXRhZGF0YSBkZWFsdCB3aXRoIGluIGFub3RoZXIgc3RlcAogICAgY29udGV4dC5oZWFkZXIgPSByYXcuY29sdW1ucy52YWx1ZXMKICAgIAogICAgIyBUT0RPOiBhbGwgb2YgdGhpcyBzaG91bGQgYmUgcGFydCBvZiBhIHNwaXR0ZXIgY29tcG9uZW50IHRoYXQgZG9lcyBjdiB0b28sIGRlYWx0IHdpdGggaW4gYW5vdGhlciBzdGVwCiAgICAjIG1ha2UgYSBob3QgZW5jb2RlIGNvcHkgb2YgbGFiZWxzIGJlZm9yZSB0aGUgc3BsaXQKICAgIHliID0gbGFiZWxfYmluYXJpemUobGFiZWxzLCBjbGFzc2VzPWxpc3QocmFuZ2UocmF3LnNoYXBlWzFdKSkpCiAgICAjIGRvdWJsZSBzcGxpdCB0byBnZW5lcmF0ZSAzIGRhdGEgc2V0czogdHJhaW4sIHZhbGlkYXRpb24gYW5kIHRlc3QKICAgICMgd2l0aCB4dGVzdCx5dGVzdCBzZXQgYXNpZGUKICAgIHgsIHh0ZXN0LCB5LCB5dGVzdCA9IHRyYWluX3Rlc3Rfc3BsaXQobnAuY29uY2F0ZW5hdGUoW3JhdywgeWJdLCBheGlzPTEpLCBsYWJlbHMsIHRlc3Rfc2l6ZT10ZXN0X3NpemUsIHJhbmRvbV9zdGF0ZT1ybmcpCiAgICB4dHJhaW4sIHh2YWxpZCwgeXRyYWluLCB5dmFsaWQgPSB0cmFpbl90ZXN0X3NwbGl0KHgsIHksIHRyYWluX3NpemU9dHJhaW5fdmFsX3NwbGl0LCByYW5kb21fc3RhdGU9cm5nKQogICAgIyBleHRyYWN0IHRoZSBob3RfZW5jb2RlZCBsYWJlbHMKICAgIHl0cmFpbmIgPSB4dHJhaW5bOiwgLXliLnNoYXBlWzFdOl0uY29weSgpCiAgICB4dHJhaW4gPSB4dHJhaW5bOiwgOi15Yi5zaGFwZVsxXV0uY29weSgpCiAgICAjIGV4dHJhY3QgdGhlIGhvdF9lbmNvZGVkIGxhYmVscwogICAgeXZhbGlkYiA9IHh2YWxpZFs6LCAteWIuc2hhcGVbMV06XS5jb3B5KCkKICAgIHh2YWxpZCA9IHh2YWxpZFs6LCA6LXliLnNoYXBlWzFdXS5jb3B5KCkKICAgICMgZXh0cmFjdCB0aGUgaG90X2VuY29kZWQgbGFiZWxzCiAgICB5dGVzdGIgPSB4dGVzdFs6LCAteWIuc2hhcGVbMV06XS5jb3B5KCkKICAgIHh0ZXN0ID0geHRlc3RbOiwgOi15Yi5zaGFwZVsxXV0uY29weSgpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICMgc2V0LWFzaWRlIHRlc3Rfc2V0CiAgICB0ZXN0X3NldCA9IHBkLmNvbmNhdCgKICAgICAgICBbcGQuRGF0YUZyYW1lKGRhdGE9eHRlc3QsIGNvbHVtbnM9Y29udGV4dC5oZWFkZXIpLAogICAgICAgICBwZC5EYXRhRnJhbWUoZGF0YT15dGVzdCwgY29sdW1ucz1bbGFiZWxfY29sdW1uXSldLAogICAgICAgIGF4aXM9MSwpCiAgICBmaWxlcGF0aCA9IG9zLnBhdGguam9pbihiYXNlX3BhdGgsIHRlc3Rfc2V0X2tleSArICIucHF0IikKICAgIHRlc3Rfc2V0LnRvX3BhcnF1ZXQoZmlsZXBhdGgsIGluZGV4PUZhbHNlKQogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QodGVzdF9zZXRfa2V5LCBsb2NhbF9wYXRoPXRlc3Rfc2V0X2tleSArICIucHF0IikKCiAgICAjIGxvYWQgdGhlIG1vZGVsIGNvbmZpZwogICAgbW9kZWxfY29uZmlnID0gZ2V0X21vZGVsX2NvbmZpZ3MobW9kZWxfcGtnX2NsYXNzKQogICAgIyBnZXQgdXBkYXRlIHBhcmFtcyBpZiBhbnkKICAgIGlmIGlzaW5zdGFuY2UoY2xhc3NfcGFyYW1zX3VwZGF0ZXMsIERhdGFJdGVtKToKICAgICAgICBjbGFzc19wYXJhbXNfdXBkYXRlcyA9IGpzb24ubG9hZHMoY2xhc3NfcGFyYW1zX3VwZGF0ZXMuZ2V0KCkpCiAgICBpZiBpc2luc3RhbmNlKGZpdF9wYXJhbXNfdXBkYXRlcywgRGF0YUl0ZW0pOgogICAgICAgIGZpdF9wYXJhbXNfdXBkYXRlcyA9IGpzb24ubG9hZHMoZml0X3BhcmFtc191cGRhdGVzLmdldCgpKQogICAgIyB1cGRhdGUgdGhlIHBhcmFtZXRlcnMgICAgICAgICAgICAKICAgICMgYWRkIGRhdGEgdG8gZml0IHBhcmFtcwogICAgZml0X3BhcmFtc191cGRhdGVzLnVwZGF0ZSh7J1gnOiB4dHJhaW4sJ3knOiB5dHJhaW4udmFsdWVzfSkKICAgIAogICAgbW9kZWxfY29uZmlnWyJDTEFTUyJdLnVwZGF0ZShjbGFzc19wYXJhbXNfdXBkYXRlcykKICAgIG1vZGVsX2NvbmZpZ1siRklUIl0udXBkYXRlKGZpdF9wYXJhbXNfdXBkYXRlcykKICAgIAogICAgIyBjcmVhdGUgY2xhc3MgYW5kIGZpdAogICAgQ2xhc3NpZmllckNsYXNzID0gX2NyZWF0ZV9jbGFzcyhtb2RlbF9jb25maWdbIk1FVEEiXVsiY2xhc3MiXSkKICAgIG1vZGVsID0gQ2xhc3NpZmllckNsYXNzKCoqbW9kZWxfY29uZmlnWyJDTEFTUyJdKQogICAgcHJpbnQobW9kZWxfY29uZmlnWyJGSVQiXSkKICAgIG1vZGVsLmZpdCgqKm1vZGVsX2NvbmZpZ1siRklUIl0pCgogICAgIyBzYXZlIG1vZGVsCiAgICBmaWxlcGF0aCA9IG9zLnBhdGguam9pbihiYXNlX3BhdGgsIGYie21vZGVsc19kaXJ9L3ttb2RlbF9rZXl9LnBrbCIpCiAgICB0cnk6CiAgICAgICAgZHVtcChtb2RlbCwgb3BlbihmaWxlcGF0aCwgIndiIikpCiAgICAgICAgY29udGV4dC5sb2dfYXJ0aWZhY3QobW9kZWxfa2V5LCBsb2NhbF9wYXRoPW1vZGVsc19kaXIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoJ1NFUklBTElaRSBNT0RFTCBFUlJPUjonLCBzdHIoZSkpCgogICAgIyBjb21wdXRlIHZhbGlkYXRpb24gbWV0cmljcwogICAgeXByZWQgPSBtb2RlbC5wcmVkaWN0KHh2YWxpZCkKICAgIHlfc2NvcmUgPSBtb2RlbC5wcmVkaWN0X3Byb2JhKHh2YWxpZCkKCiAgICBhdmVyYWdlX3ByZWNpc2lvbiA9IGF2ZXJhZ2VfcHJlY2lzaW9uX3Njb3JlKHl2YWxpZGIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlfc2NvcmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2ZXJhZ2U9c2NvcmVfbWV0aG9kKQoKICAgIGNvbnRleHQubG9nX3Jlc3VsdChmImFjY3VyYWN5IiwgZmxvYXQobW9kZWwuc2NvcmUoeHZhbGlkLCB5dmFsaWQpKSkKICAgIGNvbnRleHQubG9nX3Jlc3VsdChmInJvY2F1YyIsIHJvY19hdWNfc2NvcmUoeXZhbGlkYiwgeV9zY29yZSkpCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJmMV9zY29yZSIsIGYxX3Njb3JlKHl2YWxpZCwgeXByZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2ZXJhZ2U9c2NvcmVfbWV0aG9kKSkKICAgIGNvbnRleHQubG9nX3Jlc3VsdChmImF2Z19wcmVjc2NvcmUiLCBhdmVyYWdlX3ByZWNpc2lvbikKCiAgICAjIHZhbGlkYXRpb24gcGxvdHMKICAgIAogICAgcGxvdF9yb2MoY29udGV4dCwgeXZhbGlkYiwgeV9zY29yZSkKICAgIHBsb3RfY29uZnVzaW9uX21hdHJpeChjb250ZXh0LCB5dmFsaWQsIHlwcmVkLCBrZXk9ImNvbmZ1c2lvbiIsIGZtdD0icG5nIikKCmRlZiBwbG90X3JvYygKICAgIGNvbnRleHQsCiAgICB5X2xhYmVscywKICAgIHlfcHJvYnMsCiAgICBrZXk9InJvYyIsCiAgICBwbG90c19kaXI6IHN0ciA9ICJwbG90cyIsCiAgICBmbXQ9InBuZyIsCiAgICB4X2xhYmVsOiBzdHIgPSAiZmFsc2UgcG9zaXRpdmUgcmF0ZSIsCiAgICB5X2xhYmVsOiBzdHIgPSAgInRydWUgcG9zaXRpdmUgcmF0ZSIsCiAgICB0aXRsZTogc3RyID0gInJvYyBjdXJ2ZSIsCiAgICBsZWdlbmRfbG9jOiBzdHIgPSAiYmVzdCIKKToKICAgICIiInBsb3Qgcm9jIGN1cnZlcwogICAgCiAgICBUT0RPOiAgYWRkIGF2ZXJhZ2luZyBtZXRob2QgKGFzIHN0cmluZykgdGhhdCB3YXMgdXNlZCB0byBjcmVhdGUgcHJvYnMsIAogICAgZGlzcGxheSBpbiBsZWdlbmQKICAgIAogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgdGhlIGZ1bmN0aW9uIGNvbnRleHQKICAgIDpwYXJhbSB5X2xhYmVsczogICAgIGdyb3VuZCB0cnV0aCBsYWJlbHMsIGhvdCBlbmNvZGVkIGZvciBtdWx0aWNsYXNzICAKICAgIDpwYXJhbSB5X3Byb2JzOiAgICAgIG1vZGVsIHByZWRpY3Rpb24gcHJvYmFiaWxpdGllcwogICAgOnBhcmFtIGtleTogICAgICAgICAgKCJyb2MiKSBrZXkgb2YgcGxvdCBpbiBhcnRpZmFjdCBzdG9yZQogICAgOnBhcmFtIHBsb3RzX2RpcjogICAgKCJwbG90cyIpIGRlc3RpbmF0aW9uIGZvbGRlciByZWxhdGl2ZSBwYXRoIHRvIGFydGlmYWN0IHBhdGgKICAgIDpwYXJhbSBmbXQ6ICAgICAgICAgICgicG5nIikgcGxvdCBmb3JtYXQKICAgIDpwYXJhbSB4X2xhYmVsOiAgICAgICgiZmFsc2UgcG9zaXRpdmUgcmF0ZSIpIHgtYXhpcyBsYWJlbHMKICAgIDpwYXJhbSB5X2xhYmVsOiAgICAgICgidHJ1ZSBwb3NpdGl2ZSByYXRlIikgeS1heGlzIGxhYmVscwogICAgOnBhcmFtIHRpdGxlOiAgICAgICAgKCJyb2MgY3VydmUiKSB0aXRsZSBvZiBwbG90CiAgICA6cGFyYW0gbGVnZW5kX2xvYzogICAoImJlc3QiKSBsb2NhdGlvbiBvZiBwbG90IGxlZ2VuZAogICAgIiIiCiAgICAjIGRvbid0IGJvdGhlciBpZiB0aGlzIGRvZXNuJ3Qgd29yawogICAgYXNzZXJ0IHlfcHJvYnMuc2hhcGUgPT0geV9sYWJlbHMuc2hhcGUKICAgIAogICAgIyBjbGVhciBtYXRwbG90bGliIGN1cnJlbnQgZmlndXJlCiAgICBfZ2NmX2NsZWFyKHBsdCkKICAgIAogICAgIyBkYXRhIGFjY3VtbXVsYXRvcnMgYnkgY2xhc3MKICAgIGZwciA9IGRpY3QoKQogICAgdHByID0gZGljdCgpCiAgICByb2NfYXVjID0gZGljdCgpCiAgICAKICAgICMgZHJhdyA0NSBkZWdyZWUgbGluZQogICAgcGx0LnBsb3QoWzAsIDFdLCBbMCwgMV0sICJrLS0iKQogICAgCiAgICAjIGxhYmVsbGluZwogICAgcGx0LnhsYWJlbCh4X2xhYmVsKQogICAgcGx0LnlsYWJlbCh5X2xhYmVsKQogICAgcGx0LnRpdGxlKHRpdGxlKQogICAgcGx0LmxlZ2VuZChsb2M9bGVnZW5kX2xvYykKICAgIAogICAgIyBzaW5nbGUgUk9DIG9yIG11dGxpcGxlCiAgICBmb3IgaSBpbiByYW5nZSh5X2xhYmVscy5zaGFwZVsxXSk6CiAgICAgICAgZnByW2ldLCB0cHJbaV0sIF8gPSBtZXRyaWNzLnJvY19jdXJ2ZSh5X2xhYmVsc1s6LCBpXSwgeV9wcm9ic1s6LCBpXSwgcG9zX2xhYmVsPTEpCiAgICAgICAgcm9jX2F1Y1tpXSA9IG1ldHJpY3MuYXVjKGZwcltpXSwgdHByW2ldKQogICAgICAgIHBsdC5wbG90KGZwcltpXSwgdHByW2ldLCBsYWJlbD1mImNsYXNzIHtpfSIpCgogICAgZm5hbWUgPSBmIntwbG90c19kaXJ9L3trZXl9LntmbXR9IgogICAgcGx0LnNhdmVmaWcob3MucGF0aC5qb2luKGNvbnRleHQuYXJ0aWZhY3RfcGF0aCwgZm5hbWUpKQogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoUGxvdEFydGlmYWN0KGtleSwgYm9keT1wbHQuZ2NmKCkpLCBsb2NhbF9wYXRoPWZuYW1lKQogICAgCgpkZWYgcGxvdF9jb25mdXNpb25fbWF0cml4KAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBsYWJlbHMsCiAgICBwcmVkaWN0aW9ucywKICAgIGtleTogc3RyID0gImNvbmZ1c2lvbl9tYXRyaXgiLAogICAgcGxvdHNfZGlyOiBzdHIgPSAicGxvdHMiLAogICAgY29sb3JtYXA6IHN0ciA9ICJCbHVlcyIsCiAgICBmbXQ6IHN0ciA9ICJwbmciLAogICAgc2FtcGxlX3dlaWdodD1Ob25lCik6CiAgICAiIiJDcmVhdGUgYSBjb25mdXNpb24gbWF0cml4LgogICAgUGxvdCBhbmQgc2F2ZSBhIGNvbmZ1c2lvbiBtYXRyaXggdXNpbmcgdGVzdCBkYXRhIGZyb20gYQogICAgbW9kZWxsaW5lIHN0ZXAuCiAgICAKICAgIFNlZSBodHRwczovL3NjaWtpdC1sZWFybi5vcmcvc3RhYmxlL21vZHVsZXMvZ2VuZXJhdGVkL3NrbGVhcm4ubWV0cmljcy5jb25mdXNpb25fbWF0cml4Lmh0bWwKICAgIAogICAgVE9ETzogZml4IGxhYmVsIGFsaWdubWVudAogICAgVE9ETzogY29uc2lkZXIgdXNpbmcgYW5vdGhlciBwYWNrYWdlZCB2ZXJzaW9uCiAgICBUT0RPOiByZWZhY3RvciB0byB0YWtlIHBhcmFtcyBkaWN0IGZvciBwbG90IG9wdGlvbnMKCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0gbGFiZWxzOiAgICAgICAgICB2YWxpZGF0aW9uIGRhdGEgZ3JvdW5kLXRydXRoIGxhYmVscwogICAgOnBhcmFtIHByZWRpY3Rpb25zOiAgICAgdmFsaWRhdGlvbiBkYXRhIHByZWRpY3Rpb25zCiAgICA6cGFyYW0ga2V5OiAgICAgICAgICAgICBzdHIKICAgIDpwYXJhbSBwbG90c19kaXI6ICAgICAgIHJlbGF0aXZlIHBhdGggb2YgcGxvdHMgaW4gYXJ0aWZhY3Qgc3RvcmUKICAgIDpwYXJhbSBjb2xvcm1hcDogICAgICAgIGNvbG91cm1hcCBmb3IgY29uZnVzaW9uIG1hdHJpeAogICAgOnBhcmFtIGZtdDogICAgICAgICAgICAgcGxvdCBmb3JtYXQKICAgIDpwYXJhbSBzYW1wbGVfd2VpZ2h0OiAgIHNhbXBsZSB3ZWlnaHRzCiAgICAiIiIKICAgIF9nY2ZfY2xlYXIocGx0KQogICAgCiAgICBjbSA9IG1ldHJpY3MuY29uZnVzaW9uX21hdHJpeChsYWJlbHMsIHByZWRpY3Rpb25zLCBzYW1wbGVfd2VpZ2h0PU5vbmUpCiAgICBzbnMuaGVhdG1hcChjbSwgYW5ub3Q9VHJ1ZSwgY21hcD1jb2xvcm1hcCwgc3F1YXJlPVRydWUpCgogICAgZmlnID0gcGx0LmdjZigpCiAgICBmbmFtZSA9IGYie3Bsb3RzX2Rpcn0ve2tleX0ue2ZtdH0iCiAgICBmaWcuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oY29udGV4dC5hcnRpZmFjdF9wYXRoLCBmbmFtZSkpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3Qoa2V5LCBib2R5PWZpZyksIGxvY2FsX3BhdGg9Zm5hbWUpCg==
    commands: []
    code_origin: https://github.com/mlrun/functions.git#5c95d4ce87da0415de95bf702e4a6f18467bd105:sklearn_classifier/sklearn_classifier.py
