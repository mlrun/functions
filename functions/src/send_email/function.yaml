metadata:
  tag: ''
  name: send-email
  categories:
  - utils
verbose: false
kind: job
spec:
  image: mlrun/mlrun
  disable_auto_mount: false
  build:
    origin_filename: ''
    functionSourceCode: IyBDb3B5cmlnaHQgMjAxOSBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiMKIyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiMgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKIyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KIyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiMgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiMKIyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IG1pbWV0eXBlcwppbXBvcnQgb3MKaW1wb3J0IHNtdHBsaWIKZnJvbSBlbWFpbC5tZXNzYWdlIGltcG9ydCBFbWFpbE1lc3NhZ2UKCmZyb20gbWxydW4uZXhlY3V0aW9uIGltcG9ydCBNTENsaWVudEN0eAoKCmRlZiBzZW5kX2VtYWlsKAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBzZW5kZXI6IHN0ciwKICAgIHRvOiBzdHIsCiAgICBzdWJqZWN0OiBzdHIsCiAgICBjb250ZW50OiBzdHIgPSAiIiwKICAgIHNlcnZlcl9hZGRyOiBzdHIgPSBOb25lLAogICAgYXR0YWNobWVudHM6IGxpc3Rbc3RyXSA9IFtdLAopIC0+IE5vbmU6CiAgICAiIiJTZW5kIGFuIGVtYWlsLgogICAgOnBhcmFtIHNlbmRlcjogU2VuZGVyIGVtYWlsIGFkZHJlc3MKICAgIDpwYXJhbSBjb250ZXh0OiBUaGUgZnVuY3Rpb24gY29udGV4dAogICAgOnBhcmFtIHRvOiBFbWFpbCBhZGRyZXNzIG9mIG1haWwgcmVjaXBpZW50CiAgICA6cGFyYW0gc3ViamVjdDogRW1haWwgc3ViamVjdAogICAgOnBhcmFtIGNvbnRlbnQ6IE9wdGlvbmFsIG1haWwgdGV4dAogICAgOnBhcmFtIHNlcnZlcl9hZGRyOiBBZGRyZXNzIG9mIFNNVFAgc2VydmVyIHRvIHVzZS4gVXNlIGZvcm1hdCA8YWRkcj46PHBvcnQ+CiAgICA6cGFyYW0gYXR0YWNobWVudHM6IExpc3Qgb2YgYXR0YWNobWVudHMgdG8gYWRkLgogICAgIiIiCgogICAgZW1haWxfdXNlciA9IGNvbnRleHQuZ2V0X3NlY3JldCgiU01UUF9VU0VSIikKICAgIGVtYWlsX3Bhc3MgPSBjb250ZXh0LmdldF9zZWNyZXQoIlNNVFBfUEFTU1dPUkQiKQogICAgaWYgZW1haWxfdXNlciBpcyBOb25lIG9yIGVtYWlsX3Bhc3MgaXMgTm9uZToKICAgICAgICBjb250ZXh0LmxvZ2dlci5lcnJvcigiTWlzc2luZyBzZW5kZXIgZW1haWwgb3IgcGFzc3dvcmQgLSBjYW5ub3Qgc2VuZCBlbWFpbC4iKQogICAgICAgIHJldHVybgoKICAgIGlmIHNlcnZlcl9hZGRyIGlzIE5vbmU6CiAgICAgICAgY29udGV4dC5sb2dnZXIuZXJyb3IoIlNlcnZlciBub3Qgc3BlY2lmaWVkIC0gY2Fubm90IHNlbmQgZW1haWwuIikKICAgICAgICByZXR1cm4KCiAgICBtc2cgPSBFbWFpbE1lc3NhZ2UoKQogICAgbXNnWyJGcm9tIl0gPSBzZW5kZXIKICAgIG1zZ1siU3ViamVjdCJdID0gc3ViamVjdAogICAgbXNnWyJUbyJdID0gdG8KICAgIG1zZy5zZXRfY29udGVudChjb250ZW50KQoKICAgIGZvciBmaWxlbmFtZSBpbiBhdHRhY2htZW50czoKICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYiTG9va2luZyBhdCBhdHRhY2htZW50OiB7ZmlsZW5hbWV9IikKICAgICAgICBpZiBub3Qgb3MucGF0aC5pc2ZpbGUoZmlsZW5hbWUpOgogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci53YXJuaW5nKGYiRmlsZW5hbWUgZG9lcyBub3QgZXhpc3Qge2ZpbGVuYW1lfSIpCiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgY3R5cGUsIGVuY29kaW5nID0gbWltZXR5cGVzLmd1ZXNzX3R5cGUoZmlsZW5hbWUpCiAgICAgICAgaWYgY3R5cGUgaXMgTm9uZSBvciBlbmNvZGluZyBpcyBub3QgTm9uZToKICAgICAgICAgICAgY3R5cGUgPSAiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtIgogICAgICAgIG1haW50eXBlLCBzdWJ0eXBlID0gY3R5cGUuc3BsaXQoIi8iLCAxKQogICAgICAgIHdpdGggb3BlbihmaWxlbmFtZSwgInJiIikgYXMgZnA6CiAgICAgICAgICAgIG1zZy5hZGRfYXR0YWNobWVudCgKICAgICAgICAgICAgICAgIGZwLnJlYWQoKSwKICAgICAgICAgICAgICAgIG1haW50eXBlPW1haW50eXBlLAogICAgICAgICAgICAgICAgc3VidHlwZT1zdWJ0eXBlLAogICAgICAgICAgICAgICAgZmlsZW5hbWU9b3MucGF0aC5iYXNlbmFtZShmaWxlbmFtZSksCiAgICAgICAgICAgICkKICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygKICAgICAgICAgICAgICAgIGYiQWRkZWQgYXR0YWNobWVudDogRmlsZW5hbWU6IHtmaWxlbmFtZX0sIG9mIG1pbWV0eXBlOiB7bWFpbnR5cGV9LCB7c3VidHlwZX0iCiAgICAgICAgICAgICkKCiAgICB0cnk6CiAgICAgICAgcyA9IHNtdHBsaWIuU01UUChob3N0PXNlcnZlcl9hZGRyKQogICAgICAgIHMuc3RhcnR0bHMoKQogICAgICAgIHMubG9naW4oZW1haWxfdXNlciwgZW1haWxfcGFzcykKICAgICAgICBzLnNlbmRfbWVzc2FnZShtc2cpCiAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygiRW1haWwgc2VudCBzdWNjZXNzZnVsbHkuIikKICAgIGV4Y2VwdCBzbXRwbGliLlNNVFBFeGNlcHRpb24gYXMgZXhwOgogICAgICAgIGNvbnRleHQubG9nZ2VyLmVycm9yKGYiU01UUCBleGNlcHRpb24gY2F1Z2h0IGluIFNNVFAgY29kZToge2V4cH0iKQogICAgZXhjZXB0IENvbm5lY3Rpb25FcnJvciBhcyBjZToKICAgICAgICBjb250ZXh0LmxvZ2dlci5lcnJvcihmIkNvbm5lY3Rpb24gZXJyb3IgY2F1Z2h0IGluIFNNVFAgY29kZToge2NlfSIpCg==
    code_origin: ''
  filename: send_email.py
  entry_points:
    send_email:
      outputs:
      - type: None
      parameters:
      - name: context
        type: MLClientCtx
        doc: The function context
      - name: sender
        type: str
        doc: Sender email address
      - name: to
        type: str
        doc: Email address of mail recipient
      - name: subject
        type: str
        doc: Email subject
      - name: content
        type: str
        doc: Optional mail text
        default: ''
      - name: server_addr
        type: str
        doc: Address of SMTP server to use. Use format <addr>:<port>
        default: null
      - name: attachments
        type: list[str]
        doc: List of attachments to add.
        default: []
      name: send_email
      doc: Send an email.
      has_kwargs: false
      has_varargs: false
      lineno: 25
  command: ''
  description: Send Email messages through SMTP server
  default_handler: send_email
