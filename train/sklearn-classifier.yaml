kind: job
metadata:
  name: sklearn-classifier
spec:
  build:
    functionSourceCode: ZnJvbSBtbHJ1bi5leGVjdXRpb24gaW1wb3J0IE1MQ2xpZW50Q3R4CmZyb20gbWxydW4uZGF0YXN0b3JlIGltcG9ydCBEYXRhSXRlbQppbXBvcnQgcGFuZGFzIGFzIHBkCmltcG9ydCBsaWdodGdibSBhcyBsZ2IKZnJvbSB0eXBpbmcgaW1wb3J0IE9wdGlvbmFsLCBVbmlvbgppbXBvcnQgb3MKZnJvbSBza2xlYXJuLm1vZGVsX3NlbGVjdGlvbiBpbXBvcnQgdHJhaW5fdGVzdF9zcGxpdAppbXBvcnQgaW1wb3J0bGliCmZyb20gY2xvdWRwaWNrbGUgaW1wb3J0IGR1bXAKCmRlZiB0cmFpbigKICAgIGNvbnRleHQ6IE9wdGlvbmFsW01MQ2xpZW50Q3R4XSA9IE5vbmUsCiAgICBzcmNfZmlsZTogVW5pb25bRGF0YUl0ZW0sIHN0cl0gPSAnJywKICAgIFNLQ2xhc3NpZmllcjogc3RyICA9ICcnLAogICAgY2FsbGJhY2tzICA9IFtdLAogICAgdGVzdF9zaXplOiBmbG9hdCA9IDAuMSwKICAgIHRyYWluX3ZhbF9zcGxpdDogZmxvYXQgPSAwLjc1LAogICAgc2FtcGxlOiBpbnQgPSAtMSwKICAgIHRhcmdldF9wYXRoOiBzdHIgPSAnJywKICAgIG5hbWU6IHN0ciA9ICcnLAogICAga2V5OiBzdHIgPSAnJywKICAgIHZlcmJvc2U6IGJvb2wgPSBGYWxzZSwKICAgIHJhbmRvbV9zdGF0ZSA9IDEKKSAtPiBOb25lOgogICAgIiIiVHJhaW4gYW5kIHNhdmUgYW4gU2Npa2l0bGVhcm4gbW9kZWwuCiAgICAKICAgIFRoZSBkYXRhIHNvdXJjZSBjYW4gZWl0aGVyIGJlIGEgc3RyaW5nIGZpbGUgbmFtZSBvciBhbiBhcnRpZmFjdCBpdGVtLgogICAgCiAgICBUaGUgaGVhZGVyIGlzIGVpdGggYSBsaXN0IG9mIGNvbHVtbiBuYW1lcywgYW4gYXJ0aWZhY3QgaGVhZGVyIGl0ZW0sIG9yIE5vbmUuCiAgICAKICAgIAogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgdGhlIGZ1bmN0aW9uIGNvbnRleHQKICAgIDpwYXJhbSBzcmNfZmlsZTogICAgICAgICgncmF3JykgbmFtZSBvZiByYXcgZGF0YSBmaWxlCiAgICA6cGFyYW0gc2FtcGxlOiAgICAgICAgICAoLTEpLiBTZWxlY3RzIHRoZSBmaXJzdCBuIHJvd3MsIG9yIHNlbGVjdCBhIHNhbXBsZSBzdGFydGluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSB0aGUgZmlyc3QuIElmIG5lZ2F0aXZlIDwtMSwgc2VsZWN0IGEgcmFuZG9tIHNhbXBsZSBmcm9tIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGVudGlyZSBmaWxlCiAgICA6cGFyYW0gaGVhZGVyOiAgICAgICAgICAoTm9uZSkgaGVhZGVyIGFydGlmYWN0IG9yIGxpc3Qgb2YgY29sdW1uIG5hbWVzLgogICAgOnBhcmFtIFNLQ2xhc3NpZmllcjogICAgc3RyaW5nIG1vZHVsZSBhbmQgY2xhc3NuYW1lIG9mIGNsYXNzaWZpZXIKICAgIDpwYXJhbSBjYWxsYmFja3MKICAgIDpwYXJhbSB0ZXN0X3NpemU6ICAgICAgICgwLjEpIHRlc3Qgc2V0IHNpemUKICAgIDpwYXJhbSB0cmFpbl92YWxfc3BsaXQ6ICgwLjc1KSBPbmNlIHRoZSB0ZXN0IHNldCBoYXMgYmVlbiByZW1vdmVkIHRoZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYWluaW5nIHNldCBnZXRzIHRoaXMgcHJvcG9ydGlvbi4KICAgIDpwYXJhbSB0YXJnZXRfcGF0aDogICAgIGZvbGRlciBsb2NhdGlvbiBvZiBmaWxlcwogICAgOnBhcmFtIG5hbWU6ICAgICAgICAgICAgZGVzdGluYXRpb24gbmFtZSBmb3IgbW9kZWwgZmlsZQogICAgOnBhcmFtIGtleTogICAgICAgICAgICAga2V5IGZvciBtb2RlbCBhcnRpZmFjdAogICAgOnBhcmFtIHZlcmJvc2UgOiAgICAgICAgKEZhbHNlKSBzaG93IG1ldHJpY3MgZm9yIHRyYWluaW5nL3ZhbGlkYXRpb24gc3RlcHMuCiAgICA6cGFyYW0gcmFuZG9tX3N0YXRlOiAgICAoMSkgc2tsZWFybiBybmcgc2VlZAogICAgCiAgICBleGFtcGxlIGNhbGxiYWNrczoKICAgIGBgYAogICAgZnJvbSBsaWdodGdibSBpbXBvcnQgcmVjb3JkX2V2YWx1YXRpb24KICAgIGV2YWxfcmVzdWx0cyA9IGRpY3QoKQogICAgY2FsbGJhY2tzID0gW3JlY29yZF9ldmFsdWF0aW9uKGV2YWxfcmVzdWx0cyldCiAgICBgYGAKICAgICIiIgogICAgIyBsb2FkIGRhdGEKICAgIGlmIGlzaW5zdGFuY2Uoc3JjX2ZpbGUsIERhdGFJdGVtKToKICAgICAgICBzcmNfZmlsZSA9IHN0cihzcmNfZmlsZSkKICAgIHNyY2ZpbGVwYXRoID0gb3MucGF0aC5qb2luKHRhcmdldF9wYXRoLCBzcmNfZmlsZSkKCiAgICAjIHNhdmUgb25seSBhIHNhbXBsZSwgaW50ZW5kZWQgZm9yIGRlYnVnZ2luZwogICAgaWYgKHNhbXBsZSA9PSAtMSkgb3IgKHNhbXBsZSA+PSAxKToKICAgICAgICAjIGdldCBhbGwgcm93cywgb3IgY29udGlndW91cyBzYW1wbGUgc3RhcnRpbmcgYXQgcm93IDEuCiAgICAgICAgcmF3ID0gcGQucmVhZF9wYXJxdWV0KHNyY2ZpbGVwYXRoLCBlbmdpbmU9J3B5YXJyb3cnKQogICAgICAgIGxhYmVscyA9IHJhdy5wb3AoJ2xhYmVscycpCiAgICAgICAgcmF3ID0gcmF3Lmlsb2NbOnNhbXBsZSwgOl0KICAgICAgICBsYWJlbHMgPSBsYWJlbHMuaWxvY1s6c2FtcGxlXQogICAgZWxzZToKICAgICAgICAjIGdyYWIgYSByYW5kb20gc2FtcGxlCiAgICAgICAgcmF3ID0gcGQucmVhZF9wYXJxdWV0KHNyY2ZpbGVwYXRoLCBlbmdpbmU9J3B5YXJyb3cnKS5zYW1wbGUoc2FtcGxlKi0xKQogICAgICAgIGxhYmVscyA9IHJhdy5wb3AoJ2xhYmVscycpCiAgICAKICAgICMgZG91YmxlIHNwbGl0IHRwIGdlbmVyYXRlIDMgZGF0YSBzZXRzOiB0cmFpbiwgdmFsaWRhdGlvbiBhbmQgdGVzdAogICAgeCwgeHRlc3QsIHksIHl0ZXN0ID0gdHJhaW5fdGVzdF9zcGxpdChyYXcsIGxhYmVscywgdHJhaW5fc2l6ZT0xLXRlc3Rfc2l6ZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmRvbV9zdGF0ZT1yYW5kb21fc3RhdGUpCiAgIAogICAgeHRyYWluLCB4dmFsaWQsIHl0cmFpbiwgeXZhbGlkID0gdHJhaW5fdGVzdF9zcGxpdCh4LCB5LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhaW5fc2l6ZT10cmFpbl92YWxfc3BsaXQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5kb21fc3RhdGU9cmFuZG9tX3N0YXRlKSAgICAgICAgCiAgIAogICAgIyBjcmVhdGUgY2xhc3NpZmllciBjbGFzcyBmcm9tIHN0cmluZyBhbmQgaW5zdGFudGlhdGUKICAgIHNwbGl0cyA9IFNLQ2xhc3NpZmllci5zcGxpdCgiLiIpCiAgICBjbGZjbGFzcyA9IGdldGF0dHIoaW1wb3J0bGliLmltcG9ydF9tb2R1bGUoIi4iLmpvaW4oc3BsaXRzWzotMV0pKSwgc3BsaXRzWy0xXSkKICAgIGNsZiA9IGNsZmNsYXNzKHJhbmRvbV9zdGF0ZT1yYW5kb21fc3RhdGUsIHZlcmJvc2U9aW50KHZlcmJvc2UgPT0gVHJ1ZSkpCgogICAgY2xmLmZpdCh4dHJhaW4sIAogICAgICAgICAgICB5dHJhaW4sCiAgICAgICAgICAgIGV2YWxfc2V0PVsoeHZhbGlkLCB5dmFsaWQpLCAoeHRyYWluLCB5dHJhaW4pXSwKICAgICAgICAgICAgZXZhbF9uYW1lcz1bJ3ZhbGlkJywgJ3RyYWluJ10sCiAgICAgICAgICAgIGNhbGxiYWNrcz1jYWxsYmFja3MsCiAgICAgICAgICAgIHZlcmJvc2U9dmVyYm9zZSkKICAgICAKICAgIGNvbnRleHQubG9nX3Jlc3VsdCgidHJhaW5fYWNjdXJhY3kiLCBmbG9hdChjbGYuc2NvcmUoeHRyYWluLCB5dHJhaW4pKSkKCiAgICAjIHNhdmUgbW9kZWwKICAgIGZpbGVwYXRoID0gb3MucGF0aC5qb2luKHRhcmdldF9wYXRoLCBuYW1lKQogICAgZHVtcChjbGYsIG9wZW4oZmlsZXBhdGgsICd3YicpKQogICAgY29udGV4dC5sb2dfYXJ0aWZhY3Qoa2V5LCB0YXJnZXRfcGF0aD1maWxlcGF0aCkgIywgbGFiZWxzPWV4cF9sYWJlbHMpCiAgICAjIHNhdmUgdGVzdCBkYXRhCiAgICBmb3IgdCBpbiBbJ3gnLCAneSddOgogICAgICAgIGZuYW1lID0gdCArICd0ZXN0LnBrbCcKICAgICAgICBmaWxlcGF0aCA9IG9zLnBhdGguam9pbih0YXJnZXRfcGF0aCwgZm5hbWUpCiAgICAgICAgZHVtcCh4dGVzdCwgb3BlbihmaWxlcGF0aCwgJ3diJykpCiAgICAgICAgY29udGV4dC5sb2dfYXJ0aWZhY3QodCsndGVzdCcsIHRhcmdldF9wYXRoPWZpbGVwYXRoKQ==
    base_image: yjbds/mlrun-ds:latest
    commands: []
    code_origin: https://github.com/yjb-ds/functions.git#3f7e0c78313c0f8da3f2ae8535b625f06f5c3ee4:/User/repos/functions/train/sklearn-classifier.py
