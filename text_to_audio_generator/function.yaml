metadata:
  name: text-to-audio-generator
  categories:
  - data-preparation
  - machine-learning
  - pytorch
  tag: ''
spec:
  command: ''
  build:
    functionSourceCode: IyBDb3B5cmlnaHQgMjAyMyBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAojCiMgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQojIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiMgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiMgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAojIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgppbXBvcnQgaW1wb3J0bGliCmltcG9ydCBpbwppbXBvcnQgbG9nZ2luZwppbXBvcnQgb3MKaW1wb3J0IHBhdGhsaWIKaW1wb3J0IHJhbmRvbQppbXBvcnQgdGVtcGZpbGUKZnJvbSBhYmMgaW1wb3J0IEFCQywgYWJzdHJhY3RtZXRob2QKZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIExpc3QsIE9wdGlvbmFsLCBUdXBsZSwgVW5pb24KCmltcG9ydCBudW1weSBhcyBucAppbXBvcnQgcGFuZGFzIGFzIHBkCmltcG9ydCB0b3JjaAppbXBvcnQgdG9yY2hhdWRpbwppbXBvcnQgdHFkbQoKIyBHZXQgdGhlIGdsb2JhbCBsb2dnZXI6Cl9MT0dHRVIgPSBsb2dnaW5nLmdldExvZ2dlcigpCgpPUEVOQUlfQVBJX0tFWSA9ICJPUEVOQUlfQVBJX0tFWSIKT1BFTkFJX0JBU0VfVVJMID0gIk9QRU5BSV9BUElfQkFTRSIKU0FNUExFX1JBVEUgPSAyNDAwMAoKCmRlZiBnZW5lcmF0ZV9tdWx0aV9zcGVha2Vyc19hdWRpbygKICAgIGRhdGFfcGF0aDogc3RyLAogICAgc3BlYWtlcnM6IFVuaW9uW0xpc3Rbc3RyXSwgRGljdFtzdHIsIGludF1dLAogICAgYXZhaWxhYmxlX3ZvaWNlczogTGlzdFtzdHJdLAogICAgZW5naW5lOiBzdHIgPSAib3BlbmFpIiwKICAgIG91dHB1dF9kaXJlY3Rvcnk6IHN0ciA9IE5vbmUsCiAgICB1c2VfZ3B1OiBPcHRpb25hbFtib29sXSA9IE5vbmUsCiAgICB1c2Vfc21hbGxfbW9kZWxzOiBPcHRpb25hbFtib29sXSA9IE5vbmUsCiAgICBvZmZsb2FkX2NwdTogT3B0aW9uYWxbYm9vbF0gPSBOb25lLAogICAgbW9kZWw6IE9wdGlvbmFsW3N0cl0gPSBOb25lLAogICAgc3BlZWQ6IE9wdGlvbmFsW2Zsb2F0XSA9IE5vbmUsCiAgICBzYW1wbGVfcmF0ZTogaW50ID0gMTYwMDAsCiAgICBmaWxlX2Zvcm1hdDogc3RyID0gIndhdiIsCiAgICB2ZXJib3NlOiBib29sID0gVHJ1ZSwKICAgIGJpdHNfcGVyX3NhbXBsZTogT3B0aW9uYWxbaW50XSA9IE5vbmUsCikgLT4gVHVwbGVbc3RyLCBwZC5EYXRhRnJhbWUsIGRpY3RdOgogICAgIiIiCiAgICBHZW5lcmF0ZSBhdWRpbyBmaWxlcyBmcm9tIHRleHQgZmlsZXMuCgogICAgOnBhcmFtIGRhdGFfcGF0aDogICAgICAgICAgIFBhdGggdG8gdGhlIHRleHQgZmlsZSBvciBkaXJlY3RvcnkgY29udGFpbmluZyB0aGUgdGV4dCBmaWxlcyB0byBnZW5lcmF0ZSBhdWRpbyBmcm9tLgogICAgOnBhcmFtIHNwZWFrZXJzOiAgICAgICAgICAgIExpc3QgLyBEaWN0IG9mIHNwZWFrZXJzIHRvIGdlbmVyYXRlIGF1ZGlvIGZvci4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJZiBhIGxpc3QgaXMgZ2l2ZW4sIHRoZSBzcGVha2VycyB3aWxsIGJlIGFzc2lnbmVkIHRvIGNoYW5uZWxzIGluIHRoZSBvcmRlciBnaXZlbi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJZiBkaWN0aW9uYXJ5LCB0aGUga2V5cyB3aWxsIGJlIHRoZSBzcGVha2VycyBhbmQgdGhlIHZhbHVlcyB3aWxsIGJlIHRoZSBjaGFubmVscy4KICAgIDpwYXJhbSBhdmFpbGFibGVfdm9pY2VzOiAgICBMaXN0IG9mIGF2YWlsYWJsZSB2b2ljZXMgdG8gdXNlIGZvciB0aGUgZ2VuZXJhdGlvbi4KICAgICAgICAgICAgICAgICAgICAgICAgU2VlIGhlcmUgZm9yIHRoZSBhdmFpbGFibGUgdm9pY2VzIGZvciBiYXJrIGVuZ2luZToKICAgICAgICAgICAgICAgICAgICAgICAgaHR0cHM6Ly9zdW5vLWFpLm5vdGlvbi5zaXRlLzhiOGU4NzQ5ZWQ1MTRiMGNiZjNmNjk5MDEzNTQ4NjgzP3Y9YmM2N2NmZjc4NmIwNGI1MGIzY2ViNzU2ZmQwNWY2OGMKICAgICAgICAgICAgICAgICAgICAgICAgU2VlIGhlcmUgZm9yIHRoZSBhdmFpbGFibGUgdm9pY2VzIGZvciBvcGVuYWkgZW5naW5lOgogICAgICAgICAgICAgICAgICAgICAgICBodHRwczovL2JldGEub3BlbmFpLmNvbS9kb2NzL2FwaS1yZWZlcmVuY2Uvc3BlZWNoCiAgICA6cGFyYW0gZW5naW5lOiAgICAgICAgICAgICAgVGhlIGVuZ2luZSB0byB1c2UgZm9yIHRoZSBnZW5lcmF0aW9uLiBTZWxlY3QgZWl0aGVyICJiYXJrIiBvciAib3BlbmFpIi4gRGVmYXVsdCBpcyAib3BlbmFpIi4KICAgIDpwYXJhbSBvdXRwdXRfZGlyZWN0b3J5OiAgICBQYXRoIHRvIHRoZSBkaXJlY3RvcnkgdG8gc2F2ZSB0aGUgZ2VuZXJhdGVkIGF1ZGlvIGZpbGVzIHRvLgogICAgOnBhcmFtIHVzZV9ncHU6ICAgICAgICAgICAgIFdoZXRoZXIgdG8gdXNlIHRoZSBHUFUgZm9yIHRoZSBnZW5lcmF0aW9uLiBTdXBwb3J0ZWQgb25seSBpbiAiYmFyayIgZW5naW5lLgogICAgOnBhcmFtIHVzZV9zbWFsbF9tb2RlbHM6ICAgIFdoZXRoZXIgdG8gdXNlIHRoZSBzbWFsbCBtb2RlbHMgZm9yIHRoZSBnZW5lcmF0aW9uLiBTdXBwb3J0ZWQgb25seSBpbiAiYmFyayIgZW5naW5lLgogICAgOnBhcmFtIG9mZmxvYWRfY3B1OiAgICAgICAgIFRvIHJlZHVjZSB0aGUgbWVtb3J5IGZvb3RwcmludCwgdGhlIG1vZGVscyBjYW4gYmUgb2ZmbG9hZGVkIHRvIHRoZSBDUFUgYWZ0ZXIgbG9hZGluZy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdXBwb3J0ZWQgb25seSBpbiAiYmFyayIgZW5naW5lLgogICAgOnBhcmFtIG1vZGVsOiAgICAgICAgICAgICAgIFdoaWNoIG1vZGVsIHRvIHVzZSBmb3IgdGhlIGdlbmVyYXRpb24uIFN1cHBvcnRlZCBvbmx5IGluICJvcGVuYWkiIGVuZ2luZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IGlzICJ0dHMtMSIuCiAgICA6cGFyYW0gc3BlZWQ6ICAgICAgICAgICAgICAgVGhlIHNwZWVkIG9mIHRoZSBnZW5lcmF0ZWQgYXVkaW8uIFNlbGVjdCBhIHZhbHVlIGZyb20gYDAuMjVgIHRvIGA0LjBgLiBgMS4wYCBpcyB0aGUgZGVmYXVsdC4KICAgIDpwYXJhbSBzYW1wbGVfcmF0ZTogICAgICAgICBUaGUgc2FtcGxpbmcgcmF0ZSBvZiB0aGUgZ2VuZXJhdGVkIGF1ZGlvLgogICAgOnBhcmFtIGZpbGVfZm9ybWF0OiAgICAgICAgIFRoZSBmb3JtYXQgb2YgdGhlIGdlbmVyYXRlZCBhdWRpbyBmaWxlcy4KICAgIDpwYXJhbSB2ZXJib3NlOiAgICAgICAgICAgICBXaGV0aGVyIHRvIHByaW50IHRoZSBwcm9ncmVzcyBvZiB0aGUgZ2VuZXJhdGlvbi4KICAgIDpwYXJhbSBiaXRzX3Blcl9zYW1wbGU6ICAgICBDaGFuZ2VzIHRoZSBiaXQgZGVwdGggZm9yIHRoZSBzdXBwb3J0ZWQgZm9ybWF0cy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdXBwb3J0ZWQgb25seSBpbiAid2F2IiBvciAiZmxhYyIgZm9ybWF0cy4KCiAgICA6cmV0dXJuczogICAgICAgICAgICAgICAgICAgQSB0dXBsZSBvZjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIFRoZSBvdXRwdXQgZGlyZWN0b3J5IHBhdGguCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLSBUaGUgZ2VuZXJhdGVkIGF1ZGlvIGZpbGVzIGRhdGFmcmFtZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIFRoZSBlcnJvcnMnIGRpY3Rpb25hcnkuCiAgICAiIiIKCiAgICBnbG9iYWwgX0xPR0dFUgogICAgX0xPR0dFUiA9IF9nZXRfbG9nZ2VyKCkKICAgICMgR2V0IHRoZSBpbnB1dCB0ZXh0IGZpbGVzIHRvIHR1cm4gdG8gYXVkaW86CiAgICBkYXRhX3BhdGggPSBwYXRobGliLlBhdGgoZGF0YV9wYXRoKS5hYnNvbHV0ZSgpCiAgICB0ZXh0X2ZpbGVzID0gX2dldF90ZXh0X2ZpbGVzKGRhdGFfcGF0aD1kYXRhX3BhdGgpCgoKICAgICMgUHJlcGFyZSB0aGUgc3BlZWNoIGVuZ2luZToKICAgIGVuZ2luZSA9IF9nZXRfZW5naW5lKAogICAgICAgIGVuZ2luZT1lbmdpbmUsCiAgICAgICAgdXNlX2dwdT11c2VfZ3B1LAogICAgICAgIHVzZV9zbWFsbF9tb2RlbHM9dXNlX3NtYWxsX21vZGVscywKICAgICAgICBvZmZsb2FkX2NwdT1vZmZsb2FkX2NwdSwKICAgICAgICBtb2RlbD1tb2RlbCwKICAgICAgICBmaWxlX2Zvcm1hdD1maWxlX2Zvcm1hdCwKICAgICAgICBzcGVlZD1zcGVlZAogICAgKQoKICAgICMgQ2hlY2sgZm9yIHBlciBjaGFubmVsIGdlbmVyYXRpb246CiAgICBpZiBpc2luc3RhbmNlKHNwZWFrZXJzLCBkaWN0KToKICAgICAgICBzcGVha2VyX3Blcl9jaGFubmVsID0gVHJ1ZQogICAgICAgICMgU29ydCB0aGUgZ2l2ZW4gc3BlYWtlcnMgYnkgY2hhbm5lbHM6CiAgICAgICAgc3BlYWtlcnMgPSB7CiAgICAgICAgICAgIHNwZWFrZXI6IGNoYW5uZWwKICAgICAgICAgICAgZm9yIHNwZWFrZXIsIGNoYW5uZWwgaW4gc29ydGVkKHNwZWFrZXJzLml0ZW1zKCksIGtleT1sYW1iZGEgaXRlbTogaXRlbVsxXSkKICAgICAgICB9CiAgICBlbHNlOgogICAgICAgIHNwZWFrZXJfcGVyX2NoYW5uZWwgPSBGYWxzZQoKICAgICMgUHJlcGFyZSB0aGUgcmVzYW1wbGluZyBtb2R1bGU6CiAgICByZXNhbXBsZXIgPSB0b3JjaGF1ZGlvLnRyYW5zZm9ybXMuUmVzYW1wbGUoCiAgICAgICAgb3JpZ19mcmVxPVNBTVBMRV9SQVRFLCBuZXdfZnJlcT1zYW1wbGVfcmF0ZSwgZHR5cGU9dG9yY2guZmxvYXQzMgogICAgKQoKICAgICMgUHJlcGFyZSB0aGUgZ2FwIGJldHdlZW4gZWFjaCBzcGVha2VyOgogICAgZ2FwX2JldHdlZW5fc3BlYWtlcnMgPSBucC56ZXJvcyhpbnQoMC41ICogU0FNUExFX1JBVEUpKQoKICAgICMgUHJlcGFyZSB0aGUgc3VjY2Vzc2VzIGRhdGFmcmFtZSBhbmQgZXJyb3JzIGRpY3Rpb25hcnkgdG8gYmUgcmV0dXJuZWQ6CiAgICBzdWNjZXNzZXMgPSBbXQogICAgZXJyb3JzID0ge30KCiAgICAjIENyZWF0ZSB0aGUgb3V0cHV0IGRpcmVjdG9yeToKICAgIGlmIG91dHB1dF9kaXJlY3RvcnkgaXMgTm9uZToKICAgICAgICBvdXRwdXRfZGlyZWN0b3J5ID0gdGVtcGZpbGUubWtkdGVtcCgpCiAgICBvdXRwdXRfZGlyZWN0b3J5ID0gcGF0aGxpYi5QYXRoKG91dHB1dF9kaXJlY3RvcnkpCiAgICBpZiBub3Qgb3V0cHV0X2RpcmVjdG9yeS5leGlzdHMoKToKICAgICAgICBvdXRwdXRfZGlyZWN0b3J5Lm1rZGlyKGV4aXN0X29rPVRydWUsIHBhcmVudHM9VHJ1ZSkKCiAgICAjIFN0YXJ0IGdlbmVyYXRpbmcgYXVkaW86CiAgICAjIEdvIG92ZXIgdGhlIGF1ZGlvIGZpbGVzIGFuZCB0cmFuc2NyaWJlOgogICAgZm9yIHRleHRfZmlsZSBpbiB0cWRtLnRxZG0oCiAgICAgICAgdGV4dF9maWxlcywgZGVzYz0iR2VuZXJhdGluZyIsIHVuaXQ9ImZpbGUiLCBkaXNhYmxlPW5vdCB2ZXJib3NlCiAgICApOgoKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgUmFuZG9taXplIHZvaWNlcyBmb3IgZWFjaCBzcGVha2VyOgogICAgICAgICAgICBjaG9zZW5fdm9pY2VzID0ge30KICAgICAgICAgICAgYXZhaWxhYmxlX3ZvaWNlc19jb3B5ID0gYXZhaWxhYmxlX3ZvaWNlcy5jb3B5KCkKICAgICAgICAgICAgZm9yIHNwZWFrZXIgaW4gc3BlYWtlcnM6CiAgICAgICAgICAgICAgICB2b2ljZSA9IHJhbmRvbS5jaG9pY2UoYXZhaWxhYmxlX3ZvaWNlc19jb3B5KQogICAgICAgICAgICAgICAgY2hvc2VuX3ZvaWNlc1tzcGVha2VyXSA9IHZvaWNlCiAgICAgICAgICAgICAgICBhdmFpbGFibGVfdm9pY2VzX2NvcHkucmVtb3ZlKHZvaWNlKQogICAgICAgICAgICAjIFJlYWQgdGV4dDoKICAgICAgICAgICAgd2l0aCBvcGVuKHRleHRfZmlsZSwgInIiKSBhcyBmcDoKICAgICAgICAgICAgICAgIHRleHQgPSBmcC5yZWFkKCkKICAgICAgICAgICAgIyBQcmVwYXJlIGEgaG9sZGVyIGZvciBhbGwgdGhlIGdlbmVyYXRlZCBwaWVjZXMgKGlmIHBlciBjaGFubmVsIGVhY2ggc3BlYWtlciB3aWxsIGhhdmUgaXRzIG93bik6CiAgICAgICAgICAgIGF1ZGlvX3BpZWNlcyA9ICgKICAgICAgICAgICAgICAgIHtzcGVha2VyOiBbXSBmb3Igc3BlYWtlciBpbiBzcGVha2Vyc30KICAgICAgICAgICAgICAgIGlmIHNwZWFrZXJfcGVyX2NoYW5uZWwKICAgICAgICAgICAgICAgIGVsc2UgeyJhbGwiOiBbXX0KICAgICAgICAgICAgKQoKICAgICAgICAgICAgIyBHZW5lcmF0ZSBhdWRpbyBwZXIgbGluZToKICAgICAgICAgICAgZm9yIGxpbmUgaW4gdGV4dC5zcGxpdGxpbmVzKCk6CiAgICAgICAgICAgICAgICAjIFZhbGlkYXRlIGxpbmUgaXMgaW4gY29ycmVjdCBzcGVha2VyIGZvcm1hdDoKCiAgICAgICAgICAgICAgICBpZiAiOiAiIG5vdCBpbiBsaW5lOgogICAgICAgICAgICAgICAgICAgIGlmIHZlcmJvc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIF9MT0dHRVIud2FybmluZyhmIlNraXBwaW5nIGxpbmU6IHtsaW5lfSIpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICMgU3BsaXQgbGluZSB0byBzcGVha2VyIGFuZCBoaXMgd29yZHM6CiAgICAgICAgICAgICAgICBjdXJyZW50X3NwZWFrZXIsIHNlbnRlbmNlcyA9IGxpbmUuc3BsaXQoIjogIiwgMSkKICAgICAgICAgICAgICAgICMgVmFsaWRhdGUgc3BlYWtlciBpcyBrbm93bjoKICAgICAgICAgICAgICAgIGlmIGN1cnJlbnRfc3BlYWtlciBub3QgaW4gc3BlYWtlcnM6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgZiJVbmtub3duIHNwZWFrZXI6IHtjdXJyZW50X3NwZWFrZXJ9LiBHaXZlbiBzcGVha2VycyBhcmU6IHtzcGVha2Vyc30iCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZm9yIHNlbnRlbmNlIGluIF9zcGxpdF9saW5lKGxpbmU9c2VudGVuY2VzKToKICAgICAgICAgICAgICAgICAgICAjIEdlbmVyYXRlIHdvcmRzIGF1ZGlvOgogICAgICAgICAgICAgICAgICAgIGF1ZGlvID0gZW5naW5lLl9nZW5lcmF0ZV9hdWRpbygKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dD1zZW50ZW5jZSwKICAgICAgICAgICAgICAgICAgICAgICAgdm9pY2U9Y2hvc2VuX3ZvaWNlc1tjdXJyZW50X3NwZWFrZXJdLAogICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICAgICAgaWYgc3BlYWtlcl9wZXJfY2hhbm5lbDoKICAgICAgICAgICAgICAgICAgICAgICAgc2lsZW5jZSA9IG5wLnplcm9zX2xpa2UoYXVkaW8pCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBzcGVha2VyIGluIGF1ZGlvX3BpZWNlcy5rZXlzKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzcGVha2VyID09IGN1cnJlbnRfc3BlYWtlcjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdWRpb19waWVjZXNbc3BlYWtlcl0gKz0gW2F1ZGlvLCBnYXBfYmV0d2Vlbl9zcGVha2Vyc10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXVkaW9fcGllY2VzW3NwZWFrZXJdICs9IFtzaWxlbmNlLCBnYXBfYmV0d2Vlbl9zcGVha2Vyc10KICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBhdWRpb19waWVjZXNbImFsbCJdICs9IFthdWRpbywgZ2FwX2JldHdlZW5fc3BlYWtlcnNdCiAgICAgICAgICAgICMgQ29uc3RydWN0IGEgc2luZ2xlIGF1ZGlvIGFycmF5IGZyb20gYWxsIHRoZSBwaWVjZXMgYW5kIGNoYW5uZWxzOgoKICAgICAgICAgICAgYXVkaW8gPSBucC52c3RhY2soCiAgICAgICAgICAgICAgICBbbnAuY29uY2F0ZW5hdGUoYXVkaW9fcGllY2VzW3NwZWFrZXJdKSBmb3Igc3BlYWtlciBpbiBzcGVha2Vyc10KICAgICAgICAgICAgKS5hc3R5cGUoZHR5cGU9bnAuZmxvYXQzMikKICAgICAgICAgICAgIyBSZXNhbXBsZToKICAgICAgICAgICAgYXVkaW8gPSB0b3JjaC5mcm9tX251bXB5KGF1ZGlvKQogICAgICAgICAgICBhdWRpbyA9IHJlc2FtcGxlcihhdWRpbykKICAgICAgICAgICAgIyBTYXZlIHRvIGF1ZGlvIGZpbGU6CiAgICAgICAgICAgIGF1ZGlvX2ZpbGUgPSBvdXRwdXRfZGlyZWN0b3J5IC8gZiJ7dGV4dF9maWxlLnN0ZW19LntmaWxlX2Zvcm1hdH0iCgogICAgICAgICAgICB0b3JjaGF1ZGlvLnNhdmUoCiAgICAgICAgICAgICAgICB1cmk9c3RyKGF1ZGlvX2ZpbGUpLAogICAgICAgICAgICAgICAgc3JjPWF1ZGlvLAogICAgICAgICAgICAgICAgc2FtcGxlX3JhdGU9c2FtcGxlX3JhdGUsCiAgICAgICAgICAgICAgICBmb3JtYXQ9ZmlsZV9mb3JtYXQsCiAgICAgICAgICAgICAgICBiaXRzX3Blcl9zYW1wbGU9Yml0c19wZXJfc2FtcGxlLAogICAgICAgICAgICApCgogICAgICAgICAgICAjIENvbGxlY3QgdG8gdGhlIHN1Y2Nlc3NlczoKICAgICAgICAgICAgc3VjY2Vzc2VzLmFwcGVuZChbdGV4dF9maWxlLm5hbWUsIGF1ZGlvX2ZpbGUubmFtZV0pCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBleGNlcHRpb246CiAgICAgICAgICAgICMgTm90ZSB0aGUgZXhjZXB0aW9uIGFzIGVycm9yIGluIHRoZSBkaWN0aW9uYXJ5OgogICAgICAgICAgICBpZiB2ZXJib3NlOgogICAgICAgICAgICAgICAgX0xPR0dFUi53YXJuaW5nKGYiRXJyb3IgaW4gZmlsZTogJ3t0ZXh0X2ZpbGUubmFtZX0nIikKICAgICAgICAgICAgcHJpbnQoZXhjZXB0aW9uKQogICAgICAgICAgICBlcnJvcnNbdGV4dF9maWxlLm5hbWVdID0gc3RyKGV4Y2VwdGlvbikKCiAgICAjIENvbnN0cnVjdCB0aGUgdHJhbnNsYXRpb25zIGRhdGFmcmFtZToKICAgIHN1Y2Nlc3NlcyA9IHBkLkRhdGFGcmFtZSgKICAgICAgICBzdWNjZXNzZXMsCiAgICAgICAgY29sdW1ucz1bInRleHRfZmlsZSIsICJhdWRpb19maWxlIl0sCiAgICApCgogICAgIyBQcmludCB0aGUgaGVhZCBvZiB0aGUgcHJvZHVjZWQgZGF0YWZyYW1lIGFuZCByZXR1cm46CiAgICBpZiB2ZXJib3NlOgogICAgICAgIF9MT0dHRVIuaW5mbygKICAgICAgICAgICAgZiJEb25lICh7c3VjY2Vzc2VzLnNoYXBlWzBdfS97bGVuKHRleHRfZmlsZXMpfSlcbiIKICAgICAgICAgICAgZiJUcmFuc2xhdGlvbnMgc3VtbWFyeTpcbiIKICAgICAgICAgICAgZiJ7c3VjY2Vzc2VzLmhlYWQoKX0iCiAgICAgICAgKQogICAgcmV0dXJuIHN0cihvdXRwdXRfZGlyZWN0b3J5KSwgc3VjY2Vzc2VzLCBlcnJvcnMKCgpjbGFzcyBTcGVlY2hFbmdpbmUoQUJDKToKICAgIEBhYnN0cmFjdG1ldGhvZAogICAgZGVmIF9nZW5lcmF0ZV9hdWRpbyhzZWxmLCB0ZXh0OiBzdHIsIHZvaWNlOiBzdHIpIC0+IG5wLm5kYXJyYXk6CiAgICAgICAgcGFzcwoKCmNsYXNzIEJhcmtFbmdpbmUoU3BlZWNoRW5naW5lKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB1c2VfZ3B1OiBib29sID0gVHJ1ZSwgdXNlX3NtYWxsX21vZGVsczogYm9vbCA9IEZhbHNlLCBvZmZsb2FkX2NwdTogYm9vbCA9IEZhbHNlKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuYmFyayA9IGltcG9ydGxpYi5pbXBvcnRfbW9kdWxlKCJiYXJrIikKICAgICAgICBleGNlcHQgSW1wb3J0RXJyb3I6CiAgICAgICAgICAgIHJhaXNlIEltcG9ydEVycm9yKAogICAgICAgICAgICAgICAgIlRoZSAnYmFyaycgbGlicmFyeSBpcyByZXF1aXJlZCBmb3IgdGhlIEJhcmtFbmdpbmUuIFBsZWFzZSBpbnN0YWxsIGl0IHVzaW5nICdwaXAgaW5zdGFsbCBiYXJrLWFpJy4iCiAgICAgICAgICAgICkKCiAgICAgICAgc2VsZi5iYXJrLnByZWxvYWRfbW9kZWxzKAogICAgICAgICAgICB0ZXh0X3VzZV9ncHU9dXNlX2dwdSwKICAgICAgICAgICAgdGV4dF91c2Vfc21hbGw9dXNlX3NtYWxsX21vZGVscywKICAgICAgICAgICAgY29hcnNlX3VzZV9ncHU9dXNlX2dwdSwKICAgICAgICAgICAgY29hcnNlX3VzZV9zbWFsbD11c2Vfc21hbGxfbW9kZWxzLAogICAgICAgICAgICBmaW5lX3VzZV9ncHU9dXNlX2dwdSwKICAgICAgICAgICAgZmluZV91c2Vfc21hbGw9dXNlX3NtYWxsX21vZGVscywKICAgICAgICAgICAgY29kZWNfdXNlX2dwdT11c2VfZ3B1LAogICAgICAgICAgICBmb3JjZV9yZWxvYWQ9b2ZmbG9hZF9jcHUsCiAgICAgICAgKQoKICAgIGRlZiBfZ2VuZXJhdGVfYXVkaW8oc2VsZiwgdGV4dDogc3RyLCB2b2ljZTogc3RyKSAtPiBucC5uZGFycmF5OgogICAgICAgICMgR2VuZXJhdGUgd29yZHMgYXVkaW86CiAgICAgICAgYXVkaW8gPSBzZWxmLmJhcmsuZ2VuZXJhdGVfYXVkaW8oCiAgICAgICAgICAgIHRleHQsCiAgICAgICAgICAgIGhpc3RvcnlfcHJvbXB0PXZvaWNlLAogICAgICAgICAgICBzaWxlbnQ9VHJ1ZSwKICAgICAgICApCiAgICAgICAgcmV0dXJuIGF1ZGlvCgoKY2xhc3MgT3BlbkFJRW5naW5lKFNwZWVjaEVuZ2luZSk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgbW9kZWw6IHN0ciA9ICJ0dHMtMSIsIGZpbGVfZm9ybWF0OiBzdHIgPSAid2F2Iiwgc3BlZWQ6IGZsb2F0ID0gMS4wKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYub3BlbmFpID0gaW1wb3J0bGliLmltcG9ydF9tb2R1bGUoIm9wZW5haSIpCiAgICAgICAgICAgIHNlbGYucHlkdWIgPSBpbXBvcnRsaWIuaW1wb3J0X21vZHVsZSgicHlkdWIiKQogICAgICAgIGV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgICAgICAgICAgcmFpc2UgSW1wb3J0RXJyb3IoCiAgICAgICAgICAgICAgICAiVGhlICdvcGVuYWknIGFuZCAncHlkdWInIGxpYnJhcmllcyBhcmUgcmVxdWlyZWQgZm9yIHRoZSBPcGVuQUlFbmdpbmUuIFBsZWFzZSBpbnN0YWxsIHRoZW0gdXNpbmcgJ3BpcCBpbnN0YWxsIG9wZW5haSBweWR1YicuIgogICAgICAgICAgICApCgogICAgICAgIGFwaV9rZXkgPSBvcy5nZXRlbnYoT1BFTkFJX0FQSV9LRVkpCiAgICAgICAgYmFzZV91cmwgPSBvcy5nZXRlbnYoT1BFTkFJX0JBU0VfVVJMKQogICAgICAgICMgQ2hlY2sgaWYgdGhlIGtleSBpcyBhbHJlYWR5IGluIHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZXM6CiAgICAgICAgaWYgbm90IGFwaV9rZXkgb3Igbm90IGJhc2VfdXJsOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpbXBvcnQgbWxydW4KCiAgICAgICAgICAgICAgICBjb250ZXh0ID0gbWxydW4uZ2V0X29yX2NyZWF0ZV9jdHgobmFtZT0iY29udGV4dCIpCiAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHRoZSBrZXkgaXMgaW4gdGhlIHNlY3JldHM6CiAgICAgICAgICAgICAgICBhcGlfa2V5ID0gY29udGV4dC5nZXRfc2VjcmV0KE9QRU5BSV9BUElfS0VZKQogICAgICAgICAgICAgICAgYmFzZV91cmwgPSBjb250ZXh0LmdldF9zZWNyZXQoT1BFTkFJX0JBU0VfVVJMKQogICAgICAgICAgICBleGNlcHQgTW9kdWxlTm90Rm91bmRFcnJvcjoKICAgICAgICAgICAgICAgIHJhaXNlIEVudmlyb25tZW50RXJyb3IoCiAgICAgICAgICAgICAgICAgICAgZiJPbmUgb3IgbW9yZSBvZiB0aGUgT3BlbkFJIHJlcXVpcmVkIGVudmlyb25tZW50IHZhcmlhYmxlcyAoJ3tPUEVOQUlfQVBJX0tFWX0nLCAne09QRU5BSV9CQVNFX1VSTH0nKSBhcmUgbWlzc2luZy4iCiAgICAgICAgICAgICAgICAgICAgZiJQbGVhc2Ugc2V0IHRoZW0gYXMgZW52aXJvbm1lbnQgdmFyaWFibGVzIG9yIGluc3RhbGwgbWxydW4gKGBwaXAgaW5zdGFsbCBtbHJ1bmApIgogICAgICAgICAgICAgICAgICAgIGYiYW5kIHNldCB0aGVtIGFzIHByb2plY3Qgc2VjcmV0cyB1c2luZyBgcHJvamVjdC5zZXRfc2VjcmV0c2AuIgogICAgICAgICAgICAgICAgKQoKICAgICAgICBzZWxmLmNsaWVudCA9IHNlbGYub3BlbmFpLk9wZW5BSShhcGlfa2V5PWFwaV9rZXksIGJhc2VfdXJsPWJhc2VfdXJsKQogICAgICAgIHNlbGYubW9kZWwgPSBtb2RlbAogICAgICAgIHNlbGYuZmlsZV9mb3JtYXQgPSBmaWxlX2Zvcm1hdAogICAgICAgIHNlbGYuc3BlZWQgPSBzcGVlZAoKICAgIGRlZiBfZ2VuZXJhdGVfYXVkaW8oc2VsZiwgdGV4dDogc3RyLCB2b2ljZTogc3RyKSAtPiBucC5uZGFycmF5OgogICAgICAgICMgR2VuZXJhdGUgd29yZHMgYXVkaW86CiAgICAgICAgYXVkaW8gPSBzZWxmLmNsaWVudC5hdWRpby5zcGVlY2guY3JlYXRlKAogICAgICAgICAgICBtb2RlbD1zZWxmLm1vZGVsLAogICAgICAgICAgICBpbnB1dD10ZXh0LAogICAgICAgICAgICB2b2ljZT12b2ljZSwKICAgICAgICAgICAgcmVzcG9uc2VfZm9ybWF0PXNlbGYuZmlsZV9mb3JtYXQsCiAgICAgICAgICAgIHNwZWVkPXNlbGYuc3BlZWQsCiAgICAgICAgKQogICAgICAgIGF1ZGlvID0gYXVkaW8uY29udGVudAogICAgICAgIGF1ZGlvID0gc2VsZi5fYnl0ZXNfdG9fbnBfYXJyYXkoYXVkaW89YXVkaW8pCiAgICAgICAgcmV0dXJuIGF1ZGlvCgogICAgZGVmIF9ieXRlc190b19ucF9hcnJheShzZWxmLCBhdWRpbzogYnl0ZXMpOgogICAgICAgIGlmIHNlbGYuZmlsZV9mb3JtYXQgPT0gIm1wMyI6CiAgICAgICAgICAgIGF1ZGlvX3NlZ21lbnQgPSBzZWxmLnB5ZHViLkF1ZGlvU2VnbWVudC5mcm9tX21wMyhpby5CeXRlc0lPKGF1ZGlvKSkKCiAgICAgICAgICAgICMgQ29udmVydCB0byByYXcgUENNIGF1ZGlvIGRhdGEKICAgICAgICAgICAgc2FtcGxlcyA9IGF1ZGlvX3NlZ21lbnQuZ2V0X2FycmF5X29mX3NhbXBsZXMoKQoKICAgICAgICAgICAgIyBDb252ZXJ0IHRvIG51bXB5IGFycmF5CiAgICAgICAgICAgIGF1ZGlvX2FycmF5ID0gbnAuYXJyYXkoc2FtcGxlcykKCiAgICAgICAgICAgICMgTm9ybWFsaXplIHRvIGZsb2F0IGJldHdlZW4gLTEgYW5kIDEKICAgICAgICAgICAgcmV0dXJuIGF1ZGlvX2FycmF5LmFzdHlwZShucC5mbG9hdDMyKSAvIG5wLmlpbmZvKHNhbXBsZXMudHlwZWNvZGUpLm1heAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBucC5mcm9tYnVmZmVyKGF1ZGlvLCBkdHlwZT1ucC5pbnQxNikgLyAzMjc2OC4wCgoKZGVmIF9nZXRfZW5naW5lKGVuZ2luZTogc3RyLCBmaWxlX2Zvcm1hdDogc3RyLCAqKmt3YXJncykgLT4gU3BlZWNoRW5naW5lOgogICAgIyBlbGltaW5hdGUgdGhlIE5vbmUgdmFsdWVzOgogICAga3dhcmdzID0ge2tleTogdmFsdWUgZm9yIGtleSwgdmFsdWUgaW4ga3dhcmdzLml0ZW1zKCkgaWYgdmFsdWUgaXMgbm90IE5vbmV9CgogICAgaWYgZW5naW5lID09ICJiYXJrIjoKICAgICAgICByZXR1cm4gQmFya0VuZ2luZSgqKmt3YXJncykKICAgIGVsaWYgZW5naW5lID09ICJvcGVuYWkiOgogICAgICAgIHJldHVybiBPcGVuQUlFbmdpbmUoZmlsZV9mb3JtYXQ9ZmlsZV9mb3JtYXQsICoqa3dhcmdzKQogICAgZWxzZToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKAogICAgICAgICAgICBmIlVucmVjb2duaXplZCBlbmdpbmUuIFRoZSBwYXJhbWV0ZXIgYGVuZ2luZWAgbXVzdCBiZSBlaXRoZXIgJ2JhcmsnIG9yICdvcGVuYWknLiBHaXZlbjoge2VuZ2luZX0iCiAgICAgICAgKQoKZGVmIF9nZXRfdGV4dF9maWxlcygKICAgIGRhdGFfcGF0aDogcGF0aGxpYi5QYXRoLAopIC0+IExpc3RbcGF0aGxpYi5QYXRoXToKICAgICMgQ2hlY2sgaWYgdGhlIHBhdGggaXMgb2YgYSBkaXJlY3Rvcnkgb3IgYSBmaWxlOgogICAgaWYgZGF0YV9wYXRoLmlzX2RpcigpOgogICAgICAgICMgR2V0IGFsbCBmaWxlcyBpbnNpZGUgdGhlIGRpcmVjdG9yeToKICAgICAgICB0ZXh0X2ZpbGVzID0gbGlzdChkYXRhX3BhdGguZ2xvYigiKi4qIikpCiAgICBlbGlmIGRhdGFfcGF0aC5pc19maWxlKCk6CiAgICAgICAgdGV4dF9maWxlcyA9IFtkYXRhX3BhdGhdCiAgICBlbHNlOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCiAgICAgICAgICAgIGYiVW5yZWNvZ25pemVkIGRhdGEgcGF0aC4gVGhlIHBhcmFtZXRlciBgZGF0YV9wYXRoYCBtdXN0IGJlIGVpdGhlciBhIGRpcmVjdG9yeSBwYXRoIG9yIGEgZmlsZSBwYXRoLiAiCiAgICAgICAgICAgIGYiR2l2ZW46IHtzdHIoZGF0YV9wYXRoKX0gIgogICAgICAgICkKCiAgICByZXR1cm4gdGV4dF9maWxlcwoKCmRlZiBfc3BsaXRfbGluZShsaW5lOiBzdHIsIG1heF9sZW5ndGg6IGludCA9IDI1MCkgLT4gTGlzdFtzdHJdOgogICAgaWYgbGVuKGxpbmUpIDwgbWF4X2xlbmd0aDoKICAgICAgICByZXR1cm4gW2xpbmVdCgogICAgc2VudGVuY2VzID0gWwogICAgICAgIGYie3NlbnRlbmNlLnN0cmlwKCl9LiIgZm9yIHNlbnRlbmNlIGluIGxpbmUuc3BsaXQoIi4iKSBpZiBzZW50ZW5jZS5zdHJpcCgpCiAgICBdCgogICAgc3BsaXRzID0gW10KICAgIGN1cnJlbnRfbGVuZ3RoID0gbGVuKHNlbnRlbmNlc1swXSkKICAgIHNwbGl0ID0gc2VudGVuY2VzWzBdCiAgICBmb3Igc2VudGVuY2UgaW4gc2VudGVuY2VzWzE6XToKICAgICAgICBpZiBjdXJyZW50X2xlbmd0aCArIGxlbihzZW50ZW5jZSkgPiBtYXhfbGVuZ3RoOgogICAgICAgICAgICBzcGxpdHMuYXBwZW5kKHNwbGl0KQogICAgICAgICAgICBzcGxpdCA9IHNlbnRlbmNlCiAgICAgICAgICAgIGN1cnJlbnRfbGVuZ3RoID0gbGVuKHNlbnRlbmNlKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGN1cnJlbnRfbGVuZ3RoICs9IGxlbihzZW50ZW5jZSkKICAgICAgICAgICAgc3BsaXQgKz0gIiAiICsgc2VudGVuY2UKICAgIGlmIHNwbGl0OgogICAgICAgIHNwbGl0cy5hcHBlbmQoc3BsaXQpCgogICAgcmV0dXJuIHNwbGl0cwoKCmRlZiBfZ2V0X2xvZ2dlcigpOgogICAgZ2xvYmFsIF9MT0dHRVIKICAgIHRyeToKICAgICAgICBpbXBvcnQgbWxydW4KCiAgICAgICAgIyBDaGVjayBpZiBNTFJ1biBpcyBhdmFpbGFibGU6CiAgICAgICAgY29udGV4dCA9IG1scnVuLmdldF9vcl9jcmVhdGVfY3R4KG5hbWU9Im1scnVuIikKICAgICAgICByZXR1cm4gY29udGV4dC5sb2dnZXIKICAgIGV4Y2VwdCBNb2R1bGVOb3RGb3VuZEVycm9yOgogICAgICAgIHJldHVybiBfTE9HR0VSCg==
    code_origin: ''
    base_image: mlrun/mlrun
    requirements:
    - torchaudio
    - pydub
    origin_filename: ''
  image: ''
  disable_auto_mount: false
  entry_points:
    generate_multi_speakers_audio:
      has_kwargs: false
      name: generate_multi_speakers_audio
      doc: Generate audio files from text files.
      has_varargs: false
      lineno: 38
      parameters:
      - name: data_path
        type: str
        doc: Path to the text file or directory containing the text files to generate
          audio from.
      - name: speakers
        type: Union[List[str], Dict[str, int]]
        doc: List / Dict of speakers to generate audio for. If a list is given, the
          speakers will be assigned to channels in the order given. If dictionary,
          the keys will be the speakers and the values will be the channels.
      - name: available_voices
        type: List[str]
        doc: 'List of available voices to use for the generation. See here for the
          available voices for bark engine: https://suno-ai.notion.site/8b8e8749ed514b0cbf3f699013548683?v=bc67cff786b04b50b3ceb756fd05f68c
          See here for the available voices for openai engine: https://beta.openai.com/docs/api-reference/speech'
      - name: engine
        type: str
        doc: The engine to use for the generation. Select either "bark" or "openai".
          Default is "openai".
        default: openai
      - name: output_directory
        type: str
        doc: Path to the directory to save the generated audio files to.
        default: null
      - name: use_gpu
        type: Optional[bool]
        doc: Whether to use the GPU for the generation. Supported only in "bark" engine.
        default: null
      - name: use_small_models
        type: Optional[bool]
        doc: Whether to use the small models for the generation. Supported only in
          "bark" engine.
        default: null
      - name: offload_cpu
        type: Optional[bool]
        doc: To reduce the memory footprint, the models can be offloaded to the CPU
          after loading. Supported only in "bark" engine.
        default: null
      - name: model
        type: Optional[str]
        doc: Which model to use for the generation. Supported only in "openai" engine.
          Default is "tts-1".
        default: null
      - name: speed
        type: Optional[float]
        doc: The speed of the generated audio. Select a value from `0.25` to `4.0`.
          `1.0` is the default.
        default: null
      - name: sample_rate
        type: int
        doc: The sampling rate of the generated audio.
        default: 16000
      - name: file_format
        type: str
        doc: The format of the generated audio files.
        default: wav
      - name: verbose
        type: bool
        doc: Whether to print the progress of the generation.
        default: true
      - name: bits_per_sample
        type: Optional[int]
        doc: Changes the bit depth for the supported formats. Supported only in "wav"
          or "flac" formats.
        default: null
      outputs:
      - doc: 'A tuple of: - The output directory path. - The generated audio files
          dataframe. - The errors'' dictionary.'
        type: Tuple[str, pd.DataFrame, dict]
  default_handler: generate_multi_speakers_audio
  description: Generate audio file from text using different speakers
verbose: false
kind: job
