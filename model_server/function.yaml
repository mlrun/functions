kind: remote
metadata:
  name: model-server
  hash: 6b4e354be566a717534cb723359dd77f568982ab
  project: default
  labels:
    author: yaronh
    framework: sklearn
  categories:
  - serving
  - ml
spec:
  command: ''
  args: []
  image: ''
  description: generic sklearn model server
  min_replicas: 1
  max_replicas: 4
  env:
  - name: MODEL_CLASS
    value: ClassifierModel
  - name: ENABLE_EXPLAINER
    value: 'False'
  config:
    spec.triggers.http:
      kind: http
      maxWorkers: 8
      attributes:
        ingresses: {}
      annotations: {}
  base_spec:
    apiVersion: nuclio.io/v1
    kind: job
    metadata:
      annotations:
        nuclio.io/generated_by: function generated from 28-10-2020 by admin
      labels: {}
      name: model-server
    spec:
      build:
        commands:
        - python -m pip install numpy cloudpickle v3io sklearn mlrun
        - python -m pip install --upgrade pip
        - pip install urllib3==1.25.10
        functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKZnJvbSBjbG91ZHBpY2tsZSBpbXBvcnQgbG9hZApmcm9tIHR5cGluZyBpbXBvcnQgTGlzdApmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQpmcm9tIHNrbGVhcm4uZGF0YXNldHMgaW1wb3J0IGxvYWRfaXJpcwoKaW1wb3J0IHdhcm5pbmdzCndhcm5pbmdzLmZpbHRlcndhcm5pbmdzKCdpZ25vcmUnKQoKaW1wb3J0IG9zCmltcG9ydCBudW1weSBhcyBucAppbXBvcnQgbWxydW4KCmNsYXNzIENsYXNzaWZpZXJNb2RlbChtbHJ1bi5ydW50aW1lcy5NTE1vZGVsU2VydmVyKToKICAgIGRlZiBsb2FkKHNlbGYpOgogICAgICAgICIiIkxvYWQgbW9kZWwgZnJvbSBzdG9yYWdlLiIiIgogICAgICAgIG1vZGVsX2ZpbGUsIGV4dHJhX2RhdGEgPSBzZWxmLmdldF9tb2RlbCgnLnBrbCcpCiAgICAgICAgc2VsZi5tb2RlbCA9IGxvYWQob3Blbihtb2RlbF9maWxlLCAncmInKSkKCiAgICBkZWYgcHJlZGljdChzZWxmLCBib2R5OiBkaWN0KSAtPiBMaXN0OgogICAgICAgICIiIkdlbmVyYXRlIG1vZGVsIHByZWRpY3Rpb25zIGZyb20gc2FtcGxlLgogICAgICAgIAogICAgICAgIDpwYXJhbSBib2R5IDogQSBkaWN0IG9mIG9ic2VydmF0aW9ucywgZWFjaCBvZiB3aGljaCBpcyBhbiAxLWRpbWVuc2lvbmFsIGZlYXR1cmUgdmVjdG9yLgogICAgICAgICAgICAKICAgICAgICBSZXR1cm5zIG1vZGVsIHByZWRpY3Rpb25zIGFzIGEgYExpc3RgLCBvbmUgZm9yIGVhY2ggcm93IGluIHRoZSBgYm9keWAgaW5wdXQgYExpc3RgLgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgZmVhdHMgPSBucC5hc2FycmF5KGJvZHlbJ2luc3RhbmNlcyddKQogICAgICAgICAgICByZXN1bHQ6IG5wLm5kYXJyYXkgPSBzZWxmLm1vZGVsLnByZWRpY3QoZmVhdHMpCiAgICAgICAgICAgIHJlc3AgPSByZXN1bHQudG9saXN0KCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbihmIkZhaWxlZCB0byBwcmVkaWN0IHtlfSIpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHJlc3AKCgpmcm9tIG1scnVuLnJ1bnRpbWVzIGltcG9ydCBudWNsaW9faW5pdF9ob29rCmRlZiBpbml0X2NvbnRleHQoY29udGV4dCk6CiAgICBudWNsaW9faW5pdF9ob29rKGNvbnRleHQsIGdsb2JhbHMoKSwgJ3NlcnZpbmcnKQoKZGVmIGhhbmRsZXIoY29udGV4dCwgZXZlbnQpOgogICAgcmV0dXJuIGNvbnRleHQubWxydW5faGFuZGxlcihjb250ZXh0LCBldmVudCkK
        noBaseImagesPull: true
      env:
      - name: MODEL_CLASS
        value: ClassifierModel
      handler: model_server:handler
      image: mlrun/mlrun
      maxReplicas: 1
      runtime: python:3.6
      volumes: []
  source: ''
  function_kind: serving
