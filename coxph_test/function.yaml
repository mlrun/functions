kind: job
metadata:
  name: cox-test
  tag: ''
  hash: 357e4956dc86d43e9b8a63ce98e3ce67cdbda638
  project: ''
  labels:
    author: yjb
    framework: survival
  categories:
  - ml
  - test
spec:
  command: ''
  args: []
  image: mlrun/ml-models:0.4.8
  env: []
  default_handler: cox_test
  entry_points:
    cox_test:
      name: cox_test
      doc: "Test one or more classifier models against held-out dataset\n\nUsing held-out\
        \ test features, evaluates the peformance of the estimated model\n\nCan be\
        \ part of a kubeflow pipeline as a test step that is run post EDA and \ntraining/validation\
        \ cycles"
      parameters:
      - name: context
        doc: the function context
      - name: models_path
        type: DataItem
      - name: test_set
        type: DataItem
        doc: test features and labels
      - name: label_column
        type: str
        doc: column name for ground truth labels
      - name: plots_dest
        type: str
        doc: dir for test plots
        default: plots
      - name: model_evaluator
        doc: 'WIP: specific method to generate eval, passed in as string or available
          in this folder'
      outputs: []
      lineno: 13
  description: test a classifier using held-out or new data
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlciBvbiAyMDIwLTA1LTEzIDIwOjQ2CgppbXBvcnQgd2FybmluZ3MKd2FybmluZ3Muc2ltcGxlZmlsdGVyKGFjdGlvbj0iaWdub3JlIiwgY2F0ZWdvcnk9RnV0dXJlV2FybmluZykKCmltcG9ydCBvcwppbXBvcnQgcGFuZGFzIGFzIHBkCmZyb20gbWxydW4uZGF0YXN0b3JlIGltcG9ydCBEYXRhSXRlbQpmcm9tIG1scnVuLmFydGlmYWN0cyBpbXBvcnQgZ2V0X21vZGVsCmZyb20gY2xvdWRwaWNrbGUgaW1wb3J0IGxvYWQKZnJvbSBtbHJ1bi5tbHV0aWxzIGltcG9ydCBldmFsX2NsYXNzX21vZGVsCgpkZWYgY294X3Rlc3QoCiAgICBjb250ZXh0LAogICAgbW9kZWxzX3BhdGg6IERhdGFJdGVtLCAKICAgIHRlc3Rfc2V0OiBEYXRhSXRlbSwKICAgIGxhYmVsX2NvbHVtbjogc3RyLAogICAgcGxvdHNfZGVzdDogc3RyID0gInBsb3RzIiwKICAgIG1vZGVsX2V2YWx1YXRvciA9IE5vbmUKKSAtPiBOb25lOgogICAgIiIiVGVzdCBvbmUgb3IgbW9yZSBjbGFzc2lmaWVyIG1vZGVscyBhZ2FpbnN0IGhlbGQtb3V0IGRhdGFzZXQKICAgIAogICAgVXNpbmcgaGVsZC1vdXQgdGVzdCBmZWF0dXJlcywgZXZhbHVhdGVzIHRoZSBwZWZvcm1hbmNlIG9mIHRoZSBlc3RpbWF0ZWQgbW9kZWwKICAgIAogICAgQ2FuIGJlIHBhcnQgb2YgYSBrdWJlZmxvdyBwaXBlbGluZSBhcyBhIHRlc3Qgc3RlcCB0aGF0IGlzIHJ1biBwb3N0IEVEQSBhbmQgCiAgICB0cmFpbmluZy92YWxpZGF0aW9uIGN5Y2xlcwogICAgCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICB0aGUgZnVuY3Rpb24gY29udGV4dAogICAgOnBhcmFtIG1vZGVsX2ZpbGU6ICAgICAgbW9kZWwgYXJ0aWZhY3QgdG8gYmUgdGVzdGVkCiAgICA6cGFyYW0gdGVzdF9zZXQ6ICAgICAgICB0ZXN0IGZlYXR1cmVzIGFuZCBsYWJlbHMKICAgIDpwYXJhbSBsYWJlbF9jb2x1bW46ICAgIGNvbHVtbiBuYW1lIGZvciBncm91bmQgdHJ1dGggbGFiZWxzCiAgICA6cGFyYW0gc2NvcmVfbWV0aG9kOiAgICBmb3IgbXVsdGljbGFzcyBjbGFzc2lmaWNhdGlvbgogICAgOnBhcmFtIHBsb3RzX2Rlc3Q6ICAgICAgZGlyIGZvciB0ZXN0IHBsb3RzCiAgICA6cGFyYW0gbW9kZWxfZXZhbHVhdG9yOiBXSVA6IHNwZWNpZmljIG1ldGhvZCB0byBnZW5lcmF0ZSBldmFsLCBwYXNzZWQgaW4gYXMgc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBhdmFpbGFibGUgaW4gdGhpcyBmb2xkZXIKICAgICIiIiAgCiAgICB4dGVzdCA9IHRlc3Rfc2V0LmFzX2RmKCkKICAgIHl0ZXN0ID0geHRlc3QucG9wKGxhYmVsX2NvbHVtbikKICAgIAogICAgbW9kZWxfZmlsZSwgbW9kZWxfb2JqLCBfID0gZ2V0X21vZGVsKG1vZGVsc19wYXRoLnVybCwgc3VmZml4PScucGtsJykKICAgIG1vZGVsX29iaiA9IGxvYWQob3BlbihzdHIobW9kZWxfZmlsZSksICJyYiIpKQoKICAgIHRyeToKICAgICAgICBpZiBub3QgbW9kZWxfZXZhbHVhdG9yOgogICAgICAgICAgICBldmFsX21ldHJpY3MgPSBldmFsX2NsYXNzX21vZGVsKGNvbnRleHQsIHh0ZXN0LCB5dGVzdCwgbW9kZWxfb2JqKQoKICAgICAgICBtb2RlbF9wbG90cyA9IGV2YWxfbWV0cmljcy5wb3AoInBsb3RzIikKICAgICAgICBtb2RlbF90YWJsZXMgPSBldmFsX21ldHJpY3MucG9wKCJ0YWJsZXMiKQogICAgICAgIGZvciBwbG90IGluIG1vZGVsX3Bsb3RzOgogICAgICAgICAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChwbG90LCBsb2NhbF9wYXRoPWYie3Bsb3RzX2Rlc3R9L3twbG90LmtleX0uaHRtbCIpCiAgICAgICAgZm9yIHRibCBpbiBtb2RlbF90YWJsZXM6CiAgICAgICAgICAgIGNvbnRleHQubG9nX2FydGlmYWN0KHRibCwgbG9jYWxfcGF0aD1mIntwbG90c19kZXN0fS97cGxvdC5rZXl9LmNzdiIpCgogICAgICAgIGNvbnRleHQubG9nX3Jlc3VsdHMoZXZhbF9tZXRyaWNzKQogICAgZXhjZXB0OgogICAgICAgIGNvbnRleHQubG9nX2RhdGFzZXQoImNveC10ZXN0LXN1bW1hcnkiLCBkZj1tb2RlbF9vYmouc3VtbWFyeSwgaW5kZXg9VHJ1ZSwgZm9ybWF0PSJjc3YiKQogICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oImNveCB0ZXN0ZXIgbm90IGltcGxlbWVudGVkIikKCg==
    commands: []
    code_origin: https://github.com/yjb-ds/functions.git#8645360c007329479cd2978eba44ef4c2784e859:cox_test.ipynb
