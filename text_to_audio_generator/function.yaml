spec:
  image: ''
  default_handler: generate_multi_speakers_audio
  build:
    functionSourceCode: IyBDb3B5cmlnaHQgMjAyMyBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAojCiMgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQojIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiMgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiMgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAojIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgppbXBvcnQgaW8KaW1wb3J0IGxvZ2dpbmcKaW1wb3J0IG9zCmltcG9ydCBwYXRobGliCmltcG9ydCByYW5kb20KaW1wb3J0IHRlbXBmaWxlCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBMaXN0LCBPcHRpb25hbCwgVHVwbGUsIFVuaW9uCgppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IG9wZW5haQppbXBvcnQgcGFuZGFzIGFzIHBkCmltcG9ydCB0b3JjaAppbXBvcnQgdG9yY2hhdWRpbwppbXBvcnQgdHFkbQpmcm9tIHB5ZHViIGltcG9ydCBBdWRpb1NlZ21lbnQKCiMgR2V0IHRoZSBnbG9iYWwgbG9nZ2VyOgpfTE9HR0VSID0gbG9nZ2luZy5nZXRMb2dnZXIoKQoKT1BFTkFJX0FQSV9LRVkgPSAiT1BFTkFJX0FQSV9LRVkiCk9QRU5BSV9CQVNFX1VSTCA9ICJPUEVOQUlfQkFTRV9VUkwiClNBTVBMRV9SQVRFID0gMjQwMDAKCgpkZWYgZ2VuZXJhdGVfbXVsdGlfc3BlYWtlcnNfYXVkaW8oCiAgICBkYXRhX3BhdGg6IHN0ciwKICAgIHNwZWFrZXJzOiBVbmlvbltMaXN0W3N0cl0sIERpY3Rbc3RyLCBpbnRdXSwKICAgIGF2YWlsYWJsZV92b2ljZXM6IExpc3Rbc3RyXSwKICAgIG91dHB1dF9kaXJlY3Rvcnk6IHN0ciA9IE5vbmUsCiAgICBtb2RlbDogc3RyID0gInR0cy0xIiwKICAgIHNhbXBsZV9yYXRlOiBpbnQgPSAxNjAwMCwKICAgIGZpbGVfZm9ybWF0OiBzdHIgPSAid2F2IiwKICAgIHZlcmJvc2U6IGJvb2wgPSBUcnVlLAogICAgYml0c19wZXJfc2FtcGxlOiBPcHRpb25hbFtpbnRdID0gTm9uZSwKICAgIHNwZWVkOiBmbG9hdCA9IDEuMCwKKSAtPiBUdXBsZVtzdHIsIHBkLkRhdGFGcmFtZSwgZGljdF06CiAgICAiIiIKICAgIEdlbmVyYXRlIGF1ZGlvIGZpbGVzIGZyb20gdGV4dCBmaWxlcy4KCiAgICA6cGFyYW0gZGF0YV9wYXRoOiAgICAgICAgICAgUGF0aCB0byB0aGUgdGV4dCBmaWxlIG9yIGRpcmVjdG9yeSBjb250YWluaW5nIHRoZSB0ZXh0IGZpbGVzIHRvIGdlbmVyYXRlIGF1ZGlvIGZyb20uCiAgICA6cGFyYW0gc3BlYWtlcnM6ICAgICAgICAgICAgTGlzdCAvIERpY3Qgb2Ygc3BlYWtlcnMgdG8gZ2VuZXJhdGUgYXVkaW8gZm9yLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIGEgbGlzdCBpcyBnaXZlbiwgdGhlIHNwZWFrZXJzIHdpbGwgYmUgYXNzaWduZWQgdG8gY2hhbm5lbHMgaW4gdGhlIG9yZGVyIGdpdmVuLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIGRpY3Rpb25hcnksIHRoZSBrZXlzIHdpbGwgYmUgdGhlIHNwZWFrZXJzIGFuZCB0aGUgdmFsdWVzIHdpbGwgYmUgdGhlIGNoYW5uZWxzLgogICAgOnBhcmFtIGF2YWlsYWJsZV92b2ljZXM6ICAgIExpc3Qgb2YgYXZhaWxhYmxlIHZvaWNlcyB0byB1c2UgZm9yIHRoZSBnZW5lcmF0aW9uLgogICAgICAgICAgICAgICAgICAgICAgICBTZWUgaGVyZSBmb3IgdGhlIGF2YWlsYWJsZSB2b2ljZXM6CiAgICAgICAgICAgICAgICAgICAgICAgIGh0dHBzOi8vcGxhdGZvcm0ub3BlbmFpLmNvbS9kb2NzL2d1aWRlcy90ZXh0LXRvLXNwZWVjaCN2b2ljZS1vcHRpb25zCiAgICA6cGFyYW0gb3V0cHV0X2RpcmVjdG9yeTogICAgUGF0aCB0byB0aGUgZGlyZWN0b3J5IHRvIHNhdmUgdGhlIGdlbmVyYXRlZCBhdWRpbyBmaWxlcyB0by4KICAgIDpwYXJhbSBtb2RlbDogICAgICAgICAgICAgICBXaGljaCBtb2RlbCB0byB1c2UgZm9yIHRoZSBnZW5lcmF0aW9uLgogICAgOnBhcmFtIHNhbXBsZV9yYXRlOiAgICAgICAgIFRoZSBzYW1wbGluZyByYXRlIG9mIHRoZSBnZW5lcmF0ZWQgYXVkaW8uCiAgICA6cGFyYW0gZmlsZV9mb3JtYXQ6ICAgICAgICAgVGhlIGZvcm1hdCBvZiB0aGUgZ2VuZXJhdGVkIGF1ZGlvIGZpbGVzLgogICAgOnBhcmFtIHZlcmJvc2U6ICAgICAgICAgICAgIFdoZXRoZXIgdG8gcHJpbnQgdGhlIHByb2dyZXNzIG9mIHRoZSBnZW5lcmF0aW9uLgogICAgOnBhcmFtIGJpdHNfcGVyX3NhbXBsZTogICAgIENoYW5nZXMgdGhlIGJpdCBkZXB0aCBmb3IgdGhlIHN1cHBvcnRlZCBmb3JtYXRzLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN1cHBvcnRlZCBvbmx5IGluICJ3YXYiIG9yICJmbGFjIiBmb3JtYXRzLgogICAgOnBhcmFtIHNwZWVkOiAgICAgICAgICAgICAgIFRoZSBzcGVlZCBvZiB0aGUgZ2VuZXJhdGVkIGF1ZGlvLiBTZWxlY3QgYSB2YWx1ZSBmcm9tIGAwLjI1YCB0byBgNC4wYC4gYDEuMGAgaXMgdGhlIGRlZmF1bHQuCgogICAgOnJldHVybnM6ICAgICAgICAgICAgICAgICAgIEEgdHVwbGUgb2Y6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLSBUaGUgb3V0cHV0IGRpcmVjdG9yeSBwYXRoLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0gVGhlIGdlbmVyYXRlZCBhdWRpbyBmaWxlcyBkYXRhZnJhbWUuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLSBUaGUgZXJyb3JzJyBkaWN0aW9uYXJ5LgogICAgIiIiCgogICAgZ2xvYmFsIF9MT0dHRVIKICAgIF9MT0dHRVIgPSBfZ2V0X2xvZ2dlcigpCiAgICAjIEdldCB0aGUgaW5wdXQgdGV4dCBmaWxlcyB0byB0dXJuIHRvIGF1ZGlvOgogICAgZGF0YV9wYXRoID0gcGF0aGxpYi5QYXRoKGRhdGFfcGF0aCkuYWJzb2x1dGUoKQogICAgdGV4dF9maWxlcyA9IF9nZXRfdGV4dF9maWxlcyhkYXRhX3BhdGg9ZGF0YV9wYXRoKQoKICAgICMgY29ubmVjdCB0byBvcGVuYWkgY2xpZW50OgogICAgY2xpZW50ID0gX2dldF9vcGVuYWlfY2xpZW50KCkKCiAgICAjIENoZWNrIGZvciBwZXIgY2hhbm5lbCBnZW5lcmF0aW9uOgogICAgaWYgaXNpbnN0YW5jZShzcGVha2VycywgZGljdCk6CiAgICAgICAgc3BlYWtlcl9wZXJfY2hhbm5lbCA9IFRydWUKICAgICAgICAjIFNvcnQgdGhlIGdpdmVuIHNwZWFrZXJzIGJ5IGNoYW5uZWxzOgogICAgICAgIHNwZWFrZXJzID0gewogICAgICAgICAgICBzcGVha2VyOiBjaGFubmVsCiAgICAgICAgICAgIGZvciBzcGVha2VyLCBjaGFubmVsIGluIHNvcnRlZChzcGVha2Vycy5pdGVtcygpLCBrZXk9bGFtYmRhIGl0ZW06IGl0ZW1bMV0pCiAgICAgICAgfQogICAgZWxzZToKICAgICAgICBzcGVha2VyX3Blcl9jaGFubmVsID0gRmFsc2UKCiAgICAjIFByZXBhcmUgdGhlIHJlc2FtcGxpbmcgbW9kdWxlOgogICAgcmVzYW1wbGVyID0gdG9yY2hhdWRpby50cmFuc2Zvcm1zLlJlc2FtcGxlKAogICAgICAgIG9yaWdfZnJlcT1TQU1QTEVfUkFURSwgbmV3X2ZyZXE9c2FtcGxlX3JhdGUsIGR0eXBlPXRvcmNoLmZsb2F0MzIKICAgICkKCiAgICAjIFByZXBhcmUgdGhlIGdhcCBiZXR3ZWVuIGVhY2ggc3BlYWtlcjoKICAgIGdhcF9iZXR3ZWVuX3NwZWFrZXJzID0gbnAuemVyb3MoaW50KDAuNSAqIFNBTVBMRV9SQVRFKSkKCiAgICAjIFByZXBhcmUgdGhlIHN1Y2Nlc3NlcyBkYXRhZnJhbWUgYW5kIGVycm9ycyBkaWN0aW9uYXJ5IHRvIGJlIHJldHVybmVkOgogICAgc3VjY2Vzc2VzID0gW10KICAgIGVycm9ycyA9IHt9CgogICAgIyBDcmVhdGUgdGhlIG91dHB1dCBkaXJlY3Rvcnk6CiAgICBpZiBvdXRwdXRfZGlyZWN0b3J5IGlzIE5vbmU6CiAgICAgICAgb3V0cHV0X2RpcmVjdG9yeSA9IHRlbXBmaWxlLm1rZHRlbXAoKQogICAgb3V0cHV0X2RpcmVjdG9yeSA9IHBhdGhsaWIuUGF0aChvdXRwdXRfZGlyZWN0b3J5KQogICAgaWYgbm90IG91dHB1dF9kaXJlY3RvcnkuZXhpc3RzKCk6CiAgICAgICAgb3V0cHV0X2RpcmVjdG9yeS5ta2RpcihleGlzdF9vaz1UcnVlLCBwYXJlbnRzPVRydWUpCgogICAgIyBTdGFydCBnZW5lcmF0aW5nIGF1ZGlvOgogICAgIyBHbyBvdmVyIHRoZSBhdWRpbyBmaWxlcyBhbmQgdHJhbnNjcmliZToKICAgIGZvciB0ZXh0X2ZpbGUgaW4gdHFkbS50cWRtKAogICAgICAgIHRleHRfZmlsZXMsIGRlc2M9IkdlbmVyYXRpbmciLCB1bml0PSJmaWxlIiwgZGlzYWJsZT1ub3QgdmVyYm9zZQogICAgKToKCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFJhbmRvbWl6ZSB2b2ljZXMgZm9yIGVhY2ggc3BlYWtlcjoKICAgICAgICAgICAgY2hvc2VuX3ZvaWNlcyA9IHt9CiAgICAgICAgICAgIGF2YWlsYWJsZV92b2ljZXNfY29weSA9IGF2YWlsYWJsZV92b2ljZXMuY29weSgpCiAgICAgICAgICAgIGZvciBzcGVha2VyIGluIHNwZWFrZXJzOgogICAgICAgICAgICAgICAgdm9pY2UgPSByYW5kb20uY2hvaWNlKGF2YWlsYWJsZV92b2ljZXNfY29weSkKICAgICAgICAgICAgICAgIGNob3Nlbl92b2ljZXNbc3BlYWtlcl0gPSB2b2ljZQogICAgICAgICAgICAgICAgYXZhaWxhYmxlX3ZvaWNlc19jb3B5LnJlbW92ZSh2b2ljZSkKICAgICAgICAgICAgIyBSZWFkIHRleHQ6CiAgICAgICAgICAgIHdpdGggb3Blbih0ZXh0X2ZpbGUsICJyIikgYXMgZnA6CiAgICAgICAgICAgICAgICB0ZXh0ID0gZnAucmVhZCgpCiAgICAgICAgICAgICMgUHJlcGFyZSBhIGhvbGRlciBmb3IgYWxsIHRoZSBnZW5lcmF0ZWQgcGllY2VzIChpZiBwZXIgY2hhbm5lbCBlYWNoIHNwZWFrZXIgd2lsbCBoYXZlIGl0cyBvd24pOgogICAgICAgICAgICBhdWRpb19waWVjZXMgPSAoCiAgICAgICAgICAgICAgICB7c3BlYWtlcjogW10gZm9yIHNwZWFrZXIgaW4gc3BlYWtlcnN9CiAgICAgICAgICAgICAgICBpZiBzcGVha2VyX3Blcl9jaGFubmVsCiAgICAgICAgICAgICAgICBlbHNlIHsiYWxsIjogW119CiAgICAgICAgICAgICkKCiAgICAgICAgICAgICMgR2VuZXJhdGUgYXVkaW8gcGVyIGxpbmU6CiAgICAgICAgICAgIGZvciBsaW5lIGluIHRleHQuc3BsaXRsaW5lcygpOgogICAgICAgICAgICAgICAgIyBWYWxpZGF0ZSBsaW5lIGlzIGluIGNvcnJlY3Qgc3BlYWtlciBmb3JtYXQ6CgogICAgICAgICAgICAgICAgaWYgIjogIiBub3QgaW4gbGluZToKICAgICAgICAgICAgICAgICAgICBpZiB2ZXJib3NlOgogICAgICAgICAgICAgICAgICAgICAgICBfTE9HR0VSLndhcm5pbmcoZiJTa2lwcGluZyBsaW5lOiB7bGluZX0iKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAjIFNwbGl0IGxpbmUgdG8gc3BlYWtlciBhbmQgaGlzIHdvcmRzOgogICAgICAgICAgICAgICAgY3VycmVudF9zcGVha2VyLCBzZW50ZW5jZXMgPSBsaW5lLnNwbGl0KCI6ICIsIDEpCiAgICAgICAgICAgICAgICAjIFZhbGlkYXRlIHNwZWFrZXIgaXMga25vd246CiAgICAgICAgICAgICAgICBpZiBjdXJyZW50X3NwZWFrZXIgbm90IGluIHNwZWFrZXJzOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgICAgIGYiVW5rbm93biBzcGVha2VyOiB7Y3VycmVudF9zcGVha2VyfS4gR2l2ZW4gc3BlYWtlcnMgYXJlOiB7c3BlYWtlcnN9IgogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGZvciBzZW50ZW5jZSBpbiBfc3BsaXRfbGluZShsaW5lPXNlbnRlbmNlcyk6CiAgICAgICAgICAgICAgICAgICAgIyBHZW5lcmF0ZSB3b3JkcyBhdWRpbzoKICAgICAgICAgICAgICAgICAgICBhdWRpbyA9IGNsaWVudC5hdWRpby5zcGVlY2guY3JlYXRlKAogICAgICAgICAgICAgICAgICAgICAgICBtb2RlbD1tb2RlbCwKICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQ9c2VudGVuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHZvaWNlPWNob3Nlbl92b2ljZXNbY3VycmVudF9zcGVha2VyXSwKICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VfZm9ybWF0PWZpbGVfZm9ybWF0LAogICAgICAgICAgICAgICAgICAgICAgICBzcGVlZD1zcGVlZCwKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgYXVkaW8gPSBhdWRpby5jb250ZW50CiAgICAgICAgICAgICAgICAgICAgYXVkaW8gPSBfYnl0ZXNfdG9fbnBfYXJyYXkoYXVkaW89YXVkaW8sIGZpbGVfZm9ybWF0PWZpbGVfZm9ybWF0KQoKICAgICAgICAgICAgICAgICAgICBpZiBzcGVha2VyX3Blcl9jaGFubmVsOgogICAgICAgICAgICAgICAgICAgICAgICBzaWxlbmNlID0gbnAuemVyb3NfbGlrZShhdWRpbykKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHNwZWFrZXIgaW4gYXVkaW9fcGllY2VzLmtleXMoKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNwZWFrZXIgPT0gY3VycmVudF9zcGVha2VyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1ZGlvX3BpZWNlc1tzcGVha2VyXSArPSBbYXVkaW8sIGdhcF9iZXR3ZWVuX3NwZWFrZXJzXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdWRpb19waWVjZXNbc3BlYWtlcl0gKz0gW3NpbGVuY2UsIGdhcF9iZXR3ZWVuX3NwZWFrZXJzXQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGF1ZGlvX3BpZWNlc1siYWxsIl0gKz0gW2F1ZGlvLCBnYXBfYmV0d2Vlbl9zcGVha2Vyc10KICAgICAgICAgICAgIyBDb25zdHJ1Y3QgYSBzaW5nbGUgYXVkaW8gYXJyYXkgZnJvbSBhbGwgdGhlIHBpZWNlcyBhbmQgY2hhbm5lbHM6CgogICAgICAgICAgICBhdWRpbyA9IG5wLnZzdGFjaygKICAgICAgICAgICAgICAgIFtucC5jb25jYXRlbmF0ZShhdWRpb19waWVjZXNbc3BlYWtlcl0pIGZvciBzcGVha2VyIGluIHNwZWFrZXJzXQogICAgICAgICAgICApLmFzdHlwZShkdHlwZT1ucC5mbG9hdDMyKQogICAgICAgICAgICAjIFJlc2FtcGxlOgogICAgICAgICAgICBhdWRpbyA9IHRvcmNoLmZyb21fbnVtcHkoYXVkaW8pCiAgICAgICAgICAgIGF1ZGlvID0gcmVzYW1wbGVyKGF1ZGlvKQogICAgICAgICAgICAjIFNhdmUgdG8gYXVkaW8gZmlsZToKICAgICAgICAgICAgYXVkaW9fZmlsZSA9IG91dHB1dF9kaXJlY3RvcnkgLyBmInt0ZXh0X2ZpbGUuc3RlbX0ue2ZpbGVfZm9ybWF0fSIKCiAgICAgICAgICAgIHRvcmNoYXVkaW8uc2F2ZSgKICAgICAgICAgICAgICAgIHVyaT1zdHIoYXVkaW9fZmlsZSksCiAgICAgICAgICAgICAgICBzcmM9YXVkaW8sCiAgICAgICAgICAgICAgICBzYW1wbGVfcmF0ZT1zYW1wbGVfcmF0ZSwKICAgICAgICAgICAgICAgIGZvcm1hdD1maWxlX2Zvcm1hdCwKICAgICAgICAgICAgICAgIGJpdHNfcGVyX3NhbXBsZT1iaXRzX3Blcl9zYW1wbGUsCiAgICAgICAgICAgICkKCiAgICAgICAgICAgICMgQ29sbGVjdCB0byB0aGUgc3VjY2Vzc2VzOgogICAgICAgICAgICBzdWNjZXNzZXMuYXBwZW5kKFt0ZXh0X2ZpbGUubmFtZSwgYXVkaW9fZmlsZS5uYW1lXSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGV4Y2VwdGlvbjoKICAgICAgICAgICAgIyBOb3RlIHRoZSBleGNlcHRpb24gYXMgZXJyb3IgaW4gdGhlIGRpY3Rpb25hcnk6CiAgICAgICAgICAgIGlmIHZlcmJvc2U6CiAgICAgICAgICAgICAgICBfTE9HR0VSLndhcm5pbmcoZiJFcnJvciBpbiBmaWxlOiAne3RleHRfZmlsZS5uYW1lfSciKQogICAgICAgICAgICBwcmludChleGNlcHRpb24pCiAgICAgICAgICAgIGVycm9yc1t0ZXh0X2ZpbGUubmFtZV0gPSBzdHIoZXhjZXB0aW9uKQoKICAgICMgQ29uc3RydWN0IHRoZSB0cmFuc2xhdGlvbnMgZGF0YWZyYW1lOgogICAgc3VjY2Vzc2VzID0gcGQuRGF0YUZyYW1lKAogICAgICAgIHN1Y2Nlc3NlcywKICAgICAgICBjb2x1bW5zPVsidGV4dF9maWxlIiwgImF1ZGlvX2ZpbGUiXSwKICAgICkKCiAgICAjIFByaW50IHRoZSBoZWFkIG9mIHRoZSBwcm9kdWNlZCBkYXRhZnJhbWUgYW5kIHJldHVybjoKICAgIGlmIHZlcmJvc2U6CiAgICAgICAgX0xPR0dFUi5pbmZvKAogICAgICAgICAgICBmIkRvbmUgKHtzdWNjZXNzZXMuc2hhcGVbMF19L3tsZW4odGV4dF9maWxlcyl9KVxuIgogICAgICAgICAgICBmIlRyYW5zbGF0aW9ucyBzdW1tYXJ5OlxuIgogICAgICAgICAgICBmIntzdWNjZXNzZXMuaGVhZCgpfSIKICAgICAgICApCiAgICByZXR1cm4gc3RyKG91dHB1dF9kaXJlY3RvcnkpLCBzdWNjZXNzZXMsIGVycm9ycwoKCmRlZiBfZ2V0X29wZW5haV9jbGllbnQoKToKICAgIGFwaV9rZXkgPSBvcy5nZXRlbnYoT1BFTkFJX0FQSV9LRVkpCiAgICBiYXNlX3VybCA9IG9zLmdldGVudihPUEVOQUlfQkFTRV9VUkwpCiAgICAjIENoZWNrIGlmIHRoZSBrZXkgaXMgYWxyZWFkeSBpbiB0aGUgZW52aXJvbm1lbnQgdmFyaWFibGVzOgogICAgaWYgbm90IGFwaV9rZXkgb3Igbm90IGJhc2VfdXJsOgogICAgICAgIHRyeToKICAgICAgICAgICAgaW1wb3J0IG1scnVuCgogICAgICAgICAgICBjb250ZXh0ID0gbWxydW4uZ2V0X29yX2NyZWF0ZV9jdHgobmFtZT0iY29udGV4dCIpCiAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIGtleSBpcyBpbiB0aGUgc2VjcmV0czoKICAgICAgICAgICAgYXBpX2tleSA9IGNvbnRleHQuZ2V0X3NlY3JldChPUEVOQUlfQVBJX0tFWSkKICAgICAgICAgICAgYmFzZV91cmwgPSBjb250ZXh0LmdldF9zZWNyZXQoT1BFTkFJX0JBU0VfVVJMKQogICAgICAgIGV4Y2VwdCBNb2R1bGVOb3RGb3VuZEVycm9yOgogICAgICAgICAgICByYWlzZSBFbnZpcm9ubWVudEVycm9yKAogICAgICAgICAgICAgICAgZiJPbmUgb3IgbW9yZSBvZiB0aGUgT3BlbkFJIHJlcXVpcmVkIGVudmlyb25tZW50IHZhcmlhYmxlcyAoJ3tPUEVOQUlfQVBJX0tFWX0nLCAne09QRU5BSV9CQVNFX1VSTH0nKSBhcmUgbWlzc2luZy4iCiAgICAgICAgICAgICAgICBmIlBsZWFzZSBzZXQgdGhlbSBhcyBlbnZpcm9ubWVudCB2YXJpYWJsZXMgb3IgaW5zdGFsbCBtbHJ1biAoYHBpcCBpbnN0YWxsIG1scnVuYCkiCiAgICAgICAgICAgICAgICBmImFuZCBzZXQgdGhlbSBhcyBwcm9qZWN0IHNlY3JldHMgdXNpbmcgYHByb2plY3Quc2V0X3NlY3JldHNgLiIKICAgICAgICAgICAgKQogICAgcmV0dXJuIG9wZW5haS5PcGVuQUkoYXBpX2tleT1hcGlfa2V5LCBiYXNlX3VybD1iYXNlX3VybCkKCgpkZWYgX2J5dGVzX3RvX25wX2FycmF5KGF1ZGlvOiBieXRlcywgZmlsZV9mb3JtYXQ6IHN0cik6CiAgICBpZiBmaWxlX2Zvcm1hdCA9PSAibXAzIjoKICAgICAgICBhdWRpb19zZWdtZW50ID0gQXVkaW9TZWdtZW50LmZyb21fbXAzKGlvLkJ5dGVzSU8oYXVkaW8pKQoKICAgICAgICAjIENvbnZlcnQgdG8gcmF3IFBDTSBhdWRpbyBkYXRhCiAgICAgICAgc2FtcGxlcyA9IGF1ZGlvX3NlZ21lbnQuZ2V0X2FycmF5X29mX3NhbXBsZXMoKQoKICAgICAgICAjIENvbnZlcnQgdG8gbnVtcHkgYXJyYXkKICAgICAgICBhdWRpb19hcnJheSA9IG5wLmFycmF5KHNhbXBsZXMpCgogICAgICAgICMgTm9ybWFsaXplIHRvIGZsb2F0IGJldHdlZW4gLTEgYW5kIDEKICAgICAgICByZXR1cm4gYXVkaW9fYXJyYXkuYXN0eXBlKG5wLmZsb2F0MzIpIC8gbnAuaWluZm8oc2FtcGxlcy50eXBlY29kZSkubWF4CiAgICBlbHNlOgogICAgICAgIHJldHVybiBucC5mcm9tYnVmZmVyKGF1ZGlvLCBkdHlwZT1ucC5pbnQxNikgLyAzMjc2OC4wCgoKZGVmIF9nZXRfdGV4dF9maWxlcygKICAgIGRhdGFfcGF0aDogcGF0aGxpYi5QYXRoLAopIC0+IExpc3RbcGF0aGxpYi5QYXRoXToKICAgICMgQ2hlY2sgaWYgdGhlIHBhdGggaXMgb2YgYSBkaXJlY3Rvcnkgb3IgYSBmaWxlOgogICAgaWYgZGF0YV9wYXRoLmlzX2RpcigpOgogICAgICAgICMgR2V0IGFsbCBmaWxlcyBpbnNpZGUgdGhlIGRpcmVjdG9yeToKICAgICAgICB0ZXh0X2ZpbGVzID0gbGlzdChkYXRhX3BhdGguZ2xvYigiKi4qIikpCiAgICBlbGlmIGRhdGFfcGF0aC5pc19maWxlKCk6CiAgICAgICAgdGV4dF9maWxlcyA9IFtkYXRhX3BhdGhdCiAgICBlbHNlOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCiAgICAgICAgICAgIGYiVW5yZWNvZ25pemVkIGRhdGEgcGF0aC4gVGhlIHBhcmFtZXRlciBgZGF0YV9wYXRoYCBtdXN0IGJlIGVpdGhlciBhIGRpcmVjdG9yeSBwYXRoIG9yIGEgZmlsZSBwYXRoLiAiCiAgICAgICAgICAgIGYiR2l2ZW46IHtzdHIoZGF0YV9wYXRoKX0gIgogICAgICAgICkKCiAgICByZXR1cm4gdGV4dF9maWxlcwoKCmRlZiBfc3BsaXRfbGluZShsaW5lOiBzdHIsIG1heF9sZW5ndGg6IGludCA9IDI1MCkgLT4gTGlzdFtzdHJdOgogICAgaWYgbGVuKGxpbmUpIDwgbWF4X2xlbmd0aDoKICAgICAgICByZXR1cm4gW2xpbmVdCgogICAgc2VudGVuY2VzID0gWwogICAgICAgIGYie3NlbnRlbmNlLnN0cmlwKCl9LiIgZm9yIHNlbnRlbmNlIGluIGxpbmUuc3BsaXQoIi4iKSBpZiBzZW50ZW5jZS5zdHJpcCgpCiAgICBdCgogICAgc3BsaXRzID0gW10KICAgIGN1cnJlbnRfbGVuZ3RoID0gbGVuKHNlbnRlbmNlc1swXSkKICAgIHNwbGl0ID0gc2VudGVuY2VzWzBdCiAgICBmb3Igc2VudGVuY2UgaW4gc2VudGVuY2VzWzE6XToKICAgICAgICBpZiBjdXJyZW50X2xlbmd0aCArIGxlbihzZW50ZW5jZSkgPiBtYXhfbGVuZ3RoOgogICAgICAgICAgICBzcGxpdHMuYXBwZW5kKHNwbGl0KQogICAgICAgICAgICBzcGxpdCA9IHNlbnRlbmNlCiAgICAgICAgICAgIGN1cnJlbnRfbGVuZ3RoID0gbGVuKHNlbnRlbmNlKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGN1cnJlbnRfbGVuZ3RoICs9IGxlbihzZW50ZW5jZSkKICAgICAgICAgICAgc3BsaXQgKz0gIiAiICsgc2VudGVuY2UKICAgIGlmIHNwbGl0OgogICAgICAgIHNwbGl0cy5hcHBlbmQoc3BsaXQpCgogICAgcmV0dXJuIHNwbGl0cwoKCmRlZiBfZ2V0X2xvZ2dlcigpOgogICAgZ2xvYmFsIF9MT0dHRVIKICAgIHRyeToKICAgICAgICBpbXBvcnQgbWxydW4KCiAgICAgICAgIyBDaGVjayBpZiBNTFJ1biBpcyBhdmFpbGFibGU6CiAgICAgICAgY29udGV4dCA9IG1scnVuLmdldF9vcl9jcmVhdGVfY3R4KG5hbWU9Im1scnVuIikKICAgICAgICByZXR1cm4gY29udGV4dC5sb2dnZXIKICAgIGV4Y2VwdCBNb2R1bGVOb3RGb3VuZEVycm9yOgogICAgICAgIHJldHVybiBfTE9HR0VSCg==
    requirements:
    - openai
    - torchaudio
    - pydub
    origin_filename: ''
    base_image: mlrun/mlrun
    code_origin: ''
  command: ''
  disable_auto_mount: false
  description: Generate audio file from text using different speakers
  entry_points:
    generate_multi_speakers_audio:
      has_varargs: false
      doc: Generate audio files from text files.
      name: generate_multi_speakers_audio
      outputs:
      - doc: 'A tuple of: - The output directory path. - The generated audio files
          dataframe. - The errors'' dictionary.'
        type: Tuple[str, pd.DataFrame, dict]
      has_kwargs: false
      parameters:
      - name: data_path
        type: str
        doc: Path to the text file or directory containing the text files to generate
          audio from.
      - name: speakers
        type: Union[List[str], Dict[str, int]]
        doc: List / Dict of speakers to generate audio for. If a list is given, the
          speakers will be assigned to channels in the order given. If dictionary,
          the keys will be the speakers and the values will be the channels.
      - name: available_voices
        type: List[str]
        doc: 'List of available voices to use for the generation. See here for the
          available voices: https://platform.openai.com/docs/guides/text-to-speech#voice-options'
      - name: output_directory
        type: str
        doc: Path to the directory to save the generated audio files to.
        default: null
      - name: model
        type: str
        doc: Which model to use for the generation.
        default: tts-1
      - name: sample_rate
        type: int
        doc: The sampling rate of the generated audio.
        default: 16000
      - name: file_format
        type: str
        doc: The format of the generated audio files.
        default: wav
      - name: verbose
        type: bool
        doc: Whether to print the progress of the generation.
        default: true
      - name: bits_per_sample
        type: Optional[int]
        doc: Changes the bit depth for the supported formats. Supported only in "wav"
          or "flac" formats.
        default: null
      - name: speed
        type: float
        doc: The speed of the generated audio. Select a value from `0.25` to `4.0`.
          `1.0` is the default.
        default: 1.0
      lineno: 38
kind: job
metadata:
  categories:
  - data-preparation
  - machine-learning
  - pytorch
  tag: ''
  name: text-to-audio-generator
verbose: false
