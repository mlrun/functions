kind: job
spec:
  default_handler: train_model
  command: ''
  image: mlrun/mlrun
  entry_points:
    get_sample:
      has_kwargs: false
      has_varargs: false
      lineno: 33
      parameters:
      - name: dataset
        type: DataItem
        doc: DataItem containing the dataset
      - name: sample
        type: int
        doc: Number of samples to take. If -1, use all. If < -1, take random sample.
      - name: label_column
        type: str
        doc: Name of the label column
      outputs:
      - type: Tuple[pd.DataFrame, pd.Series, list]
      name: get_sample
      doc: Get a sample of the dataset with labels separated.
    get_splits:
      has_kwargs: false
      has_varargs: false
      lineno: 56
      parameters:
      - name: features
        type: DataFrame
        doc: Feature DataFrame
      - name: labels
        type: Series
        doc: Labels Series
      - name: num_splits
        type: int
        doc: Number of splits (3 for train/val/test)
      - name: test_size
        type: float
        doc: Proportion for test set
      - name: val_size
        type: float
        doc: Proportion of remaining data for validation
      - name: random_state
        type: int
        doc: Random seed
        default: 1
      outputs:
      - type: List[Tuple[pd.DataFrame, pd.Series]]
      name: get_splits
      doc: Split data into train, validation, and test sets.
    gen_sklearn_model:
      has_kwargs: false
      has_varargs: false
      lineno: 86
      parameters:
      - name: model_pkg_class
        type: str
        doc: Full class path (e.g., "sklearn.ensemble.RandomForestClassifier")
      - name: parameters
        type: list
        doc: List of (key, value) parameter tuples
      outputs:
      - type: dict
      name: gen_sklearn_model
      doc: Generate sklearn model configuration from class name and parameters.
    eval_model_v2:
      has_kwargs: false
      has_varargs: false
      lineno: 117
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context
      - name: xvalid
        type: DataFrame
        doc: Validation features
      - name: yvalid
        type: Series
        doc: Validation labels
      - name: model
        doc: Trained sklearn model
      - name: plots_artifact_path
        type: str
        doc: Path for plots (not used in this simplified version)
        default: null
      outputs:
      - type: dict
      name: eval_model_v2
      doc: Evaluate a sklearn classifier model.
    train_model:
      has_kwargs: false
      has_varargs: false
      lineno: 148
      parameters:
      - name: context
        type: MLClientCtx
        doc: the function context
      - name: model_pkg_class
        type: str
        doc: the model to train, e.g, "sklearn.neural_networks.MLPClassifier", or
          json model config
      - name: dataset
        type: DataItem
        doc: ("data") name of raw data file
      - name: label_column
        type: str
        doc: ground-truth (y) labels
        default: labels
      - name: encode_cols
        type: List[str]
        doc: dictionary of names and prefixes for columns that are to hot be encoded.
        default: []
      - name: sample
        type: int
        doc: Selects the first n rows, or select a sample starting from the first.
          If negative <-1, select a random sample
        default: <ast.USub object at 0x1077c5600>
      - name: test_size
        type: float
        doc: (0.05) test set size
        default: 0.3
      - name: train_val_split
        type: float
        doc: (0.75) Once the test set has been removed the training set gets this
          proportion.
        default: 0.7
      - name: test_set_key
        type: str
        doc: key of held out data in artifact store
        default: test_set
      - name: model_evaluator
        doc: (None) a custom model evaluator can be specified
        default: null
      - name: models_dest
        type: str
        doc: ("") models subfolder on artifact path
        default: ''
      - name: plots_dest
        type: str
        doc: plot subfolder on artifact path
        default: plots
      - name: file_ext
        type: str
        doc: ("parquet") format for test_set_key hold out data
        default: parquet
      - name: model_pkg_file
        type: str
        default: ''
      - name: random_state
        type: int
        doc: (1) sklearn rng seed
        default: 1
      outputs:
      - type: None
      name: train_model
      doc: 'train a classifier


        An optional cutom model evaluator can be supplied that should have the signature:

        `my_custom_evaluator(context, xvalid, yvalid, model)` and return a dictionary
        of

        scalar "results", a "plots" keys with a list of PlotArtifacts, and

        and "tables" key containing a returned list of TableArtifacts.'
  build:
    functionSourceCode: IyBDb3B5cmlnaHQgMjAxOSBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiMKIyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiMgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKIyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KIyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiMgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiMKIyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IHdhcm5pbmdzCgp3YXJuaW5ncy5zaW1wbGVmaWx0ZXIoYWN0aW9uPSJpZ25vcmUiLCBjYXRlZ29yeT1GdXR1cmVXYXJuaW5nKQoKCmZyb20gY2xvdWRwaWNrbGUgaW1wb3J0IGR1bXBzCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IG51bXB5IGFzIG5wCmZyb20gdHlwaW5nIGltcG9ydCBMaXN0LCBUdXBsZQpmcm9tIHNrbGVhcm4ubW9kZWxfc2VsZWN0aW9uIGltcG9ydCB0cmFpbl90ZXN0X3NwbGl0CmZyb20gc2tsZWFybi5tZXRyaWNzIGltcG9ydCBhY2N1cmFjeV9zY29yZSwgcHJlY2lzaW9uX3Njb3JlLCByZWNhbGxfc2NvcmUsIGYxX3Njb3JlCmZyb20gbWxydW4uZXhlY3V0aW9uIGltcG9ydCBNTENsaWVudEN0eApmcm9tIG1scnVuLmRhdGFzdG9yZSBpbXBvcnQgRGF0YUl0ZW0KZnJvbSBtbHJ1bi51dGlscy5oZWxwZXJzIGltcG9ydCBjcmVhdGVfY2xhc3MKCgpkZWYgZ2V0X3NhbXBsZShkYXRhc2V0OiBEYXRhSXRlbSwgc2FtcGxlOiBpbnQsIGxhYmVsX2NvbHVtbjogc3RyKSAtPiBUdXBsZVtwZC5EYXRhRnJhbWUsIHBkLlNlcmllcywgbGlzdF06CiAgICAiIiJHZXQgYSBzYW1wbGUgb2YgdGhlIGRhdGFzZXQgd2l0aCBsYWJlbHMgc2VwYXJhdGVkLgoKICAgIDpwYXJhbSBkYXRhc2V0OiBEYXRhSXRlbSBjb250YWluaW5nIHRoZSBkYXRhc2V0CiAgICA6cGFyYW0gc2FtcGxlOiBOdW1iZXIgb2Ygc2FtcGxlcyB0byB0YWtlLiBJZiAtMSwgdXNlIGFsbC4gSWYgPCAtMSwgdGFrZSByYW5kb20gc2FtcGxlLgogICAgOnBhcmFtIGxhYmVsX2NvbHVtbjogTmFtZSBvZiB0aGUgbGFiZWwgY29sdW1uCiAgICAiIiIKICAgIGRmID0gZGF0YXNldC5hc19kZigpCgogICAgaWYgc2FtcGxlID09IC0xOgogICAgICAgIHNhbXBsZWRfZGYgPSBkZgogICAgZWxpZiBzYW1wbGUgPCAtMToKICAgICAgICBzYW1wbGVkX2RmID0gZGYuc2FtcGxlKG49YWJzKHNhbXBsZSksIHJhbmRvbV9zdGF0ZT0xKQogICAgZWxzZToKICAgICAgICBzYW1wbGVkX2RmID0gZGYuaGVhZChzYW1wbGUpCgogICAgbGFiZWxzID0gc2FtcGxlZF9kZltsYWJlbF9jb2x1bW5dCiAgICBmZWF0dXJlcyA9IHNhbXBsZWRfZGYuZHJvcChsYWJlbF9jb2x1bW4sIGF4aXM9MSkKICAgIGhlYWRlciA9IGxpc3QoZmVhdHVyZXMuY29sdW1ucykKCiAgICByZXR1cm4gZmVhdHVyZXMsIGxhYmVscywgaGVhZGVyCgoKZGVmIGdldF9zcGxpdHMoCiAgICBmZWF0dXJlczogcGQuRGF0YUZyYW1lLAogICAgbGFiZWxzOiBwZC5TZXJpZXMsCiAgICBudW1fc3BsaXRzOiBpbnQsCiAgICB0ZXN0X3NpemU6IGZsb2F0LAogICAgdmFsX3NpemU6IGZsb2F0LAogICAgcmFuZG9tX3N0YXRlOiBpbnQgPSAxCikgLT4gTGlzdFtUdXBsZVtwZC5EYXRhRnJhbWUsIHBkLlNlcmllc11dOgogICAgIiIiU3BsaXQgZGF0YSBpbnRvIHRyYWluLCB2YWxpZGF0aW9uLCBhbmQgdGVzdCBzZXRzLgoKICAgIDpwYXJhbSBmZWF0dXJlczogRmVhdHVyZSBEYXRhRnJhbWUKICAgIDpwYXJhbSBsYWJlbHM6IExhYmVscyBTZXJpZXMKICAgIDpwYXJhbSBudW1fc3BsaXRzOiBOdW1iZXIgb2Ygc3BsaXRzICgzIGZvciB0cmFpbi92YWwvdGVzdCkKICAgIDpwYXJhbSB0ZXN0X3NpemU6IFByb3BvcnRpb24gZm9yIHRlc3Qgc2V0CiAgICA6cGFyYW0gdmFsX3NpemU6IFByb3BvcnRpb24gb2YgcmVtYWluaW5nIGRhdGEgZm9yIHZhbGlkYXRpb24KICAgIDpwYXJhbSByYW5kb21fc3RhdGU6IFJhbmRvbSBzZWVkCiAgICAiIiIKICAgICMgRmlyc3Qgc3BsaXQ6IHNlcGFyYXRlIHRlc3Qgc2V0CiAgICBYX3RlbXAsIFhfdGVzdCwgeV90ZW1wLCB5X3Rlc3QgPSB0cmFpbl90ZXN0X3NwbGl0KAogICAgICAgIGZlYXR1cmVzLCBsYWJlbHMsIHRlc3Rfc2l6ZT10ZXN0X3NpemUsIHJhbmRvbV9zdGF0ZT1yYW5kb21fc3RhdGUKICAgICkKCiAgICAjIFNlY29uZCBzcGxpdDogc2VwYXJhdGUgdHJhaW4gYW5kIHZhbGlkYXRpb24gZnJvbSByZW1haW5pbmcgZGF0YQogICAgWF90cmFpbiwgWF92YWwsIHlfdHJhaW4sIHlfdmFsID0gdHJhaW5fdGVzdF9zcGxpdCgKICAgICAgICBYX3RlbXAsIHlfdGVtcCwgdGVzdF9zaXplPXZhbF9zaXplLCByYW5kb21fc3RhdGU9cmFuZG9tX3N0YXRlCiAgICApCgogICAgcmV0dXJuIFsoWF90cmFpbiwgeV90cmFpbiksIChYX3ZhbCwgeV92YWwpLCAoWF90ZXN0LCB5X3Rlc3QpXQoKCmRlZiBnZW5fc2tsZWFybl9tb2RlbChtb2RlbF9wa2dfY2xhc3M6IHN0ciwgcGFyYW1ldGVyczogbGlzdCkgLT4gZGljdDoKICAgICIiIkdlbmVyYXRlIHNrbGVhcm4gbW9kZWwgY29uZmlndXJhdGlvbiBmcm9tIGNsYXNzIG5hbWUgYW5kIHBhcmFtZXRlcnMuCgogICAgOnBhcmFtIG1vZGVsX3BrZ19jbGFzczogRnVsbCBjbGFzcyBwYXRoIChlLmcuLCAic2tsZWFybi5lbnNlbWJsZS5SYW5kb21Gb3Jlc3RDbGFzc2lmaWVyIikKICAgIDpwYXJhbSBwYXJhbWV0ZXJzOiBMaXN0IG9mIChrZXksIHZhbHVlKSBwYXJhbWV0ZXIgdHVwbGVzCiAgICAiIiIKICAgIGNvbmZpZyA9IHsKICAgICAgICAiTUVUQSI6IHsiY2xhc3MiOiBtb2RlbF9wa2dfY2xhc3N9LAogICAgICAgICJDTEFTUyI6IHt9LAogICAgICAgICJGSVQiOiB7fQogICAgfQoKICAgICMgUGFyYW1ldGVycyB0aGF0IHNob3VsZCBub3QgYmUgcGFzc2VkIHRvIHNrbGVhcm4gbW9kZWwKICAgIGV4Y2x1ZGVkX3BhcmFtcyA9IHsKICAgICAgICAnbW9kZWxfcGtnX2NsYXNzJywgJ2RhdGFzZXQnLCAnbGFiZWxfY29sdW1uJywgJ2VuY29kZV9jb2xzJywKICAgICAgICAnc2FtcGxlJywgJ3Rlc3Rfc2l6ZScsICd0cmFpbl92YWxfc3BsaXQnLCAndGVzdF9zZXRfa2V5JywKICAgICAgICAnbW9kZWxfZXZhbHVhdG9yJywgJ21vZGVsc19kZXN0JywgJ3Bsb3RzX2Rlc3QnLCAnZmlsZV9leHQnLAogICAgICAgICdtb2RlbF9wa2dfZmlsZScsICdjb250ZXh0JwogICAgfQoKICAgICMgU2VwYXJhdGUgcGFyYW1ldGVycyBpbnRvIG1vZGVsIGluaXQgcGFyYW1zIGFuZCBmaXQgcGFyYW1zCiAgICBmb3Iga2V5LCB2YWx1ZSBpbiBwYXJhbWV0ZXJzOgogICAgICAgIGlmIGtleSBpbiBbJ1gnLCAneScsICdzYW1wbGVfd2VpZ2h0J106CiAgICAgICAgICAgIGNvbmZpZ1siRklUIl1ba2V5XSA9IHZhbHVlCiAgICAgICAgZWxpZiBrZXkgbm90IGluIGV4Y2x1ZGVkX3BhcmFtczoKICAgICAgICAgICAgIyBPbmx5IGFkZCBwYXJhbWV0ZXJzIHRoYXQgYXJlIG5vdCBmdW5jdGlvbi1zcGVjaWZpYwogICAgICAgICAgICBjb25maWdbIkNMQVNTIl1ba2V5XSA9IHZhbHVlCgogICAgcmV0dXJuIGNvbmZpZwoKCmRlZiBldmFsX21vZGVsX3YyKAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICB4dmFsaWQ6IHBkLkRhdGFGcmFtZSwKICAgIHl2YWxpZDogcGQuU2VyaWVzLAogICAgbW9kZWwsCiAgICBwbG90c19hcnRpZmFjdF9wYXRoOiBzdHIgPSBOb25lCikgLT4gZGljdDoKICAgICIiIkV2YWx1YXRlIGEgc2tsZWFybiBjbGFzc2lmaWVyIG1vZGVsLgoKICAgIDpwYXJhbSBjb250ZXh0OiBNTFJ1biBjb250ZXh0CiAgICA6cGFyYW0geHZhbGlkOiBWYWxpZGF0aW9uIGZlYXR1cmVzCiAgICA6cGFyYW0geXZhbGlkOiBWYWxpZGF0aW9uIGxhYmVscwogICAgOnBhcmFtIG1vZGVsOiBUcmFpbmVkIHNrbGVhcm4gbW9kZWwKICAgIDpwYXJhbSBwbG90c19hcnRpZmFjdF9wYXRoOiBQYXRoIGZvciBwbG90cyAobm90IHVzZWQgaW4gdGhpcyBzaW1wbGlmaWVkIHZlcnNpb24pCiAgICAiIiIKICAgIHlfcHJlZCA9IG1vZGVsLnByZWRpY3QoeHZhbGlkKQoKICAgIG1ldHJpY3MgPSB7CiAgICAgICAgImFjY3VyYWN5IjogYWNjdXJhY3lfc2NvcmUoeXZhbGlkLCB5X3ByZWQpLAogICAgICAgICJwcmVjaXNpb24iOiBwcmVjaXNpb25fc2NvcmUoeXZhbGlkLCB5X3ByZWQsIGF2ZXJhZ2U9J3dlaWdodGVkJywgemVyb19kaXZpc2lvbj0wKSwKICAgICAgICAicmVjYWxsIjogcmVjYWxsX3Njb3JlKHl2YWxpZCwgeV9wcmVkLCBhdmVyYWdlPSd3ZWlnaHRlZCcsIHplcm9fZGl2aXNpb249MCksCiAgICAgICAgImYxX3Njb3JlIjogZjFfc2NvcmUoeXZhbGlkLCB5X3ByZWQsIGF2ZXJhZ2U9J3dlaWdodGVkJywgemVyb19kaXZpc2lvbj0wKQogICAgfQoKICAgICMgTG9nIG1ldHJpY3MgdG8gY29udGV4dAogICAgZm9yIGtleSwgdmFsdWUgaW4gbWV0cmljcy5pdGVtcygpOgogICAgICAgIGNvbnRleHQubG9nX3Jlc3VsdChrZXksIHZhbHVlKQoKICAgIHJldHVybiB7fQoKCmRlZiB0cmFpbl9tb2RlbCgKICAgIGNvbnRleHQ6IE1MQ2xpZW50Q3R4LAogICAgbW9kZWxfcGtnX2NsYXNzOiBzdHIsCiAgICBkYXRhc2V0OiBEYXRhSXRlbSwKICAgIGxhYmVsX2NvbHVtbjogc3RyID0gImxhYmVscyIsCiAgICBlbmNvZGVfY29sczogTGlzdFtzdHJdID0gW10sCiAgICBzYW1wbGU6IGludCA9IC0xLAogICAgdGVzdF9zaXplOiBmbG9hdCA9IDAuMzAsCiAgICB0cmFpbl92YWxfc3BsaXQ6IGZsb2F0ID0gMC43MCwKICAgIHRlc3Rfc2V0X2tleTogc3RyID0gInRlc3Rfc2V0IiwKICAgIG1vZGVsX2V2YWx1YXRvcj1Ob25lLAogICAgbW9kZWxzX2Rlc3Q6IHN0ciA9ICIiLAogICAgcGxvdHNfZGVzdDogc3RyID0gInBsb3RzIiwKICAgIGZpbGVfZXh0OiBzdHIgPSAicGFycXVldCIsCiAgICBtb2RlbF9wa2dfZmlsZTogc3RyID0gIiIsCiAgICByYW5kb21fc3RhdGU6IGludCA9IDEsCikgLT4gTm9uZToKICAgICIiInRyYWluIGEgY2xhc3NpZmllcgoKICAgIEFuIG9wdGlvbmFsIGN1dG9tIG1vZGVsIGV2YWx1YXRvciBjYW4gYmUgc3VwcGxpZWQgdGhhdCBzaG91bGQgaGF2ZSB0aGUgc2lnbmF0dXJlOgogICAgYG15X2N1c3RvbV9ldmFsdWF0b3IoY29udGV4dCwgeHZhbGlkLCB5dmFsaWQsIG1vZGVsKWAgYW5kIHJldHVybiBhIGRpY3Rpb25hcnkgb2YKICAgIHNjYWxhciAicmVzdWx0cyIsIGEgInBsb3RzIiBrZXlzIHdpdGggYSBsaXN0IG9mIFBsb3RBcnRpZmFjdHMsIGFuZAogICAgYW5kICJ0YWJsZXMiIGtleSBjb250YWluaW5nIGEgcmV0dXJuZWQgbGlzdCBvZiBUYWJsZUFydGlmYWN0cy4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0gbW9kZWxfcGtnX2NsYXNzOiAgIHRoZSBtb2RlbCB0byB0cmFpbiwgZS5nLCAic2tsZWFybi5uZXVyYWxfbmV0d29ya3MuTUxQQ2xhc3NpZmllciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGpzb24gbW9kZWwgY29uZmlnCiAgICA6cGFyYW0gZGF0YXNldDogICAgICAgICAgICgiZGF0YSIpIG5hbWUgb2YgcmF3IGRhdGEgZmlsZQogICAgOnBhcmFtIGxhYmVsX2NvbHVtbjogICAgICBncm91bmQtdHJ1dGggKHkpIGxhYmVscwogICAgOnBhcmFtIGVuY29kZV9jb2xzOiAgICAgICBkaWN0aW9uYXJ5IG9mIG5hbWVzIGFuZCBwcmVmaXhlcyBmb3IgY29sdW1ucyB0aGF0IGFyZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0byBob3QgYmUgZW5jb2RlZC4KICAgIDpwYXJhbSBzYW1wbGU6ICAgICAgICAgICAgU2VsZWN0cyB0aGUgZmlyc3QgbiByb3dzLCBvciBzZWxlY3QgYSBzYW1wbGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRpbmcgZnJvbSB0aGUgZmlyc3QuIElmIG5lZ2F0aXZlIDwtMSwgc2VsZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgcmFuZG9tIHNhbXBsZQogICAgOnBhcmFtIHRlc3Rfc2l6ZTogICAgICAgICAoMC4wNSkgdGVzdCBzZXQgc2l6ZQogICAgOnBhcmFtIHRyYWluX3ZhbF9zcGxpdDogICAoMC43NSkgT25jZSB0aGUgdGVzdCBzZXQgaGFzIGJlZW4gcmVtb3ZlZCB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhaW5pbmcgc2V0IGdldHMgdGhpcyBwcm9wb3J0aW9uLgogICAgOnBhcmFtIHRlc3Rfc2V0X2tleTogICAgICBrZXkgb2YgaGVsZCBvdXQgZGF0YSBpbiBhcnRpZmFjdCBzdG9yZQogICAgOnBhcmFtIG1vZGVsX2V2YWx1YXRvcjogICAoTm9uZSkgYSBjdXN0b20gbW9kZWwgZXZhbHVhdG9yIGNhbiBiZSBzcGVjaWZpZWQKICAgIDpwYXJhbSBtb2RlbHNfZGVzdDogICAgICAgKCIiKSBtb2RlbHMgc3ViZm9sZGVyIG9uIGFydGlmYWN0IHBhdGgKICAgIDpwYXJhbSBwbG90c19kZXN0OiAgICAgICAgcGxvdCBzdWJmb2xkZXIgb24gYXJ0aWZhY3QgcGF0aAogICAgOnBhcmFtIGZpbGVfZXh0OiAgICAgICAgICAoInBhcnF1ZXQiKSBmb3JtYXQgZm9yIHRlc3Rfc2V0X2tleSBob2xkIG91dCBkYXRhCiAgICA6cGFyYW0gcmFuZG9tX3N0YXRlOiAgICAgICgxKSBza2xlYXJuIHJuZyBzZWVkCgogICAgIiIiCiAgICBtb2RlbHNfZGVzdCA9IG1vZGVsc19kZXN0IG9yICJtb2RlbCIKCiAgICByYXcsIGxhYmVscywgaGVhZGVyID0gZ2V0X3NhbXBsZShkYXRhc2V0LCBzYW1wbGUsIGxhYmVsX2NvbHVtbikKCiAgICBpZiBlbmNvZGVfY29sczoKICAgICAgICByYXcgPSBwZC5nZXRfZHVtbWllcygKICAgICAgICAgICAgcmF3LAogICAgICAgICAgICBjb2x1bW5zPWxpc3QoZW5jb2RlX2NvbHMua2V5cygpKSwKICAgICAgICAgICAgcHJlZml4PWxpc3QoZW5jb2RlX2NvbHMudmFsdWVzKCkpLAogICAgICAgICAgICBkcm9wX2ZpcnN0PVRydWUsCiAgICAgICAgKQoKICAgICh4dHJhaW4sIHl0cmFpbiksICh4dmFsaWQsIHl2YWxpZCksICh4dGVzdCwgeXRlc3QpID0gZ2V0X3NwbGl0cygKICAgICAgICByYXcsIGxhYmVscywgMywgdGVzdF9zaXplLCAxIC0gdHJhaW5fdmFsX3NwbGl0LCByYW5kb21fc3RhdGUKICAgICkKCiAgICB0ZXN0X3NldCA9IHBkLmNvbmNhdChbeHRlc3QsIHl0ZXN0LnRvX2ZyYW1lKCldLCBheGlzPTEpCiAgICBjb250ZXh0LmxvZ19kYXRhc2V0KAogICAgICAgIHRlc3Rfc2V0X2tleSwKICAgICAgICBkZj10ZXN0X3NldCwKICAgICAgICBmb3JtYXQ9ZmlsZV9leHQsCiAgICAgICAgaW5kZXg9RmFsc2UsCiAgICAgICAgbGFiZWxzPXsiZGF0YS10eXBlIjogImhlbGQtb3V0In0sCiAgICAgICAgYXJ0aWZhY3RfcGF0aD1jb250ZXh0LmFydGlmYWN0X3N1YnBhdGgoImRhdGEiKSwKICAgICkKCiAgICBtb2RlbF9jb25maWcgPSBnZW5fc2tsZWFybl9tb2RlbChtb2RlbF9wa2dfY2xhc3MsIGNvbnRleHQucGFyYW1ldGVycy5pdGVtcygpKQoKICAgIG1vZGVsX2NvbmZpZ1siRklUIl0udXBkYXRlKHsiWCI6IHh0cmFpbiwgInkiOiB5dHJhaW4udmFsdWVzfSkKCiAgICBDbGFzc2lmaWVyQ2xhc3MgPSBjcmVhdGVfY2xhc3MobW9kZWxfY29uZmlnWyJNRVRBIl1bImNsYXNzIl0pCgogICAgbW9kZWwgPSBDbGFzc2lmaWVyQ2xhc3MoKiptb2RlbF9jb25maWdbIkNMQVNTIl0pCgogICAgbW9kZWwuZml0KCoqbW9kZWxfY29uZmlnWyJGSVQiXSkKCiAgICBhcnRpZmFjdF9wYXRoID0gY29udGV4dC5hcnRpZmFjdF9zdWJwYXRoKG1vZGVsc19kZXN0KQogICAgcGxvdHNfcGF0aCA9IGNvbnRleHQuYXJ0aWZhY3Rfc3VicGF0aChtb2RlbHNfZGVzdCwgcGxvdHNfZGVzdCkKICAgIGlmIG1vZGVsX2V2YWx1YXRvcjoKICAgICAgICBldmFsX21ldHJpY3MgPSBtb2RlbF9ldmFsdWF0b3IoCiAgICAgICAgICAgIGNvbnRleHQsIHh2YWxpZCwgeXZhbGlkLCBtb2RlbCwgcGxvdHNfYXJ0aWZhY3RfcGF0aD1wbG90c19wYXRoCiAgICAgICAgKQogICAgZWxzZToKICAgICAgICBldmFsX21ldHJpY3MgPSBldmFsX21vZGVsX3YyKAogICAgICAgICAgICBjb250ZXh0LCB4dmFsaWQsIHl2YWxpZCwgbW9kZWwsIHBsb3RzX2FydGlmYWN0X3BhdGg9cGxvdHNfcGF0aAogICAgICAgICkKCiAgICBrd2FyZ3MgPSB7InRyYWluaW5nX3NldCI6IHRlc3Rfc2V0LCAibGFiZWxfY29sdW1uIjogbGFiZWxfY29sdW1ufQogICAgc3BsaXQgPSBtb2RlbF9wa2dfY2xhc3MucnNwbGl0KCIuIiwgMSkKICAgIGlmIHNwbGl0IGFuZCBsZW4oc3BsaXQpID09IDI6CiAgICAgICAga3dhcmdzWyJhbGdvcml0aG0iXSA9IHNwbGl0WzFdCgogICAgaWYgZGF0YXNldC5tZXRhIGFuZCBkYXRhc2V0Lm1ldGEua2luZCA9PSAiRmVhdHVyZVZlY3RvciI6CiAgICAgICAga3dhcmdzWyJmZWF0dXJlX3ZlY3RvciJdID0gZGF0YXNldC5tZXRhLnVyaQoKICAgIGNvbnRleHQuc2V0X2xhYmVsKCJjbGFzcyIsIG1vZGVsX3BrZ19jbGFzcykKICAgIGNvbnRleHQubG9nX21vZGVsKAogICAgICAgICJtb2RlbCIsCiAgICAgICAgYm9keT1kdW1wcyhtb2RlbCksCiAgICAgICAgYXJ0aWZhY3RfcGF0aD1hcnRpZmFjdF9wYXRoLAogICAgICAgIGV4dHJhX2RhdGE9ZXZhbF9tZXRyaWNzLAogICAgICAgIG1vZGVsX2ZpbGU9Im1vZGVsLnBrbCIsCiAgICAgICAgbWV0cmljcz1jb250ZXh0LnJlc3VsdHMsCiAgICAgICAgbGFiZWxzPXsiY2xhc3MiOiBtb2RlbF9wa2dfY2xhc3N9LAogICAgICAgIGZyYW1ld29yaz0ic2tsZWFybiIsCiAgICAgICAgKiprd2FyZ3MKICAgICkK
    origin_filename: ''
    code_origin: ''
  disable_auto_mount: false
  filename: /Users/Tomer_Weitzman/PycharmProjects/functions/functions/src/sklearn_classifier/sklearn_classifier.py
  description: train any classifier using scikit-learn's API
metadata:
  name: sklearn-classifier
  categories:
  - machine-learning
  - model-training
  tag: ''
verbose: false
