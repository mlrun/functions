kind: dask
metadata:
  name: sklearn-classifier-dask
  tag: ''
  hash: 1fa1e4941d50a46b0999113da0fe02a9990fe770
  project: default
spec:
  command: ''
  image: mlrun/ml-models
  env:
  - name: V3IO_API
    value: ''
  - name: V3IO_USERNAME
    value: ''
  - name: V3IO_ACCESS_KEY
    value: ''
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IHdhcm5pbmdzCndhcm5pbmdzLmZpbHRlcndhcm5pbmdzKCdpZ25vcmUnKQoKaW1wb3J0IG9zCmltcG9ydCBqb2JsaWIKaW1wb3J0IG51bXB5IGFzIG5wCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IHNrbGVhcm4KZnJvbSBjbG91ZHBpY2tsZSBpbXBvcnQgZHVtcHMsIGxvYWQsIGR1bXAKZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QsIE9wdGlvbmFsCgpmcm9tIGRhc2suZGlzdHJpYnV0ZWQgaW1wb3J0IENsaWVudApmcm9tIGRhc2sgaW1wb3J0IGRhdGFmcmFtZSBhcyBkZApmcm9tIGRhc2sgaW1wb3J0IGFycmF5IGFzIGRhCmZyb20gZGFzay5kZWxheWVkIGltcG9ydCBkZWxheWVkCmZyb20gZGFza19tbCBpbXBvcnQgbW9kZWxfc2VsZWN0aW9uCmZyb20gZGFza19tbCBpbXBvcnQgbWV0cmljcwpmcm9tIGRhc2tfbWwucHJlcHJvY2Vzc2luZyBpbXBvcnQgTGFiZWxFbmNvZGVyLCBTdGFuZGFyZFNjYWxlcgoKZnJvbSBtbHJ1bi5leGVjdXRpb24gaW1wb3J0IE1MQ2xpZW50Q3R4CmZyb20gbWxydW4uZGF0YXN0b3JlIGltcG9ydCBEYXRhSXRlbQpmcm9tIG1scnVuLmFydGlmYWN0cyBpbXBvcnQgUGxvdEFydGlmYWN0CmZyb20gbWxydW4ubWx1dGlscyBpbXBvcnQgKGdlbl9za2xlYXJuX21vZGVsLCBjcmVhdGVfY2xhc3MpCmltcG9ydCBtbHJ1bgoKaW1wb3J0IG1hdHBsb3RsaWIucHlwbG90IGFzIHBsdApmcm9tIHllbGxvd2JyaWNrLmNsYXNzaWZpZXIgaW1wb3J0IFJPQ0FVQywgQ2xhc3NpZmljYXRpb25SZXBvcnQsIENvbmZ1c2lvbk1hdHJpeApmcm9tIHllbGxvd2JyaWNrLm1vZGVsX3NlbGVjdGlvbiBpbXBvcnQgRmVhdHVyZUltcG9ydGFuY2VzCgpkZWYgdHJhaW5fbW9kZWwoY29udGV4dDogTUxDbGllbnRDdHgsCiAgICAgICAgICAgICAgICBkYXRhc2V0OiBEYXRhSXRlbSwKICAgICAgICAgICAgICAgIG1vZGVsX3BrZ19jbGFzczogc3RyLAogICAgICAgICAgICAgICAgbGFiZWxfY29sdW1uOiBzdHIgPSAibGFiZWwiLAogICAgICAgICAgICAgICAgdHJhaW5fdmFsaWRhdGlvbl9zaXplOiBmbG9hdCA9IDAuNzUsCiAgICAgICAgICAgICAgICBzYW1wbGU6IGZsb2F0ID0gMS4wLAogICAgICAgICAgICAgICAgbW9kZWxzX2Rlc3Q6IHN0ciA9ICJtb2RlbHMiLAogICAgICAgICAgICAgICAgdGVzdF9zZXRfa2V5OiBzdHIgPSAidGVzdF9zZXQiLAogICAgICAgICAgICAgICAgcGxvdHNfZGVzdDogc3RyID0gInBsb3RzIiwKICAgICAgICAgICAgICAgIGRhc2tfa2V5OiBzdHIgPSAiZGFza19rZXkiLAogICAgICAgICAgICAgICAgZGFza19wZXJzaXN0OiBib29sID0gRmFsc2UsCiAgICAgICAgICAgICAgICBzY2hlZHVsZXJfa2V5OiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgZmlsZV9leHQ6IHN0ciA9ICJwYXJxdWV0IiwKICAgICAgICAgICAgICAgIHJhbmRvbV9zdGF0ZTogaW50ID0gNDIpIC0+IE5vbmU6CiAgICAKICAgICIiIgogICAgVHJhaW4gYSBza2xlYXJuIGNsYXNzaWZpZXIgd2l0aCBEYXNrCiAgICAKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgICAgICAgICAgRnVuY3Rpb24gY29udGV4dC4KICAgIDpwYXJhbSBkYXRhc2V0OiAgICAgICAgICAgICAgICAgUmF3IGRhdGEgZmlsZS4KICAgIDpwYXJhbSBtb2RlbF9wa2dfY2xhc3M6ICAgICAgICAgTW9kZWwgdG8gdHJhaW4sIGUuZywgInNrbGVhcm4uZW5zZW1ibGUuUmFuZG9tRm9yZXN0Q2xhc3NpZmllciIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBqc29uIG1vZGVsIGNvbmZpZy4KICAgIDpwYXJhbSBsYWJlbF9jb2x1bW46ICAgICAgICAgICAgKGxhYmVsKSBHcm91bmQtdHJ1dGggeSBsYWJlbHMuCiAgICA6cGFyYW0gdHJhaW5fdmFsaWRhdGlvbl9zaXplOiAgICgwLjc1KSBUcmFpbiB2YWxpZGF0aW9uIHNldCBwcm9wb3J0aW9uIG91dCBvZiB0aGUgZnVsbCBkYXRhc2V0LgogICAgOnBhcmFtIHNhbXBsZTogICAgICAgICAgICAgICAgICAoMS4wKSBTZWxlY3Qgc2FtcGxlIGZyb20gZGF0YXNldCAobi1yb3dzLyUgb2YgdG90YWwpLCByYW5kb216aWUgcm93cyBhcyBkZWZhdWx0LgogICAgOnBhcmFtIG1vZGVsc19kZXN0OiAgICAgICAgICAgICAobW9kZWxzKSBNb2RlbHMgc3ViZm9sZGVyIG9uIGFydGlmYWN0IHBhdGguCiAgICA6cGFyYW0gdGVzdF9zZXRfa2V5OiAgICAgICAgICAgICh0ZXN0X3NldCkgTWxydW4gZGIga2V5IG9mIGhlbGQgb3V0IGRhdGEgaW4gYXJ0aWZhY3Qgc3RvcmUuCiAgICA6cGFyYW0gcGxvdHNfZGVzdDogICAgICAgICAgICAgIChwbG90cykgUGxvdCBzdWJmb2xkZXIgb24gYXJ0aWZhY3QgcGF0aC4KICAgIDpwYXJhbSBkYXNrX2tleTogICAgICAgICAgICAgICAgKGRhc2sga2V5KSBLZXkgb2YgZGF0YWZyYW1lIGluIGRhc2sgY2xpZW50ICJkYXRhc2V0cyIgYXR0cmlidXRlLgogICAgOnBhcmFtIGRhc2tfcGVyc2lzdDogICAgICAgICAgICAoRmFsc2UpIFNob3VsZCB0aGUgZGF0YSBiZSBwZXJzaXN0ZWQgKHRocm91Z2ggdGhlIGBjbGllbnQucGVyc2lzdGApCiAgICA6cGFyYW0gc2NoZWR1bGVyX2tleTogICAgICAgICAgIChzY2hlZHVsZXIpIERhc2sgc2NoZWR1bGVyIGNvbmZpZ3VyYXRpb24sIGpzb24gYWxzbyBsb2dnZWQgYXMgYW4gYXJ0aWZhY3QuCiAgICA6cGFyYW0gZmlsZV9leHQ6ICAgICAgICAgICAgICAgIChwYXJxdWV0KSBmb3JtYXQgZm9yIHRlc3Rfc2V0X2tleSBob2xkIG91dCBkYXRhCiAgICA6cGFyYW0gcmFuZG9tX3N0YXRlOiAgICAgICAgICAgICg0Mikgc2tsZWFybiBzZWVkCiAgICAiIiIKICAgIAogICAgaWYgaGFzYXR0cihjb250ZXh0LCAiZGFza19jbGllbnQiKToKICAgICAgICBkYXNrX2NsaWVudCA9IGNvbnRleHQuZGFza19jbGllbnQKICAgICAgICBkYXNrX2NsaWVudC53cml0ZV9zY2hlZHVsZXJfZmlsZSgic2NoZWR1bGVyLmpzb24iKQogICAgICAgIAogICAgZWxpZiBzY2hlZHVsZXJfa2V5ICE9IE5vbmU6CiAgICAgICAgZGFza19jbGllbnQgPSBDbGllbnQoc2NoZWR1bGVyX2ZpbGU9c3RyKHNjaGVkdWxlcl9rZXkpKQogICAgICAgIGRhc2tfY2xpZW50LndyaXRlX3NjaGVkdWxlcl9maWxlKHNjaGVkdWxlcl9rZXkgKyAiLmpzb24iKQogICAgICAgIAogICAgZWxzZToKICAgICAgICBkYXNrX2NsaWVudCA9IENsaWVudCgpCiAgICAgICAgZGFza19jbGllbnQud3JpdGVfc2NoZWR1bGVyX2ZpbGUoInNjaGVkdWxlci5qc29uIikKICAgICAgICAKICAgIGlmIGRhc2tfcGVyc2lzdDoKICAgICAgICBkZiA9IGRhc2tfY2xpZW50LnBlcnNpc3QoZGYpCiAgICAgICAgaWYgZGFza19jbGllbnQuZGF0YXNldHMgYW5kIGRhc2tfa2V5IGluIGRhc2tfY2xpZW50LmRhdGFzZXRzOgogICAgICAgICAgICBkYXNrX2NsaWVudC51bnB1Ymxpc2hfZGF0YXNldChkYXNrX2tleSkKICAgICAgICBkYXNrX2NsaWVudC5wdWJsaXNoX2RhdGFzZXQoZGYsIG5hbWU9ZGFza19rZXkpCiAgICAKICAgIGlmIGNvbnRleHQ6CiAgICAgICAgY29udGV4dC5kYXNrX2NsaWVudCA9IGRhc2tfY2xpZW50CiAgICAKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIlJlYWQgRGF0YSIpCiAgICB0ZW1wID0gZGF0YXNldC5hc19kZigpCiAgICAKICAgIGRmID0gZGQuZnJvbV9wYW5kYXModGVtcCwgY2h1bmtzaXplPTEwMDApCiAgICBkZl9oZWFkZXIgPSBkZi5jb2x1bW5zCiAgICAKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIlByZXAgRGF0YSIpCiAgICBudW1lcmljcyA9IFsnaW50MTYnLCAnaW50MzInLCAnaW50NjQnLCAnZmxvYXQxNicsICdmbG9hdDMyJywgJ2Zsb2F0NjQnXQogICAgZGYgPSBkZi5zZWxlY3RfZHR5cGVzKGluY2x1ZGU9bnVtZXJpY3MpCiAgICAKICAgIGRmID0gZGYuZHJvcG5hKCkKICAgIAogICAgZGYgPSBkZi5zYW1wbGUoZnJhYz1zYW1wbGUpLnJlc2V0X2luZGV4KGRyb3A9VHJ1ZSkKICAgIAogICAgZW5jb2RlciA9IExhYmVsRW5jb2RlcigpCiAgICBlbmNvZGVyID0gZW5jb2Rlci5maXQoZGZbbGFiZWxfY29sdW1uXSkKICAgIFggPSBkZi5kcm9wKGxhYmVsX2NvbHVtbiwgYXhpcz0xKS50b19kYXNrX2FycmF5KGxlbmd0aHM9VHJ1ZSkKICAgIHkgPSBlbmNvZGVyLnRyYW5zZm9ybShkZltsYWJlbF9jb2x1bW5dKQoKICAgIGNsYXNzZXMgPSBkZltsYWJlbF9jb2x1bW5dLmRyb3BfZHVwbGljYXRlcygpCiAgICBjbGFzc2VzID0gW3N0cihpKSBmb3IgaSBpbiBjbGFzc2VzXQoKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIlNwbGl0IGFuZCBUcmFpbiIpCiAgICBYX3RyYWluLCBYX3Rlc3QsIHlfdHJhaW4sIHlfdGVzdCA9IGRlbGF5ZWQobW9kZWxfc2VsZWN0aW9uLnRyYWluX3Rlc3Rfc3BsaXQpKFgsIHksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFpbl9zaXplPXRyYWluX3ZhbGlkYXRpb25fc2l6ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZG9tX3N0YXRlPXJhbmRvbV9zdGF0ZSkuY29tcHV0ZSgpCiAgICAKICAgIHNjYWxlciA9IFN0YW5kYXJkU2NhbGVyKCkKICAgIHNjYWxlciA9IHNjYWxlci5maXQoWF90cmFpbikKICAgIFhfdHJhaW5fdHJhbnNmb3JtZWQgPSBzY2FsZXIudHJhbnNmb3JtKFhfdHJhaW4pCiAgICBYX3Rlc3RfdHJhbnNmb3JtZWQgPSBzY2FsZXIudHJhbnNmb3JtKFhfdGVzdCkKICAgIAogICAgbW9kZWxfY29uZmlnID0gZ2VuX3NrbGVhcm5fbW9kZWwobW9kZWxfcGtnX2NsYXNzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5wYXJhbWV0ZXJzLml0ZW1zKCkpCgogICAgbW9kZWxfY29uZmlnWyJGSVQiXS51cGRhdGUoeyJYIjogWF90cmFpbl90cmFuc2Zvcm1lZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAieSI6IHlfdHJhaW59KQogICAgCiAgICBDbGFzc2lmaWVyQ2xhc3MgPSBjcmVhdGVfY2xhc3MobW9kZWxfY29uZmlnWyJNRVRBIl1bImNsYXNzIl0pCiAgICAKICAgIG1vZGVsID0gQ2xhc3NpZmllckNsYXNzKCoqbW9kZWxfY29uZmlnWyJDTEFTUyJdKQogICAgCiAgICB3aXRoIGpvYmxpYi5wYXJhbGxlbF9iYWNrZW5kKCJkYXNrIik6CiAgICAgICAgCiAgICAgICAgbW9kZWwgPSBkZWxheWVkKG1vZGVsLmZpdCkoKiptb2RlbF9jb25maWdbIkZJVCJdKS5jb21wdXRlKCkKCiAgICBhcnRpZmFjdF9wYXRoID0gY29udGV4dC5hcnRpZmFjdF9zdWJwYXRoKG1vZGVsc19kZXN0KQogICAgCiAgICBwbG90c19wYXRoID0gY29udGV4dC5hcnRpZmFjdF9zdWJwYXRoKG1vZGVsc19kZXN0LCBwbG90c19kZXN0KQoKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIkV2YWx1YXRlIikKICAgIGV4dHJhX2RhdGFfZGljdCA9IHt9CiAgICBmb3IgcmVwb3J0IGluIChST0NBVUMsIENsYXNzaWZpY2F0aW9uUmVwb3J0LCBDb25mdXNpb25NYXRyaXgpOgogICAgICAgIAogICAgICAgIHJlcG9ydF9uYW1lID0gc3RyKHJlcG9ydC5fX25hbWVfXykKICAgICAgICBwbHQuY2xhKCkKICAgICAgICBwbHQuY2xmKCkKICAgICAgICBwbHQuY2xvc2UoKQogICAgICAgIAogICAgICAgIHZpeiA9IHJlcG9ydChtb2RlbCwgY2xhc3Nlcz1jbGFzc2VzLCBwZXJfY2xhc3M9VHJ1ZSwgaXNfZml0dGVkPVRydWUpCiAgICAgICAgdml6LmZpdChYX3RyYWluX3RyYW5zZm9ybWVkLCB5X3RyYWluKSAgICAgICAgIyBGaXQgdGhlIHRyYWluaW5nIGRhdGEgdG8gdGhlIHZpc3VhbGl6ZXIKICAgICAgICB2aXouc2NvcmUoWF90ZXN0X3RyYW5zZm9ybWVkLCB5X3Rlc3QpICAgICAgICAjIEV2YWx1YXRlIHRoZSBtb2RlbCBvbiB0aGUgdGVzdCBkYXRhCiAgICAgICAgCiAgICAgICAgcGxvdCA9IGNvbnRleHQubG9nX2FydGlmYWN0KFBsb3RBcnRpZmFjdChyZXBvcnRfbmFtZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5PXZpei5maWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZT1yZXBvcnRfbmFtZSksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGJfa2V5PUZhbHNlKQogICAgICAgIGV4dHJhX2RhdGFfZGljdFtzdHIocmVwb3J0KV0gPSBwbG90CiAgICAgICAgCiAgICAgICAgaWYgcmVwb3J0X25hbWUgPT0gJ1JPQ0FVQyc6CiAgICAgICAgICAgIGNvbnRleHQubG9nX3Jlc3VsdHMoeyJtaWNybyI6IHZpei5yb2NfYXVjLmdldCgibWljcm8iKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibWFjcm8iOiB2aXoucm9jX2F1Yy5nZXQoIm1hY3JvIil9KQogICAgICAgICAgICAKICAgICAgICBlbGlmIHJlcG9ydF9uYW1lID09ICdDbGFzc2lmaWNhdGlvblJlcG9ydCc6CiAgICAgICAgICAgIGZvciBzY29yZV9uYW1lIGluIHZpei5zY29yZXNfOgogICAgICAgICAgICAgICAgZm9yIHNjb3JlX2NsYXNzIGluIHZpei5zY29yZXNfW3Njb3JlX25hbWVdOgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnRleHQubG9nX3Jlc3VsdHMoe3Njb3JlX25hbWUgKyAiLSIgKyBzY29yZV9jbGFzcyA6IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpei5zY29yZXNfW3Njb3JlX25hbWVdLmdldChzY29yZV9jbGFzcyl9KQogICAgICAgIAogICAgICAgIHZpei5zaG93KCkKICAgIAogICAgdml6ID0gRmVhdHVyZUltcG9ydGFuY2VzKG1vZGVsLCBjbGFzc2VzPWNsYXNzZXMsIHBlcl9jbGFzcz1UcnVlLCBpc19maXR0ZWQ9VHJ1ZSwgbGFiZWxzPWRmX2hlYWRlcikKICAgIHZpei5maXQoWF90cmFpbl90cmFuc2Zvcm1lZCwgeV90cmFpbikgCiAgICB2aXouc2NvcmUoWF90ZXN0X3RyYW5zZm9ybWVkLCB5X3Rlc3QpCiAgICB2aXouc2hvdygpCiAgICAKICAgIHBsb3QgPSBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3QoIkZlYXR1cmVJbXBvcnRhbmNlcyIsIGJvZHk9dml6LmZpZywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPSJGZWF0dXJlSW1wb3J0YW5jZXMiKSwgZGJfa2V5PUZhbHNlKQogICAgZXh0cmFfZGF0YV9kaWN0W3N0cigiRmVhdHVyZUltcG9ydGFuY2VzIildID0gcGxvdAogICAgCiAgICBwbHQuY2xhKCkKICAgIHBsdC5jbGYoKQogICAgcGx0LmNsb3NlKCkKCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCJMb2cgYXJ0aWZhY3RzIikKICAgIGFydGlmYWN0X3BhdGggPSBjb250ZXh0LmFydGlmYWN0X3N1YnBhdGgobW9kZWxzX2Rlc3QpCiAgICAKICAgIHBsb3RzX3BhdGggPSBjb250ZXh0LmFydGlmYWN0X3N1YnBhdGgobW9kZWxzX2Rlc3QsIHBsb3RzX2Rlc3QpCiAgICAKICAgIGNvbnRleHQuc2V0X2xhYmVsKCdjbGFzcycsIG1vZGVsX3BrZ19jbGFzcykKICAgIAogICAgY29udGV4dC5sb2dfbW9kZWwoIm1vZGVsIiwgYm9keT1kdW1wcyhtb2RlbCksCiAgICAgICAgICAgICAgICAgICAgICBhcnRpZmFjdF9wYXRoPWFydGlmYWN0X3BhdGgsCiAgICAgICAgICAgICAgICAgICAgICBtb2RlbF9maWxlPSJtb2RlbC5wa2wiLAogICAgICAgICAgICAgICAgICAgICAgZXh0cmFfZGF0YT1leHRyYV9kYXRhX2RpY3QsCiAgICAgICAgICAgICAgICAgICAgICBtZXRyaWNzPWNvbnRleHQucmVzdWx0cywKICAgICAgICAgICAgICAgICAgICAgIGxhYmVscz17ImNsYXNzIjogbW9kZWxfcGtnX2NsYXNzfSkKICAgIAogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoInN0YW5kYXJkX3NjYWxlciIsIGJvZHk9ZHVtcHMoc2NhbGVyKSwKICAgICAgICAgICAgICAgICAgICAgICAgIGFydGlmYWN0X3BhdGg9YXJ0aWZhY3RfcGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsX2ZpbGU9InNjYWxlci5neiIsCiAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbD0ic3RhbmRhcmRfc2NhbGVyIikKICAgIAogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoImxhYmVsX2VuY29kZXIiLCBib2R5PWR1bXBzKGVuY29kZXIpLAogICAgICAgICAgICAgICAgICAgICAgICAgYXJ0aWZhY3RfcGF0aD1hcnRpZmFjdF9wYXRoLAogICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWxfZmlsZT0iZW5jb2Rlci5neiIsCiAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbD0ibGFiZWxfZW5jb2RlciIpCiAgICAKICAgIGRmX3RvX3NhdmUgPSBkZWxheWVkKG5wLmNvbHVtbl9zdGFjaykoKFhfdGVzdCwgeV90ZXN0KSkuY29tcHV0ZSgpCiAgICBjb250ZXh0LmxvZ19kYXRhc2V0KHRlc3Rfc2V0X2tleSwgCiAgICAgICAgICAgICAgICAgICAgICAgIGRmPXBkLkRhdGFGcmFtZShkZl90b19zYXZlLCBjb2x1bW5zPWRmX2hlYWRlciksICMgdGFsayB3aXRoIHRoZSB0ZWFtCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdD1maWxlX2V4dCwgaW5kZXg9RmFsc2UsIAogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbHM9eyJkYXRhLXR5cGUiOiAiaGVsZC1vdXQifSwKICAgICAgICAgICAgICAgICAgICAgICAgYXJ0aWZhY3RfcGF0aD1jb250ZXh0LmFydGlmYWN0X3N1YnBhdGgoJ2RhdGEnKSkKICAgIAogICAgY29udGV4dC5sb2dnZXIuaW5mbygiRG9uZSEiKQoKZHNmID0gbWxydW4uY29kZV90b19mdW5jdGlvbignc2tsZWFybi1jbGFzc2lmaWVyLWRhc2snLCBraW5kPSdkYXNrJywgY29kZV9vdXRwdXQ9Ii4iKSAuYXBwbHkobWxydW4ubW91bnRfdjNpbygpKQoKZHNmLnNwZWMuaW1hZ2UgPSAnbWxydW4vbWwtbW9kZWxzJwpkc2Yuc3BlYy5yZW1vdGUgPSBUcnVlCmRzZi5zcGVjLnJlcGxpY2FzID0gMQpkc2Yuc3BlYy5zZXJ2aWNlX3R5cGUgPSAnTm9kZVBvcnQnCmRzZi5leHBvcnQoImZ1bmN0aW9uLnlhbWwiKQoKYXJ0aWZhY3RfcGF0aCA9IG1scnVuLnNldF9lbnZpcm9ubWVudChhcGlfcGF0aCA9ICdodHRwOi8vbWxydW4tYXBpOjgwODAnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFydGlmYWN0X3BhdGggPSBvcy5wYXRoLmFic3BhdGgoJy4vJykpCgpEQVRBX1VSTCA9ICdodHRwczovL3MzLndhc2FiaXN5cy5jb20vaWd1YXppby9kYXRhL2lyaXMvaXJpc19kYXRhc2V0LmNzdicKCnRhc2tfcGFyYW1zID0gewogICAgInBhcmFtcyIgOiB7CiAgICAgICAgInNhbXBsZSIgICAgICAgICAgICAgOiAxLAogICAgICAgICJ0ZXN0X3NpemUiICAgICAgICAgIDogMC4zMCwKICAgICAgICAidHJhaW5fdmFsX3NwbGl0IiAgICA6IDAuNzUsCiAgICAgICAgInJhbmRvbV9zdGF0ZSIgICAgICAgOiA0MiwKICAgICAgICAibl9qb2JzIiAgICAgICAgICAgICA6IC0xLAogICAgICAgICJwbG90c19kZXN0IiAgICAgICAgIDogInBsb3RzLXAiLAogICAgICAgICJtb2RlbHNfZGVzdCIgICAgICAgIDogJ3NrbGVhcm4tY2xmbW9kZWwnfX0KCgptb2RlbHMgPSBbCiAgICAic2tsZWFybi5lbnNlbWJsZS5SYW5kb21Gb3Jlc3RDbGFzc2lmaWVyIiwgCiAgICAic2tsZWFybi5saW5lYXJfbW9kZWwuTG9naXN0aWNSZWdyZXNzaW9uIiwKICAgICJza2xlYXJuLmVuc2VtYmxlLkFkYUJvb3N0Q2xhc3NpZmllciIKXQoKb3V0cHV0cyA9IFtdCmZvciBtb2RlbCBpbiBtb2RlbHM6CiAgICB0YXNrX2NvcHkgPSB0YXNrX3BhcmFtcy5jb3B5KCkKICAgIHRhc2tfY29weS51cGRhdGUoCiAgICAgICAgewogICAgICAgICAgICAicGFyYW1zIjp7ICJtb2RlbF9wa2dfY2xhc3MiIDogbW9kZWwsCiAgICAgICAgICAgICAgICAgICAgICAgImxhYmVsX2NvbHVtbiIgICAgOiAibGFiZWwifQogICAgICAgIH0KICAgICkKICAgIAogICAgaWYgIlJhbmRvbUZvcmVzdENsYXNzaWZpZXIiIGluIG1vZGVsOgogICAgICAgIHRhc2tfY29weVsicGFyYW1zIl0udXBkYXRlKHsiQ0xBU1NfbWF4X2RlcHRoIiA6IDV9KQoKICAgIGlmICJMb2dpc3RpY1JlZ3Jlc3Npb24iIGluIG1vZGVsOgogICAgICAgIHRhc2tfY29weVsicGFyYW1zIl0udXBkYXRlKHsiQ0xBU1Nfc29sdmVyIiA6ICJsaWJsaW5lYXIifSkKICAgIAogICAgaWYgIkFkYUJvb3N0Q2xhc3NpZmllciIgaW4gbW9kZWw6CiAgICAgICAgdGFza19jb3B5WyJwYXJhbXMiXS51cGRhdGUoeyJDTEFTU19uX2VzdGltYXRvcnMiICA6IDIwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkNMQVNTX2xlYXJuaW5nX3JhdGUiIDogMC4wMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAKICAgIG5hbWUgPSBtb2RlbC5yZXBsYWNlKCcuJywgJ18nKQogICAgb3V0cHV0ID0gZHNmLnJ1bihtbHJ1bi5OZXdUYXNrKCoqdGFza19jb3B5KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyPXRyYWluX21vZGVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU9bmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dHM9eyJkYXRhc2V0IiAgOiBEQVRBX1VSTH0sIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFydGlmYWN0X3BhdGg9b3MucGF0aC5qb2luKGFydGlmYWN0X3BhdGgsIG1vZGVsKSkKICAgIAogICAgb3V0cHV0cy5hcHBlbmQoe25hbWU6IG91dHB1dC5vdXRwdXRzfSkKCg==
    commands: []
    code_origin: https://github.com/mlrun/functions.git#dc150ab093629994eb24f5d81f104859bb959a1c:sklearn-classifier-dask.ipynb
  default_handler: ''
  entry_points:
    train_model:
      name: train_model
      doc: Train a sklearn classifier with Dask
      parameters:
      - name: context
        type: MLClientCtx
        doc: Function context.
        default: ''
      - name: dataset
        type: DataItem
        doc: Raw data file.
        default: ''
      - name: model_pkg_class
        type: str
        doc: Model to train, e.g, "sklearn.ensemble.RandomForestClassifier",  or json
          model config.
        default: ''
      - name: label_column
        type: str
        doc: (label) Ground-truth y labels.
        default: label
      - name: train_validation_size
        type: float
        doc: (0.75) Train validation set proportion out of the full dataset.
        default: 0.75
      - name: sample
        type: float
        doc: (1.0) Select sample from dataset (n-rows/% of total), randomzie rows
          as default.
        default: 1.0
      - name: models_dest
        type: str
        doc: (models) Models subfolder on artifact path.
        default: models
      - name: test_set_key
        type: str
        doc: (test_set) Mlrun db key of held out data in artifact store.
        default: test_set
      - name: plots_dest
        type: str
        doc: (plots) Plot subfolder on artifact path.
        default: plots
      - name: dask_key
        type: str
        doc: (dask key) Key of dataframe in dask client "datasets" attribute.
        default: dask_key
      - name: dask_persist
        type: bool
        doc: (False) Should the data be persisted (through the `client.persist`)
        default: false
      - name: scheduler_key
        type: str
        doc: (scheduler) Dask scheduler configuration, json also logged as an artifact.
        default: null
      - name: file_ext
        type: str
        doc: (parquet) format for test_set_key hold out data
        default: parquet
      - name: random_state
        type: int
        doc: (42) sklearn seed
        default: 42
      outputs:
      - default: ''
      lineno: 32
  description: ''
  replicas: 1
  remote: true
  service_type: NodePort
  nthreads: 1
  min_replicas: 0
  max_replicas: 16
  scheduler_timeout: 60 minutes
