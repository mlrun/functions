kind: job
metadata:
  name: validate-expectations
  tag: ''
  hash: e761f583f56a80bc98413de32fce0ab6af482264
  project: ''
  labels:
    author: nicks
  categories:
    - data-validation
spec:
  command: ''
  args: []
  image: ''
  build:
    functionSourceCode: aW1wb3J0IG9zCmltcG9ydCBzaHV0aWwKCmltcG9ydCBtbHJ1bgoKZnJvbSBncmVhdF9leHBlY3RhdGlvbnMuY29yZS5iYXRjaCBpbXBvcnQgUnVudGltZUJhdGNoUmVxdWVzdApmcm9tIGdyZWF0X2V4cGVjdGF0aW9ucy5kYXRhX2NvbnRleHQgaW1wb3J0IEJhc2VEYXRhQ29udGV4dApmcm9tIGdyZWF0X2V4cGVjdGF0aW9ucy5kYXRhX2NvbnRleHQudHlwZXMuYmFzZSBpbXBvcnQgKAogICAgRGF0YUNvbnRleHRDb25maWcsCiAgICBGaWxlc3lzdGVtU3RvcmVCYWNrZW5kRGVmYXVsdHMsCikKZnJvbSBncmVhdF9leHBlY3RhdGlvbnMuY2hlY2twb2ludC50eXBlcy5jaGVja3BvaW50X3Jlc3VsdCBpbXBvcnQgQ2hlY2twb2ludFJlc3VsdAoKCmRlZiBnZXRfZGVmYXVsdF9kYXRhc291cmNlX2NvbmZpZygKICAgIGRhdGFzb3VyY2VfbmFtZTogc3RyLCBkYXRhX2Nvbm5lY3Rvcl9uYW1lOiBzdHIKKSAtPiBkaWN0OgogICAgIiIiCiAgICBDb252ZW5pZW5jZSBmdW5jdGlvbiB0byBnZXQgdGhlIGRlZmF1bHQgcGFuZGFzIGRhdGFzb3VyY2UgY29uZmlnCiAgICBmb3IgdXNlIGluIHZhbGlkYXRpbmcgZXhwZWN0YXRpb25zLgoKICAgIDpwYXJhbSBkYXRhc291cmNlX25hbWU6ICAgICBOYW1lIG9mIGRhdGFzb3VyY2UuCiAgICA6cGFyYW0gZGF0YV9jb25uZWN0b3JfbmFtZSIgTmFtZSBvZiBkYXRhIGNvbm5lY3Rvci4KCiAgICA6cmV0dXJuOiBDb25maWd1cmF0aW9uIGZvciBkZWZhdWx0IGRhdGFzb3VyY2UuCiAgICAiIiIKICAgIGRlZmF1bHRfZGF0YXNvdXJjZV9jb25maWcgPSB7CiAgICAgICAgIm5hbWUiOiBmIntkYXRhc291cmNlX25hbWV9IiwKICAgICAgICAiY2xhc3NfbmFtZSI6ICJEYXRhc291cmNlIiwKICAgICAgICAibW9kdWxlX25hbWUiOiAiZ3JlYXRfZXhwZWN0YXRpb25zLmRhdGFzb3VyY2UiLAogICAgICAgICJleGVjdXRpb25fZW5naW5lIjogewogICAgICAgICAgICAibW9kdWxlX25hbWUiOiAiZ3JlYXRfZXhwZWN0YXRpb25zLmV4ZWN1dGlvbl9lbmdpbmUiLAogICAgICAgICAgICAiY2xhc3NfbmFtZSI6ICJQYW5kYXNFeGVjdXRpb25FbmdpbmUiLAogICAgICAgIH0sCiAgICAgICAgImRhdGFfY29ubmVjdG9ycyI6IHsKICAgICAgICAgICAgZiJ7ZGF0YV9jb25uZWN0b3JfbmFtZX0iOiB7CiAgICAgICAgICAgICAgICAiY2xhc3NfbmFtZSI6ICJSdW50aW1lRGF0YUNvbm5lY3RvciIsCiAgICAgICAgICAgICAgICAibW9kdWxlX25hbWUiOiAiZ3JlYXRfZXhwZWN0YXRpb25zLmRhdGFzb3VyY2UuZGF0YV9jb25uZWN0b3IiLAogICAgICAgICAgICAgICAgImJhdGNoX2lkZW50aWZpZXJzIjogWyJkZWZhdWx0X2lkZW50aWZpZXJfbmFtZSJdLAogICAgICAgICAgICB9LAogICAgICAgIH0sCiAgICB9CiAgICByZXR1cm4gZGVmYXVsdF9kYXRhc291cmNlX2NvbmZpZwoKCmRlZiBnZXRfZGVmYXVsdF9jaGVja3BvaW50X2NvbmZpZyhjaGVja3BvaW50X25hbWU6IHN0cikgLT4gZGljdDoKICAgICIiIgogICAgQ29udmVuaWVuY2UgZnVuY3Rpb24gdG8gZ2V0IHRoZSBkZWZhdWx0IGNoZWNrcG9pbnQgY29uZmlnIGZvcgogICAgdXNlIGluIHZhbGlkYXRpbmcgZXhwZWN0YXRpb25zLgoKICAgIDpwYXJhbSBjaGVja3BvaW50X25hbWU6ICAgICBOYW1lIG9mIGNoZWNrcG9pbnQuCgogICAgOnJldHVybjogQ29uZmlndXJhdGlvbiBmb3IgZGVmYXVsdCBjaGVja3BvaW50LgogICAgIiIiCiAgICByZXR1cm4gewogICAgICAgICJuYW1lIjogY2hlY2twb2ludF9uYW1lLAogICAgICAgICJjb25maWdfdmVyc2lvbiI6IDEuMCwKICAgICAgICAiY2xhc3NfbmFtZSI6ICJTaW1wbGVDaGVja3BvaW50IiwKICAgICAgICAicnVuX25hbWVfdGVtcGxhdGUiOiAiJVklbSVkLSVIJU0lUy1teS1ydW4tbmFtZS10ZW1wbGF0ZSIsCiAgICB9CgoKZGVmIGdldF9kYXRhX2RvY19wYXRoKGNoZWNrcG9pbnRfcmVzdWx0OiBDaGVja3BvaW50UmVzdWx0KSAtPiBzdHI6CiAgICAiIiIKICAgIENvbnZlbmllbmNlIGZ1bmN0aW9uIHRvIGdldCB0aGUgcGF0aCBvZiB0aGUgb3V0cHV0CiAgICBkYXRhIGRvYyBmcm9tIGEgY2hlY2twb2ludCByZXN1bHQuCgogICAgOnBhcmFtIGNoZWNrcG9pbnRfcmVzdWx0OiBHcmVhdCBFeHBlY3RhdGlvbnMgY2hlY2twb2ludCByZXN1bHQuCgogICAgOnJldHVybjogQWJzb2x1dGUgcGF0aCB0byBuZXcgZGF0YSBkb2MuCiAgICAiIiIKICAgIHJlc3VsdF9pZCA9IGNoZWNrcG9pbnRfcmVzdWx0Lmxpc3RfdmFsaWRhdGlvbl9yZXN1bHRfaWRlbnRpZmllcnMoKVswXQogICAgZGF0YV9kb2NfcGF0aCA9IGNoZWNrcG9pbnRfcmVzdWx0WyJydW5fcmVzdWx0cyJdW3Jlc3VsdF9pZF1bImFjdGlvbnNfcmVzdWx0cyJdWwogICAgICAgICJ1cGRhdGVfZGF0YV9kb2NzIgogICAgXVsibG9jYWxfc2l0ZSJdCiAgICBkYXRhX2RvY19wYXRoID0gZGF0YV9kb2NfcGF0aC5yZXBsYWNlKCJmaWxlOi8vIiwgIiIpCiAgICByZXR1cm4gZGF0YV9kb2NfcGF0aAoKCmRlZiB2YWxpZGF0ZV9leHBlY3RhdGlvbnMoCiAgICBjb250ZXh0OiBtbHJ1bi5NTENsaWVudEN0eCwKICAgIGRhdGE6IG1scnVuLkRhdGFJdGVtLAogICAgZXhwZWN0YXRpb25fc3VpdGVfbmFtZTogc3RyLAogICAgZGF0YV9hc3NldF9uYW1lOiBzdHIsCiAgICBkYXRhc291cmNlX25hbWU6IHN0ciA9ICJwYW5kYXNfZGF0YXNvdXJjZSIsCiAgICBkYXRhX2Nvbm5lY3Rvcl9uYW1lOiBzdHIgPSAiZGVmYXVsdF9ydW50aW1lX2RhdGFfY29ubmVjdG9yX25hbWUiLAogICAgZGF0YXNvdXJjZV9jb25maWc6IGRpY3QgPSBOb25lLAogICAgYmF0Y2hfaWRlbnRpZmllcnM6IGRpY3QgPSBOb25lLAogICAgcm9vdF9kaXJlY3Rvcnk6IHN0ciA9IE5vbmUsCiAgICBjaGVja3BvaW50X25hbWU6IHN0ciA9IE5vbmUsCiAgICBjaGVja3BvaW50X2NvbmZpZzogZGljdCA9IE5vbmUsCikgLT4gTm9uZToKICAgICIiIgogICAgTWFpbiBmdW5jdGlvbiB0byB2YWxpZGF0ZSBhbiBpbnB1dCBkYXRhc2V0LCBkYXRhc291cmNlLCBkYXRhIGNvbm5lY3RvciwKICAgIGFuZCBleHBlY3RhdGlvbiBzdWl0ZS4KCiAgICBSdW5zIHRoZSBHcmVhdCBFeHBlY3RhdGlvbiB2YWxpZGF0aW9uIGFuZCBsb2dzCiAgICB3aGV0aGVyIHRoZSB2YWxpZGF0aW9uIHdhcyBhIHN1Y2Nlc3MgYXMgd2VsbCBhcyB0aGUgb3V0cHV0IHBhZ2UKICAgIG9mIHRoZSBkYXRhIGRvY3MuCgogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgICAgICAgIE1MUnVuIGNvbnRleHQuCiAgICA6cGFyYW0gZGF0YTogICAgICAgICAgICAgICAgICAgRGF0YSB0byB2YWxpZGF0ZS4KICAgIDpwYXJhbSBleHBlY3RhdGlvbl9zdWl0ZV9uYW1lOiBOYW1lIG9mIGV4cGVjdGF0aW9uIHN1aXRlIHRvIHZhbGlkYXRlIGFnYWluc3QuCiAgICA6cGFyYW0gZGF0YV9hc3NldF9uYW1lOiAgICAgICAgTmFtZSBvZiBkYXRhc2V0IGluIEdyZWF0IEV4cGVjdGF0aW9ucy4KICAgIDpwYXJhbSBkYXRhc291cmNlX25hbWU6ICAgICAgICBOYW1lIG9mIGRhdGFzb3VyY2UgdG8gdXNlIGZvciB2YWxpZGF0aW9uLgogICAgOnBhcmFtIGRhdGFfY29ubmVjdG9yX25hbWU6ICAgIE5hbWUgb2YgZGF0YSBjb25uZWN0b3IgdG8gdXNlIGZvciB2YWxpZGF0aW9uLgogICAgOnBhcmFtIGRhdGFzb3VyY2VfY29uZmlnOiAgICAgIEZ1bGwgY29uZmlndXJhdGlvbiBmb3IgZGF0YXNvdXJjZS4gRm9yIHVzZSB3aXRoIGN1c3RvbQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgc291cmNlcyBvdGhlciB0aGFuIHRoZSBkZWZhdWx0IHBhbmRhcyBkYXRhc291cmNlLgogICAgOnBhcmFtIGJhdGNoX2lkZW50aWZpZXJzOiAgICAgIEN1c3RvbSBtZXRhZGF0YSBmb3IgaWRlbnRpZnlpbmcgcGFydGljdWxhciBiYXRjaGVzIG9mCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS4gRm9yIHVzZSB3aGVuIG5vdCB1c2luZyB0aGUgZGVmYXVsdCBiYXRjaCBpZGVudGlmaWVycy4KICAgIDpwYXJhbSByb290X2RpcmVjdG9yeTogICAgICAgICBQYXRoIHRvIHVuZGVybHlpbmcgR3JlYXQgRXhwZWN0YXRpb25zIHByb2plY3QuIERlZmF1bHRzIHRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTUxSdW4gcHJvamVjdCBhcnRpZmFjdCBwYXRoIGlmIG5vdCBzcGVjaWZpZWQuCiAgICA6cGFyYW0gY2hlY2twb2ludF9uYW1lOiAgICAgICAgTmFtZSBvZiBjaGVja3BvaW50IHRvIHVzZSBmb3IgdmFsaWRhdGlvbi4KICAgIDpwYXJhbSBjaGVja3BvaW50X2NvbmZpZzogICAgICBGdWxsIGNvbmZpZ3VyYXRpb24gZm9yIGNoZWNrcG9pbnQuIEZvciB1c2Ugd2l0aCBjdXN0b21lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2twb2ludCBjb25maWcgb3RoZXIgdGhhbiB0aGUgZGVmYXVsdC4KICAgICIiIgoKICAgICMgR2V0IGRhdGEKICAgIGRmID0gZGF0YS5hc19kZigpCgogICAgIyBVc2UgZGVmYXVsdCByb290IGRpcmVjdG9yeSBmb3IgcHJvamVjdCBpZiBub3Qgc3BlY2lmaWVkCiAgICByb290X2RpcmVjdG9yeSA9ICgKICAgICAgICByb290X2RpcmVjdG9yeQogICAgICAgIGlmIHJvb3RfZGlyZWN0b3J5CiAgICAgICAgZWxzZSBmIi92M2lvL3Byb2plY3RzL3tjb250ZXh0LnByb2plY3R9L2dyZWF0X2V4cGVjdGF0aW9ucyIKICAgICkKCiAgICAjIExvYWQgZ3JlYXQgZXhwZWN0YXRpb25zIGNvbnRleHQKICAgIGdlX2NvbnRleHQgPSBCYXNlRGF0YUNvbnRleHQoCiAgICAgICAgcHJvamVjdF9jb25maWc9RGF0YUNvbnRleHRDb25maWcoCiAgICAgICAgICAgIHN0b3JlX2JhY2tlbmRfZGVmYXVsdHM9RmlsZXN5c3RlbVN0b3JlQmFja2VuZERlZmF1bHRzKAogICAgICAgICAgICAgICAgcm9vdF9kaXJlY3Rvcnk9cm9vdF9kaXJlY3RvcnkKICAgICAgICAgICAgKQogICAgICAgICkKICAgICkKCiAgICAjIEdldCBleHBlY3RhdGlvbiBzdWl0ZQogICAgZ2VfY29udGV4dC5nZXRfZXhwZWN0YXRpb25fc3VpdGUoZXhwZWN0YXRpb25fc3VpdGVfbmFtZT1leHBlY3RhdGlvbl9zdWl0ZV9uYW1lKQoKICAgICMgQWRkIGRlZmF1bHQgZGF0YSBzb3VyY2UgaWYgbm90IHNwZWNpZmllZAogICAgZGF0YXNvdXJjZV9jb25maWcgPSAoCiAgICAgICAgZGF0YXNvdXJjZV9jb25maWcKICAgICAgICBpZiBkYXRhc291cmNlX2NvbmZpZwogICAgICAgIGVsc2UgZ2V0X2RlZmF1bHRfZGF0YXNvdXJjZV9jb25maWcoZGF0YXNvdXJjZV9uYW1lLCBkYXRhX2Nvbm5lY3Rvcl9uYW1lKQogICAgKQogICAgZ2VfY29udGV4dC5hZGRfZGF0YXNvdXJjZSgqKmRhdGFzb3VyY2VfY29uZmlnKQoKICAgICMgR2V0IGRhdGEgYmF0Y2gKICAgIGJhdGNoX2lkZW50aWZpZXJzID0gKAogICAgICAgIGJhdGNoX2lkZW50aWZpZXJzCiAgICAgICAgaWYgYmF0Y2hfaWRlbnRpZmllcnMKICAgICAgICBlbHNlIHsiZGVmYXVsdF9pZGVudGlmaWVyX25hbWUiOiAiZGVmYXVsdF9pZGVudGlmaWVyIn0KICAgICkKICAgIGJhdGNoX3JlcXVlc3QgPSBSdW50aW1lQmF0Y2hSZXF1ZXN0KAogICAgICAgIGRhdGFzb3VyY2VfbmFtZT1kYXRhc291cmNlX25hbWUsCiAgICAgICAgZGF0YV9jb25uZWN0b3JfbmFtZT1kYXRhX2Nvbm5lY3Rvcl9uYW1lLAogICAgICAgIGRhdGFfYXNzZXRfbmFtZT1kYXRhX2Fzc2V0X25hbWUsCiAgICAgICAgcnVudGltZV9wYXJhbWV0ZXJzPXsiYmF0Y2hfZGF0YSI6IGRmfSwKICAgICAgICBiYXRjaF9pZGVudGlmaWVycz1iYXRjaF9pZGVudGlmaWVycywKICAgICkKCiAgICAjIEdldCB2YWxpZGF0b3IKICAgIHZhbGlkYXRvciA9IGdlX2NvbnRleHQuZ2V0X3ZhbGlkYXRvcigKICAgICAgICBiYXRjaF9yZXF1ZXN0PWJhdGNoX3JlcXVlc3QsCiAgICAgICAgZXhwZWN0YXRpb25fc3VpdGVfbmFtZT1leHBlY3RhdGlvbl9zdWl0ZV9uYW1lLAogICAgKQoKICAgICMgVXNlIGRlZmF1bHQgY2hlY2twb2ludCBuYW1lIGFuZCBjb25maWcgaWYgbm90IHNwZWNpZmllZAogICAgY2hlY2twb2ludF9uYW1lID0gKAogICAgICAgIGNoZWNrcG9pbnRfbmFtZSBpZiBjaGVja3BvaW50X25hbWUgZWxzZSBmIntkYXRhX2Fzc2V0X25hbWV9X2NoZWNrcG9pbnQiCiAgICApCiAgICBjaGVja3BvaW50X2NvbmZpZyA9ICgKICAgICAgICBjaGVja3BvaW50X2NvbmZpZwogICAgICAgIGlmIGNoZWNrcG9pbnRfY29uZmlnCiAgICAgICAgZWxzZSBnZXRfZGVmYXVsdF9jaGVja3BvaW50X2NvbmZpZyhjaGVja3BvaW50X25hbWUpCiAgICApCgogICAgIyBBZGQgY2hlY2twb2ludAogICAgZ2VfY29udGV4dC5hZGRfY2hlY2twb2ludCgqKmNoZWNrcG9pbnRfY29uZmlnKQoKICAgICMgUnVuIGV4cGVjdGF0aW9uIHN1aXRlIG9uIGNoZWNrcG9pbnQKICAgIGNoZWNrcG9pbnRfcmVzdWx0ID0gZ2VfY29udGV4dC5ydW5fY2hlY2twb2ludCgKICAgICAgICBjaGVja3BvaW50X25hbWU9Y2hlY2twb2ludF9uYW1lLAogICAgICAgIHZhbGlkYXRpb25zPVsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgImJhdGNoX3JlcXVlc3QiOiBiYXRjaF9yZXF1ZXN0LAogICAgICAgICAgICAgICAgImV4cGVjdGF0aW9uX3N1aXRlX25hbWUiOiBleHBlY3RhdGlvbl9zdWl0ZV9uYW1lLAogICAgICAgICAgICB9CiAgICAgICAgXSwKICAgICkKCiAgICAjIExvZyBzdWNjZXNzCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoInZhbGlkYXRlZCIsIGNoZWNrcG9pbnRfcmVzdWx0WyJzdWNjZXNzIl0pCgogICAgIyBMb2cgZGF0YSBkb2MKICAgIGRhdGFfZG9jX3BhdGggPSBnZXRfZGF0YV9kb2NfcGF0aChjaGVja3BvaW50X3Jlc3VsdCkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KCJ2YWxpZGF0aW9uX3Jlc3VsdHMiLCB0YXJnZXRfcGF0aD1kYXRhX2RvY19wYXRoKQo=
    base_image: mlrun/mlrun
    commands:
    - python -m pip install great-expectations==0.14.9
    code_origin: https://github.com/igz-us-sales/functions.git#13b3c6edf76fc4c8d32dba5c8c231cb9723bd5f2:great_expectations_mlrun.py
    origin_filename: great_expectations_mlrun.py
  description: ''
  default_handler: validate_expectations
  disable_auto_mount: false
  env:
  - name: V3IO_API
    value: ''
  - name: V3IO_USERNAME
    value: ''
  - name: V3IO_ACCESS_KEY
    value: ''
  - name: V3IO_FRAMESD
    value: ''
  priority_class_name: igz-workload-medium
  affinity: null
verbose: false
