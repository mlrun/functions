kind: job
metadata:
  name: structured-data-generator
  tag: ''
  hash: 5fd0aeef68845c8ed18159496cc166f9f38eeca2
  project: ''
  labels:
    author: zeevr
  categories:
  - machine-learning
  - Data Preparation
  - Data Generation
  - GenAI
spec:
  command: ''
  args: []
  image: ''
  build:
    functionSourceCode: IyBDb3B5cmlnaHQgMjAyMyBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAojCiMgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQojIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiMgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiMgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAojIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgppbXBvcnQgYXN0CmltcG9ydCBvcwoKaW1wb3J0IHRxZG0KZnJvbSBsYW5nY2hhaW4uY2hhdF9tb2RlbHMgaW1wb3J0IENoYXRPcGVuQUkKCgpkZWYgX3NldF9vcGVuYWlfc2VjcmV0cygpIC0+IGJvb2w6CiAgICBrZXkgPSAiT1BFTkFJX0FQSV9LRVkiCiAgICBiYXNlID0gIk9QRU5BSV9BUElfQkFTRSIKICAgICMgQ2hlY2sgaWYgdGhlIGtleSBpcyBhbHJlYWR5IGluIHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZXM6CiAgICBpZiBrZXkgaW4gb3MuZW52aXJvbiBhbmQgYmFzZSBpbiBvcy5lbnZpcm9uOgogICAgICAgIHJldHVybiBUcnVlCiAgICAjIENoZWNrIGlmIG1scnVuIGlzIGluc3RhbGxlZDoKICAgIHRyeToKICAgICAgICBpbXBvcnQgbWxydW4KICAgIGV4Y2VwdCBNb2R1bGVOb3RGb3VuZEVycm9yOgogICAgICAgIHJhaXNlIEVudmlyb25tZW50RXJyb3IoCiAgICAgICAgICAgIGYiT25lIG9yIG1vcmUgb2YgdGhlIE9wZW5BSSByZXF1aXJlZCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgKCd7a2V5fScsICd7YmFzZX0nKSBhcmUgbWlzc2luZy4iCiAgICAgICAgICAgIGYiUGxlYXNlIHNldCB0aGVtIGFzIGVudmlyb25tZW50IHZhcmlhYmxlcyBvciBpbnN0YWxsIG1scnVuIChgcGlwIGluc3RhbGwgbWxydW5gKSIKICAgICAgICAgICAgZiJhbmQgc2V0IHRoZW0gYXMgcHJvamVjdCBzZWNyZXRzIHVzaW5nIGBwcm9qZWN5LnNldF9zZWNyZXRzYC4iCiAgICAgICAgKQoKICAgICMgQ2hlY2sgaWYgdGhlIGtleSBpcyBpbiB0aGUgc2VjcmV0czoKICAgIGNvbnRleHQgPSBtbHJ1bi5nZXRfb3JfY3JlYXRlX2N0eChuYW1lPSJjb250ZXh0IikKICAgIG9wZW5haV9rZXkgPSBjb250ZXh0LmdldF9zZWNyZXQoa2V5LCBOb25lKQogICAgb3BlbmFpX2Jhc2UgPSBjb250ZXh0LmdldF9zZWNyZXQoYmFzZSwgTm9uZSkKCiAgICAjIElmIHRoZSBrZXkgaXMgbm90IGluIHRoZSBzZWNyZXRzLCByZXR1cm4gRmFsc2U6CiAgICBpZiBub3Qgb3BlbmFpX2tleToKICAgICAgICByYWlzZSBFbnZpcm9ubWVudEVycm9yKAogICAgICAgICAgICBmIkNvdWxkIG5vdCBmaW5kIE9wZW5BSSBBUEkga2V5IGluIHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZXMgb3Igc2VjcmV0cywiCiAgICAgICAgICAgIGYiIHBsZWFzZSBzZXQgaXQgYXM6IHtrZXl9LiIKICAgICAgICApCiAgICBpZiBub3Qgb3BlbmFpX2Jhc2U6CiAgICAgICAgcmFpc2UgRW52aXJvbm1lbnRFcnJvcigKICAgICAgICAgICAgZiJDb3VsZCBub3QgZmluZCBPcGVuQUkgQVBJIGJhc2UgaW4gdGhlIGVudmlyb25tZW50IHZhcmlhYmxlcyBvciBzZWNyZXRzLCIKICAgICAgICAgICAgZiIgcGxlYXNlIHNldCBpdCBhczoge2Jhc2V9LiIKICAgICAgICApCiAgICAjIElmIHRoZSBrZXkgaXMgaW4gdGhlIHNlY3JldHMsIHNldCBpdCBpbiB0aGUgZW52aXJvbm1lbnQgdmFyaWFibGVzIGFuZCByZXR1cm4gVHJ1ZToKICAgIG9zLmVudmlyb25ba2V5XSA9IG9wZW5haV9rZXkKICAgIG9zLmVudmlyb25bYmFzZV0gPSBvcGVuYWlfYmFzZQogICAgcmV0dXJuIFRydWUKCgpkZWYgZ2VuZXJhdGVfZGF0YSgKICAgIGZpZWxkczogbGlzdCwKICAgIGFtb3VudDogaW50ID0gMTAsCiAgICBtb2RlbF9uYW1lOiBzdHIgPSAiZ3B0LTMuNS10dXJibyIsCiAgICBsYW5ndWFnZTogc3RyID0gImVuIiwKICAgIGNodW5rX3NpemU6IGludCA9IDUwLAopIC0+IGxpc3Q6CiAgICAiIiIKICAgIFN0cnVjdHVyZWQgZGF0YSBvZiBlbGVtZW50cyBhY2NvcmRpbmcgdG8gdGhlIGdpdmVuIHBhcmFtZXRlcnMuCiAgICBUaGUgZGF0YSBjYW4gYmUgbGF0ZXIgbG9nZ2VkIGFzIGEgc3RydWN0dXJlZCBmaWxlIHdpdGggTUxSdW4ncyBgcmV0dXJuc2AgcGFyYW1ldGVyLgoKICAgIDpwYXJhbSBmaWVsZHM6IEEgbGlzdCBvZiBmaWVsZHMgdG8gcmFuZG9tbHkgZ2VuZXJhdGUuCiAgICA6cGFyYW0gYW1vdW50OiBUaGUgbnVtYmVyIG9mIHZhcmlhbnRzIHRvIGdlbmVyYXRlLgogICAgOnBhcmFtIG1vZGVsX25hbWU6IFRoZSBuYW1lIG9mIHRoZSBtb2RlbCB0byB1c2UgZm9yIGNvbnZlcnNhdGlvbiBnZW5lcmF0aW9uLgogICAgICAgICAgICAgICAgICAgICAgIFlvdSBzaG91bGQgY2hvb3NlIG9uZSBvZiBHUFQtNCBvciBHUFQtMy41IGZyb20gdGhlIGxpc3QgaGVyZTogaHR0cHM6Ly9wbGF0Zm9ybS5vcGVuYWkuY29tL2RvY3MvbW9kZWxzLgogICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQ6ICdncHQtMy41LXR1cmJvJy4KICAgIDpwYXJhbSBsYW5ndWFnZTogVGhlIGxhbmd1YWdlIHRvIHVzZSBmb3IgdGhlIGdlbmVyYXRlZCBjb252ZXJzYXRpb24gdGV4dC4KICAgIDpwYXJhbSBjaHVua19zaXplOiBOdW1iZXIgb2Ygc2FtcGxlcyBnZW5lcmF0ZWQgYXQgZWFjaCBHUFQgcXVlcnkuCiAgICAiIiIKICAgIGluc3RydWN0aW9ucyA9ICIiCiAgICBmb3IgZmllbGQgaW4gZmllbGRzOgogICAgICAgICMgU3BsaXQgdGhlIGZpZWxkIHRvIGtleSBhbmQgaW5zdHJ1Y3Rpb246CiAgICAgICAgaWYgIjoiIGluIGZpZWxkOgogICAgICAgICAgICBrZXksIGluc3RydWN0aW9uID0gZmllbGQuc3BsaXQoIjoiLCAxKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGtleSwgaW5zdHJ1Y3Rpb24gPSBmaWVsZCwgIm5vIHNwZWNpYWwgaW5zdHJ1Y3Rpb24iCiAgICAgICAgIyBSZXBsYWNlIHNwYWNlcyB3aXRoIHVuZGVyc2NvcmVzIGZvciB0aGUga2V5IHRvIGJlIHVzZWQgYXMgYSBqc29uIGtleToKICAgICAgICBrZXkgPSBrZXkucmVwbGFjZSgiICIsICJfIikKICAgICAgICBpbnN0cnVjdGlvbnMgKz0gZiIqIHtrZXl9OiB7aW5zdHJ1Y3Rpb259XG4iCgogICAgIyBDcmVhdGUgdGhlIHByb21wdCBzdHJ1Y3R1cmU6CiAgICBwcm9tcHRfc3RydWN0dXJlID0gKAogICAgICAgIGYiZ2VuZXJhdGUgdGhlIGZvbGxvd2luZyB2YWx1ZXMge2Ftb3VudH0gdGltZXMgcmFuZG9tbHksIGluIGFuIG9yZGVyIHRoYXQgY3JlYXRlcyBhIGpzb24gdGFibGUuXG4iCiAgICAgICAgZiJVc2UgdGhlIGZvbGxvd2luZyBrZXlzIGFuZCBpbnN0cnVjdGlvbnMgKGV4YW1wbGU6ICdrZXk6IGluc3RydWN0aW9uIG9yIG5vIHNwZWNpYWwgaW5zdHJ1Y3Rpb24nKTogIgogICAgICAgIGYie2luc3RydWN0aW9uc30uXG4iCiAgICAgICAgZiJQbGVhc2UgZ2VuZXJhdGUgdGhlIHZhbHVlcyBpbiB7bGFuZ3VhZ2V9IGxhbmd1YWdlLiBcbiIKICAgICAgICBmIk1ha2Ugc3VyZSB0aGUgbmFtZXMgb2YgdGhlIGtleXMgYXJlIHRoZSBzYW1lIGFzIHRoZSBnaXZlbiBmaWVsZCBuYW1lLlxuIgogICAgICAgIGYiUGxlYXNlIHJldHVybiBvbmx5IHRoZSBqc29uIGZvcm1hdCB3aXRob3V0IGFueSBpbnRyb2R1Y3Rpb24gYW5kIGVuZGluZyIKICAgICkKCiAgICAjIFNldCB0aGUgT3BlbkFJIHNlY3JldHM6CiAgICBfc2V0X29wZW5haV9zZWNyZXRzKCkKCiAgICAjIExvYWQgdGhlIE9wZW5BSSBtb2RlbCB1c2luZyBsYW5nY2hhaW46CiAgICBsbG0gPSBDaGF0T3BlbkFJKG1vZGVsPW1vZGVsX25hbWUpCgogICAgIyBTdGFydCBnZW5lcmF0aW5nIGRhdGE6CiAgICBkYXRhID0gW10KICAgIGZvciBfIGluIHRxZG0udHFkbShyYW5nZSgoYW1vdW50IC8vIGNodW5rX3NpemUpICsgMSksIGRlc2M9IkdlbmVyYXRpbmciKToKICAgICAgICAjIFdlIHRyeSB0byBnZW5lcmF0ZSB0aGUgZGF0YSAzIHRpbWVzLCBpZiB3ZSBmYWlsIHdlIHJhaXNlIGFuIGVycm9yOgogICAgICAgIGZvciB0cnlvdXQgaW4gcmFuZ2UoMyk6CiAgICAgICAgICAgICMgSWYgdGhlIGFtb3VudCB3YW50ZWQgaXMgYmlnZ2VyIHRoYW4gdGhlIGNodW5rIHNpemUsIHdlIGdlbmVyYXRlIGEgY2h1bmsgb2YgZGF0YSBpbiB0aGUgc2l6ZSBvZiB0aGUgY2h1bmsKICAgICAgICAgICAgIyBhbmQgZGVjcmVhc2UgdGhlIGFtb3VudCBieSB0aGUgY2h1bmsgc2l6ZS4KICAgICAgICAgICAgIyBvdGhlcndpc2Ugd2UgZ2VuZXJhdGUgYSBjaHVuayBvZiBkYXRhIGluIHRoZSBzaXplIG9mIHRoZSBhbW91bnQ6CiAgICAgICAgICAgIGlmIGFtb3VudCA+IGNodW5rX3NpemU6CiAgICAgICAgICAgICAgICBjdXJyZW50X2NodW5rX3NpemUgPSBjaHVua19zaXplCiAgICAgICAgICAgICAgICBhbW91bnQgLT0gY2h1bmtfc2l6ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgY3VycmVudF9jaHVua19zaXplID0gYW1vdW50CgogICAgICAgICAgICAjIENyZWF0ZSB0aGUgcHJvbXB0OgogICAgICAgICAgICBwcm9tcHQgPSBwcm9tcHRfc3RydWN0dXJlLmZvcm1hdCgKICAgICAgICAgICAgICAgIGFtb3VudD1jdXJyZW50X2NodW5rX3NpemUsCiAgICAgICAgICAgICkKCiAgICAgICAgICAgICMgR2VuZXJhdGUgYSBjaHVuayBvZiBkYXRhOgogICAgICAgICAgICBjaHVua19kYXRhID0gbGxtLnByZWRpY3QodGV4dD1wcm9tcHQpCgogICAgICAgICAgICAjIFZhbGlkYXRlIHRoZSByZXNwb25zZSBmb3IgY29ycmVjdCBweXRob24gYGxpc3RgIHN0cnVjdHVyZQogICAgICAgICAgICBjaHVua19kYXRhID0gY2h1bmtfZGF0YVtjaHVua19kYXRhLmZpbmQoIlsiKSA6IGNodW5rX2RhdGEucmZpbmQoIl0iKSArIDFdCiAgICAgICAgICAgIGlmIGNodW5rX2RhdGEuY291bnQoIlsiKSAhPSBjaHVua19kYXRhLmNvdW50KCJdIik6CiAgICAgICAgICAgICAgICBwcmludCgKICAgICAgICAgICAgICAgICAgICAiRmFpbGVkIHRvIGdldCBwcm9wZXIganNvbiBmb3JtYXQgZnJvbSBtb2RlbCwgbnVtYmVyIG9mICdbJyBkb2Vzbid0IG1hdGNoIG51bWJlciBvZiAnXScuIgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgY2h1bmtfZGF0YSA9IGFzdC5saXRlcmFsX2V2YWwoY2h1bmtfZGF0YSkKICAgICAgICAgICAgZGF0YSArPSBjaHVua19kYXRhCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgaWYgdHJ5b3V0ID09IDM6CiAgICAgICAgICAgIHJhaXNlIFJ1bnRpbWVFcnJvcigKICAgICAgICAgICAgICAgIGYiQ291bGQgbm90IGdlbmVyYXRlIGEgcHJvcGVyIGpzb24gZm9ybWF0IGZvciB0aGUgZ2l2ZW4gZmllbGRzLCB1c2luZyBnaXZlbiBtb2RlbDoge21vZGVsX25hbWV9LiIKICAgICAgICAgICAgICAgIGYiIEhpbnQ6IEdwdC00IHdvcmtzIGJlc3QgZm9yIG1vc3Qgc2NlbmFyaW9zLiIKICAgICAgICAgICAgKQogICAgcmV0dXJuIGRhdGEK
    base_image: mlrun/mlrun
    commands: []
    code_origin: ''
    origin_filename: ''
    requirements:
    - langchain
    - tqdm
  entry_points:
    generate_data:
      name: generate_data
      doc: 'Structured data of elements according to the given parameters.

        The data can be later logged as a structured file with MLRun''s `returns`
        parameter.'
      parameters:
      - name: fields
        type: list
        doc: A list of fields to randomly generate.
      - name: amount
        type: int
        doc: The number of variants to generate.
        default: 10
      - name: model_name
        type: str
        doc: 'The name of the model to use for conversation generation. You should
          choose one of GPT-4 or GPT-3.5 from the list here: https://platform.openai.com/docs/models.
          Default: ''gpt-3.5-turbo''.'
        default: gpt-3.5-turbo
      - name: language
        type: str
        doc: The language to use for the generated conversation text.
        default: en
      - name: chunk_size
        type: int
        doc: Number of samples generated at each GPT query.
        default: 50
      outputs:
      - type: list
      lineno: 59
      has_varargs: false
      has_kwargs: false
  description: GenAI approach of generating structured data according to a given schema
  default_handler: generate_data
  disable_auto_mount: false
  clone_target_dir: ''
  env: []
  priority_class_name: ''
  preemption_mode: prevent
  affinity: null
  tolerations: null
  security_context: {}
verbose: false
