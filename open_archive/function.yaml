kind: job
metadata:
  name: open-archive
  tag: latest
  hash: 9a1cac7fc6fe7c28c954ab98c3175b3d882217cc
  project: ''
  labels:
    author: yaronh
  categories:
  - fileutils
  - retrieve
spec:
  command: ''
  args: []
  image: mlrun/ml-base
  env: []
  default_handler: open_archive
  entry_points:
    open_archive:
      name: open_archive
      doc: 'Open a file/object archive into a target directory


        Currently supports zip and tar.gz'
      parameters:
      - name: context
        type: MLClientCtx
        doc: function execution context
      - name: archive_url
        type: DataItem
        doc: url of archive file
      - name: subdir
        type: str
        default: content
      - name: key
        type: str
        doc: key of archive contents in artifact store
        default: content
      outputs: []
      lineno: 14
  description: Open a file/object archive into a target directory
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlciBvbiAyMDIwLTAzLTMxIDE0OjQwCgppbXBvcnQgb3MKaW1wb3J0IHppcGZpbGUKaW1wb3J0IHVybGxpYi5yZXF1ZXN0CmltcG9ydCB0YXJmaWxlCmltcG9ydCBqc29uCgpmcm9tIG1scnVuLmV4ZWN1dGlvbiBpbXBvcnQgTUxDbGllbnRDdHgKZnJvbSBtbHJ1bi5kYXRhc3RvcmUgaW1wb3J0IERhdGFJdGVtCgpmcm9tIHR5cGluZyBpbXBvcnQgVW5pb24KCmRlZiBvcGVuX2FyY2hpdmUoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwgCiAgICBhcmNoaXZlX3VybDogRGF0YUl0ZW0gPSAiIiwKICAgIHN1YmRpcjogc3RyID0gImNvbnRlbnQiLAogICAga2V5OiBzdHIgPSAiY29udGVudCIKKToKICAgICIiIk9wZW4gYSBmaWxlL29iamVjdCBhcmNoaXZlIGludG8gYSB0YXJnZXQgZGlyZWN0b3J5CiAgICAKICAgIEN1cnJlbnRseSBzdXBwb3J0cyB6aXAgYW5kIHRhci5negogICAgCiAgICA6cGFyYW0gY29udGV4dDogICAgICBmdW5jdGlvbiBleGVjdXRpb24gY29udGV4dAogICAgOnBhcmFtIGFyY2hpdmVfdXJsOiAgdXJsIG9mIGFyY2hpdmUgZmlsZQogICAgOnBhcmFtIGtleTogICAgICAgICAga2V5IG9mIGFyY2hpdmUgY29udGVudHMgaW4gYXJ0aWZhY3Qgc3RvcmUKICAgICIiIgogICAgdGFyZ2V0X2RpciA9IG9zLnBhdGguam9pbihjb250ZXh0LmFydGlmYWN0X3BhdGgsIHN1YmRpcikKICAgIG9zLm1ha2VkaXJzKHRhcmdldF9kaXIsIGV4aXN0X29rPVRydWUpCiAgICAKICAgIGFyY2hpdmVfdXJsID0gc3RyKGFyY2hpdmVfdXJsKQogICAgaWYgYXJjaGl2ZV91cmwuZW5kc3dpdGgoInRhci5neiIpOgogICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIm9wZW5pbmcgdGFyX2d6IikKICAgICAgICBmdHBzdHJlYW0gPSB1cmxsaWIucmVxdWVzdC51cmxvcGVuKGFyY2hpdmVfdXJsKQogICAgICAgIHdpdGggdGFyZmlsZS5vcGVuKGZpbGVvYmo9ZnRwc3RyZWFtLCBtb2RlPSJyfGd6IikgYXMgcmVmOgogICAgICAgICAgICByZWYuZXh0cmFjdGFsbCh0YXJnZXRfZGlyKQogICAgZWxpZiBhcmNoaXZlX3VybC5lbmRzd2l0aCgiLnppcCIpOgogICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIm9wZW5pbmcgemlwIikKICAgICAgICB3aXRoIHppcGZpbGUuWmlwRmlsZShhcmNoaXZlX3VybCwgInIiKSBhcyByZWY6CiAgICAgICAgICAgIHJlZi5leHRyYWN0YWxsKHRhcmdldF9kaXIpCiAgICBlbHNlOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoZid1bnN1cHBvcnRlZCBhcmNoaXZlIHR5cGUgaW4ge2FyY2hpdmVfdXJsfScpCiAgICAKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KGtleSwgbG9jYWxfcGF0aD1zdWJkaXIpCgo=
    commands: []
    code_origin: https://github.com/yjb-ds/functions.git#02cab6b12a879e6477f290e9deaf03b043bd7c16:open_archive.ipynb
