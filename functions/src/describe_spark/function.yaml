spec:
  entry_points:
    describe:
      has_kwargs: true
      parameters:
      - name: df
      - name: bins
      - name: corr_reject
      - name: config
      lineno: 58
      has_varargs: false
      name: describe
      doc: ''
    pretty_name:
      has_kwargs: false
      parameters:
      - name: x
      lineno: 71
      has_varargs: false
      name: pretty_name
      doc: ''
    corr_matrix:
      has_kwargs: false
      parameters:
      - name: df
      - name: columns
        default: null
      lineno: 78
      has_varargs: false
      name: corr_matrix
      doc: ''
    separate:
      has_kwargs: false
      parameters:
      - name: l
      - name: n
      lineno: 83
      has_varargs: false
      name: separate
      doc: ''
    create_hist_data:
      has_kwargs: false
      parameters:
      - name: df
      - name: column
      - name: minim
      - name: maxim
      - name: bins
        default: 10
      lineno: 100
      has_varargs: false
      name: create_hist_data
      doc: ''
    create_all_conditions:
      has_kwargs: false
      parameters:
      - name: current_col
      - name: column
      - name: left_edges
      - name: count
        default: 1
      lineno: 101
      has_varargs: false
      name: create_all_conditions
      doc: 'Recursive function that exploits the

        ability to call the Spark SQL Column method

        .when() in a recursive way.'
    describe_integer_1d:
      has_kwargs: false
      parameters:
      - name: df
      - name: column
      - name: current_result
      - name: nrows
      lineno: 159
      has_varargs: false
      name: describe_integer_1d
      doc: ''
    describe_float_1d:
      has_kwargs: false
      parameters:
      - name: df
      - name: column
      - name: current_result
      - name: nrows
      lineno: 202
      has_varargs: false
      name: describe_float_1d
      doc: ''
    describe_date_1d:
      has_kwargs: false
      parameters:
      - name: df
      - name: column
      lineno: 245
      has_varargs: false
      name: describe_date_1d
      doc: ''
    guess_json_type:
      has_kwargs: false
      parameters:
      - name: string_value
      lineno: 265
      has_varargs: false
      name: guess_json_type
      doc: ''
    describe_categorical_1d:
      has_kwargs: false
      parameters:
      - name: df
      - name: column
      lineno: 273
      has_varargs: false
      name: describe_categorical_1d
      doc: ''
    describe_constant_1d:
      has_kwargs: false
      parameters:
      - name: df
      - name: column
      lineno: 330
      has_varargs: false
      name: describe_constant_1d
      doc: ''
    describe_unique_1d:
      has_kwargs: false
      parameters:
      - name: df
      - name: column
      lineno: 337
      has_varargs: false
      name: describe_unique_1d
      doc: ''
    describe_1d:
      has_kwargs: false
      parameters:
      - name: df
      - name: column
      - name: nrows
      - name: lookup_config
        default: null
      lineno: 344
      has_varargs: false
      name: describe_1d
      doc: ''
    gradient_format:
      has_kwargs: false
      parameters:
      - name: value
      - name: limit1
      - name: limit2
      - name: c1
      - name: c2
      lineno: 487
      has_varargs: false
      name: gradient_format
      doc: ''
    LerpColour:
      has_kwargs: false
      parameters:
      - name: c1
      - name: c2
      - name: t
      lineno: 488
      has_varargs: false
      name: LerpColour
      doc: ''
    fmt_color:
      has_kwargs: false
      parameters:
      - name: text
      - name: color
      lineno: 499
      has_varargs: false
      name: fmt_color
      doc: ''
    fmt_class:
      has_kwargs: false
      parameters:
      - name: text
      - name: cls
      lineno: 503
      has_varargs: false
      name: fmt_class
      doc: ''
    fmt_bytesize:
      has_kwargs: false
      parameters:
      - name: num
      - name: suffix
        default: B
      lineno: 507
      has_varargs: false
      name: fmt_bytesize
      doc: ''
    fmt_percent:
      has_kwargs: false
      parameters:
      - name: v
      lineno: 517
      has_varargs: false
      name: fmt_percent
      doc: ''
    fmt_varname:
      has_kwargs: false
      parameters:
      - name: v
      lineno: 521
      has_varargs: false
      name: fmt_varname
      doc: ''
    fmt_row_severity:
      has_kwargs: false
      parameters:
      - name: v
      lineno: 539
      has_varargs: false
      name: fmt_row_severity
      doc: ''
    fmt_skewness:
      has_kwargs: false
      parameters:
      - name: v
      lineno: 546
      has_varargs: false
      name: fmt_skewness
      doc: ''
    describe_spark:
      has_kwargs: false
      parameters:
      - name: context
        type: MLClientCtx
      - name: dataset
        type: DataItem
      - name: artifact_path
      - name: bins
        type: int
        default: 30
      - name: describe_extended
        type: bool
        default: true
      lineno: 564
      has_varargs: false
      name: describe_spark
      doc: ''
  command: ''
  disable_auto_mount: false
  description: ''
  default_handler: describe_spark
  image: iguazio/shell:3.0_b5565_20201026062233_wsdf
  build:
    origin_filename: ''
    code_origin: ''
    functionSourceCode: IyBDb3B5cmlnaHQgMjAxOSBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiMKIyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiMgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKIyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KIyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiMgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiMKIyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IHdhcm5pbmdzCmZyb20gc3VicHJvY2VzcyBpbXBvcnQgcnVuCgppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IHBhbmRhcyBhcyBwZApmcm9tIG1scnVuLmRhdGFzdG9yZSBpbXBvcnQgRGF0YUl0ZW0KZnJvbSBtbHJ1bi5leGVjdXRpb24gaW1wb3J0IE1MQ2xpZW50Q3R4CmZyb20gcHlzcGFyay5zcWwgaW1wb3J0IFNwYXJrU2Vzc2lvbgoKd2FybmluZ3MuZmlsdGVyd2FybmluZ3MoImlnbm9yZSIpCgppbXBvcnQganNvbgpmcm9tIGl0ZXJ0b29scyBpbXBvcnQgcHJvZHVjdAoKaW1wb3J0IG1hdHBsb3RsaWIKZnJvbSBweXNwYXJrLnNxbCBpbXBvcnQgRGF0YUZyYW1lIGFzIFNwYXJrRGF0YUZyYW1lCmZyb20gcHlzcGFyay5zcWwuZnVuY3Rpb25zIGltcG9ydCAoCiAgICBhYnMgYXMgZGZfYWJzLAopCmZyb20gcHlzcGFyay5zcWwuZnVuY3Rpb25zIGltcG9ydCAoCiAgICBjb2wsCiAgICBjb3VudCwKICAgIGNvdW50RGlzdGluY3QsCiAgICBrdXJ0b3NpcywKICAgIG1lYW4sCiAgICBza2V3bmVzcywKICAgIHN0ZGRldiwKICAgIHZhcmlhbmNlLAogICAgd2hlbiwKKQpmcm9tIHB5c3Bhcmsuc3FsLmZ1bmN0aW9ucyBpbXBvcnQgKAogICAgbWF4IGFzIGRmX21heCwKKQpmcm9tIHB5c3Bhcmsuc3FsLmZ1bmN0aW9ucyBpbXBvcnQgKAogICAgbWluIGFzIGRmX21pbiwKKQpmcm9tIHB5c3Bhcmsuc3FsLmZ1bmN0aW9ucyBpbXBvcnQgKAogICAgc3VtIGFzIGRmX3N1bSwKKQoKCmRlZiBkZXNjcmliZShkZiwgYmlucywgY29ycl9yZWplY3QsIGNvbmZpZywgKiprd2FyZ3MpOgogICAgaWYgbm90IGlzaW5zdGFuY2UoZGYsIFNwYXJrRGF0YUZyYW1lKToKICAgICAgICByYWlzZSBUeXBlRXJyb3IoImRmIG11c3QgYmUgb2YgdHlwZSBweXNwYXJrLnNxbC5EYXRhRnJhbWUiKQoKICAgIHRhYmxlX3N0YXRzID0geyJuIjogZGYuY291bnQoKX0KICAgIGlmIHRhYmxlX3N0YXRzWyJuIl0gPT0gMDoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJkZiBjYW5ub3QgYmUgZW1wdHkiKQoKICAgIHRyeToKICAgICAgICBtYXRwbG90bGliLnN0eWxlLnVzZSgiZGVmYXVsdCIpCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcwoKICAgIGRlZiBwcmV0dHlfbmFtZSh4KToKICAgICAgICB4ICo9IDEwMAogICAgICAgIGlmIHggPT0gaW50KHgpOgogICAgICAgICAgICByZXR1cm4gIiUuMGYlJSIgJSB4CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuICIlLjFmJSUiICUgeAoKICAgIGRlZiBjb3JyX21hdHJpeChkZiwgY29sdW1ucz1Ob25lKToKICAgICAgICBpZiBjb2x1bW5zIGlzIE5vbmU6CiAgICAgICAgICAgIGNvbHVtbnMgPSBkZi5jb2x1bW5zCiAgICAgICAgY29tYmluYXRpb25zID0gbGlzdChwcm9kdWN0KGNvbHVtbnMsIGNvbHVtbnMpKQoKICAgICAgICBkZWYgc2VwYXJhdGUobCwgbik6CiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDAsIGxlbihsKSwgbik6CiAgICAgICAgICAgICAgICB5aWVsZCBsW2kgOiBpICsgbl0KCiAgICAgICAgZ3JvdXBlZCA9IGxpc3Qoc2VwYXJhdGUoY29tYmluYXRpb25zLCBsZW4oY29sdW1ucykpKQogICAgICAgIGRmX2NsZWFuZWQgPSBkZi5zZWxlY3QoKmNvbHVtbnMpLm5hLmRyb3AoaG93PSJhbnkiKQoKICAgICAgICBmb3IgaSBpbiBncm91cGVkOgogICAgICAgICAgICBmb3IgaiBpbiBlbnVtZXJhdGUoaSk6CiAgICAgICAgICAgICAgICBpW2pbMF1dID0gaVtqWzBdXSArIChkZl9jbGVhbmVkLmNvcnIoc3RyKGpbMV1bMF0pLCBzdHIoalsxXVsxXSkpLCkKCiAgICAgICAgZGZfcGFuZGFzID0gcGQuRGF0YUZyYW1lKGdyb3VwZWQpLmFwcGx5bWFwKGxhbWJkYSB4OiB4WzJdKQogICAgICAgIGRmX3BhbmRhcy5jb2x1bW5zID0gY29sdW1ucwogICAgICAgIGRmX3BhbmRhcy5pbmRleCA9IGNvbHVtbnMKCiAgICAgICAgcmV0dXJuIGRmX3BhbmRhcwoKICAgIGRlZiBjcmVhdGVfaGlzdF9kYXRhKGRmLCBjb2x1bW4sIG1pbmltLCBtYXhpbSwgYmlucz0xMCk6CiAgICAgICAgZGVmIGNyZWF0ZV9hbGxfY29uZGl0aW9ucyhjdXJyZW50X2NvbCwgY29sdW1uLCBsZWZ0X2VkZ2VzLCBjb3VudD0xKToKICAgICAgICAgICAgIiIiCiAgICAgICAgICAgIFJlY3Vyc2l2ZSBmdW5jdGlvbiB0aGF0IGV4cGxvaXRzIHRoZQogICAgICAgICAgICBhYmlsaXR5IHRvIGNhbGwgdGhlIFNwYXJrIFNRTCBDb2x1bW4gbWV0aG9kCiAgICAgICAgICAgIC53aGVuKCkgaW4gYSByZWN1cnNpdmUgd2F5LgogICAgICAgICAgICAiIiIKICAgICAgICAgICAgbGVmdF9lZGdlcyA9IGxlZnRfZWRnZXNbOl0KICAgICAgICAgICAgaWYgbGVuKGxlZnRfZWRnZXMpID09IDA6CiAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudF9jb2wKICAgICAgICAgICAgaWYgbGVuKGxlZnRfZWRnZXMpID09IDE6CiAgICAgICAgICAgICAgICBuZXh0X2NvbCA9IGN1cnJlbnRfY29sLndoZW4oY29sKGNvbHVtbikgPj0gZmxvYXQobGVmdF9lZGdlc1swXSksIGNvdW50KQogICAgICAgICAgICAgICAgbGVmdF9lZGdlcy5wb3AoMCkKICAgICAgICAgICAgICAgIHJldHVybiBjcmVhdGVfYWxsX2NvbmRpdGlvbnMobmV4dF9jb2wsIGNvbHVtbiwgbGVmdF9lZGdlc1s6XSwgY291bnQgKyAxKQogICAgICAgICAgICBuZXh0X2NvbCA9IGN1cnJlbnRfY29sLndoZW4oCiAgICAgICAgICAgICAgICAoZmxvYXQobGVmdF9lZGdlc1swXSkgPD0gY29sKGNvbHVtbikpCiAgICAgICAgICAgICAgICAmIChjb2woY29sdW1uKSA8IGZsb2F0KGxlZnRfZWRnZXNbMV0pKSwKICAgICAgICAgICAgICAgIGNvdW50LAogICAgICAgICAgICApCiAgICAgICAgICAgIGxlZnRfZWRnZXMucG9wKDApCiAgICAgICAgICAgIHJldHVybiBjcmVhdGVfYWxsX2NvbmRpdGlvbnMobmV4dF9jb2wsIGNvbHVtbiwgbGVmdF9lZGdlc1s6XSwgY291bnQgKyAxKQoKICAgICAgICBudW1fcmFuZ2UgPSBtYXhpbSAtIG1pbmltCiAgICAgICAgYmluX3dpZHRoID0gbnVtX3JhbmdlIC8gZmxvYXQoYmlucykKICAgICAgICBsZWZ0X2VkZ2VzID0gW21pbmltXQogICAgICAgIGZvciBfYmluIGluIHJhbmdlKGJpbnMpOgogICAgICAgICAgICBsZWZ0X2VkZ2VzID0gbGVmdF9lZGdlcyArIFtsZWZ0X2VkZ2VzWy0xXSArIGJpbl93aWR0aF0KICAgICAgICBsZWZ0X2VkZ2VzLnBvcCgpCiAgICAgICAgZXhwcmVzc2lvbl9jb2wgPSB3aGVuKAogICAgICAgICAgICAoZmxvYXQobGVmdF9lZGdlc1swXSkgPD0gY29sKGNvbHVtbikpCiAgICAgICAgICAgICYgKGNvbChjb2x1bW4pIDwgZmxvYXQobGVmdF9lZGdlc1sxXSkpLAogICAgICAgICAgICAwLAogICAgICAgICkKICAgICAgICBsZWZ0X2VkZ2VzX2NvcHkgPSBsZWZ0X2VkZ2VzWzpdCiAgICAgICAgbGVmdF9lZGdlc19jb3B5LnBvcCgwKQogICAgICAgIGJpbl9kYXRhID0gKAogICAgICAgICAgICBkZi5zZWxlY3QoY29sKGNvbHVtbikpCiAgICAgICAgICAgIC5uYS5kcm9wKCkKICAgICAgICAgICAgLnNlbGVjdCgKICAgICAgICAgICAgICAgIGNvbChjb2x1bW4pLAogICAgICAgICAgICAgICAgY3JlYXRlX2FsbF9jb25kaXRpb25zKGV4cHJlc3Npb25fY29sLCBjb2x1bW4sIGxlZnRfZWRnZXNfY29weSkuYWxpYXMoCiAgICAgICAgICAgICAgICAgICAgImJpbl9pZCIKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICkKICAgICAgICAgICAgLmdyb3VwQnkoImJpbl9pZCIpCiAgICAgICAgICAgIC5jb3VudCgpCiAgICAgICAgKS50b1BhbmRhcygpCgogICAgICAgIGJpbl9kYXRhLmluZGV4ID0gYmluX2RhdGFbImJpbl9pZCJdCiAgICAgICAgbmV3X2luZGV4ID0gbGlzdChyYW5nZShiaW5zKSkKICAgICAgICBiaW5fZGF0YSA9IGJpbl9kYXRhLnJlaW5kZXgobmV3X2luZGV4KQogICAgICAgIGJpbl9kYXRhWyJiaW5faWQiXSA9IGJpbl9kYXRhLmluZGV4CiAgICAgICAgYmluX2RhdGEgPSBiaW5fZGF0YS5maWxsbmEoMCkKCiAgICAgICAgYmluX2RhdGFbImxlZnRfZWRnZSJdID0gbGVmdF9lZGdlcwogICAgICAgIGJpbl9kYXRhWyJ3aWR0aCJdID0gYmluX3dpZHRoCgogICAgICAgIHJldHVybiBiaW5fZGF0YQoKICAgIGRlZiBkZXNjcmliZV9pbnRlZ2VyXzFkKGRmLCBjb2x1bW4sIGN1cnJlbnRfcmVzdWx0LCBucm93cyk6CiAgICAgICAgc3RhdHNfZGYgPSAoCiAgICAgICAgICAgIGRmLnNlbGVjdChjb2x1bW4pCiAgICAgICAgICAgIC5uYS5kcm9wKCkKICAgICAgICAgICAgLmFnZygKICAgICAgICAgICAgICAgIG1lYW4oY29sKGNvbHVtbikpLmFsaWFzKCJtZWFuIiksCiAgICAgICAgICAgICAgICBkZl9taW4oY29sKGNvbHVtbikpLmFsaWFzKCJtaW4iKSwKICAgICAgICAgICAgICAgIGRmX21heChjb2woY29sdW1uKSkuYWxpYXMoIm1heCIpLAogICAgICAgICAgICAgICAgdmFyaWFuY2UoY29sKGNvbHVtbikpLmFsaWFzKCJ2YXJpYW5jZSIpLAogICAgICAgICAgICAgICAga3VydG9zaXMoY29sKGNvbHVtbikpLmFsaWFzKCJrdXJ0b3NpcyIpLAogICAgICAgICAgICAgICAgc3RkZGV2KGNvbChjb2x1bW4pKS5hbGlhcygic3RkIiksCiAgICAgICAgICAgICAgICBza2V3bmVzcyhjb2woY29sdW1uKSkuYWxpYXMoInNrZXduZXNzIiksCiAgICAgICAgICAgICAgICBkZl9zdW0oY29sKGNvbHVtbikpLmFsaWFzKCJzdW0iKSwKICAgICAgICAgICAgKQogICAgICAgICAgICAudG9QYW5kYXMoKQogICAgICAgICkKCiAgICAgICAgZm9yIHggaW4gbnAuYXJyYXkoWzAuMDUsIDAuMjUsIDAuNSwgMC43NSwgMC45NV0pOgogICAgICAgICAgICBzdGF0c19kZltwcmV0dHlfbmFtZSh4KV0gPSAoCiAgICAgICAgICAgICAgICBkZi5zZWxlY3QoY29sdW1uKQogICAgICAgICAgICAgICAgLm5hLmRyb3AoKQogICAgICAgICAgICAgICAgLnNlbGVjdEV4cHIoZiJwZXJjZW50aWxlKGB7Y29sdW1ufWAsQ0FTVCh7eH0gQVMgRE9VQkxFKSkiKQogICAgICAgICAgICAgICAgLnRvUGFuZGFzKCkKICAgICAgICAgICAgICAgIC5pbG9jWzosIDBdCiAgICAgICAgICAgICkKICAgICAgICBzdGF0cyA9IHN0YXRzX2RmLmlsb2NbMF0uY29weSgpCiAgICAgICAgc3RhdHMubmFtZSA9IGNvbHVtbgogICAgICAgIHN0YXRzWyJyYW5nZSJdID0gc3RhdHNbIm1heCJdIC0gc3RhdHNbIm1pbiJdCiAgICAgICAgc3RhdHNbImlxciJdID0gc3RhdHNbcHJldHR5X25hbWUoMC43NSldIC0gc3RhdHNbcHJldHR5X25hbWUoMC4yNSldCiAgICAgICAgc3RhdHNbImN2Il0gPSBzdGF0c1sic3RkIl0gLyBmbG9hdChzdGF0c1sibWVhbiJdKQogICAgICAgIHN0YXRzWyJtYWQiXSA9IGRmLnNlbGVjdChjb2x1bW4pLm5hLmRyb3AoKS5zZWxlY3QoCiAgICAgICAgICAgIGRmX2Ficyhjb2woY29sdW1uKSAtIHN0YXRzWyJtZWFuIl0pLmFsaWFzKCJkZWx0YSIpCiAgICAgICAgKS5hZ2coZGZfc3VtKGNvbCgiZGVsdGEiKSkpLnRvUGFuZGFzKCkuaWxvY1swLCAwXSAvIGZsb2F0KAogICAgICAgICAgICBjdXJyZW50X3Jlc3VsdFsiY291bnQiXQogICAgICAgICkKICAgICAgICBzdGF0c1sidHlwZSJdID0gIk5VTSIKICAgICAgICBzdGF0c1sibl96ZXJvcyJdID0gZGYuc2VsZWN0KGNvbHVtbikud2hlcmUoY29sKGNvbHVtbikgPT0gMC4wKS5jb3VudCgpCiAgICAgICAgc3RhdHNbInBfemVyb3MiXSA9IHN0YXRzWyJuX3plcm9zIl0gLyBmbG9hdChucm93cykKCiAgICAgICAgaGlzdF9kYXRhID0gY3JlYXRlX2hpc3RfZGF0YShkZiwgY29sdW1uLCBzdGF0c1sibWluIl0sIHN0YXRzWyJtYXgiXSwgYmlucykKCiAgICAgICAgcmV0dXJuIHN0YXRzCgogICAgZGVmIGRlc2NyaWJlX2Zsb2F0XzFkKGRmLCBjb2x1bW4sIGN1cnJlbnRfcmVzdWx0LCBucm93cyk6CiAgICAgICAgc3RhdHNfZGYgPSAoCiAgICAgICAgICAgIGRmLnNlbGVjdChjb2x1bW4pCiAgICAgICAgICAgIC5uYS5kcm9wKCkKICAgICAgICAgICAgLmFnZygKICAgICAgICAgICAgICAgIG1lYW4oY29sKGNvbHVtbikpLmFsaWFzKCJtZWFuIiksCiAgICAgICAgICAgICAgICBkZl9taW4oY29sKGNvbHVtbikpLmFsaWFzKCJtaW4iKSwKICAgICAgICAgICAgICAgIGRmX21heChjb2woY29sdW1uKSkuYWxpYXMoIm1heCIpLAogICAgICAgICAgICAgICAgdmFyaWFuY2UoY29sKGNvbHVtbikpLmFsaWFzKCJ2YXJpYW5jZSIpLAogICAgICAgICAgICAgICAga3VydG9zaXMoY29sKGNvbHVtbikpLmFsaWFzKCJrdXJ0b3NpcyIpLAogICAgICAgICAgICAgICAgc3RkZGV2KGNvbChjb2x1bW4pKS5hbGlhcygic3RkIiksCiAgICAgICAgICAgICAgICBza2V3bmVzcyhjb2woY29sdW1uKSkuYWxpYXMoInNrZXduZXNzIiksCiAgICAgICAgICAgICAgICBkZl9zdW0oY29sKGNvbHVtbikpLmFsaWFzKCJzdW0iKSwKICAgICAgICAgICAgKQogICAgICAgICAgICAudG9QYW5kYXMoKQogICAgICAgICkKCiAgICAgICAgZm9yIHggaW4gbnAuYXJyYXkoWzAuMDUsIDAuMjUsIDAuNSwgMC43NSwgMC45NV0pOgogICAgICAgICAgICBzdGF0c19kZltwcmV0dHlfbmFtZSh4KV0gPSAoCiAgICAgICAgICAgICAgICBkZi5zZWxlY3QoY29sdW1uKQogICAgICAgICAgICAgICAgLm5hLmRyb3AoKQogICAgICAgICAgICAgICAgLnNlbGVjdEV4cHIoZiJwZXJjZW50aWxlX2FwcHJveChge2NvbHVtbn1gLENBU1Qoe3h9IEFTIERPVUJMRSkpIikKICAgICAgICAgICAgICAgIC50b1BhbmRhcygpCiAgICAgICAgICAgICAgICAuaWxvY1s6LCAwXQogICAgICAgICAgICApCiAgICAgICAgc3RhdHMgPSBzdGF0c19kZi5pbG9jWzBdLmNvcHkoKQogICAgICAgIHN0YXRzLm5hbWUgPSBjb2x1bW4KICAgICAgICBzdGF0c1sicmFuZ2UiXSA9IHN0YXRzWyJtYXgiXSAtIHN0YXRzWyJtaW4iXQogICAgICAgIHN0YXRzWyJpcXIiXSA9IHN0YXRzW3ByZXR0eV9uYW1lKDAuNzUpXSAtIHN0YXRzW3ByZXR0eV9uYW1lKDAuMjUpXQogICAgICAgIHN0YXRzWyJjdiJdID0gc3RhdHNbInN0ZCJdIC8gZmxvYXQoc3RhdHNbIm1lYW4iXSkKICAgICAgICBzdGF0c1sibWFkIl0gPSBkZi5zZWxlY3QoY29sdW1uKS5uYS5kcm9wKCkuc2VsZWN0KAogICAgICAgICAgICBkZl9hYnMoY29sKGNvbHVtbikgLSBzdGF0c1sibWVhbiJdKS5hbGlhcygiZGVsdGEiKQogICAgICAgICkuYWdnKGRmX3N1bShjb2woImRlbHRhIikpKS50b1BhbmRhcygpLmlsb2NbMCwgMF0gLyBmbG9hdCgKICAgICAgICAgICAgY3VycmVudF9yZXN1bHRbImNvdW50Il0KICAgICAgICApCiAgICAgICAgc3RhdHNbInR5cGUiXSA9ICJOVU0iCiAgICAgICAgc3RhdHNbIm5femVyb3MiXSA9IGRmLnNlbGVjdChjb2x1bW4pLndoZXJlKGNvbChjb2x1bW4pID09IDAuMCkuY291bnQoKQogICAgICAgIHN0YXRzWyJwX3plcm9zIl0gPSBzdGF0c1sibl96ZXJvcyJdIC8gZmxvYXQobnJvd3MpCgogICAgICAgIGhpc3RfZGF0YSA9IGNyZWF0ZV9oaXN0X2RhdGEoZGYsIGNvbHVtbiwgc3RhdHNbIm1pbiJdLCBzdGF0c1sibWF4Il0sIGJpbnMpCgogICAgICAgIHJldHVybiBzdGF0cwoKICAgIGRlZiBkZXNjcmliZV9kYXRlXzFkKGRmLCBjb2x1bW4pOgogICAgICAgIHN0YXRzX2RmID0gKAogICAgICAgICAgICBkZi5zZWxlY3QoY29sdW1uKQogICAgICAgICAgICAubmEuZHJvcCgpCiAgICAgICAgICAgIC5hZ2coZGZfbWluKGNvbChjb2x1bW4pKS5hbGlhcygibWluIiksIGRmX21heChjb2woY29sdW1uKSkuYWxpYXMoIm1heCIpKQogICAgICAgICAgICAudG9QYW5kYXMoKQogICAgICAgICkKICAgICAgICBzdGF0cyA9IHN0YXRzX2RmLmlsb2NbMF0uY29weSgpCiAgICAgICAgc3RhdHMubmFtZSA9IGNvbHVtbgoKICAgICAgICBpZiBpc2luc3RhbmNlKHN0YXRzWyJtYXgiXSwgcGQuVGltZXN0YW1wKToKICAgICAgICAgICAgc3RhdHMgPSBzdGF0cy5hc3R5cGUob2JqZWN0KQogICAgICAgICAgICBzdGF0c1sibWF4Il0gPSBzdHIoc3RhdHNbIm1heCJdLnRvX3B5ZGF0ZXRpbWUoKSkKICAgICAgICAgICAgc3RhdHNbIm1pbiJdID0gc3RyKHN0YXRzWyJtaW4iXS50b19weWRhdGV0aW1lKCkpCgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHN0YXRzWyJyYW5nZSJdID0gc3RhdHNbIm1heCJdIC0gc3RhdHNbIm1pbiJdCiAgICAgICAgc3RhdHNbInR5cGUiXSA9ICJEQVRFIgogICAgICAgIHJldHVybiBzdGF0cwoKICAgIGRlZiBndWVzc19qc29uX3R5cGUoc3RyaW5nX3ZhbHVlKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMoc3RyaW5nX3ZhbHVlKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgcmV0dXJuIHR5cGUob2JqKQoKICAgIGRlZiBkZXNjcmliZV9jYXRlZ29yaWNhbF8xZChkZiwgY29sdW1uKToKICAgICAgICB2YWx1ZV9jb3VudHMgPSAoCiAgICAgICAgICAgIGRmLnNlbGVjdChjb2x1bW4pCiAgICAgICAgICAgIC5uYS5kcm9wKCkKICAgICAgICAgICAgLmdyb3VwQnkoY29sdW1uKQogICAgICAgICAgICAuYWdnKGNvdW50KGNvbChjb2x1bW4pKSkKICAgICAgICAgICAgLm9yZGVyQnkoZiJjb3VudCh7Y29sdW1ufSkiLCBhc2NlbmRpbmc9RmFsc2UpCiAgICAgICAgKS5jYWNoZSgpCgogICAgICAgIHN0YXRzID0gKAogICAgICAgICAgICAoCiAgICAgICAgICAgICAgICB2YWx1ZV9jb3VudHMubGltaXQoMSkKICAgICAgICAgICAgICAgIC53aXRoQ29sdW1uUmVuYW1lZChjb2x1bW4sICJ0b3AiKQogICAgICAgICAgICAgICAgLndpdGhDb2x1bW5SZW5hbWVkKGYiY291bnQoe2NvbHVtbn0pIiwgImZyZXEiKQogICAgICAgICAgICApCiAgICAgICAgICAgIC50b1BhbmRhcygpCiAgICAgICAgICAgIC5pbG9jWzBdCiAgICAgICAgKQoKICAgICAgICB0b3BfNTAgPSAoCiAgICAgICAgICAgIHZhbHVlX2NvdW50cy5saW1pdCg1MCkKICAgICAgICAgICAgLnRvUGFuZGFzKCkKICAgICAgICAgICAgLnNvcnRfdmFsdWVzKGYiY291bnQoe2NvbHVtbn0pIiwgYXNjZW5kaW5nPUZhbHNlKQogICAgICAgICkKICAgICAgICB0b3BfNTBfY2F0ZWdvcmllcyA9IHRvcF81MFtjb2x1bW5dLnZhbHVlcy50b2xpc3QoKQoKICAgICAgICBvdGhlcnNfY291bnQgPSBwZC5TZXJpZXMoCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIGRmLnNlbGVjdChjb2x1bW4pCiAgICAgICAgICAgICAgICAubmEuZHJvcCgpCiAgICAgICAgICAgICAgICAud2hlcmUofihjb2woY29sdW1uKS5pc2luKCp0b3BfNTBfY2F0ZWdvcmllcykpKQogICAgICAgICAgICAgICAgLmNvdW50KCkKICAgICAgICAgICAgXSwKICAgICAgICAgICAgaW5kZXg9WyIqKipPdGhlciBWYWx1ZXMqKioiXSwKICAgICAgICApCiAgICAgICAgb3RoZXJzX2Rpc3RpbmN0X2NvdW50ID0gcGQuU2VyaWVzKAogICAgICAgICAgICBbdmFsdWVfY291bnRzLndoZXJlKH4oY29sKGNvbHVtbikuaXNpbigqdG9wXzUwX2NhdGVnb3JpZXMpKSkuY291bnQoKV0sCiAgICAgICAgICAgIGluZGV4PVsiKioqT3RoZXIgVmFsdWVzIERpc3RpbmN0IENvdW50KioqIl0sCiAgICAgICAgKQoKICAgICAgICB0b3AgPSB0b3BfNTAuc2V0X2luZGV4KGNvbHVtbilbZiJjb3VudCh7Y29sdW1ufSkiXQogICAgICAgIHRvcCA9IHRvcC5hcHBlbmQob3RoZXJzX2NvdW50KQogICAgICAgIHRvcCA9IHRvcC5hcHBlbmQob3RoZXJzX2Rpc3RpbmN0X2NvdW50KQogICAgICAgIHN0YXRzWyJ2YWx1ZV9jb3VudHMiXSA9IHRvcAogICAgICAgIHN0YXRzWyJ0eXBlIl0gPSAiQ0FUIgogICAgICAgIHZhbHVlX2NvdW50cy51bnBlcnNpc3QoKQogICAgICAgIHVucGFyc2VkX3ZhbGlkX2pzb25zID0gKAogICAgICAgICAgICBkZi5zZWxlY3QoY29sdW1uKQogICAgICAgICAgICAubmEuZHJvcCgpCiAgICAgICAgICAgIC5yZGQubWFwKGxhbWJkYSB4OiBndWVzc19qc29uX3R5cGUoeFtjb2x1bW5dKSkKICAgICAgICAgICAgLmZpbHRlcihsYW1iZGEgeDogeCkKICAgICAgICAgICAgLmRpc3RpbmN0KCkKICAgICAgICAgICAgLmNvbGxlY3QoKQogICAgICAgICkKICAgICAgICBzdGF0c1sidW5wYXJzZWRfanNvbl90eXBlcyJdID0gdW5wYXJzZWRfdmFsaWRfanNvbnMKICAgICAgICByZXR1cm4gc3RhdHMKCiAgICBkZWYgZGVzY3JpYmVfY29uc3RhbnRfMWQoZGYsIGNvbHVtbik6CiAgICAgICAgc3RhdHMgPSBwZC5TZXJpZXMoWyJDT05TVCJdLCBpbmRleD1bInR5cGUiXSwgbmFtZT1jb2x1bW4pCiAgICAgICAgc3RhdHNbInZhbHVlX2NvdW50cyJdID0gKAogICAgICAgICAgICAoZGYuc2VsZWN0KGNvbHVtbikubmEuZHJvcCgpLmxpbWl0KDEpKS50b1BhbmRhcygpLmlsb2NbOiwgMF0udmFsdWVfY291bnRzKCkKICAgICAgICApCiAgICAgICAgcmV0dXJuIHN0YXRzCgogICAgZGVmIGRlc2NyaWJlX3VuaXF1ZV8xZChkZiwgY29sdW1uKToKICAgICAgICBzdGF0cyA9IHBkLlNlcmllcyhbIlVOSVFVRSJdLCBpbmRleD1bInR5cGUiXSwgbmFtZT1jb2x1bW4pCiAgICAgICAgc3RhdHNbInZhbHVlX2NvdW50cyJdID0gKAogICAgICAgICAgICAoZGYuc2VsZWN0KGNvbHVtbikubmEuZHJvcCgpLmxpbWl0KDUwKSkudG9QYW5kYXMoKS5pbG9jWzosIDBdLnZhbHVlX2NvdW50cygpCiAgICAgICAgKQogICAgICAgIHJldHVybiBzdGF0cwoKICAgIGRlZiBkZXNjcmliZV8xZChkZiwgY29sdW1uLCBucm93cywgbG9va3VwX2NvbmZpZz1Ob25lKToKICAgICAgICBjb2x1bW5fdHlwZSA9IGRmLnNlbGVjdChjb2x1bW4pLmR0eXBlc1swXVsxXQogICAgICAgIGlmICgKICAgICAgICAgICAgKCJhcnJheSIgaW4gY29sdW1uX3R5cGUpCiAgICAgICAgICAgIG9yICgic3R1Y3QiIGluIGNvbHVtbl90eXBlKQogICAgICAgICAgICBvciAoIm1hcCIgaW4gY29sdW1uX3R5cGUpCiAgICAgICAgKToKICAgICAgICAgICAgcmFpc2UgTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgICAgIGYiQ29sdW1uIHtjb2x1bW59IGlzIG9mIHR5cGUge2NvbHVtbl90eXBlfSBhbmQgY2Fubm90IGJlIGFuYWx5emVkIgogICAgICAgICAgICApCgogICAgICAgIGRpc3RpbmN0X2NvdW50ID0gKAogICAgICAgICAgICBkZi5zZWxlY3QoY29sdW1uKQogICAgICAgICAgICAuYWdnKGNvdW50RGlzdGluY3QoY29sKGNvbHVtbikpLmFsaWFzKCJkaXN0aW5jdF9jb3VudCIpKQogICAgICAgICAgICAudG9QYW5kYXMoKQogICAgICAgICkKICAgICAgICBub25fbmFuX2NvdW50ID0gKAogICAgICAgICAgICBkZi5zZWxlY3QoY29sdW1uKQogICAgICAgICAgICAubmEuZHJvcCgpCiAgICAgICAgICAgIC5zZWxlY3QoY291bnQoY29sKGNvbHVtbikpLmFsaWFzKCJjb3VudCIpKQogICAgICAgICAgICAudG9QYW5kYXMoKQogICAgICAgICkKICAgICAgICByZXN1bHRzX2RhdGEgPSBwZC5jb25jYXQoW2Rpc3RpbmN0X2NvdW50LCBub25fbmFuX2NvdW50XSwgYXhpcz0xKQogICAgICAgIHJlc3VsdHNfZGF0YVsicF91bmlxdWUiXSA9IHJlc3VsdHNfZGF0YVsiZGlzdGluY3RfY291bnQiXSAvIGZsb2F0KAogICAgICAgICAgICByZXN1bHRzX2RhdGFbImNvdW50Il0KICAgICAgICApCiAgICAgICAgcmVzdWx0c19kYXRhWyJpc191bmlxdWUiXSA9IHJlc3VsdHNfZGF0YVsiZGlzdGluY3RfY291bnQiXSA9PSBucm93cwogICAgICAgIHJlc3VsdHNfZGF0YVsibl9taXNzaW5nIl0gPSBucm93cyAtIHJlc3VsdHNfZGF0YVsiY291bnQiXQogICAgICAgIHJlc3VsdHNfZGF0YVsicF9taXNzaW5nIl0gPSByZXN1bHRzX2RhdGFbIm5fbWlzc2luZyJdIC8gZmxvYXQobnJvd3MpCiAgICAgICAgcmVzdWx0c19kYXRhWyJwX2luZmluaXRlIl0gPSAwCiAgICAgICAgcmVzdWx0c19kYXRhWyJuX2luZmluaXRlIl0gPSAwCiAgICAgICAgcmVzdWx0ID0gcmVzdWx0c19kYXRhLmlsb2NbMF0uY29weSgpCiAgICAgICAgcmVzdWx0WyJtZW1vcnlzaXplIl0gPSAwCiAgICAgICAgcmVzdWx0Lm5hbWUgPSBjb2x1bW4KCiAgICAgICAgaWYgcmVzdWx0WyJkaXN0aW5jdF9jb3VudCJdIDw9IDE6CiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5hcHBlbmQoZGVzY3JpYmVfY29uc3RhbnRfMWQoZGYsIGNvbHVtbikpCiAgICAgICAgZWxpZiBjb2x1bW5fdHlwZSBpbiB7InRpbnlpbnQiLCAic21hbGxpbnQiLCAiaW50IiwgImJpZ2ludCJ9OgogICAgICAgICAgICByZXN1bHQgPSByZXN1bHQuYXBwZW5kKGRlc2NyaWJlX2ludGVnZXJfMWQoZGYsIGNvbHVtbiwgcmVzdWx0LCBucm93cykpCiAgICAgICAgZWxpZiBjb2x1bW5fdHlwZSBpbiB7ImZsb2F0IiwgImRvdWJsZSIsICJkZWNpbWFsIn06CiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5hcHBlbmQoZGVzY3JpYmVfZmxvYXRfMWQoZGYsIGNvbHVtbiwgcmVzdWx0LCBucm93cykpCiAgICAgICAgZWxpZiBjb2x1bW5fdHlwZSBpbiB7ImRhdGUiLCAidGltZXN0YW1wIn06CiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5hcHBlbmQoZGVzY3JpYmVfZGF0ZV8xZChkZiwgY29sdW1uKSkKICAgICAgICBlbGlmIHJlc3VsdFsiaXNfdW5pcXVlIl0gPT0gVHJ1ZToKICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmFwcGVuZChkZXNjcmliZV91bmlxdWVfMWQoZGYsIGNvbHVtbikpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmFwcGVuZChkZXNjcmliZV9jYXRlZ29yaWNhbF8xZChkZiwgY29sdW1uKSkKICAgICAgICAgICAgaWYgcmVzdWx0WyJuX21pc3NpbmciXSA+IDA6CiAgICAgICAgICAgICAgICByZXN1bHRbImRpc3RpbmN0X2NvdW50Il0gPSByZXN1bHRbImRpc3RpbmN0X2NvdW50Il0gKyAxCgogICAgICAgIGlmIHJlc3VsdFsiY291bnQiXSA+IHJlc3VsdFsiZGlzdGluY3RfY291bnQiXSA+IDE6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJlc3VsdFsibW9kZSJdID0gcmVzdWx0WyJ0b3AiXQogICAgICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgICAgICByZXN1bHRbIm1vZGUiXSA9IDAKICAgICAgICBlbHNlOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXN1bHRbIm1vZGUiXSA9IHJlc3VsdFsidmFsdWVfY291bnRzIl0uaW5kZXhbMF0KICAgICAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICAgICAgcmVzdWx0WyJtb2RlIl0gPSAwCiAgICAgICAgICAgIGV4Y2VwdCBJbmRleEVycm9yOgogICAgICAgICAgICAgICAgcmVzdWx0WyJtb2RlIl0gPSAiTUlTU0lORyIKCiAgICAgICAgaWYgbG9va3VwX2NvbmZpZzoKICAgICAgICAgICAgbG9va3VwX29iamVjdCA9IGxvb2t1cF9jb25maWdbIm9iamVjdCJdCiAgICAgICAgICAgIGNvbF9uYW1lX2luX2RiID0gKAogICAgICAgICAgICAgICAgbG9va3VwX2NvbmZpZ1siY29sX25hbWVfaW5fZGIiXQogICAgICAgICAgICAgICAgaWYgImNvbF9uYW1lX2luX2RiIiBpbiBsb29rdXBfY29uZmlnCiAgICAgICAgICAgICAgICBlbHNlIE5vbmUKICAgICAgICAgICAgKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBtYXRjaGVkLCB1bm1hdGNoZWQgPSBsb29rdXBfb2JqZWN0Lmxvb2t1cCgKICAgICAgICAgICAgICAgICAgICBkZi5zZWxlY3QoY29sdW1uKSwgY29sX25hbWVfaW5fZGIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHJlc3VsdFsibG9va2VkdXBfdmFsdWVzIl0gPSAoCiAgICAgICAgICAgICAgICAgICAgc3RyKG1hdGNoZWQuY291bnQoKSkgKyAiLyIgKyBzdHIoZGYuc2VsZWN0KGNvbHVtbikuY291bnQoKSkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcmVzdWx0WyJsb29rZWR1cF92YWx1ZXMiXSA9ICJGQUlMRUQiCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmVzdWx0WyJsb29rZWR1cF92YWx1ZXMiXSA9ICIiCgogICAgICAgIHJldHVybiByZXN1bHQKCiAgICBsZGVzYyA9IHt9CiAgICBmb3IgY29sdW0gaW4gZGYuY29sdW1uczoKICAgICAgICBpZiBjb2x1bSBpbiBjb25maWc6CiAgICAgICAgICAgIGlmICJsb29rdXAiIGluIGNvbmZpZ1tjb2x1bV06CiAgICAgICAgICAgICAgICBsb29rdXBfY29uZmlnID0gY29uZmlnW2NvbHVtXVsibG9va3VwIl0KICAgICAgICAgICAgICAgIGRlc2MgPSBkZXNjcmliZV8xZCgKICAgICAgICAgICAgICAgICAgICBkZiwgY29sdW0sIHRhYmxlX3N0YXRzWyJuIl0sIGxvb2t1cF9jb25maWc9bG9va3VwX2NvbmZpZwogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZGVzYyA9IGRlc2NyaWJlXzFkKGRmLCBjb2x1bSwgdGFibGVfc3RhdHNbIm4iXSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBkZXNjID0gZGVzY3JpYmVfMWQoZGYsIGNvbHVtLCB0YWJsZV9zdGF0c1sibiJdKQogICAgICAgIGxkZXNjLnVwZGF0ZSh7Y29sdW06IGRlc2N9KQoKICAgIGlmIGNvcnJfcmVqZWN0IGlzIG5vdCBOb25lOgogICAgICAgIGNvbXB1dGFibGVfY29ycnMgPSBbY29sdW0gZm9yIGNvbHVtIGluIGxkZXNjIGlmIGxkZXNjW2NvbHVtXVsidHlwZSJdIGluIHsiTlVNIn1dCgogICAgICAgIGlmIGxlbihjb21wdXRhYmxlX2NvcnJzKSA+IDA6CiAgICAgICAgICAgIGNvcnIgPSBjb3JyX21hdHJpeChkZiwgY29sdW1ucz1jb21wdXRhYmxlX2NvcnJzKQogICAgICAgICAgICBmb3IgeCwgY29ycl94IGluIGNvcnIuaXRlcnJvd3MoKToKICAgICAgICAgICAgICAgIGZvciB5LCBjb3JyIGluIGNvcnJfeC5pdGVyaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICBpZiB4ID09IHk6CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgdmFyaWFibGVfc3RhdHMgPSBwZC5EYXRhRnJhbWUobGRlc2MpCgogICAgdGFibGVfc3RhdHNbIm52YXIiXSA9IGxlbihkZi5jb2x1bW5zKQogICAgdGFibGVfc3RhdHNbInRvdGFsX21pc3NpbmciXSA9IGZsb2F0KHZhcmlhYmxlX3N0YXRzLmxvY1sibl9taXNzaW5nIl0uc3VtKCkpIC8gKAogICAgICAgIHRhYmxlX3N0YXRzWyJuIl0gKiB0YWJsZV9zdGF0c1sibnZhciJdCiAgICApCiAgICBtZW1zaXplID0gMAogICAgdGFibGVfc3RhdHNbIm1lbXNpemUiXSA9IGZtdF9ieXRlc2l6ZShtZW1zaXplKQogICAgdGFibGVfc3RhdHNbInJlY29yZHNpemUiXSA9IGZtdF9ieXRlc2l6ZShtZW1zaXplIC8gdGFibGVfc3RhdHNbIm4iXSkKICAgIHRhYmxlX3N0YXRzLnVwZGF0ZSgKICAgICAgICB7azogMCBmb3IgayBpbiAoIk5VTSIsICJEQVRFIiwgIkNPTlNUIiwgIkNBVCIsICJVTklRVUUiLCAiQ09SUiIpfQogICAgKQogICAgdGFibGVfc3RhdHMudXBkYXRlKGRpY3QodmFyaWFibGVfc3RhdHMubG9jWyJ0eXBlIl0udmFsdWVfY291bnRzKCkpKQogICAgdGFibGVfc3RhdHNbIlJFSkVDVEVEIl0gPSB0YWJsZV9zdGF0c1siQ09OU1QiXSArIHRhYmxlX3N0YXRzWyJDT1JSIl0KCiAgICBmcmVxX2RpY3QgPSB7fQogICAgZm9yIHZhciBpbiB2YXJpYWJsZV9zdGF0czoKICAgICAgICBpZiAidmFsdWVfY291bnRzIiBub3QgaW4gdmFyaWFibGVfc3RhdHNbdmFyXToKICAgICAgICAgICAgcGFzcwogICAgICAgIGVsaWYgdmFyaWFibGVfc3RhdHNbdmFyXVsidmFsdWVfY291bnRzIl0gaXMgbm90IG5wLm5hbjoKICAgICAgICAgICAgZnJlcV9kaWN0W3Zhcl0gPSB2YXJpYWJsZV9zdGF0c1t2YXJdWyJ2YWx1ZV9jb3VudHMiXQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHBhc3MKICAgIHRyeToKICAgICAgICB2YXJpYWJsZV9zdGF0cyA9IHZhcmlhYmxlX3N0YXRzLmRyb3AoInZhbHVlX2NvdW50cyIpCiAgICBleGNlcHQgKFZhbHVlRXJyb3IsIEtleUVycm9yKToKICAgICAgICBwYXNzCgogICAgcmV0dXJuIHRhYmxlX3N0YXRzLCB2YXJpYWJsZV9zdGF0cy5ULCBmcmVxX2RpY3QKCgpTS0VXTkVTU19DVVRPRkYgPSAyMApERUZBVUxUX0ZMT0FUX0ZPUk1BVFRFUiA9ICJzcGFya19kZl9wcm9maWxpbmcuX19kZWZhdWx0X2Zsb2F0X2Zvcm1hdHRlciIKCgpkZWYgZ3JhZGllbnRfZm9ybWF0KHZhbHVlLCBsaW1pdDEsIGxpbWl0MiwgYzEsIGMyKToKICAgIGRlZiBMZXJwQ29sb3VyKGMxLCBjMiwgdCk6CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgaW50KGMxWzBdICsgKGMyWzBdIC0gYzFbMF0pICogdCksCiAgICAgICAgICAgIGludChjMVsxXSArIChjMlsxXSAtIGMxWzFdKSAqIHQpLAogICAgICAgICAgICBpbnQoYzFbMl0gKyAoYzJbMl0gLSBjMVsyXSkgKiB0KSwKICAgICAgICApCgogICAgYyA9IExlcnBDb2xvdXIoYzEsIGMyLCAodmFsdWUgLSBsaW1pdDEpIC8gKGxpbWl0MiAtIGxpbWl0MSkpCiAgICByZXR1cm4gZm10X2NvbG9yKHZhbHVlLCBmInJnYntzdHIoYyl9IikKCgpkZWYgZm10X2NvbG9yKHRleHQsIGNvbG9yKToKICAgIHJldHVybiBmJzxzcGFuIHN0eWxlPSJjb2xvcjp7Y29sb3J9Ij57c3RyKHRleHQpfTwvc3Bhbj4nCgoKZGVmIGZtdF9jbGFzcyh0ZXh0LCBjbHMpOgogICAgcmV0dXJuIGYnPHNwYW4gY2xhc3M9IntjbHN9Ij57c3RyKHRleHQpfTwvc3Bhbj4nCgoKZGVmIGZtdF9ieXRlc2l6ZShudW0sIHN1ZmZpeD0iQiIpOgogICAgZm9yIHVuaXQgaW4gWyIiLCAiS2kiLCAiTWkiLCAiR2kiLCAiVGkiLCAiUGkiLCAiRWkiLCAiWmkiXToKICAgICAgICBpZiBudW0gPCAwOgogICAgICAgICAgICBudW0gPSBudW0gKiAtMQogICAgICAgICAgICBpZiBudW0gPCAxMDI0LjA6CiAgICAgICAgICAgICAgICByZXR1cm4gIiUzLjFmICVzJXMiICUgKG51bSwgdW5pdCwgc3VmZml4KQogICAgICAgICAgICBudW0gLz0gMTAyNC4wCiAgICByZXR1cm4gIiUuMWYgJXMlcyIgJSAobnVtLCAiWWkiLCBzdWZmaXgpCgoKZGVmIGZtdF9wZXJjZW50KHYpOgogICAgcmV0dXJuIGYie3YgKiAxMDA6Mi4xZn0lIgoKCmRlZiBmbXRfdmFybmFtZSh2KToKICAgIHJldHVybiBmIjxjb2RlPnt2fTwvY29kZT4iCgoKdmFsdWVfZm9ybWF0dGVycyA9IHsKICAgICJmcmVxIjogKGxhbWJkYSB2OiBncmFkaWVudF9mb3JtYXQodiwgMCwgNjIwMDAsICgzMCwgMTk4LCAyNDQpLCAoOTksIDIwMCwgNzIpKSksCiAgICAicF9taXNzaW5nIjogZm10X3BlcmNlbnQsCiAgICAicF9pbmZpbml0ZSI6IGZtdF9wZXJjZW50LAogICAgInBfdW5pcXVlIjogZm10X3BlcmNlbnQsCiAgICAicF96ZXJvcyI6IGZtdF9wZXJjZW50LAogICAgIm1lbW9yeXNpemUiOiBmbXRfYnl0ZXNpemUsCiAgICAidG90YWxfbWlzc2luZyI6IGZtdF9wZXJjZW50LAogICAgREVGQVVMVF9GTE9BVF9GT1JNQVRURVI6IGxhbWJkYSB2OiBzdHIoZmxvYXQoZiJ7djouNWd9IikpLnJzdHJpcCgiMCIpLnJzdHJpcCgiLiIpLAogICAgImNvcnJlbGF0aW9uX3ZhciI6IGxhbWJkYSB2OiBmbXRfdmFybmFtZSh2KSwKICAgICJ1bnBhcnNlZF9qc29uX3R5cGVzIjogbGFtYmRhIHY6ICIsICIuam9pbihbcy5fX25hbWVfXyBmb3IgcyBpbiB2XSksCn0KCgpkZWYgZm10X3Jvd19zZXZlcml0eSh2KToKICAgIGlmIG5wLmlzbmFuKHYpIG9yIHYgPD0gMC4wMToKICAgICAgICByZXR1cm4gImlnbm9yZSIKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuICJhbGVydCIKCgpkZWYgZm10X3NrZXduZXNzKHYpOgogICAgaWYgbm90IG5wLmlzbmFuKHYpIGFuZCAodiA8IC1TS0VXTkVTU19DVVRPRkYgb3IgdiA+IFNLRVdORVNTX0NVVE9GRik6CiAgICAgICAgcmV0dXJuICJhbGVydCIKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuICIiCgoKcm93X2Zvcm1hdHRlcnMgPSB7CiAgICAicF96ZXJvcyI6IGZtdF9yb3dfc2V2ZXJpdHksCiAgICAicF9taXNzaW5nIjogZm10X3Jvd19zZXZlcml0eSwKICAgICJwX2luZmluaXRlIjogZm10X3Jvd19zZXZlcml0eSwKICAgICJuX2R1cGxpY2F0ZXMiOiBmbXRfcm93X3NldmVyaXR5LAogICAgInNrZXduZXNzIjogZm10X3NrZXduZXNzLAp9CgpydW4oWyIvYmluL2Jhc2giLCAiL2V0Yy9jb25maWcvdjNpby92M2lvLXNwYXJrLW9wZXJhdG9yLnNoIl0pCgoKZGVmIGRlc2NyaWJlX3NwYXJrKAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBkYXRhc2V0OiBEYXRhSXRlbSwKICAgIGFydGlmYWN0X3BhdGgsCiAgICBiaW5zOiBpbnQgPSAzMCwKICAgIGRlc2NyaWJlX2V4dGVuZGVkOiBib29sID0gVHJ1ZSwKKToKICAgIGxvY2F0aW9uID0gZGF0YXNldC5sb2NhbCgpCgogICAgc3BhcmsgPSBTcGFya1Nlc3Npb24uYnVpbGRlci5hcHBOYW1lKCJTcGFyayBqb2IiKS5nZXRPckNyZWF0ZSgpCgogICAgZGYgPSBzcGFyay5yZWFkLmNzdihsb2NhdGlvbiwgaGVhZGVyPVRydWUsIGluZmVyU2NoZW1hPVRydWUpCgogICAga3dhcmdzID0gW10KCiAgICBmbG9hdF9jb2xzID0gWwogICAgICAgIGl0ZW1bMF0KICAgICAgICBmb3IgaXRlbSBpbiBkZi5kdHlwZXMKICAgICAgICBpZiBpdGVtWzFdLnN0YXJ0c3dpdGgoImZsb2F0Iikgb3IgaXRlbVsxXS5zdGFydHN3aXRoKCJkb3VibGUiKQogICAgXQoKICAgIGlmIGRlc2NyaWJlX2V4dGVuZGVkID09IFRydWU6CiAgICAgICAgdGFibGUsIHZhcmlhYmxlcywgZnJlcSA9IGRlc2NyaWJlKGRmLCBiaW5zLCBmbG9hdF9jb2xzLCBrd2FyZ3MpCgogICAgICAgIHRibF8xID0gdmFyaWFibGVzLnJlc2V0X2luZGV4KCkKCiAgICAgICAgaWYgbGVuKGZyZXEpICE9IDA6CiAgICAgICAgICAgIHRibF8yID0gKAogICAgICAgICAgICAgICAgcGQuRGF0YUZyYW1lLmZyb21fZGljdChmcmVxLCBvcmllbnQ9ImluZGV4IikKICAgICAgICAgICAgICAgIC5zb3J0X2luZGV4KCkKICAgICAgICAgICAgICAgIC5zdGFjaygpCiAgICAgICAgICAgICAgICAucmVzZXRfaW5kZXgoKQogICAgICAgICAgICApCiAgICAgICAgICAgIHRibF8yLmNvbHVtbnMgPSBbImNvbCIsICJrZXkiLCAidmFsIl0KICAgICAgICAgICAgdGJsXzJbIk1lcmdlZCJdID0gW3trZXk6IHZhbH0gZm9yIGtleSwgdmFsIGluIHppcCh0YmxfMi5rZXksIHRibF8yLnZhbCldCiAgICAgICAgICAgIHRibF8yID0gdGJsXzIuZ3JvdXBieSgiY29sIiwgYXNfaW5kZXg9RmFsc2UpLmFnZyhsYW1iZGEgeDogdHVwbGUoeCkpWwogICAgICAgICAgICAgICAgWyJjb2wiLCAiTWVyZ2VkIl0KICAgICAgICAgICAgXQoKICAgICAgICAgICAgc3VtbWFyeSA9IHBkLm1lcmdlKAogICAgICAgICAgICAgICAgdGJsXzEsIHRibF8yLCBob3c9ImxlZnQiLCBsZWZ0X29uPSJpbmRleCIsIHJpZ2h0X29uPSJjb2wiCiAgICAgICAgICAgICkKCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc3VtbWFyeSA9IHRibF8xCgogICAgICAgIGNvbnRleHQubG9nX2RhdGFzZXQoCiAgICAgICAgICAgICJzdW1tYXJ5X3N0YXRzIiwKICAgICAgICAgICAgZGY9c3VtbWFyeSwKICAgICAgICAgICAgZm9ybWF0PSJjc3YiLAogICAgICAgICAgICBpbmRleD1GYWxzZSwKICAgICAgICAgICAgYXJ0aWZhY3RfcGF0aD1jb250ZXh0LmFydGlmYWN0X3N1YnBhdGgoImRhdGEiKSwKICAgICAgICApCgogICAgICAgIGNvbnRleHQubG9nX3Jlc3VsdHModGFibGUpCgogICAgZWxzZToKICAgICAgICB0YmxfMSA9IGRmLmRlc2NyaWJlKCkudG9QYW5kYXMoKQoKICAgICAgICBzdW1tYXJ5ID0gdGJsXzEuVAoKICAgICAgICBjb250ZXh0LmxvZ19kYXRhc2V0KAogICAgICAgICAgICAic3VtbWFyeV9zdGF0cyIsCiAgICAgICAgICAgIGRmPXN1bW1hcnksCiAgICAgICAgICAgIGZvcm1hdD0iY3N2IiwKICAgICAgICAgICAgaW5kZXg9RmFsc2UsCiAgICAgICAgICAgIGFydGlmYWN0X3BhdGg9Y29udGV4dC5hcnRpZmFjdF9zdWJwYXRoKCJkYXRhIiksCiAgICAgICAgKQoKICAgIHNwYXJrLnN0b3AoKQo=
  filename: describe_spark.py
verbose: false
kind: job
metadata:
  tag: ''
  name: describe-spark
  categories:
  - data-analysis
