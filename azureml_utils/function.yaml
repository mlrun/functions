kind: job
metadata:
  name: azureml-utils
  tag: ''
  hash: 9ed49ae732001bc6b7e1a25416e38cf331ad4da2
  project: default
  labels:
    author: yonish
  categories:
  - Utilities
  - machine-learning
  - model-training
spec:
  command: ''
  args: []
  image: mlrun/mlrun
  env: []
  default_handler: automl_train
  entry_points:
    init_compute:
      name: init_compute
      doc: 'Initialize Azure ML compute target to run experiment. Checks for

        existing compute target and creates new if does not exist.'
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context.
        default: ''
      - name: cpu_cluster_name
        type: str
        doc: Name of Azure ML compute target. Created if does not exist.
        default: ''
      - name: vm_size
        type: str
        doc: Azure machine type for compute target.
        default: STANDARD_D2_V2
      - name: max_nodes
        type: int
        doc: Maximum number of concurrent compute targets.
        default: 1
      outputs:
      - default: ''
        doc: Azure ML Compute Target.
        type: ComputeTarget
      lineno: 86
    register_dataset:
      name: register_dataset
      doc: 'Register dataset object (can be also an Iguazio FeatureVector) in Azure
        ML.

        Uploads parquet file to Azure blob storage and registers

        that file as a dataset in Azure ML.'
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context.
        default: ''
      - name: dataset_name
        type: str
        doc: Name of Azure dataset to register.
        default: ''
      - name: dataset_description
        type: str
        doc: Description of Azure dataset to register.
        default: ''
      - name: data
        type: DataItem
        doc: MLRun FeatureVector or dataset object to upload.
        default: ''
      - name: create_new_version
        type: bool
        doc: Register Azure dataset as new version. Must be used when modifying dataset
          schema.
        default: false
      outputs:
      - default: ''
      lineno: 122
    download_model:
      name: download_model
      doc: Download trained model from Azure ML to local filesystem.
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context.
        default: ''
      - name: model_name
        type: str
        doc: Name of trained and registered model.
        default: ''
      - name: model_version
        type: int
        doc: Version of model to download.
        default: ''
      - name: target_dir
        type: str
        doc: Target directory to download model.
        default: .
      outputs:
      - default: ''
      lineno: 199
    upload_model:
      name: upload_model
      doc: Upload pre-trained model from local filesystem to Azure ML.
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context.
        default: ''
      - name: model_name
        type: str
        doc: Name of trained and registered model.
        default: ''
      - name: model_path
        type: str
        doc: Path to file on local filesystem.
        default: ''
      - name: model_description
        type: str
        doc: Description of models.
        default: null
      - name: model_tags
        type: dict
        doc: KV pairs of model tags.
        default: null
      outputs:
      - default: ''
      lineno: 220
    submit_training_job:
      name: submit_training_job
      doc: 'Submit training job to Azure AutoML and download trained model

        when completed. Uses previously registered dataset for training.'
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context.
        default: ''
      - name: experiment
        type: Experiment
        doc: Azure experiment.
        default: ''
      - name: compute_target
        type: ComputeTarget
        doc: Azure compute target.
        default: ''
      - name: register_model_name
        type: str
        doc: Name of model to register in Azure.
        default: ''
      - name: registered_dataset_name
        type: str
        doc: Name of dataset registered in Azure ML.
        default: ''
      - name: label_column_name
        type: str
        doc: Name of target column in dataset.
        default: ''
      - name: automl_settings
        type: dict
        doc: JSON string of all Azure AutoML settings.
        default: ''
      - name: training_set
        type: DataItem
        doc: Training set to log with model. For model monitoring integration.
        default: ''
      - name: save_n_models
        type: int
        doc: How many of the top performing models to log.
        default: 3
      - name: show_output
        type: bool
        doc: Displaying Azure logs.
        default: true
      outputs:
      - default: ''
      lineno: 332
    automl_train:
      name: automl_train
      doc: 'Whole training flow for Azure AutoML. Registers dataset/feature vector,

        submits training job to Azure AutoML, and downloads trained model

        when completed.'
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context.
        default: ''
      - name: training_data
        type: DataItem
        doc: MLRun FeatureVector or dataset URI to upload. Will drop index before
          uploading when it is a FeatureVector.
        default: ''
      - name: experiment_name
        type: str
        doc: Name of experiment to create in Azure ML.
        default: ''
      - name: cpu_cluster_name
        type: str
        doc: Name of Azure ML compute target. Created if does not exist.
        default: ''
      - name: vm_size
        type: str
        doc: Azure machine type for compute target.
        default: STANDARD_D2_V2
      - name: max_nodes
        type: int
        doc: Maximum number of concurrent compute targets.
        default: 1
      - name: dataset_name
        type: str
        doc: Name of Azure dataset to register.
        default: ''
      - name: dataset_description
        type: str
        doc: Description of Azure dataset to register.
        default: ''
      - name: create_new_version
        type: bool
        doc: Register Azure dataset as new version. Must be used when modifying dataset
          schema.
        default: false
      - name: label_column_name
        type: str
        doc: Target column in dataset.
        default: ''
      - name: register_model_name
        type: str
        doc: Name of model to register in Azure.
        default: ''
      - name: save_n_models
        type: int
        doc: How many of the top performing models to log.
        default: 1
      - name: log_azure
        type: bool
        doc: Displaying Azure logs.
        default: true
      - name: automl_settings
        type: str
        doc: JSON string of all Azure AutoML settings.
        default: null
      outputs:
      - default: ''
      lineno: 440
  description: Azure AutoML integration in MLRun, including utils functions for training
    models on Azure AutoML platfrom.
  build:
    functionSourceCode: aW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCBsb2dnaW5nCmZyb20gdHlwaW5nIGltcG9ydCBUdXBsZSwgTGlzdAoKZnJvbSBtbHJ1biBpbXBvcnQgTUxDbGllbnRDdHgsIERhdGFJdGVtLCBnZXRfZGF0YWl0ZW0KaW1wb3J0IG1scnVuLmZlYXR1cmVfc3RvcmUgYXMgZl9zdG9yZQpmcm9tIG1scnVuLmFwaS5zY2hlbWFzIGltcG9ydCBPYmplY3RLaW5kCgpmcm9tIGF6dXJlbWwuY29yZS5hdXRoZW50aWNhdGlvbiBpbXBvcnQgU2VydmljZVByaW5jaXBhbEF1dGhlbnRpY2F0aW9uCmZyb20gYXp1cmVtbC5jb3JlLndvcmtzcGFjZSBpbXBvcnQgV29ya3NwYWNlCmZyb20gYXp1cmVtbC5jb3JlLmV4cGVyaW1lbnQgaW1wb3J0IEV4cGVyaW1lbnQKZnJvbSBhenVyZW1sLmNvcmUuZGF0YXNldCBpbXBvcnQgRGF0YXNldApmcm9tIGF6dXJlbWwuY29yZS5tb2RlbCBpbXBvcnQgTW9kZWwKZnJvbSBhenVyZW1sLmNvcmUuY29tcHV0ZSBpbXBvcnQgQ29tcHV0ZVRhcmdldCwgQW1sQ29tcHV0ZQpmcm9tIGF6dXJlbWwuY29yZS5jb21wdXRlX3RhcmdldCBpbXBvcnQgQ29tcHV0ZVRhcmdldEV4Y2VwdGlvbgpmcm9tIGF6dXJlbWwuY29yZS5zY3JpcHRfcnVuIGltcG9ydCBTY3JpcHRSdW4KCmZyb20gYXp1cmVtbC50cmFpbi5hdXRvbWwgaW1wb3J0IEF1dG9NTENvbmZpZwpmcm9tIGF6dXJlbWwudHJhaW4uYXV0b21sLnJ1biBpbXBvcnQgQXV0b01MUnVuCgoKZGVmIF9lbnZfb3Jfc2VjcmV0KGNvbnRleHQsIGtleSk6CiAgICBpZiBrZXkgaW4gb3MuZW52aXJvbjoKICAgICAgICByZXR1cm4gb3MuZW52aXJvbltrZXldCiAgICByZXR1cm4gY29udGV4dC5nZXRfc2VjcmV0KGtleSkKCgpkZWYgX2xvYWRfd29ya3NwYWNlKGNvbnRleHQ6IE1MQ2xpZW50Q3R4KSAtPiBXb3Jrc3BhY2U6CiAgICAiIiIKICAgIExvYWRpbmcgQXp1cmVNTCBXb3Jrc3BhY2Ugd2l0aCBBenVyZSBzZWNyZXRzLgoKICAgIDpwYXJhbSBjb250ZXh0OiBNTFJ1biBjb250ZXh0LgogICAgOnJldHVybnM6ICAgICAgIEF6dXJlTUwgV29ya3NwYWNlCiAgICAiIiIKCiAgICBpZiBoYXNhdHRyKGNvbnRleHQsICJfYXp1cmVfd29ya3NwYWNlIik6CiAgICAgICAgcmV0dXJuIGNvbnRleHQuX2F6dXJlX3dvcmtzcGFjZQoKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIkxvYWRpbmcgQXp1cmVNTCBXb3Jrc3BhY2UiKQogICAgIyBBenVyZSBzZXJ2aWNlIGF1dGhlbnRpY2F0aW9uOgogICAgc2VydmljZV9hdXRoZW50aWNhdGlvbiA9IFNlcnZpY2VQcmluY2lwYWxBdXRoZW50aWNhdGlvbigKICAgICAgICB0ZW5hbnRfaWQ9X2Vudl9vcl9zZWNyZXQoY29udGV4dCwgIkFaVVJFX1RFTkFOVF9JRCIpLAogICAgICAgIHNlcnZpY2VfcHJpbmNpcGFsX2lkPV9lbnZfb3Jfc2VjcmV0KGNvbnRleHQsICJBWlVSRV9TRVJWSUNFX1BSSU5DSVBBTF9JRCIpLAogICAgICAgIHNlcnZpY2VfcHJpbmNpcGFsX3Bhc3N3b3JkPV9lbnZfb3Jfc2VjcmV0KAogICAgICAgICAgICBjb250ZXh0LCAiQVpVUkVfU0VSVklDRV9QUklOQ0lQQUxfUEFTU1dPUkQiCiAgICAgICAgKSwKICAgICkKCiAgICAjIExvYWRpbmcgQXp1cmUgd29ya3NwYWNlOgogICAgd29ya3NwYWNlID0gV29ya3NwYWNlKAogICAgICAgIHN1YnNjcmlwdGlvbl9pZD1fZW52X29yX3NlY3JldChjb250ZXh0LCAiQVpVUkVfU1VCU0NSSVBUSU9OX0lEIiksCiAgICAgICAgcmVzb3VyY2VfZ3JvdXA9X2Vudl9vcl9zZWNyZXQoY29udGV4dCwgIkFaVVJFX1JFU09VUkNFX0dST1VQIiksCiAgICAgICAgd29ya3NwYWNlX25hbWU9X2Vudl9vcl9zZWNyZXQoY29udGV4dCwgIkFaVVJFX1dPUktTUEFDRV9OQU1FIiksCiAgICAgICAgYXV0aD1zZXJ2aWNlX2F1dGhlbnRpY2F0aW9uLAogICAgKQoKICAgIGNvbnRleHQuX2F6dXJlX3dvcmtzcGFjZSA9IHdvcmtzcGFjZQogICAgcmV0dXJuIHdvcmtzcGFjZQoKCmRlZiBfaW5pdF9leHBlcmltZW50KAogICAgY29udGV4dDogTUxDbGllbnRDdHgsIGV4cGVyaW1lbnRfbmFtZTogc3RyCikgLT4gVHVwbGVbV29ya3NwYWNlLCBFeHBlcmltZW50XToKICAgICIiIgogICAgSW5pdGlhbGl6ZSB3b3Jrc3BhY2UgYW5kIGV4cGVyaW1lbnQgaW4gQXp1cmUgTUwuIFVzZXMgU2VydmljZQogICAgUHJpbmNpcGFsIGF1dGhlbnRpY2F0aW9uIHZpYSBlbnZpcm9ubWVudCB2YXJpYWJsZXMuCgogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgTUxSdW4gY29udGV4dC4KICAgIDpwYXJhbSBleHBlcmltZW50X25hbWU6IE5hbWUgb2YgZXhwZXJpbWVudCB0byBjcmVhdGUgaW4gQXp1cmUgTUwuCiAgICA6cmV0dXJuczogICAgICAgICAgICAgICBBenVyZSBNTCBXb3Jrc3BhY2UgYW5kIEV4cGVyaW1lbnQuCiAgICAiIiIKCiAgICAjIEluaXRpYWxpemUgZXhwZXJpbWVudCB2aWEgU2VydmljZSBQcmluY2lwYWwgQXV0aGVudGljYXRpb246CiAgICAjIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL2F6dXJlL21hY2hpbmUtbGVhcm5pbmcvaG93LXRvLXNldHVwLWF1dGhlbnRpY2F0aW9uI3VzZS1zZXJ2aWNlLXByaW5jaXBhbC1hdXRoZW50aWNhdGlvbgoKICAgIHdvcmtzcGFjZSA9IF9sb2FkX3dvcmtzcGFjZShjb250ZXh0KQoKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJJbml0aWFsaXppbmcgQXp1cmVNTCBleHBlcmltZW50IHtleHBlcmltZW50X25hbWV9IikKICAgICMgQ3JlYXRpbmcgZXhwZXJpbWVudDoKICAgIGV4cGVyaW1lbnQgPSBFeHBlcmltZW50KHdvcmtzcGFjZSwgZXhwZXJpbWVudF9uYW1lKQoKICAgIHJldHVybiB3b3Jrc3BhY2UsIGV4cGVyaW1lbnQKCgpkZWYgaW5pdF9jb21wdXRlKAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBjcHVfY2x1c3Rlcl9uYW1lOiBzdHIsCiAgICB2bV9zaXplOiBzdHIgPSAiU1RBTkRBUkRfRDJfVjIiLAogICAgbWF4X25vZGVzOiBpbnQgPSAxLAopIC0+IENvbXB1dGVUYXJnZXQ6CiAgICAiIiIKICAgIEluaXRpYWxpemUgQXp1cmUgTUwgY29tcHV0ZSB0YXJnZXQgdG8gcnVuIGV4cGVyaW1lbnQuIENoZWNrcyBmb3IKICAgIGV4aXN0aW5nIGNvbXB1dGUgdGFyZ2V0IGFuZCBjcmVhdGVzIG5ldyBpZiBkb2VzIG5vdCBleGlzdC4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgTUxSdW4gY29udGV4dC4KICAgIDpwYXJhbSBjcHVfY2x1c3Rlcl9uYW1lOiBOYW1lIG9mIEF6dXJlIE1MIGNvbXB1dGUgdGFyZ2V0LiBDcmVhdGVkIGlmIGRvZXMgbm90IGV4aXN0LgogICAgOnBhcmFtIHZtX3NpemU6ICAgICAgICAgIEF6dXJlIG1hY2hpbmUgdHlwZSBmb3IgY29tcHV0ZSB0YXJnZXQuCiAgICA6cGFyYW0gbWF4X25vZGVzOiAgICAgICAgTWF4aW11bSBudW1iZXIgb2YgY29uY3VycmVudCBjb21wdXRlIHRhcmdldHMuCiAgICA6cmV0dXJuczogICAgICAgICAgICAgICAgQXp1cmUgTUwgQ29tcHV0ZSBUYXJnZXQuCiAgICAiIiIKCiAgICB3b3Jrc3BhY2UgPSBfbG9hZF93b3Jrc3BhY2UoY29udGV4dCkKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJJbml0aWFsaXppbmcgQXp1cmVNTCBjb21wdXRlIHRhcmdldCB7Y3B1X2NsdXN0ZXJfbmFtZX0iKQoKICAgICMgVmVyaWZ5IHRoYXQgY2x1c3RlciBkb2VzIG5vdCBleGlzdCBhbHJlYWR5OgogICAgdHJ5OgogICAgICAgIGNvbXB1dGVfdGFyZ2V0ID0gQ29tcHV0ZVRhcmdldCh3b3Jrc3BhY2U9d29ya3NwYWNlLCBuYW1lPWNwdV9jbHVzdGVyX25hbWUpCiAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygiRm91bmQgZXhpc3RpbmcgY2x1c3Rlciwgd2lsbCB1c2UgaXQuIikKICAgIGV4Y2VwdCBDb21wdXRlVGFyZ2V0RXhjZXB0aW9uOgogICAgICAgIGNvbXB1dGVfY29uZmlnID0gQW1sQ29tcHV0ZS5wcm92aXNpb25pbmdfY29uZmlndXJhdGlvbigKICAgICAgICAgICAgdm1fc2l6ZT12bV9zaXplLCBtYXhfbm9kZXM9bWF4X25vZGVzCiAgICAgICAgKQogICAgICAgIGNvbXB1dGVfdGFyZ2V0ID0gQ29tcHV0ZVRhcmdldC5jcmVhdGUoCiAgICAgICAgICAgIHdvcmtzcGFjZSwgY3B1X2NsdXN0ZXJfbmFtZSwgY29tcHV0ZV9jb25maWcKICAgICAgICApCgogICAgY29tcHV0ZV90YXJnZXQud2FpdF9mb3JfY29tcGxldGlvbihzaG93X291dHB1dD1UcnVlKQogICAgcmV0dXJuIGNvbXB1dGVfdGFyZ2V0CgoKZGVmIHJlZ2lzdGVyX2RhdGFzZXQoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIGRhdGFzZXRfbmFtZTogc3RyLAogICAgZGF0YXNldF9kZXNjcmlwdGlvbjogc3RyLAogICAgZGF0YTogRGF0YUl0ZW0sCiAgICBjcmVhdGVfbmV3X3ZlcnNpb246IGJvb2wgPSBGYWxzZSwKKToKICAgICIiIgogICAgUmVnaXN0ZXIgZGF0YXNldCBvYmplY3QgKGNhbiBiZSBhbHNvIGFuIElndWF6aW8gRmVhdHVyZVZlY3RvcikgaW4gQXp1cmUgTUwuCiAgICBVcGxvYWRzIHBhcnF1ZXQgZmlsZSB0byBBenVyZSBibG9iIHN0b3JhZ2UgYW5kIHJlZ2lzdGVycwogICAgdGhhdCBmaWxlIGFzIGEgZGF0YXNldCBpbiBBenVyZSBNTC4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgICAgICBNTFJ1biBjb250ZXh0LgogICAgOnBhcmFtIGRhdGFzZXRfbmFtZTogICAgICAgICAgTmFtZSBvZiBBenVyZSBkYXRhc2V0IHRvIHJlZ2lzdGVyLgogICAgOnBhcmFtIGRhdGFzZXRfZGVzY3JpcHRpb246ICAgRGVzY3JpcHRpb24gb2YgQXp1cmUgZGF0YXNldCB0byByZWdpc3Rlci4KICAgIDpwYXJhbSBkYXRhOiAgICAgICAgICAgICAgICAgIE1MUnVuIEZlYXR1cmVWZWN0b3Igb3IgZGF0YXNldCBvYmplY3QgdG8gdXBsb2FkLgogICAgOnBhcmFtIGNyZWF0ZV9uZXdfdmVyc2lvbjogICAgUmVnaXN0ZXIgQXp1cmUgZGF0YXNldCBhcyBuZXcgdmVyc2lvbi4gTXVzdCBiZSB1c2VkIHdoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmeWluZyBkYXRhc2V0IHNjaGVtYS4KICAgICIiIgoKICAgICMgdGVzdCBmb3IgQXp1cmUgc3RvcmFnZSBjb25uZWN0aW9uIGVudmlyb25tZW50IHZhcmlhYmxlIG9yIHNlY3JldDoKICAgIGFzc2VydCBfZW52X29yX3NlY3JldCgKICAgICAgICBjb250ZXh0LCAiQVpVUkVfU1RPUkFHRV9DT05ORUNUSU9OX1NUUklORyIKICAgICksICJBWlVSRV9TVE9SQUdFX0NPTk5FQ1RJT05fU1RSSU5HIHNlY3JldCBub3Qgc2V0IgoKICAgIGRhdGFfdHlwZSA9IGRhdGEuc3VmZml4CiAgICAjIENvbm5lY3QgdG8gQXp1cmVNTCBleHBlcmltZW50IGFuZCBkYXRhc3RvcmU6CiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCJDb25uZWN0aW5nIHRvIEF6dXJlTUwgZXhwZXJpbWVudCBkZWZhdWx0IGRhdGFzdG9yZSIpCgogICAgd29ya3NwYWNlID0gX2xvYWRfd29ya3NwYWNlKGNvbnRleHQpCiAgICBkYXRhc3RvcmUgPSB3b3Jrc3BhY2UuZ2V0X2RlZmF1bHRfZGF0YXN0b3JlKCkKCiAgICAjIEF6dXJlIGJsb2IgcGF0aCAoZGVmYXVsdCBkYXRhc3RvcmUgZm9yIHdvcmtzcGFjZSk6CiAgICBibG9iX3BhdGggPSBmImF6Oi8ve2RhdGFzdG9yZS5jb250YWluZXJfbmFtZX0ve2RhdGFzZXRfbmFtZX17ZGF0YV90eXBlfSIKCiAgICAjIFJldHJpZXZlIGRhdGEgc291cmNlIGFzIGRhdGFmcmFtZToKICAgIGlmIGRhdGEubWV0YSBhbmQgZGF0YS5tZXRhLmtpbmQgPT0gT2JqZWN0S2luZC5mZWF0dXJlX3ZlY3RvcjoKICAgICAgICAjIEZlYXR1cmVWZWN0b3IgY2FzZToKICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKAogICAgICAgICAgICBmIlJldHJpZXZpbmcgZmVhdHVyZSB2ZWN0b3IgYW5kIHVwbG9hZGluZyB0byBBenVyZSBibG9iIHN0b3JhZ2U6IHtibG9iX3BhdGh9IgogICAgICAgICkKICAgICAgICBmX3N0b3JlLmdldF9vZmZsaW5lX2ZlYXR1cmVzKGRhdGEubWV0YS51cmkpLnRvX3BhcnF1ZXQoYmxvYl9wYXRoKQogICAgZWxzZToKICAgICAgICAjIERhdGFJdGVtIGNhc2U6CiAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygKICAgICAgICAgICAgZiJSZXRyaWV2aW5nIGZlYXR1cmUgdmVjdG9yIGFuZCB1cGxvYWRpbmcgdG8gQXp1cmUgYmxvYiBzdG9yYWdlOiB7YmxvYl9wYXRofSIKICAgICAgICApCiAgICAgICAgZGF0YV9pbl9ieXRlcyA9IGRhdGEuZ2V0KCkKICAgICAgICBnZXRfZGF0YWl0ZW0oYmxvYl9wYXRoKS5wdXQoZGF0YV9pbl9ieXRlcykKCiAgICAjIFJlZ2lzdGVyIGRhdGFzZXQgaW4gQXp1cmVNTDoKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJSZWdpc3RlcmluZyBkYXRhc2V0IHtkYXRhc2V0X25hbWV9IGluIEF6dXJlIE1MIikKICAgIGlmIGRhdGFfdHlwZSA9PSAiLnBhcnF1ZXQiOgogICAgICAgIGRhdGFzZXQgPSBEYXRhc2V0LlRhYnVsYXIuZnJvbV9wYXJxdWV0X2ZpbGVzKAogICAgICAgICAgICBwYXRoPShkYXRhc3RvcmUsIGYie2RhdGFzZXRfbmFtZX0ucGFycXVldCIpLCB2YWxpZGF0ZT1GYWxzZQogICAgICAgICkKICAgIGVsc2U6CiAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygKICAgICAgICAgICAgZiJPcGVuU1NMIHZlcnNpb24gbXVzdCBiZSAxLjEuIE92ZXJyaWRpbmcgdGhlIE9wZW5TU0wgdmVyc2lvbiB0byAxLjEiCiAgICAgICAgKQogICAgICAgICMgT3BlblNTTCB2ZXJzaW9uIG11c3QgYmUgMS4xCiAgICAgICAgb3MuZW52aXJvblsiQ0xSX09QRU5TU0xfVkVSU0lPTl9PVkVSUklERSJdID0gIjEuMSIKICAgICAgICBkYXRhc2V0ID0gRGF0YXNldC5UYWJ1bGFyLmZyb21fZGVsaW1pdGVkX2ZpbGVzKAogICAgICAgICAgICBwYXRoPShkYXRhc3RvcmUsIGYie2RhdGFzZXRfbmFtZX17ZGF0YV90eXBlfSIpLCB2YWxpZGF0ZT1GYWxzZQogICAgICAgICkKCiAgICBkYXRhc2V0LnJlZ2lzdGVyKAogICAgICAgIHdvcmtzcGFjZT13b3Jrc3BhY2UsCiAgICAgICAgbmFtZT1kYXRhc2V0X25hbWUsCiAgICAgICAgZGVzY3JpcHRpb249ZGF0YXNldF9kZXNjcmlwdGlvbiwKICAgICAgICBjcmVhdGVfbmV3X3ZlcnNpb249Y3JlYXRlX25ld192ZXJzaW9uLAogICAgKQoKICAgICMgT3V0cHV0IHJlZ2lzdGVyZWQgZGF0YXNldCBuYW1lIGluIEF6dXJlOgogICAgY29udGV4dC5sb2dfcmVzdWx0KCJkYXRhc2V0X2Jsb2JfcGF0aCIsIGJsb2JfcGF0aCkKCgpkZWYgZG93bmxvYWRfbW9kZWwoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIG1vZGVsX25hbWU6IHN0ciwKICAgIG1vZGVsX3ZlcnNpb246IGludCwKICAgIHRhcmdldF9kaXI6IHN0ciA9ICIuIiwKKSAtPiBOb25lOgogICAgIiIiCiAgICBEb3dubG9hZCB0cmFpbmVkIG1vZGVsIGZyb20gQXp1cmUgTUwgdG8gbG9jYWwgZmlsZXN5c3RlbS4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgTUxSdW4gY29udGV4dC4KICAgIDpwYXJhbSBtb2RlbF9uYW1lOiAgICBOYW1lIG9mIHRyYWluZWQgYW5kIHJlZ2lzdGVyZWQgbW9kZWwuCiAgICA6cGFyYW0gbW9kZWxfdmVyc2lvbjogVmVyc2lvbiBvZiBtb2RlbCB0byBkb3dubG9hZC4KICAgIDpwYXJhbSB0YXJnZXRfZGlyOiAgICBUYXJnZXQgZGlyZWN0b3J5IHRvIGRvd25sb2FkIG1vZGVsLgogICAgIiIiCiAgICAjIExvYWRpbmcgd29ya3NwYWNlIGlmIG5vdCBwcm92aWRlZDoKICAgIHdvcmtzcGFjZSA9IF9sb2FkX3dvcmtzcGFjZShjb250ZXh0KQogICAgY29udGV4dC5sb2dnZXIuaW5mbyhmIkRvd25sb2FkaW5nIG1vZGVsIHttb2RlbF9uYW1lfTp7bW9kZWxfdmVyc2lvbn0iKQogICAgbW9kZWwgPSBNb2RlbCh3b3Jrc3BhY2UsIG1vZGVsX25hbWUsIHZlcnNpb249bW9kZWxfdmVyc2lvbikKICAgIG1vZGVsLmRvd25sb2FkKHRhcmdldF9kaXI9dGFyZ2V0X2RpciwgZXhpc3Rfb2s9VHJ1ZSkKCgpkZWYgdXBsb2FkX21vZGVsKAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBtb2RlbF9uYW1lOiBzdHIsCiAgICBtb2RlbF9wYXRoOiBzdHIsCiAgICBtb2RlbF9kZXNjcmlwdGlvbjogc3RyID0gTm9uZSwKICAgIG1vZGVsX3RhZ3M6IGRpY3QgPSBOb25lLAopIC0+IE5vbmU6CiAgICAiIiIKICAgIFVwbG9hZCBwcmUtdHJhaW5lZCBtb2RlbCBmcm9tIGxvY2FsIGZpbGVzeXN0ZW0gdG8gQXp1cmUgTUwuCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgIE1MUnVuIGNvbnRleHQuCiAgICA6cGFyYW0gbW9kZWxfbmFtZTogICAgICAgIE5hbWUgb2YgdHJhaW5lZCBhbmQgcmVnaXN0ZXJlZCBtb2RlbC4KICAgIDpwYXJhbSBtb2RlbF9wYXRoOiAgICAgICAgUGF0aCB0byBmaWxlIG9uIGxvY2FsIGZpbGVzeXN0ZW0uCiAgICA6cGFyYW0gbW9kZWxfZGVzY3JpcHRpb246IERlc2NyaXB0aW9uIG9mIG1vZGVscy4KICAgIDpwYXJhbSBtb2RlbF90YWdzOiAgICAgICAgS1YgcGFpcnMgb2YgbW9kZWwgdGFncy4KICAgICIiIgogICAgIyBMb2FkaW5nIHdvcmtzcGFjZSBpZiBub3QgcHJvdmlkZWQ6CiAgICB3b3Jrc3BhY2UgPSBfbG9hZF93b3Jrc3BhY2UoY29udGV4dCkKCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYiVXBsb2FkIG1vZGVsIHttb2RlbF9uYW1lfSBmcm9tIHttb2RlbF9wYXRofSIpCiAgICBNb2RlbC5yZWdpc3RlcigKICAgICAgICB3b3Jrc3BhY2U9d29ya3NwYWNlLAogICAgICAgIG1vZGVsX3BhdGg9bW9kZWxfcGF0aCwKICAgICAgICBtb2RlbF9uYW1lPW1vZGVsX25hbWUsCiAgICAgICAgZGVzY3JpcHRpb249bW9kZWxfZGVzY3JpcHRpb24sCiAgICAgICAgdGFncz1tb2RlbF90YWdzLAogICAgKQoKCmRlZiBfZ2V0X3RvcF9uX3J1bnMoCiAgICByZW1vdGVfcnVuOiBBdXRvTUxSdW4sIG46IGludCA9IDUsIHByaW1hcnlfbWV0cmljOiBzdHIgPSAiYWNjdXJhY3kiCikgLT4gTGlzdFtTY3JpcHRSdW5dOgogICAgIiIiCiAgICBHZXQgdG9wIE4gY29tcGxldGUgcnVucyBmcm9tIGV4cGVyaW1lbnQgc29ydGVkIGJ5IHByaW1hcnkgbWV0cmljLgoKICAgIDpwYXJhbSByZW1vdGVfcnVuOiAgICAgQXp1cmUgTUwgUnVuLgogICAgOnBhcmFtIG46ICAgICAgICAgICAgICBOdW1iZXIgb2YgdG9wIHJ1bnMgdG8gcmV0dXJuLgogICAgOnBhcmFtIHByaW1hcnlfbWV0cmljOiBNZXRyaWMgdG8gc29ydCBieS4KCiAgICA6cmV0dXJuczogICAgICAgICAgICAgIExpc3Qgb2YgdG9wIE4gcnVucyBzb3J0ZWQgYnkgcHJpbWFyeSBtZXRyaWMuCiAgICAiIiIKICAgICMgQ29sbGVjdCBhbGwgbW9kZWxzOgogICAgY29tcGxldGVfcnVucyA9IFsKICAgICAgICBydW4KICAgICAgICBmb3IgcnVuIGluIHJlbW90ZV9ydW4uZ2V0X2NoaWxkcmVuKHN0YXR1cz0iQ29tcGxldGVkIikKICAgICAgICBpZiAic2V0dXAiIG5vdCBpbiBydW4uaWQKICAgIF0KCiAgICAjIENoZWNraW5nIHRoYXQgdGhlIHJlcXVpcmVkIG51bWJlciBvZiBydW5zIGFyZSBkb25lOgogICAgaWYgbGVuKGNvbXBsZXRlX3J1bnMpIDwgbjoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGYiRXhwZWN0ZWQge259IHJ1bnMgYnV0IG9ubHkgcmVjZWl2ZWQge2xlbihjb21wbGV0ZV9ydW5zKX0iKQoKICAgICMgU29ydGluZyBieSB0aGUgcHJpbWFyeSBtZXRyaWM6CiAgICBzb3J0ZWRfcnVucyA9IHNvcnRlZCgKICAgICAgICBjb21wbGV0ZV9ydW5zLCBrZXk9bGFtYmRhIHJ1bjogcnVuLmdldF9tZXRyaWNzKClbcHJpbWFyeV9tZXRyaWNdLCByZXZlcnNlPVRydWUKICAgICkKICAgIHJldHVybiBzb3J0ZWRfcnVuc1s6bl0KCgpkZWYgX2dldF9tb2RlbF9ocCgKICAgIHJ1bjogU2NyaXB0UnVuLAopIC0+IGRpY3Q6CiAgICAiIiIKICAgIEdldCBoeXBlci1wYXJhbWV0ZXJzIG9mIHRyYWluZWQgQXp1cmVNTCBtb2RlbC4KICAgIENvbWJpbmUgdGhlIGh5cGVyLXBhcmFtZXRlcnMgb2YgdGhlIGRhdGEgdHJhbnNmb3JtYXRpb24gYW5kIHRyYWluaW5nIHRvIGEgZGljdGlvbmFyeS4KICAgIFRoZSBwcmVmaXggb2YgdGhlIGRpY3Rpb25hcnkga2V5cyBjb3JyZXNwb25kcyB0byAnZGF0YSB0cmFuc2Zvcm1hdGlvbicgYW5kICd0cmFpbmluZycuCgogICAgOnBhcmFtIHJ1bjogUnVuIG9iamVjdCBvZiBBenVyZU1MIHRyYWluZWQgbW9kZWwuCgogICAgOnJldHVybnM6ICAgIEEgZGljdGlvbmFyeSBhcyBkZXNjcmliZWQgaW4gdGhlIGRvY3N0cmluZy4KICAgICIiIgoKICAgIHNwZWNfZmllbGQgPSAicGlwZWxpbmVfc3BlYyIKICAgIGlmIHNwZWNfZmllbGQgbm90IGluIHJ1bi5wcm9wZXJ0aWVzOgogICAgICAgIHJldHVybiB7fQogICAgc3BlY19zdHJpbmcgPSBydW4ucHJvcGVydGllc1tzcGVjX2ZpZWxkXQogICAgc3BlY19kaWN0ID0ganNvbi5sb2FkcyhzcGVjX3N0cmluZykKCiAgICBpZiAib2JqZWN0cyIgbm90IGluIHNwZWNfZGljdDoKICAgICAgICAjIE5vIGh5cGVyLXBhcmFtcwogICAgICAgIHJldHVybiB7fQogICAgaHBfZGljdHMgPSBzcGVjX2RpY3RbIm9iamVjdHMiXQogICAgIyBhZnRlciB0cmFpbmluZyB0aGVyZSBhcmUgdHdvIGh5cGVyLXBhcmFtZXRlcnMgZGljdHMgaW5zaWRlIHRoZSBydW4gb2JqZWN0OgogICAgYXNzZXJ0ICgKICAgICAgICBsZW4oaHBfZGljdHMpID09IDIKICAgICksICJhZnRlciB0cmFpbmluZyB0aGVyZSBhcmUgdHdvIGh5cGVyLXBhcmFtZXRlcnMgZGljdHMgaW5zaWRlIHRoZSBydW4gb2JqZWN0IgogICAgcmVzdWx0X2RpY3QgPSB7fQogICAgZGljdF9rZXlzID0gWwogICAgICAgIFsiZGF0YV90cmFuc19jbGFzc19uYW1lIiwgImRhdGFfdHJhbnNfbW9kdWxlIiwgImRhdGFfdHJhbnNfc3BlY19jbGFzcyJdLAogICAgICAgIFsKICAgICAgICAgICAgInRyYWluX2NsYXNzX25hbWUiLAogICAgICAgICAgICAidHJhaW5fbW9kdWxlIiwKICAgICAgICAgICAgInRyYWluX3BhcmFtX2t3YXJnc19DIiwKICAgICAgICAgICAgInRyYWluX3BhcmFtX2t3YXJnc19jbGFzc193ZWlnaHQiLAogICAgICAgICAgICAidHJhaW5fc3BlY19jbGFzcyIsCiAgICAgICAgXSwKICAgIF0KCiAgICAjIGNyZWF0aW5nIGh5cGVyLXBhcmFtcyBkaWN0IHdpdGgga2V5IHByZWZpeGVzIGZvciBlYWNoIHBhcnQ6CiAgICBrd2FyZ3NfcHJlZml4ID0gInBhcmFtX2t3YXJncyIKICAgIGZvciBkLCBuYW1lLCBrZXlzIGluIHppcChocF9kaWN0cywgWyJkYXRhX3RyYW5zIiwgInRyYWluIl0sIGRpY3Rfa2V5cyk6CiAgICAgICAgZm9yIGtleSBpbiBrZXlzOgoKICAgICAgICAgICAgaWYga3dhcmdzX3ByZWZpeCBpbiBrZXk6CiAgICAgICAgICAgICAgICByZXN1bHRfZGljdFtrZXldID0gZFtrd2FyZ3NfcHJlZml4XVsKICAgICAgICAgICAgICAgICAgICBrZXkucmVwbGFjZShmIntuYW1lfV97a3dhcmdzX3ByZWZpeH1fIiwgIiIpCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXN1bHRfZGljdFtrZXldID0gZFtrZXkucmVwbGFjZShmIntuYW1lfV8iLCAiIildCgogICAgcmV0dXJuIHJlc3VsdF9kaWN0CgoKZGVmIHN1Ym1pdF90cmFpbmluZ19qb2IoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIGV4cGVyaW1lbnQ6IEV4cGVyaW1lbnQsCiAgICBjb21wdXRlX3RhcmdldDogQ29tcHV0ZVRhcmdldCwKICAgIHJlZ2lzdGVyX21vZGVsX25hbWU6IHN0ciwKICAgIHJlZ2lzdGVyZWRfZGF0YXNldF9uYW1lOiBzdHIsCiAgICBsYWJlbF9jb2x1bW5fbmFtZTogc3RyLAogICAgYXV0b21sX3NldHRpbmdzOiBkaWN0LAogICAgdHJhaW5pbmdfc2V0OiBEYXRhSXRlbSwKICAgIHNhdmVfbl9tb2RlbHM6IGludCA9IDMsCiAgICBzaG93X291dHB1dDogYm9vbCA9IFRydWUsCikgLT4gTm9uZToKICAgICIiIgogICAgU3VibWl0IHRyYWluaW5nIGpvYiB0byBBenVyZSBBdXRvTUwgYW5kIGRvd25sb2FkIHRyYWluZWQgbW9kZWwKICAgIHdoZW4gY29tcGxldGVkLiBVc2VzIHByZXZpb3VzbHkgcmVnaXN0ZXJlZCBkYXRhc2V0IGZvciB0cmFpbmluZy4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgICAgICAgIE1MUnVuIGNvbnRleHQuCiAgICA6cGFyYW0gZXhwZXJpbWVudDogICAgICAgICAgICAgIEF6dXJlIGV4cGVyaW1lbnQuCiAgICA6cGFyYW0gY29tcHV0ZV90YXJnZXQ6ICAgICAgICAgIEF6dXJlIGNvbXB1dGUgdGFyZ2V0LgogICAgOnBhcmFtIHJlZ2lzdGVyX21vZGVsX25hbWU6ICAgICBOYW1lIG9mIG1vZGVsIHRvIHJlZ2lzdGVyIGluIEF6dXJlLgogICAgOnBhcmFtIHJlZ2lzdGVyZWRfZGF0YXNldF9uYW1lOiBOYW1lIG9mIGRhdGFzZXQgcmVnaXN0ZXJlZCBpbiBBenVyZSBNTC4KICAgIDpwYXJhbSBsYWJlbF9jb2x1bW5fbmFtZTogICAgICAgTmFtZSBvZiB0YXJnZXQgY29sdW1uIGluIGRhdGFzZXQuCiAgICA6cGFyYW0gYXV0b21sX3NldHRpbmdzOiAgICAgICAgIEpTT04gc3RyaW5nIG9mIGFsbCBBenVyZSBBdXRvTUwgc2V0dGluZ3MuCiAgICA6cGFyYW0gdHJhaW5pbmdfc2V0OiAgICAgICAgICAgIFRyYWluaW5nIHNldCB0byBsb2cgd2l0aCBtb2RlbC4gRm9yIG1vZGVsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vbml0b3JpbmcgaW50ZWdyYXRpb24uCiAgICA6cGFyYW0gc2hvd19vdXRwdXQ6ICAgICAgICAgICAgIERpc3BsYXlpbmcgQXp1cmUgbG9ncy4KICAgIDpwYXJhbSBzYXZlX25fbW9kZWxzOiAgICAgICAgICAgSG93IG1hbnkgb2YgdGhlIHRvcCBwZXJmb3JtaW5nIG1vZGVscyB0byBsb2cuCiAgICAiIiIKICAgICMgTG9hZGluZyB3b3Jrc3BhY2UgaWYgbm90IHByb3ZpZGVkOgogICAgd29ya3NwYWNlID0gX2xvYWRfd29ya3NwYWNlKGNvbnRleHQpCgogICAgIyBTZXR1cCBleHBlcmltZW50OgogICAgY29udGV4dC5sb2dnZXIuaW5mbygiU2V0dGluZyB1cCBleHBlcmltZW50IHBhcmFtZXRlcnMiKQogICAgZGF0YXNldCA9IERhdGFzZXQuZ2V0X2J5X25hbWUod29ya3NwYWNlLCBuYW1lPXJlZ2lzdGVyZWRfZGF0YXNldF9uYW1lKQogICAgYXV0b21sX3NldHRpbmdzID0gYXV0b21sX3NldHRpbmdzCiAgICBhdXRvbWxfY29uZmlnID0gQXV0b01MQ29uZmlnKAogICAgICAgIGNvbXB1dGVfdGFyZ2V0PWNvbXB1dGVfdGFyZ2V0LAogICAgICAgIHRyYWluaW5nX2RhdGE9ZGF0YXNldCwKICAgICAgICB2ZXJib3NpdHk9bG9nZ2luZy5JTkZPLAogICAgICAgIGxhYmVsX2NvbHVtbl9uYW1lPWxhYmVsX2NvbHVtbl9uYW1lLAogICAgICAgICoqYXV0b21sX3NldHRpbmdzLAogICAgKQoKICAgICMgUnVuIGV4cGVyaW1lbnQgb24gQXp1cmVNTDoKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIlN1Ym1pdHRpbmcgYW5kIHJ1bm5pbmcgZXhwZXJpbWVudCIpCiAgICByZW1vdGVfcnVuID0gZXhwZXJpbWVudC5zdWJtaXQoYXV0b21sX2NvbmZpZykKICAgIHJlbW90ZV9ydW4ud2FpdF9mb3JfY29tcGxldGlvbihzaG93X291dHB1dD1zaG93X291dHB1dCkKCiAgICAjIEdldCB0b3AgTiBydW5zIHRvIGxvZzoKICAgIHRvcF9ydW5zID0gX2dldF90b3Bfbl9ydW5zKAogICAgICAgIHJlbW90ZV9ydW49cmVtb3RlX3J1biwKICAgICAgICBuPXNhdmVfbl9tb2RlbHMsCiAgICAgICAgcHJpbWFyeV9tZXRyaWM9YXV0b21sX3NldHRpbmdzWyJwcmltYXJ5X21ldHJpYyJdLAogICAgKQoKICAgICMgR2V0IHRyYWluaW5nIHNldCB0byBsb2cgd2l0aCBtb2RlbDoKICAgIGZlYXR1cmVfdmVjdG9yID0gTm9uZQogICAgaWYgdHJhaW5pbmdfc2V0Lm1ldGEgYW5kIHRyYWluaW5nX3NldC5tZXRhLmtpbmQgPT0gT2JqZWN0S2luZC5mZWF0dXJlX3ZlY3RvcjoKICAgICAgICBmZWF0dXJlX3ZlY3RvciA9IHRyYWluaW5nX3NldC5tZXRhLnVyaQogICAgdHJhaW5pbmdfc2V0ID0gdHJhaW5pbmdfc2V0LmFzX2RmKCkKCiAgICAjIFJlZ2lzdGVyLCBkb3dubG9hZCwgYW5kIGxvZyBtb2RlbHM6CiAgICBmb3IgaSwgcnVuIGluIGVudW1lcmF0ZSh0b3BfcnVucyk6CiAgICAgICAgIyBSZWdpc3RlciBtb2RlbDoKICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCJSZWdpc3RlcmluZyBtb2RlbCIpCiAgICAgICAgbW9kZWwgPSBydW4ucmVnaXN0ZXJfbW9kZWwoCiAgICAgICAgICAgIG1vZGVsX25hbWU9cmVnaXN0ZXJfbW9kZWxfbmFtZSwgbW9kZWxfcGF0aD0ib3V0cHV0cy9tb2RlbC5wa2wiCiAgICAgICAgKQogICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oCiAgICAgICAgICAgIGYiUmVnaXN0ZXJlZCBtb2RlbCB3aXRoIG5hbWUgJ3ttb2RlbC5uYW1lfScsIGlkICd7bW9kZWwuaWR9JywgdmVyc2lvbiAne21vZGVsLnZlcnNpb259JyIKICAgICAgICApCgogICAgICAgICMgRG93bmxvYWQgbW9kZWwgbG9jYWxseToKICAgICAgICBkb3dubG9hZF9tb2RlbCgKICAgICAgICAgICAgY29udGV4dD1jb250ZXh0LAogICAgICAgICAgICBtb2RlbF9uYW1lPXJlZ2lzdGVyX21vZGVsX25hbWUsCiAgICAgICAgICAgIG1vZGVsX3ZlcnNpb249bW9kZWwudmVyc2lvbiwKICAgICAgICAgICAgdGFyZ2V0X2Rpcj1mIi4ve21vZGVsLnZlcnNpb259IiwKICAgICAgICApCgogICAgICAgIG1ldHJpY3MgPSB7ay5sb3dlcigpOiB2YWwgZm9yIGssIHZhbCBpbiBydW4uZ2V0X21ldHJpY3MoKS5pdGVtcygpfQogICAgICAgIGRlbCBtZXRyaWNzWyJjb25mdXNpb25fbWF0cml4Il0KICAgICAgICBkZWwgbWV0cmljc1siYWNjdXJhY3lfdGFibGUiXQoKICAgICAgICAjIENvbGxlY3QgbW9kZWwgaHlwZXItcGFyYW1ldGVyczoKICAgICAgICBtb2RlbF9ocF9kaWN0ID0gX2dldF9tb2RlbF9ocChydW4pCiAgICAgICAgd2l0aCBjb250ZXh0LmdldF9jaGlsZF9jb250ZXh0KCoqbW9kZWxfaHBfZGljdCkgYXMgY2hpbGQ6CiAgICAgICAgICAgICMgTG9nIG1vZGVsOgogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKAogICAgICAgICAgICAgICAgZiJMb2dnaW5nIHttb2RlbF9ocF9kaWN0Wyd0cmFpbl9jbGFzc19uYW1lJ119IG1vZGVsIHRvIE1MUnVuIgogICAgICAgICAgICApCiAgICAgICAgICAgIGNoaWxkLmxvZ19yZXN1bHRzKG1ldHJpY3MpCiAgICAgICAgICAgIGNoaWxkLmxvZ19tb2RlbCgKICAgICAgICAgICAgICAgICJtb2RlbCIsCiAgICAgICAgICAgICAgICBkYl9rZXk9ZiJtb2RlbHtpfV97bW9kZWxfaHBfZGljdFsndHJhaW5fY2xhc3NfbmFtZSddLmxvd2VyKCl9IiwKICAgICAgICAgICAgICAgIGFydGlmYWN0X3BhdGg9Y29udGV4dC5hcnRpZmFjdF9zdWJwYXRoKCJtb2RlbHMiKSwKICAgICAgICAgICAgICAgIG1ldHJpY3M9bWV0cmljcywKICAgICAgICAgICAgICAgIG1vZGVsX2ZpbGU9ZiJ7bW9kZWwudmVyc2lvbn0vbW9kZWwucGtsIiwKICAgICAgICAgICAgICAgIHRyYWluaW5nX3NldD10cmFpbmluZ19zZXQsCiAgICAgICAgICAgICAgICBsYWJlbF9jb2x1bW49bGFiZWxfY29sdW1uX25hbWUsCiAgICAgICAgICAgICAgICBmZWF0dXJlX3ZlY3Rvcj1mZWF0dXJlX3ZlY3RvciwKICAgICAgICAgICAgICAgIGZyYW1ld29yaz0iQXp1cmVNTCIsCiAgICAgICAgICAgICAgICBhbGdvcml0aG09bW9kZWxfaHBfZGljdC5nZXQoInRyYWluX2NsYXNzX25hbWUiKSwKICAgICAgICAgICAgKQogICAgICAgICAgICBpZiBpID09IDA6CiAgICAgICAgICAgICAgICBjaGlsZC5tYXJrX2FzX2Jlc3QoKQoKCmRlZiBhdXRvbWxfdHJhaW4oCiAgICAjIE1sUnVuCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIHRyYWluaW5nX2RhdGE6IERhdGFJdGVtLAogICAgIyBJbml0IGV4cGVyaW1lbnQgYW5kIGNvbXB1dGUKICAgIGV4cGVyaW1lbnRfbmFtZTogc3RyID0gIiIsCiAgICBjcHVfY2x1c3Rlcl9uYW1lOiBzdHIgPSAiIiwKICAgIHZtX3NpemU6IHN0ciA9ICJTVEFOREFSRF9EMl9WMiIsCiAgICBtYXhfbm9kZXM6IGludCA9IDEsCiAgICAjIFJlZ2lzdGVyIGRhdGFzZXQKICAgIGRhdGFzZXRfbmFtZTogc3RyID0gIiIsCiAgICBkYXRhc2V0X2Rlc2NyaXB0aW9uOiBzdHIgPSAiIiwKICAgIGNyZWF0ZV9uZXdfdmVyc2lvbjogYm9vbCA9IEZhbHNlLAogICAgbGFiZWxfY29sdW1uX25hbWU6IHN0ciA9ICIiLAogICAgIyBTdWJtaXQgdHJhaW5pbmcgam9iCiAgICByZWdpc3Rlcl9tb2RlbF9uYW1lOiBzdHIgPSAiIiwKICAgIHNhdmVfbl9tb2RlbHM6IGludCA9IDEsCiAgICBsb2dfYXp1cmU6IGJvb2wgPSBUcnVlLAogICAgYXV0b21sX3NldHRpbmdzOiBzdHIgPSBOb25lLAopIC0+IE5vbmU6CiAgICAiIiIKICAgIFdob2xlIHRyYWluaW5nIGZsb3cgZm9yIEF6dXJlIEF1dG9NTC4gUmVnaXN0ZXJzIGRhdGFzZXQvZmVhdHVyZSB2ZWN0b3IsCiAgICBzdWJtaXRzIHRyYWluaW5nIGpvYiB0byBBenVyZSBBdXRvTUwsIGFuZCBkb3dubG9hZHMgdHJhaW5lZCBtb2RlbAogICAgd2hlbiBjb21wbGV0ZWQuCgogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgICAgICAgTUxSdW4gY29udGV4dC4KCiAgICA6cGFyYW0gZXhwZXJpbWVudF9uYW1lOiAgICAgICBOYW1lIG9mIGV4cGVyaW1lbnQgdG8gY3JlYXRlIGluIEF6dXJlIE1MLgogICAgOnBhcmFtIGNwdV9jbHVzdGVyX25hbWU6ICAgICAgTmFtZSBvZiBBenVyZSBNTCBjb21wdXRlIHRhcmdldC4gQ3JlYXRlZCBpZiBkb2VzIG5vdCBleGlzdC4KICAgIDpwYXJhbSB2bV9zaXplOiAgICAgICAgICAgICAgIEF6dXJlIG1hY2hpbmUgdHlwZSBmb3IgY29tcHV0ZSB0YXJnZXQuCiAgICA6cGFyYW0gbWF4X25vZGVzOiAgICAgICAgICAgICBNYXhpbXVtIG51bWJlciBvZiBjb25jdXJyZW50IGNvbXB1dGUgdGFyZ2V0cy4KCiAgICA6cGFyYW0gZGF0YXNldF9uYW1lOiAgICAgICAgICBOYW1lIG9mIEF6dXJlIGRhdGFzZXQgdG8gcmVnaXN0ZXIuCiAgICA6cGFyYW0gZGF0YXNldF9kZXNjcmlwdGlvbjogICBEZXNjcmlwdGlvbiBvZiBBenVyZSBkYXRhc2V0IHRvIHJlZ2lzdGVyLgogICAgOnBhcmFtIHRyYWluaW5nX2RhdGE6ICAgICAgICAgTUxSdW4gRmVhdHVyZVZlY3RvciBvciBkYXRhc2V0IFVSSSB0byB1cGxvYWQuIFdpbGwgZHJvcAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggYmVmb3JlIHVwbG9hZGluZyB3aGVuIGl0IGlzIGEgRmVhdHVyZVZlY3Rvci4KICAgIDpwYXJhbSBjcmVhdGVfbmV3X3ZlcnNpb246ICAgIFJlZ2lzdGVyIEF6dXJlIGRhdGFzZXQgYXMgbmV3IHZlcnNpb24uIE11c3QgYmUgdXNlZCB3aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZnlpbmcgZGF0YXNldCBzY2hlbWEuCiAgICA6cGFyYW0gbGFiZWxfY29sdW1uX25hbWU6ICAgICBUYXJnZXQgY29sdW1uIGluIGRhdGFzZXQuCgogICAgOnBhcmFtIHJlZ2lzdGVyX21vZGVsX25hbWU6ICAgTmFtZSBvZiBtb2RlbCB0byByZWdpc3RlciBpbiBBenVyZS4KICAgIDpwYXJhbSBzYXZlX25fbW9kZWxzOiAgICAgICAgIEhvdyBtYW55IG9mIHRoZSB0b3AgcGVyZm9ybWluZyBtb2RlbHMgdG8gbG9nLgogICAgOnBhcmFtIGxvZ19henVyZTogICAgICAgICAgICAgRGlzcGxheWluZyBBenVyZSBsb2dzLgogICAgOnBhcmFtIGF1dG9tbF9zZXR0aW5nczogICAgICAgSlNPTiBzdHJpbmcgb2YgYWxsIEF6dXJlIEF1dG9NTCBzZXR0aW5ncy4KICAgICIiIgogICAgaWYgbm90IGF1dG9tbF9zZXR0aW5nczoKICAgICAgICBhdXRvbWxfc2V0dGluZ3MgPSB7CiAgICAgICAgICAgICJ0YXNrIjogImNsYXNzaWZpY2F0aW9uIiwKICAgICAgICAgICAgImRlYnVnX2xvZyI6ICJhdXRvbWxfZXJyb3JzLmxvZyIsCiAgICAgICAgICAgICMgImV4cGVyaW1lbnRfZXhpdF9zY29yZSI6IDAuOSwKICAgICAgICAgICAgImVuYWJsZV9lYXJseV9zdG9wcGluZyI6IEZhbHNlLAogICAgICAgICAgICAiYWxsb3dlZF9tb2RlbHMiOiBbIkxvZ2lzdGljUmVncmVzc2lvbiIsICJTR0QiLCAiU1ZNIl0sCiAgICAgICAgICAgICJpdGVyYXRpb25zIjogMywKICAgICAgICAgICAgIml0ZXJhdGlvbl90aW1lb3V0X21pbnV0ZXMiOiAyLAogICAgICAgICAgICAibWF4X2NvbmN1cnJlbnRfaXRlcmF0aW9ucyI6IDIsCiAgICAgICAgICAgICJtYXhfY29yZXNfcGVyX2l0ZXJhdGlvbiI6IC0xLAogICAgICAgICAgICAibl9jcm9zc192YWxpZGF0aW9ucyI6IDUsCiAgICAgICAgICAgICJwcmltYXJ5X21ldHJpYyI6ICJhY2N1cmFjeSIsCiAgICAgICAgICAgICJmZWF0dXJpemF0aW9uIjogIm9mZiIsCiAgICAgICAgICAgICJtb2RlbF9leHBsYWluYWJpbGl0eSI6IEZhbHNlLAogICAgICAgICAgICAiZW5hYmxlX3ZvdGluZ19lbnNlbWJsZSI6IEZhbHNlLAogICAgICAgICAgICAiZW5hYmxlX3N0YWNrX2Vuc2VtYmxlIjogRmFsc2UsCiAgICAgICAgfQoKICAgICMgSW5pdCBleHBlcmltZW50IGFuZCBjb21wdXRlCiAgICB3b3Jrc3BhY2UsIGV4cGVyaW1lbnQgPSBfaW5pdF9leHBlcmltZW50KAogICAgICAgIGNvbnRleHQ9Y29udGV4dCwgZXhwZXJpbWVudF9uYW1lPWV4cGVyaW1lbnRfbmFtZQogICAgKQoKICAgIGNvbXB1dGVfdGFyZ2V0ID0gaW5pdF9jb21wdXRlKAogICAgICAgIGNvbnRleHQ9Y29udGV4dCwKICAgICAgICBjcHVfY2x1c3Rlcl9uYW1lPWNwdV9jbHVzdGVyX25hbWUsCiAgICAgICAgdm1fc2l6ZT12bV9zaXplLAogICAgICAgIG1heF9ub2Rlcz1tYXhfbm9kZXMsCiAgICApCgogICAgIyBSZWdpc3RlciBkYXRhc2V0CiAgICByZWdpc3Rlcl9kYXRhc2V0KAogICAgICAgIGNvbnRleHQ9Y29udGV4dCwKICAgICAgICBkYXRhc2V0X25hbWU9ZGF0YXNldF9uYW1lLAogICAgICAgIGRhdGFzZXRfZGVzY3JpcHRpb249ZGF0YXNldF9kZXNjcmlwdGlvbiwKICAgICAgICBkYXRhPXRyYWluaW5nX2RhdGEsCiAgICAgICAgY3JlYXRlX25ld192ZXJzaW9uPWNyZWF0ZV9uZXdfdmVyc2lvbiwKICAgICkKCiAgICAjIFN1Ym1pdCB0cmFpbmluZyBqb2IKICAgIHN1Ym1pdF90cmFpbmluZ19qb2IoCiAgICAgICAgY29udGV4dCwKICAgICAgICBleHBlcmltZW50PWV4cGVyaW1lbnQsCiAgICAgICAgY29tcHV0ZV90YXJnZXQ9Y29tcHV0ZV90YXJnZXQsCiAgICAgICAgcmVnaXN0ZXJfbW9kZWxfbmFtZT1yZWdpc3Rlcl9tb2RlbF9uYW1lLAogICAgICAgIHJlZ2lzdGVyZWRfZGF0YXNldF9uYW1lPWRhdGFzZXRfbmFtZSwKICAgICAgICBsYWJlbF9jb2x1bW5fbmFtZT1sYWJlbF9jb2x1bW5fbmFtZSwKICAgICAgICBhdXRvbWxfc2V0dGluZ3M9YXV0b21sX3NldHRpbmdzLAogICAgICAgIHRyYWluaW5nX3NldD10cmFpbmluZ19kYXRhLAogICAgICAgIHNob3dfb3V0cHV0PWxvZ19henVyZSwKICAgICAgICBzYXZlX25fbW9kZWxzPXNhdmVfbl9tb2RlbHMsCiAgICApCg==
    commands: []
    code_origin: https://github.com/mlrun/functions.git#8c7ee60df2a6228a8dfdc71aa54152253a9cabe4:C:\Users\yonatans\projects\functions\azureml_utils\azureml_utils.py
    origin_filename: C:\Users\yonatans\projects\functions\azureml_utils\azureml_utils.py
  disable_auto_mount: false
  priority_class_name: ''
  affinity: null
verbose: false
