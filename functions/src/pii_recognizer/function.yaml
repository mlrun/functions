spec:
  build:
    functionSourceCode: IyBDb3B5cmlnaHQgMjAyMyBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAojCiMgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQojIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiMgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiMgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAojIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoKaW1wb3J0IGxvZ2dpbmcKaW1wb3J0IG9zCmltcG9ydCBwYXRobGliCmltcG9ydCB0ZW1wZmlsZQppbXBvcnQgd2FybmluZ3MKZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QKCmltcG9ydCBhbm5vdGF0ZWRfdGV4dC51dGlsIGFzIGF0X3V0aWwKaW1wb3J0IG1scnVuCmltcG9ydCBubHRrCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IHByZXNpZGlvX2FuYWx5emVyIGFzIHBhCmltcG9ydCBwcmVzaWRpb19hbm9ueW1pemVyIGFzIHByZV9hbm95bWl6ZXIKZnJvbSBwcmVzaWRpb19hbm9ueW1pemVyLmVudGl0aWVzIGltcG9ydCBPcGVyYXRvckNvbmZpZwpmcm9tIHRxZG0gaW1wb3J0IHRxZG0KCnRyeToKICAgIGltcG9ydCBmbGFpciBhcyBmbApleGNlcHQgTW9kdWxlTm90Rm91bmRFcnJvcjoKICAgIHByaW50KCJGbGFpciBpcyBub3QgaW5zdGFsbGVkIikKCiMgVGhlcmUgaXMgYSBjb25mbGljdCBiZXR3ZWVuIFJ1c3QtYmFzZWQgdG9rZW5pemVycycgcGFyYWxsZWwgcHJvY2Vzc2luZwojIGFuZCBQeXRob24ncyBmb3JrIG9wZXJhdGlvbnMgZHVyaW5nIG11bHRpcHJvY2Vzc2luZy4gVG8gYXZvaWQgdGhpcywgd2UgbmVlZAojIHRoZSBmb2xsb3dpbmcgdHdvIGxpbmVzCgpvcy5lbnZpcm9uWyJUT0tFTklaRVJTX1BBUkFMTEVMSVNNIl0gPSAiZmFsc2UiCndhcm5pbmdzLmZpbHRlcndhcm5pbmdzKCJpZ25vcmUiKQoKbG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoInBpaS1yZWNvZ25pemVyIikKCgojIEFkZCB0aGUgY29uc3RhbnQgY2xhc3NlcyBvZiBNb2RlbHMgYW5kIEVudGl0aWVzIHRvIGdvdmVybiB0aGUgd2hvbGUgcGFja2FnZQpjbGFzcyBNb2RlbHM6CiAgICBXSE9MRSA9ICJ3aG9sZSIKICAgIFBBVFRFUk4gPSAicGF0dGVybiIKICAgIFNQQUNZID0gInNwYWN5IgogICAgRkxBSVIgPSAiZmxhaXIiCgoKY2xhc3MgRW50aXRpZXM6CiAgICBDUkVESVRfQ0FSRCA9ICJDUkVESVRfQ0FSRCIKICAgIFNTTiA9ICJTU04iCiAgICBQSE9ORSA9ICJQSE9ORSIKICAgIEVNQUlMID0gIkVNQUlMIgogICAgTE9DQVRJT04gPSAiTE9DQVRJT04iCiAgICBQRVJTT04gPSAiUEVSU09OIgogICAgTlJQID0gIk5SUCIKICAgIE9SR0FOSVpBVElPTiA9ICJPUkdBTklaQVRJT04iCiAgICBEQVRFX1RJTUUgPSAiREFURV9USU1FIgogICAgR1BFID0gKCJHUEUiLCkKICAgIE1BQ19BRERSRVNTID0gIk1BQ19BRERSRVNTIgogICAgVVNfQkFOS19OVU1CRVIgPSAiVVNfQkFOS19OVU1CRVIiCiAgICBJTUVJID0gIklNRUkiCiAgICBUSVRMRSA9ICJUSVRMRSIKICAgIExJQ0VOU0VfUExBVEUgPSAiTElDRU5TRV9QTEFURSIKICAgIFVTX1BBU1NQT1JUID0gIlVTX1BBU1NQT1JUIgogICAgQ1VSUkVOQ1kgPSAiQ1VSUkVOQ1kiCiAgICBST1VUSU5HX05VTUJFUiA9ICJST1VUSU5HX05VTUJFUiIKICAgIFVTX0lUSU4gPSAiVVNfSVRJTiIKICAgIFVTX0JBTktfTlVNQkVSID0gIlVTX0JBTktfTlVNQkVSIgogICAgVVNfRFJJVkVSX0xJQ0VOU0UgPSAiVVNfRFJJVkVSX0xJQ0VOU0UiCiAgICBBR0UgPSAiQUdFIgogICAgUEFTU1dPUkQgPSAiUEFTU1dPUkQiCiAgICBTV0lGVF9DT0RFID0gIlNXSUZUX0NPREUiCgoKY2xhc3MgUGF0dGVyblJlY29nbml6ZXJGYWN0b3J5OgogICAgIiIiCiAgICBGYWN0b3J5IGZvciBjcmVhdGluZyBwYXR0ZXJuIHJlY29nbml6ZXJzLCBpdCBjYW4gYmUgZXh0ZW5kZWQgaW4gdGhlIGZ1dHVyZSB0bwogICAgYWRkIG1vcmUgcmVnZXggcGF0dGVybiBmb3IgZGlmZmVyZW50IGVudGl0aWVzLiBGb3IgdGhlIHBhdHRlcm4gcmVjb2duaXplciB0byB3b3JrLAogICAgd2UgbmVlZCBjb25zdHJ1Y3QgYSBsaXN0IG9mIHJlZ2V4IHBhdHRlcm5zIGZvciBlYWNoIGVudGl0eS4KICAgICIiIgoKICAgIFJFQ09HTklaQUJMRV9FTlRJVElFUyA9IHsKICAgICAgICAiQ1JFRElUX0NBUkQiOiBbcGEuUGF0dGVybigiQ1JFRElUX0NBUkQiLCByIlxiKD86XGRbIC1dKj8pezEzLDE2fVxiIiwgMC41KV0sCiAgICAgICAgIlNTTiI6IFtwYS5QYXR0ZXJuKCJTU04iLCByIlxiXGR7M30tP1xkezJ9LT9cZHs0fVxiIiwgMC41KV0sCiAgICAgICAgIlBIT05FIjogW3BhLlBhdHRlcm4oIlBIT05FIiwgciJcKD9cZHszfVwpP1stLlxzXT9cZHszfVstLlxzXT9cZHs0fSIsIDAuNSldLAogICAgICAgICJFTUFJTCI6IFtwYS5QYXR0ZXJuKCJFTUFJTCIsIHIiXFMrQFxTKyIsIDAuNSldLAogICAgfQoKICAgICMgY3JlYXRlIGEgbGlzdCBvZiBwYXR0ZXJuIHJlY29nbml6ZXJzCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBfY3JlYXRlX3BhdHRlcm5fcmVjb2duaXplcihjbHMpOgogICAgICAgICIiIgogICAgICAgIEZvciBlYWNoIGVudGl0eSwgY3JlYXRlIGEgbGlzdCBvZiBwYXR0ZXJucyB0byByZWNvZ25pemUgaXQKCiAgICAgICAgOnBhcmFtIGNsczogUGF0dGVyblJlY29nbml6ZXJGYWN0b3J5IGNsYXNzCgogICAgICAgIDpyZXR1cm5zOiBMaXN0IG9mIHBhdHRlcm4gcmVjb2duaXplcnMKICAgICAgICAiIiIKCiAgICAgICAgIyBFbnRpdGllcyB0byByZWNvZ25pemUgYW5kIHRoZWlyIHJlZ2V4IHBhdHRlcm5zCgogICAgICAgIHJldHVybiBbCiAgICAgICAgICAgIHBhLlBhdHRlcm5SZWNvZ25pemVyKHN1cHBvcnRlZF9lbnRpdHk9ZW50aXR5LCBwYXR0ZXJucz1wYXR0ZXJuKQogICAgICAgICAgICBmb3IgZW50aXR5LCBwYXR0ZXJuIGluIGNscy5SRUNPR05JWkFCTEVfRU5USVRJRVMuaXRlbXMoKQogICAgICAgIF0KCgpjbGFzcyBDdXN0b21TcGFjeVJlY29nbml6ZXIocGEuTG9jYWxSZWNvZ25pemVyKToKICAgICIiIgogICAgQ3VzdG9tIFNwYWN5IFJlY29nbml6ZXIgZnJvbSBQcmVzaWRpbyBBbmFseXplciB0cmFpbmVkIG9uIFByaXZ5IGRhdGEuCiAgICBUaGUgcHJpdnkgZGF0YSBpcyBnZW5lcmF0ZWQgdXNpbmcgdGhpcyBodHRwczovL2dpdGh1Yi5jb20vcGl4aWUtaW8vcGl4aWUvdHJlZS9tYWluL3NyYy9kYXRhZ2VuL3BpaS9wcml2eQogICAgSXQgY2FuIGJlIHVzZWQgdG8gcmVjb2duaXplIGN1c3RvbSBlbnRpdGllcywgU2luY2Ugd2Ugd2FudCB0byB1c2UgUHJlc2lkaW8ncyBSZWdpc3RyaWVzIHRvIGdlbmVyYXRlIEFuYWx5emVyRW5naW5lLAogICAgaXQgaW5oZXJpdHMgZnJvbSBQcmVzaWRpbyBBbmFseXplcidzIExvY2FsUmVjb2duaXplciBjbGFzcy4KICAgICIiIgoKICAgICMgRW50aXRpZXMgdG8gcmVjb2duaXplCgogICAgUkVDT0dOSVpBQkxFX0VOVElUSUVTID0gewogICAgICAgICJMT0NBVElPTiIsCiAgICAgICAgIlBFUlNPTiIsCiAgICAgICAgIk5SUCIsCiAgICAgICAgIk9SR0FOSVpBVElPTiIsCiAgICAgICAgIkRBVEVfVElNRSIsCiAgICB9CgogICAgIyBEZWZhdWx0IGV4cGxhbmF0aW9uIGZvciB0aGlzIHJlY29nbml6ZXIKCiAgICBfREVGQVVMVF9FWFBMQU5BVElPTiA9ICgKICAgICAgICAiSWRlbnRpZmllZCBhcyB7fSBieSBTcGFjeSdzIE5hbWVkIEVudGl0eSBSZWNvZ25pdGlvbiAoUHJpdnktdHJhaW5lZCkiCiAgICApCgogICAgIyBMYWJlbCBncm91cHMgdG8gY2hlY2sKCiAgICBfREVGQVVMVF9DSEVDS19MQUJFTF9HUk9VUFMgPSBbCiAgICAgICAgKHsiTE9DQVRJT04ifSwgeyJMT0MiLCAiTE9DQVRJT04iLCAiU1RSRUVUX0FERFJFU1MiLCAiQ09PUkRJTkFURSJ9KSwKICAgICAgICAoeyJQRVJTT04ifSwgeyJQRVIiLCAiUEVSU09OIn0pLAogICAgICAgICh7Ik5SUCJ9LCB7Ik5PUlAiLCAiTlJQIn0pLAogICAgICAgICh7Ik9SR0FOSVpBVElPTiJ9LCB7Ik9SRyJ9KSwKICAgICAgICAoeyJEQVRFX1RJTUUifSwgeyJEQVRFX1RJTUUifSksCiAgICBdCgogICAgIyBwcmV0cmFpbmVkIG1vZGVsIGZvciB0aGlzIHJlY29nbml6ZXIKCiAgICBfREVGQVVMVF9NT0RFTF9MQU5HVUFHRVMgPSB7CiAgICAgICAgImVuIjogImJla2kvZW5fc3BhY3lfcGlpX2Rpc3RpbGJlcnQiLAogICAgfQoKICAgIF9ERUZBVUxUX1BSRVNJRElPX0VRVUlWQUxFTkNFUyA9IHsKICAgICAgICAiUEVSIjogIlBFUlNPTiIsCiAgICAgICAgIkxPQyI6ICJMT0NBVElPTiIsCiAgICAgICAgIk9SRyI6ICJPUkdBTklaQVRJT04iLAogICAgICAgICJOUk9QIjogIk5SUCIsCiAgICAgICAgIkRBVEVfVElNRSI6ICJEQVRFX1RJTUUiLAogICAgfQoKICAgIGRlZiBfX2luaXRfXygKICAgICAgICBzZWxmLAogICAgICAgIHN1cHBvcnRlZF9sYW5ndWFnZTogc3RyID0gImVuIiwKICAgICAgICBzdXBwb3J0ZWRfZW50aXRpZXM6IGxpc3Rbc3RyXSA9IE5vbmUsCiAgICAgICAgY2hlY2tfbGFiZWxfZ3JvdXBzOiB0dXBsZVtzZXQsIHNldF0gPSBOb25lLAogICAgICAgIGNvbnRleHQ6IGxpc3Rbc3RyXSA9IE5vbmUsCiAgICAgICAgbmVyX3N0cmVuZ3RoOiBmbG9hdCA9IDEsCiAgICApOgogICAgICAgICIiIgogICAgICAgIEluaXRpYWxpemUgU3BhY3kgUmVjb2duaXplci4KCiAgICAgICAgOnBhcmFtIHN1cHBvcnRlZF9sYW5ndWFnZTogTGFuZ3VhZ2UgdG8gdXNlLCBkZWZhdWx0IGlzIEVuZ2xpc2gKICAgICAgICA6cGFyYW0gc3VwcG9ydGVkX2VudGl0aWVzOiBFbnRpdGllcyB0byB1c2UgZm9yIHJlY29nbml0aW9uCiAgICAgICAgOnBhcmFtIGNoZWNrX2xhYmVsX2dyb3VwczogTGFiZWwgZ3JvdXBzIHRvIGNoZWNrIGZvciB0aGUgZW50aXRpZXMKICAgICAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgICBDb250ZXh0IHRvIHVzZSBpZiBhbnkKICAgICAgICA6cGFyYW0gbmVyX3N0cmVuZ3RoOiAgICAgICBEZWZhdWx0IGNvbmZpZGVuY2UgZm9yIE5FUiBwcmVkaWN0aW9uCgogICAgICAgIDpyZXR1cm5zOiBTcGFjeVJlY29nbml6ZXIgb2JqZWN0CiAgICAgICAgIiIiCgogICAgICAgICMgRGVmYXVsdCBjb25maWRlbmNlIGZvciBORVIgcHJlZGljdGlvbgogICAgICAgIHNlbGYubmVyX3N0cmVuZ3RoID0gbmVyX3N0cmVuZ3RoCgogICAgICAgIHNlbGYuY2hlY2tfbGFiZWxfZ3JvdXBzID0gY2hlY2tfbGFiZWxfZ3JvdXBzIG9yIHNlbGYuX0RFRkFVTFRfQ0hFQ0tfTEFCRUxfR1JPVVBTCiAgICAgICAgc3VwcG9ydGVkX2VudGl0aWVzID0gc3VwcG9ydGVkX2VudGl0aWVzIG9yIHNlbGYuUkVDT0dOSVpBQkxFX0VOVElUSUVTCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygKICAgICAgICAgICAgc3VwcG9ydGVkX2VudGl0aWVzPXN1cHBvcnRlZF9lbnRpdGllcywKICAgICAgICAgICAgc3VwcG9ydGVkX2xhbmd1YWdlPXN1cHBvcnRlZF9sYW5ndWFnZSwKICAgICAgICApCgogICAgIyBnZXQgdGhlIHByZXNpZGlvIGV4cGxhbmF0aW9uIGZvciB0aGUgcmVzdWx0CgogICAgZGVmIF9idWlsZF9zcGFjeV9leHBsYW5hdGlvbigKICAgICAgICBzZWxmLCBvcmlnaW5hbF9zY29yZTogZmxvYXQsIGV4cGxhbmF0aW9uOiBzdHIKICAgICkgLT4gcGEuQW5hbHlzaXNFeHBsYW5hdGlvbjoKICAgICAgICAiIiIKICAgICAgICBDcmVhdGUgZXhwbGFuYXRpb24gZm9yIHdoeSB0aGlzIHJlc3VsdCB3YXMgZGV0ZWN0ZWQuCgogICAgICAgIDpwYXJhbSBvcmlnaW5hbF9zY29yZTogU2NvcmUgZ2l2ZW4gYnkgdGhpcyByZWNvZ25pemVyCiAgICAgICAgOnBhcmFtIGV4cGxhbmF0aW9uOiAgICBFeHBsYW5hdGlvbiBzdHJpbmcKCiAgICAgICAgOnJldHVybnM6IFByZXNpZGlvIEFuYWx5c2lzRXhwbGFuYXRpb24gb2JqZWN0CiAgICAgICAgIiIiCiAgICAgICAgZXhwbGFuYXRpb24gPSBwYS5BbmFseXNpc0V4cGxhbmF0aW9uKAogICAgICAgICAgICByZWNvZ25pemVyPXNlbGYuX19jbGFzc19fLl9fbmFtZV9fLAogICAgICAgICAgICBvcmlnaW5hbF9zY29yZT1vcmlnaW5hbF9zY29yZSwKICAgICAgICAgICAgdGV4dHVhbF9leHBsYW5hdGlvbj1leHBsYW5hdGlvbiwKICAgICAgICApCiAgICAgICAgcmV0dXJuIGV4cGxhbmF0aW9uCgogICAgIyBtYWluIG1ldGhvZCBmb3IgdGhlIHJlY29nbml6ZXIKICAgIGRlZiBhbmFseXplKHNlbGYsIHRleHQ6IHN0ciwgZW50aXRpZXM6IExpc3Rbc3RyXSwgbmxwX2FydGlmYWN0cz1Ob25lKTogICMgbm9xYSBEMTAyCiAgICAgICAgIiIiCiAgICAgICAgQW5hbHl6ZSB0ZXh0IHVzaW5nIFNwYWN5LgoKICAgICAgICA6cGFyYW0gdGV4dDogICAgICAgICAgVGV4dCB0byBhbmFseXplCiAgICAgICAgOnBhcmFtIGVudGl0aWVzOiAgICAgIEVudGl0aWVzIHRvIGFuYWx5emUKICAgICAgICA6cGFyYW0gbmxwX2FydGlmYWN0czogTkxQIGFydGlmYWN0cyB0byB1c2UKCiAgICAgICAgOnJldHVybnM6IExpc3Qgb2YgUHJlc2lkaW8gUmVjb2duaXplclJlc3VsdCBvYmplY3RzCiAgICAgICAgIiIiCiAgICAgICAgcmVzdWx0cyA9IFtdCiAgICAgICAgaWYgbm90IG5scF9hcnRpZmFjdHM6CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJTa2lwcGluZyBTcGFDeSwgbmxwIGFydGlmYWN0cyBub3QgcHJvdmlkZWQuLi4iKQogICAgICAgICAgICByZXR1cm4gcmVzdWx0cwoKICAgICAgICBuZXJfZW50aXRpZXMgPSBubHBfYXJ0aWZhY3RzLmVudGl0aWVzCgogICAgICAgICMgcmVjb2duaXplIHRoZSBzdXBwb3J0ZWQgZW50aXRpZXMKICAgICAgICBmb3IgZW50aXR5IGluIGVudGl0aWVzOgogICAgICAgICAgICBpZiBlbnRpdHkgbm90IGluIHNlbGYuc3VwcG9ydGVkX2VudGl0aWVzOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZm9yIGVudCBpbiBuZXJfZW50aXRpZXM6CiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5fX2NoZWNrX2xhYmVsKGVudGl0eSwgZW50LmxhYmVsXywgc2VsZi5jaGVja19sYWJlbF9ncm91cHMpOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgIyBzdHJpbmcgb2YgdGhlIGV4cGxhbmF0aW9uIHNheWluZyB0aGUgZW50aXR5IGlzIHJlY29nbml6ZWQgYnkgc3BhY3kKICAgICAgICAgICAgICAgIHRleHR1YWxfZXhwbGFuYXRpb24gPSBzZWxmLl9ERUZBVUxUX0VYUExBTkFUSU9OLmZvcm1hdChlbnQubGFiZWxfKQogICAgICAgICAgICAgICAgZXhwbGFuYXRpb24gPSBzZWxmLl9idWlsZF9zcGFjeV9leHBsYW5hdGlvbigKICAgICAgICAgICAgICAgICAgICBzZWxmLm5lcl9zdHJlbmd0aCwgdGV4dHVhbF9leHBsYW5hdGlvbgogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICMgY3JlYXRlIHRoZSBzdGFuZGFyZCByZXN1bHQgd2l0aCB0aGUgZW50aXR5LCBzdGFydCwgZW5kLCBzY29yZSwgYW5kIGV4cGxhbmF0aW9uCiAgICAgICAgICAgICAgICBzcGFjeV9yZXN1bHQgPSBwYS5SZWNvZ25pemVyUmVzdWx0KAogICAgICAgICAgICAgICAgICAgIGVudGl0eV90eXBlPWVudGl0eSwKICAgICAgICAgICAgICAgICAgICBzdGFydD1lbnQuc3RhcnRfY2hhciwKICAgICAgICAgICAgICAgICAgICBlbmQ9ZW50LmVuZF9jaGFyLAogICAgICAgICAgICAgICAgICAgIHNjb3JlPXNlbGYubmVyX3N0cmVuZ3RoLAogICAgICAgICAgICAgICAgICAgIGFuYWx5c2lzX2V4cGxhbmF0aW9uPWV4cGxhbmF0aW9uLAogICAgICAgICAgICAgICAgICAgIHJlY29nbml0aW9uX21ldGFkYXRhPXsKICAgICAgICAgICAgICAgICAgICAgICAgcGEuUmVjb2duaXplclJlc3VsdC5SRUNPR05JWkVSX05BTUVfS0VZOiBzZWxmLm5hbWUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoc3BhY3lfcmVzdWx0KQoKICAgICAgICByZXR1cm4gcmVzdWx0cwoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBfX2NoZWNrX2xhYmVsKAogICAgICAgIGVudGl0eTogc3RyLCBsYWJlbDogc3RyLCBjaGVja19sYWJlbF9ncm91cHM6IHR1cGxlW3NldCwgc2V0XQogICAgKSAtPiBib29sOgogICAgICAgICIiIgogICAgICAgIENoZWNrIGlmIHRoZSBsYWJlbCBpcyBpbiB0aGUgbGFiZWwgZ3JvdXAuCgogICAgICAgIDpwYXJhbSBlbnRpdHk6ICAgICAgICAgICAgIEVudGl0eSB0byBjaGVjawogICAgICAgIDpwYXJhbSBsYWJlbDogICAgICAgICAgICAgIExhYmVsIHRvIGNoZWNrCiAgICAgICAgOnBhcmFtIGNoZWNrX2xhYmVsX2dyb3VwczogTGFiZWwgZ3JvdXBzIHRvIGNoZWNrCgogICAgICAgIDpyZXR1cm5zOiBUcnVlIGlmIHRoZSBsYWJlbCBpcyBpbiB0aGUgbGFiZWwgZ3JvdXAsIEZhbHNlIG90aGVyd2lzZQogICAgICAgICIiIgogICAgICAgIHJldHVybiBhbnkoCiAgICAgICAgICAgIGVudGl0eSBpbiBlZ3JwIGFuZCBsYWJlbCBpbiBsZ3JwIGZvciBlZ3JwLCBsZ3JwIGluIGNoZWNrX2xhYmVsX2dyb3VwcwogICAgICAgICkKCgojIENsYXNzIHRvIHVzZSBGbGFpciB3aXRoIFByZXNpZGlvIGFzIGFuIGV4dGVybmFsIHJlY29nbml6ZXIuCmNsYXNzIEZsYWlyUmVjb2duaXplcihwYS5FbnRpdHlSZWNvZ25pemVyKToKICAgICIiIgogICAgV3JhcHBlciBmb3IgYSBmbGFpciBtb2RlbCwgaWYgbmVlZGVkIHRvIGJlIHVzZWQgd2l0aGluIFByZXNpZGlvIEFuYWx5emVyLgogICAgVGhpcyBpcyB0byBtYWtlIHN1cmUgdGhlIHJlY29nbml6ZXIgY2FuIGJlIHJlZ2lzdGVyZWQgd2l0aCBQcmVzaWRpbyByZWdpc3RyeS4KICAgICIiIgoKICAgIFJFQ09HTklaQUJMRV9FTlRJVElFUyA9IHsKICAgICAgICAiTE9DQVRJT04iLAogICAgICAgICJQRVJTT04iLAogICAgICAgICJOUlAiLAogICAgICAgICJHUEUiLAogICAgICAgICJPUkdBTklaQVRJT04iLAogICAgICAgICJNQUNfQUREUkVTUyIsCiAgICAgICAgIlVTX0JBTktfTlVNQkVSIiwKICAgICAgICAiSU1FSSIsCiAgICAgICAgIlRJVExFIiwKICAgICAgICAiTElDRU5TRV9QTEFURSIsCiAgICAgICAgIlVTX1BBU1NQT1JUIiwKICAgICAgICAiQ1VSUkVOQ1kiLAogICAgICAgICJST1VUSU5HX05VTUJFUiIsCiAgICAgICAgIlVTX0lUSU4iLAogICAgICAgICJVU19CQU5LX05VTUJFUiIsCiAgICAgICAgIlVTX0RSSVZFUl9MSUNFTlNFIiwKICAgICAgICAiQUdFIiwKICAgICAgICAiUEFTU1dPUkQiLAogICAgICAgICJTV0lGVF9DT0RFIiwKICAgIH0KCiAgICAjIFRoaXMgaXMgdXNlZCB0byBjb25zdHJ1Y3QgdGhlIGV4cGxhbmF0aW9uIGZvciB0aGUgcmVzdWx0CgogICAgX0RFRkFVTFRfRVhQTEFOQVRJT04gPSAiSWRlbnRpZmllZCBhcyB7fSBieSBGbGFpcidzIE5hbWVkIEVudGl0eSBSZWNvZ25pdGlvbiIKCiAgICBfREVGQVVMVF9DSEVDS19MQUJFTF9HUk9VUFMgPSBbCiAgICAgICAgKHsiTE9DQVRJT04ifSwgeyJMT0MiLCAiTE9DQVRJT04iLCAiU1RSRUVUX0FERFJFU1MiLCAiQ09PUkRJTkFURSJ9KSwKICAgICAgICAoeyJQRVJTT04ifSwgeyJQRVIiLCAiUEVSU09OIn0pLAogICAgICAgICh7Ik5SUCJ9LCB7Ik5PUlAiLCAiTlJQIn0pLAogICAgICAgICh7IkdQRSJ9LCB7IkdQRSJ9KSwKICAgICAgICAoeyJPUkdBTklaQVRJT04ifSwgeyJPUkcifSksCiAgICAgICAgKHsiTUFDX0FERFJFU1MifSwgeyJNQUNfQUREUkVTUyJ9KSwKICAgICAgICAoeyJVU19CQU5LX05VTUJFUiJ9LCB7IlVTX0JBTktfTlVNQkVSIn0pLAogICAgICAgICh7IklNRUkifSwgeyJJTUVJIn0pLAogICAgICAgICh7IlRJVExFIn0sIHsiVElUTEUifSksCiAgICAgICAgKHsiTElDRU5TRV9QTEFURSJ9LCB7IkxJQ0VOU0VfUExBVEUifSksCiAgICAgICAgKHsiVVNfUEFTU1BPUlQifSwgeyJVU19QQVNTUE9SVCJ9KSwKICAgICAgICAoeyJDVVJSRU5DWSJ9LCB7IkNVUlJFTkNZIn0pLAogICAgICAgICh7IlJPVVRJTkdfTlVNQkVSIn0sIHsiUk9VVElOR19OVU1CRVIifSksCiAgICAgICAgKHsiQUdFIn0sIHsiQUdFIn0pLAogICAgICAgICh7IkNVUlJFTkNZIn0sIHsiQ1VSUkVOQ1kifSksCiAgICAgICAgKHsiU1dJRlRfQ09ERSJ9LCB7IlNXSUZUX0NPREUifSksCiAgICAgICAgKHsiVVNfSVRJTiJ9LCB7IlVTX0lUSU4ifSksCiAgICAgICAgKHsiVVNfQkFOS19OVU1CRVIifSwgeyJVU19CQU5LX05VTUJFUiJ9KSwKICAgICAgICAoeyJVU19EUklWRVJfTElDRU5TRSJ9LCB7IlVTX0RSSVZFUl9MSUNFTlNFIn0pLAogICAgXQoKICAgIF9ERUZBVUxUX01PREVMX0xBTkdVQUdFUyA9IHsKICAgICAgICAiZW4iOiAiYmVraS9mbGFpci1waWktZGlzdGlsYmVydCIsCiAgICB9CgogICAgX0RFRkFVTFRfUFJFU0lESU9fRVFVSVZBTEVOQ0VTID0gewogICAgICAgICJQRVIiOiAiUEVSU09OIiwKICAgICAgICAiTE9DIjogIkxPQ0FUSU9OIiwKICAgICAgICAiT1JHIjogIk9SR0FOSVpBVElPTiIsCiAgICAgICAgIk5ST1AiOiAiTlJQIiwKICAgICAgICAiVVJMIjogIlVSTCIsCiAgICAgICAgIlVTX0lUSU4iOiAiVVNfSVRJTiIsCiAgICAgICAgIlVTX1BBU1NQT1JUIjogIlVTX1BBU1NQT1JUIiwKICAgICAgICAiSUJBTl9DT0RFIjogIklCQU5fQ09ERSIsCiAgICAgICAgIklQX0FERFJFU1MiOiAiSVBfQUREUkVTUyIsCiAgICAgICAgIkVNQUlMX0FERFJFU1MiOiAiRU1BSUwiLAogICAgICAgICJVU19EUklWRVJfTElDRU5TRSI6ICJVU19EUklWRVJfTElDRU5TRSIsCiAgICAgICAgIlVTX0JBTktfTlVNQkVSIjogIlVTX0JBTktfTlVNQkVSIiwKICAgIH0KCiAgICBkZWYgX19pbml0X18oCiAgICAgICAgc2VsZiwKICAgICAgICBzdXBwb3J0ZWRfbGFuZ3VhZ2U6IHN0ciA9ICJlbiIsCiAgICAgICAgc3VwcG9ydGVkX2VudGl0aWVzOiBsaXN0W3N0cl0gPSBOb25lLAogICAgICAgIGNoZWNrX2xhYmVsX2dyb3VwczogdHVwbGVbc2V0LCBzZXRdID0gTm9uZSwKICAgICk6CiAgICAgICAgIiIiCiAgICAgICAgSW5pdGlhbGl6ZSB0aGUgRmxhaXJSZWNvZ25pemVyLgoKICAgICAgICA6cGFyYW0gc3VwcG9ydGVkX2xhbmd1YWdlOiBMYW5ndWFnZSB0byB1c2UKICAgICAgICA6cGFyYW0gc3VwcG9ydGVkX2VudGl0aWVzOiBFbnRpdGllcyB0byB1c2UKICAgICAgICA6cGFyYW0gY2hlY2tfbGFiZWxfZ3JvdXBzOiBMYWJlbCBncm91cHMgdG8gY2hlY2sKCiAgICAgICAgOnJldHVybnM6IEZsYWlyUmVjb2duaXplciBvYmplY3QKCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5jaGVja19sYWJlbF9ncm91cHMgPSBjaGVja19sYWJlbF9ncm91cHMgb3Igc2VsZi5fREVGQVVMVF9DSEVDS19MQUJFTF9HUk9VUFMKCiAgICAgICAgc3VwcG9ydGVkX2VudGl0aWVzID0gc3VwcG9ydGVkX2VudGl0aWVzIG9yIHNlbGYuUkVDT0dOSVpBQkxFX0VOVElUSUVTCiAgICAgICAgc2VsZi5tb2RlbCA9IGZsLm1vZGVscy5TZXF1ZW5jZVRhZ2dlci5sb2FkKAogICAgICAgICAgICBzZWxmLl9ERUZBVUxUX01PREVMX0xBTkdVQUdFUy5nZXQoc3VwcG9ydGVkX2xhbmd1YWdlKQogICAgICAgICkKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygKICAgICAgICAgICAgc3VwcG9ydGVkX2VudGl0aWVzPXN1cHBvcnRlZF9lbnRpdGllcywKICAgICAgICAgICAgc3VwcG9ydGVkX2xhbmd1YWdlPXN1cHBvcnRlZF9sYW5ndWFnZSwKICAgICAgICAgICAgbmFtZT0iRmxhaXIgQW5hbHl0aWNzIiwKICAgICAgICApCgogICAgIyBtYWluIG1ldGhvZCBmb3IgdGhlIHJlY29nbml6ZXIKICAgIGRlZiBhbmFseXplKAogICAgICAgIHNlbGYsCiAgICAgICAgdGV4dDogc3RyLAogICAgICAgIGVudGl0aWVzOiBsaXN0W3N0cl0sCiAgICAgICAgbmxwX2FydGlmYWN0czogcGEubmxwX2VuZ2luZS5ObHBBcnRpZmFjdHMgPSBOb25lLAogICAgKSAtPiBsaXN0W3BhLlJlY29nbml6ZXJSZXN1bHRdOgogICAgICAgICIiIgogICAgICAgIEFuYWx5emUgdGV4dCBhbmQgcmV0dXJuIHRoZSByZXN1bHRzLgoKICAgICAgICA6cGFyYW0gdGV4dDogICAgICAgICAgVGhlIHRleHQgZm9yIGFuYWx5c2lzLgogICAgICAgIDpwYXJhbSBlbnRpdGllczogICAgICBUaGUgbGlzdCBvZiBlbnRpdGllcyB0byByZWNvZ25pemUuCiAgICAgICAgOnBhcmFtIG5scF9hcnRpZmFjdHM6IE5vdCB1c2VkIGJ5IHRoaXMgcmVjb2duaXplciBidXQgbmVlZGVkIGZvciB0aGUgaW50ZXJmYWNlLgoKICAgICAgICA6cmV0dXJuczogVGhlIGxpc3Qgb2YgUHJlc2lkaW8gUmVjb2duaXplclJlc3VsdCBjb25zdHJ1Y3RlZCBmcm9tIHRoZSByZWNvZ25pemVkIEZsYWlyIGRldGVjdGlvbnMuCiAgICAgICAgIiIiCgogICAgICAgIHJlc3VsdHMgPSBbXQoKICAgICAgICBzZW50ZW5jZXMgPSBmbC5kYXRhLlNlbnRlbmNlKHRleHQpCiAgICAgICAgc2VsZi5tb2RlbC5wcmVkaWN0KHNlbnRlbmNlcykKCiAgICAgICAgIyBJZiB0aGVyZSBhcmUgbm8gc3BlY2lmaWMgbGlzdCBvZiBlbnRpdGllcywgd2Ugd2lsbCBsb29rIGZvciBhbGwgb2YgaXQuCiAgICAgICAgaWYgbm90IGVudGl0aWVzOgogICAgICAgICAgICBlbnRpdGllcyA9IHNlbGYuc3VwcG9ydGVkX2VudGl0aWVzCgogICAgICAgICMgR28gb3ZlciB0aGUgZW50aXRpZXMgYW5kIGNoZWNrIGlmIHRoZXkgYXJlIGluIHRoZSBzdXBwb3J0ZWQgZW50aXRpZXMgbGlzdC4KICAgICAgICBmb3IgZW50aXR5IGluIGVudGl0aWVzOgogICAgICAgICAgICBpZiBlbnRpdHkgbm90IGluIHNlbGYuc3VwcG9ydGVkX2VudGl0aWVzOgogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICMgR28gb3ZlciB0aGUgc2VudGVuY2VzIGFuZCBjaGVjayBpZiB0aGUgZW50aXR5IGlzIGluIHRoZSBzZW50ZW5jZS4KICAgICAgICAgICAgZm9yIGVudCBpbiBzZW50ZW5jZXMuZ2V0X3NwYW5zKCJuZXIiKToKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9fY2hlY2tfbGFiZWwoCiAgICAgICAgICAgICAgICAgICAgZW50aXR5LCBlbnQubGFiZWxzWzBdLnZhbHVlLCBzZWxmLmNoZWNrX2xhYmVsX2dyb3VwcwogICAgICAgICAgICAgICAgKToKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgICAgICMgSWYgdGhlIGVudGl0eSBpcyBpbiB0aGUgc2VudGVuY2UsIHdlIHdpbGwgYWRkIGl0IHRvIHRoZSByZXN1bHRzLgogICAgICAgICAgICAgICAgdGV4dHVhbF9leHBsYW5hdGlvbiA9IHNlbGYuX0RFRkFVTFRfRVhQTEFOQVRJT04uZm9ybWF0KAogICAgICAgICAgICAgICAgICAgIGVudC5sYWJlbHNbMF0udmFsdWUKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICAjIEJ1aWxkIHRoZSBleHBsYW5hdGlvbiBmb3IgdGhlIHJlc3VsdAogICAgICAgICAgICAgICAgZXhwbGFuYXRpb24gPSBzZWxmLl9idWlsZF9mbGFpcl9leHBsYW5hdGlvbigKICAgICAgICAgICAgICAgICAgICByb3VuZChlbnQuc2NvcmUsIDIpLCB0ZXh0dWFsX2V4cGxhbmF0aW9uCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgZmxhaXJfcmVzdWx0ID0gc2VsZi5fY29udmVydF90b19yZWNvZ25pemVyX3Jlc3VsdChlbnQsIGV4cGxhbmF0aW9uKQoKICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKGZsYWlyX3Jlc3VsdCkKCiAgICAgICAgcmV0dXJuIHJlc3VsdHMKCiAgICBkZWYgX2NvbnZlcnRfdG9fcmVjb2duaXplcl9yZXN1bHQoCiAgICAgICAgc2VsZiwgZW50aXR5OiBmbC5kYXRhLlNwYW4sIGV4cGxhbmF0aW9uOiBzdHIKICAgICkgLT4gcGEuUmVjb2duaXplclJlc3VsdDoKICAgICAgICAiIiIKICAgICAgICBDb252ZXJ0IEZsYWlyIHJlc3VsdCB0byBQcmVzaWRpbyBSZWNvZ25pemVyUmVzdWx0LgoKICAgICAgICA6cGFyYW0gZW50aXR5OiAgICAgIEZsYWlyIGVudGl0eSBvZiBTcGFuCiAgICAgICAgOnBhcmFtIGV4cGxhbmF0aW9uOiBQcmVzaWRpbyBBbmFseXNpc0V4cGxhbmF0aW9uCgogICAgICAgIDpyZXR1cm5zOiBQcmVzaWRpbyBSZWNvZ25pemVyUmVzdWx0CiAgICAgICAgIiIiCgogICAgICAgICMgQ29udmVydCB0aGUgZW50aXR5IHR5cGUgdG8gUHJlc2lkaW8gZW50aXR5IHR5cGUKICAgICAgICBlbnRpdHlfdHlwZSA9IHNlbGYuX0RFRkFVTFRfUFJFU0lESU9fRVFVSVZBTEVOQ0VTLmdldChlbnRpdHkudGFnLCBlbnRpdHkudGFnKQoKICAgICAgICAjIENvbnZlcnQgdGhlIHNjb3JlIHRvIFByZXNpZGlvIHNjb3JlCiAgICAgICAgZmxhaXJfc2NvcmUgPSByb3VuZChlbnRpdHkuc2NvcmUsIDIpCgogICAgICAgICMgQ3JlYXRlIHRoZSBQcmVzaWRpbyBSZWNvZ25pemVyUmVzdWx0IGZyb20gdGhlIEZsYWlyIGVudGl0eQogICAgICAgIGZsYWlyX3Jlc3VsdHMgPSBwYS5SZWNvZ25pemVyUmVzdWx0KAogICAgICAgICAgICBlbnRpdHlfdHlwZT1lbnRpdHlfdHlwZSwKICAgICAgICAgICAgc3RhcnQ9ZW50aXR5LnN0YXJ0X3Bvc2l0aW9uLAogICAgICAgICAgICBlbmQ9ZW50aXR5LmVuZF9wb3NpdGlvbiwKICAgICAgICAgICAgc2NvcmU9ZmxhaXJfc2NvcmUsCiAgICAgICAgICAgIGFuYWx5c2lzX2V4cGxhbmF0aW9uPWV4cGxhbmF0aW9uLAogICAgICAgICkKCiAgICAgICAgcmV0dXJuIGZsYWlyX3Jlc3VsdHMKCiAgICBkZWYgX2J1aWxkX2ZsYWlyX2V4cGxhbmF0aW9uKAogICAgICAgIHNlbGYsIG9yaWdpbmFsX3Njb3JlOiBmbG9hdCwgZXhwbGFuYXRpb246IHN0cgogICAgKSAtPiBwYS5BbmFseXNpc0V4cGxhbmF0aW9uOgogICAgICAgICIiIgogICAgICAgIENyZWF0ZSBleHBsYW5hdGlvbiBmb3Igd2h5IHRoaXMgcmVzdWx0IHdhcyBkZXRlY3RlZC4KCiAgICAgICAgOnBhcmFtIG9yaWdpbmFsX3Njb3JlOiBTY29yZSBnaXZlbiBieSB0aGlzIHJlY29nbml6ZXIKICAgICAgICA6cGFyYW0gZXhwbGFuYXRpb246ICAgIEV4cGxhbmF0aW9uIHN0cmluZwoKICAgICAgICA6cmV0dXJuczogUHJlc2lkaW8gQW5hbHlzaXNFeHBsYW5hdGlvbgogICAgICAgICIiIgoKICAgICAgICAjIENyZWF0ZSB0aGUgUHJlc2lkaW8gQW5hbHlzaXNFeHBsYW5hdGlvbiBmb3IgdGhlIHJlc3VsdAogICAgICAgIGV4cGxhbmF0aW9uID0gcGEuQW5hbHlzaXNFeHBsYW5hdGlvbigKICAgICAgICAgICAgcmVjb2duaXplcj1zZWxmLl9fY2xhc3NfXy5fX25hbWVfXywKICAgICAgICAgICAgb3JpZ2luYWxfc2NvcmU9b3JpZ2luYWxfc2NvcmUsCiAgICAgICAgICAgIHRleHR1YWxfZXhwbGFuYXRpb249ZXhwbGFuYXRpb24sCiAgICAgICAgKQogICAgICAgIHJldHVybiBleHBsYW5hdGlvbgoKICAgICMgc2FuaXR5IGNoZWNrIG9mIHRoZSBlbnRpdHkgYW5kIGxhYmVsIGJlZm9yZSByZWNvZ25pdGlvbgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIF9fY2hlY2tfbGFiZWwoCiAgICAgICAgZW50aXR5OiBzdHIsIGxhYmVsOiBzdHIsIGNoZWNrX2xhYmVsX2dyb3VwczogdHVwbGVbc2V0LCBzZXRdCiAgICApIC0+IGJvb2w6CiAgICAgICAgcmV0dXJuIGFueSgKICAgICAgICAgICAgZW50aXR5IGluIGVncnAgYW5kIGxhYmVsIGluIGxncnAgZm9yIGVncnAsIGxncnAgaW4gY2hlY2tfbGFiZWxfZ3JvdXBzCiAgICAgICAgKQoKCiMgZ2V0IHRoZSBhbmFseXplciBlbmdpbmUgYmFzZWQgb24gdGhlIG1vZGVsCmRlZiBfZ2V0X2FuYWx5emVyX2VuZ2luZSgKICAgIG1vZGVsOiBzdHIgPSBOb25lLCBlbnRpdGllczogbGlzdFtzdHJdID0gTm9uZQopIC0+IHBhLkFuYWx5emVyRW5naW5lOgogICAgIiIiCiAgICBSZXR1cm4gcGEuQW5hbHl6ZXJFbmdpbmUuCgogICAgOnBhcmFtIG1vZGVsOiBUaGUgbW9kZWwgdG8gdXNlLiBDYW4gYmUgInNwYWN5IiwgImZsYWlyIiwgInBhdHRlcm4iIG9yICJ3aG9sZSIuCiAgICA6cGFyYW0gZW50aXRpZXM6IFRoZSBsaXN0IG9mIGVudGl0aWVzIHRvIHVzZS4KCiAgICA6cmV0dXJuczogcGEuQW5hbHl6ZXJFbmdpbmUKICAgICIiIgogICAgIyByZWNvZ25pemVyIHJlZ2lzdHJ5IHRoYXQgY2FuIHN0b3JlIG11bHRpcGxlIHJlY29nbml6ZXJzCiAgICByZWdpc3RyeSA9IHBhLlJlY29nbml6ZXJSZWdpc3RyeSgpCiAgICBpZiBtb2RlbCA9PSBNb2RlbHMuU1BBQ1k6CiAgICAgICAgIyBjdXN0b20gc3BhY3kgcmVjb2duaXplcgogICAgICAgIHNwYWN5X3JlY29nbml6ZXIgPSBDdXN0b21TcGFjeVJlY29nbml6ZXIoKQogICAgICAgICMgYWRkIHRoZSBjdXN0b20gYnVpbGQgc3BhY3kgcmVjb2duaXplcgogICAgICAgIHJlZ2lzdHJ5LmFkZF9yZWNvZ25pemVyKHNwYWN5X3JlY29nbml6ZXIpCiAgICBlbGlmIG1vZGVsID09IE1vZGVscy5GTEFJUjoKICAgICAgICAjIHByZS10cmFpbmVkIGZsYWlyIHJlY29nbml6ZXIKICAgICAgICBmbGFpcl9yZWNvZ25pemVyID0gRmxhaXJSZWNvZ25pemVyKCkKICAgICAgICAjIGFkZCB0aGUgY3VzdG9tIGJ1aWxkIGZsYWlyIHJlY29nbml6ZXIKICAgICAgICByZWdpc3RyeS5hZGRfcmVjb2duaXplcihmbGFpcl9yZWNvZ25pemVyKQogICAgZWxpZiBtb2RlbCA9PSBNb2RlbHMuUEFUVEVSTjoKICAgICAgICAjIGFkZCB0aGUgcGF0dGVybiByZWNvZ25pemVyCiAgICAgICAgcGF0dGVybl9yZWNvZ25pemVyX2ZhY3RvcnkgPSBQYXR0ZXJuUmVjb2duaXplckZhY3RvcnkoKQogICAgICAgIGZvciByZWNvZ25pemVyIGluIHBhdHRlcm5fcmVjb2duaXplcl9mYWN0b3J5Ll9jcmVhdGVfcGF0dGVybl9yZWNvZ25pemVyKCk6CiAgICAgICAgICAgIHJlZ2lzdHJ5LmFkZF9yZWNvZ25pemVyKHJlY29nbml6ZXIpCiAgICBlbGlmIG1vZGVsID09IE1vZGVscy5XSE9MRToKICAgICAgICBzcGFjeV9yZWNvZ25pemVyID0gQ3VzdG9tU3BhY3lSZWNvZ25pemVyKCkKICAgICAgICBmbGFpcl9yZWNvZ25pemVyID0gRmxhaXJSZWNvZ25pemVyKCkKICAgICAgICByZWdpc3RyeS5hZGRfcmVjb2duaXplcihzcGFjeV9yZWNvZ25pemVyKQogICAgICAgIHJlZ2lzdHJ5LmFkZF9yZWNvZ25pemVyKGZsYWlyX3JlY29nbml6ZXIpCiAgICAgICAgIyBhZGQgdGhlIHBhdHRlcm4gcmVjb2duaXplcgogICAgICAgIHBhdHRlcm5fcmVjb2duaXplcl9mYWN0b3J5ID0gUGF0dGVyblJlY29nbml6ZXJGYWN0b3J5KCkKICAgICAgICBmb3IgcmVjb2duaXplciBpbiBwYXR0ZXJuX3JlY29nbml6ZXJfZmFjdG9yeS5fY3JlYXRlX3BhdHRlcm5fcmVjb2duaXplcigpOgogICAgICAgICAgICByZWdpc3RyeS5hZGRfcmVjb2duaXplcihyZWNvZ25pemVyKQogICAgZWxpZiBub3QgbW9kZWwgYW5kIGVudGl0aWVzOgogICAgICAgIGlmIHNldChlbnRpdGllcykgJiBDdXN0b21TcGFjeVJlY29nbml6ZXIuUkVDT0dOSVpBQkxFX0VOVElUSUVTOgogICAgICAgICAgICBzcGFjeV9yZWNvZ25pemVyID0gQ3VzdG9tU3BhY3lSZWNvZ25pemVyKCkKICAgICAgICAgICAgcmVnaXN0cnkuYWRkX3JlY29nbml6ZXIoc3BhY3lfcmVjb2duaXplcikKICAgICAgICBpZiBzZXQoZW50aXRpZXMpICYgRmxhaXJSZWNvZ25pemVyLlJFQ09HTklaQUJMRV9FTlRJVElFUzoKICAgICAgICAgICAgZmxhaXJfcmVjb2duaXplciA9IEZsYWlyUmVjb2duaXplcigpCiAgICAgICAgICAgIHJlZ2lzdHJ5LmFkZF9yZWNvZ25pemVyKGZsYWlyX3JlY29nbml6ZXIpCiAgICAgICAgIyBhZGQgdGhlIHBhdHRlcm4gcmVjb2duaXplcgogICAgICAgIGlmIHNldChlbnRpdGllcykgJiAoc2V0KFBhdHRlcm5SZWNvZ25pemVyRmFjdG9yeS5SRUNPR05JWkFCTEVfRU5USVRJRVMua2V5cygpKSk6CiAgICAgICAgICAgIHBhdHRlcm5fcmVjb2duaXplcl9mYWN0b3J5ID0gUGF0dGVyblJlY29nbml6ZXJGYWN0b3J5KCkKICAgICAgICAgICAgZm9yIHJlY29nbml6ZXIgaW4gcGF0dGVybl9yZWNvZ25pemVyX2ZhY3RvcnkuX2NyZWF0ZV9wYXR0ZXJuX3JlY29nbml6ZXIoKToKICAgICAgICAgICAgICAgIHJlZ2lzdHJ5LmFkZF9yZWNvZ25pemVyKHJlY29nbml6ZXIpCiAgICBlbHNlOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCiAgICAgICAgICAgICJhcmd1bWVudCBvZiBtb2RlbCBhbmQgZW50aXRpZXMgY2FuIG5vdCBiZSBOb25lIGF0IHRoZSBzYW1lIHRpbWUiCiAgICAgICAgKQogICAgYW5hbHl6ZXIgPSBwYS5BbmFseXplckVuZ2luZSgKICAgICAgICByZWdpc3RyeT1yZWdpc3RyeSwKICAgICAgICBzdXBwb3J0ZWRfbGFuZ3VhZ2VzPVsiZW4iXSwKICAgICkKCiAgICBzdXBwb3J0ZWRfZW50aXRpZXMgPSBhbmFseXplci5nZXRfc3VwcG9ydGVkX2VudGl0aWVzKCkKCiAgICBpZiBlbnRpdGllcyBhbmQgbm90IGFsbChpdGVtIGluIHN1cHBvcnRlZF9lbnRpdGllcyBmb3IgaXRlbSBpbiBlbnRpdGllcyk6CiAgICAgICAgbm90X3N1cHBvcnRlZF9lbnRpdGllcyA9IFsKICAgICAgICAgICAgaXRlbSBmb3IgaXRlbSBpbiBlbnRpdGllcyBpZiBpdGVtIG5vdCBpbiBzdXBwb3J0ZWRfZW50aXRpZXMKICAgICAgICBdCiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigKICAgICAgICAgICAgZiJUaGUgY3VycmVudCBtb2RlbCB7bW9kZWx9IGRvZXNuJ3Qgc3VwcG9ydCB0aGUgZm9sbG93aW5nIGVudGl0aWVzOiB7bm90X3N1cHBvcnRlZF9lbnRpdGllc30uICIKICAgICAgICAgICAgZiJTdXBwb3J0ZWQgZW50aXRpZXMgYXJlOiB7c3VwcG9ydGVkX2VudGl0aWVzfSIKICAgICAgICApCiAgICByZXR1cm4gYW5hbHl6ZXIKCgpkZWYgX2dldF9hbm9ueW1pemVyX2VuZ2luZSgpIC0+IHByZV9hbm95bWl6ZXIuQW5vbnltaXplckVuZ2luZToKICAgICIiIgogICAgUmV0dXJuIEFub255bWl6ZXJFbmdpbmUuCgogICAgOnJldHVybnM6IFRoZSBBbm9ueW1pemVyRW5naW5lLgogICAgIiIiCiAgICByZXR1cm4gcHJlX2Fub3ltaXplci5Bbm9ueW1pemVyRW5naW5lKCkKCgpkZWYgX2Fub255bWl6ZSgKICAgIHRleHQ6IHN0ciwKICAgIGFuYWx5emVfcmVzdWx0czogbGlzdFtwYS5SZWNvZ25pemVyUmVzdWx0XSwKICAgIGVudGl0eV9vcGVyYXRvcl9tYXA6IGRpY3QgPSBOb25lLAogICAgaXNfZnVsbF90ZXh0OiBib29sID0gVHJ1ZSwKKSAtPiBzdHI6CiAgICAiIiIKICAgIEFub255bWl6ZSBpZGVudGlmaWVkIGlucHV0IHVzaW5nIFByZXNpZGlvIEFib255bWl6ZXIuCgogICAgOnBhcmFtIHRleHQ6ICAgICAgICAgICAgICAgIFRoZSB0ZXh0IGZvciBhbmFseXNpcy4KICAgIDpwYXJhbSBhbmFseXplX3Jlc3VsdHM6ICAgICBUaGUgbGlzdCBvZiBQcmVzaWRpbyBSZWNvZ25pemVyUmVzdWx0IGNvbnN0cnVjdGVkIGZyb20KICAgIDpwYXJhbSBlbnRpdHlfb3BlcmF0b3JfbWFwOiBUaGUgZW50aXR5X29wZXJhdG9yX21hcCBpcyBhIGRpY3Rpb25hcnkgdGhhdCBtYXBzIGVudGl0eSB0byBvcGVyYXRvciBuYW1lIGFuZCBvcGVyYXRvciBwYXJhbXMuCiAgICA6cGFyYW0gaXNfZnVsbF90ZXh0OiAgICAgICAgV2hldGhlciB0aGUgdGV4dCBpcyBmdWxsIHRleHQgb3Igbm90LgoKICAgIDpyZXR1cm5zOiBUaGUgYW5vbnltaXplZCB0ZXh0LgogICAgIiIiCiAgICBpZiBub3QgdGV4dDoKICAgICAgICByZXR1cm4gIiIKCiAgICBhbm9ueW1pemVyX2VuZ2luZSA9IF9nZXRfYW5vbnltaXplcl9lbmdpbmUoKQogICAgaWYgbm90IGVudGl0eV9vcGVyYXRvcl9tYXA6CiAgICAgICAgb3BlcmF0b3JzID0gTm9uZQogICAgZWxzZToKICAgICAgICAjIENyZWF0ZSBPcGVyYXRvckNvbmZpZyBiYXNlZCBvbiB0aGUgZW50aXR5X29wZXJhdG9yX21hcAogICAgICAgIG9wZXJhdG9ycyA9IHsKICAgICAgICAgICAgZW50aXR5OiBPcGVyYXRvckNvbmZpZyhvcGVyYXRvcl9uYW1lLCBvcGVyYXRvcl9wYXJhbXMpCiAgICAgICAgICAgIGZvciBlbnRpdHksIChvcGVyYXRvcl9uYW1lLCBvcGVyYXRvcl9wYXJhbXMpIGluIGVudGl0eV9vcGVyYXRvcl9tYXAuaXRlbXMoKQogICAgICAgIH0KCiAgICBpZiBpc19mdWxsX3RleHQ6CiAgICAgICAgIyBBbm9ueW1pemUgdGhlIGVudGlyZSB0ZXh0CiAgICAgICAgcmV0dXJuIGFub255bWl6ZXJfZW5naW5lLmFub255bWl6ZSgKICAgICAgICAgICAgdGV4dD10ZXh0LCBhbmFseXplcl9yZXN1bHRzPWFuYWx5emVfcmVzdWx0cywgb3BlcmF0b3JzPW9wZXJhdG9ycwogICAgICAgICkudGV4dAogICAgIyBUb2tlbml6ZSB0aGUgdGV4dCB0byBzZW50ZW5jZXMKICAgIHNlbnRlbmNlcyA9IG5sdGsuc2VudF90b2tlbml6ZSh0ZXh0KQogICAgYW5vbnltaXplZF9zZW50ZW5jZXMgPSBbXQogICAgY3VycmVudF9pZHggPSAwCgogICAgIyBGaW5kIHRoZSBzZW50ZW5jZSB0aGF0IGhhcyBwaWkgZW50aXR5CiAgICBmb3Igc2VudGVuY2UgaW4gc2VudGVuY2VzOgogICAgICAgIHN0YXJ0X2lkeCA9IGN1cnJlbnRfaWR4CiAgICAgICAgZW5kX2lkeCA9IHN0YXJ0X2lkeCArIGxlbihzZW50ZW5jZSkKCiAgICAgICAgIyBHZXQgdGhlIGVudGl0aWVzIHRoYXQgYXJlIGluIHRoZSBzZW50ZW5jZSwgdXBkYXRlIGh0ZSBzdGFydF9pZHggYW5kIGVuZF9pZHgKICAgICAgICBzZW50ZW5jZV9yZXN1bHRzID0gWwogICAgICAgICAgICBwYS5SZWNvZ25pemVyUmVzdWx0KAogICAgICAgICAgICAgICAgcmVzdWx0LmVudGl0eV90eXBlLAogICAgICAgICAgICAgICAgc3RhcnQ9cmVzdWx0LnN0YXJ0IC0gc3RhcnRfaWR4LAogICAgICAgICAgICAgICAgZW5kPXJlc3VsdC5lbmQgLSBzdGFydF9pZHgsCiAgICAgICAgICAgICAgICBzY29yZT1yZXN1bHQuc2NvcmUsCiAgICAgICAgICAgICkKICAgICAgICAgICAgZm9yIHJlc3VsdCBpbiBhbmFseXplX3Jlc3VsdHMKICAgICAgICAgICAgaWYgcmVzdWx0LnN0YXJ0ID49IHN0YXJ0X2lkeCBhbmQgcmVzdWx0LmVuZCA8PSBlbmRfaWR4CiAgICAgICAgXQoKICAgICAgICAjIElmIFBJSSBpcyBkZXRlY3RlZAogICAgICAgIGlmIHNlbnRlbmNlX3Jlc3VsdHM6CiAgICAgICAgICAgIGFub255bWl6ZWRfc2VudGVuY2UgPSBhbm9ueW1pemVyX2VuZ2luZS5hbm9ueW1pemUoCiAgICAgICAgICAgICAgICB0ZXh0PXNlbnRlbmNlLCBhbmFseXplcl9yZXN1bHRzPXNlbnRlbmNlX3Jlc3VsdHMsIG9wZXJhdG9ycz1vcGVyYXRvcnMKICAgICAgICAgICAgKS50ZXh0CiAgICAgICAgICAgIGFub255bWl6ZWRfc2VudGVuY2VzLmFwcGVuZChhbm9ueW1pemVkX3NlbnRlbmNlKQoKICAgICAgICBjdXJyZW50X2lkeCA9IGVuZF9pZHgKCiAgICByZXR1cm4gIiAiLmpvaW4oYW5vbnltaXplZF9zZW50ZW5jZXMpCgoKZGVmIF9nZXRfdG9rZW5zKAogICAgdGV4dDogc3RyLCBhbmFseXplX3Jlc3VsdHM6IGxpc3RbcGEuUmVjb2duaXplclJlc3VsdF0sIGlzX2Z1bGw6IGJvb2wgPSBUcnVlCikgLT4gbGlzdFtzdHJdOgogICAgIiIiCiAgICBHZXQgdGhlIGZ1bGwgdG9rZW5zIG9yIG9ubHkgY29udGFpbnMgdGhlIGVudGl0aWVzIHRoYXQgY2FuIGZvcm0gYSBzZW50ZW5jZS4KCiAgICA6cGFyYW0gdGV4dDogICAgICAgICAgICBUaGUgdGV4dCBmb3IgYW5hbHlzaXMuCiAgICA6cGFyYW0gYW5hbHl6ZV9yZXN1bHRzOiBUaGUgbGlzdCBvZiBQcmVzaWRpbyBSZWNvZ25pemVyUmVzdWx0IGNvbnN0cnVjdGVkIGZyb20KICAgIDpwYXJhbSBpc19mdWxsOiAgICAgICAgIFdoZXRoZXIgcmV0dXJuIGZ1bGwgdG9rZW5zIG9yIGp1c3QgdGhlIHRva2VucyB0aGF0IG9ubHkgY29udGFpbnMgdGhlIGVudGl0aWVzIHRoYXQgY2FuIGZvcm0gYSBzZW50ZW5jZS4KCiAgICA6cmV0dXJuczogVGhlIHRva2Vucy4KICAgICIiIgoKICAgIHRva2VucyA9IFtdCiAgICAjIHNvcnQgYnkgc3RhcnQgaW5kZXgKICAgIHJlc3VsdHMgPSBzb3J0ZWQoYW5hbHl6ZV9yZXN1bHRzLCBrZXk9bGFtYmRhIHg6IHguc3RhcnQpCiAgICBmb3IgaSwgcmVzIGluIGVudW1lcmF0ZShyZXN1bHRzKToKICAgICAgICBpZiBpID09IDA6CiAgICAgICAgICAgIHRva2Vucy5hcHBlbmQodGV4dFs6IHJlcy5zdGFydF0pCgogICAgICAgICMgYXBwZW5kIGVudGl0eSB0ZXh0IGFuZCBlbnRpdHkgdHlwZQogICAgICAgIHRva2Vucy5hcHBlbmQoKHRleHRbcmVzLnN0YXJ0IDogcmVzLmVuZF0sIHJlcy5lbnRpdHlfdHlwZSkpCgogICAgICAgICMgaWYgYW5vdGhlciBlbnRpdHkgY29taW5nIGkuZS4gd2UncmUgbm90IGF0IHRoZSBsYXN0IHJlc3VsdHMgZWxlbWVudCwKICAgICAgICAjIGFkZCB0ZXh0IHVwIHRvIG5leHQgZW50aXR5CiAgICAgICAgaWYgaSAhPSBsZW4ocmVzdWx0cykgLSAxOgogICAgICAgICAgICB0b2tlbnMuYXBwZW5kKHRleHRbcmVzLmVuZCA6IHJlc3VsdHNbaSArIDFdLnN0YXJ0XSkKICAgICAgICAjIGlmIG5vIG1vcmUgZW50aXRpZXMgY29taW5nLCBhZGQgYWxsIHJlbWFpbmluZyB0ZXh0CiAgICAgICAgZWxzZToKICAgICAgICAgICAgdG9rZW5zLmFwcGVuZCh0ZXh0W3Jlcy5lbmQgOl0pCgogICAgIyBnZXQgdGhlIHRva2VucyB0aGF0IG9ubHkgY29udGFpbnMgdGhlIGVudGl0aWVzIHRoYXQgY2FuIGZvcm0gYSBzZW50ZW5jZQogICAgcGFydF9hbm5vbnRhdGVkX3Rva2VucyA9IFtdCiAgICBpZiBub3QgaXNfZnVsbDoKICAgICAgICBsYXN0X2VuZF9zZW50ZW5jZSA9IDAKICAgICAgICBmb3IgaSwgdG9rZW4gaW4gZW51bWVyYXRlKHRva2Vucyk6CiAgICAgICAgICAgIGlmIGFueShpdGVtIGluIHRva2VuIGZvciBpdGVtIGluIFsiLiIsICIhIiwgIj8iXSkgYW5kIGFueSgKICAgICAgICAgICAgICAgIHR5cGUoaXRlbSkgaXMgdHVwbGUgZm9yIGl0ZW0gaW4gdG9rZW5zW2xhc3RfZW5kX3NlbnRlbmNlOmldCiAgICAgICAgICAgICk6CiAgICAgICAgICAgICAgICBwYXJ0X2Fubm9udGF0ZWRfdG9rZW5zLmFwcGVuZCh0b2tlbnNbbGFzdF9lbmRfc2VudGVuY2U6aV0pCiAgICAgICAgICAgICAgICBsYXN0X2VuZF9zZW50ZW5jZSA9IGkKICAgICAgICByZXR1cm4gcGFydF9hbm5vbnRhdGVkX3Rva2VucwogICAgcmV0dXJuIHRva2VucwoKCmRlZiBfYW5ub3RhdGUoCiAgICB0ZXh0OiBzdHIsIHN0X2FuYWx5emVfcmVzdWx0czogbGlzdFtwYS5SZWNvZ25pemVyUmVzdWx0XSwgaXNfZnVsbF9odG1sOiBib29sID0gVHJ1ZQopIC0+IGxpc3Rbc3RyXToKICAgICIiIgogICAgQW5ub3RhdGUgaWRlbnRpZmllZCBpbnB1dCB1c2luZyBQcmVzaWRpbyBBbm9ueW1pemVyLgoKICAgIDpwYXJhbSB0ZXh0OiAgICAgICAgICAgICAgIFRoZSB0ZXh0IGZvciBhbmFseXNpcy4KICAgIDpwYXJhbSBzdF9hbmFseXplX3Jlc3VsdHM6IFRoZSBsaXN0IG9mIFByZXNpZGlvIFJlY29nbml6ZXJSZXN1bHQgY29uc3RydWN0ZWQgZnJvbSBhbmFseXNpcy4KICAgIDpwYXJhbSBpc19mdWxsX2h0bWw6ICAgICAgIFdoZXRoZXIgZ2VuZXJhdGUgZnVsbCBodG1sIG9yIG5vdC4KCiAgICA6cmV0dXJuczogVGhlIGxpc3Qgb2YgdG9rZW5zIHdpdGggdGhlIGlkZW50aWZpZWQgZW50aXRpZXMuCgogICAgIiIiCiAgICByZXR1cm4gX2dldF90b2tlbnModGV4dCwgc3RfYW5hbHl6ZV9yZXN1bHRzLCBpc19mdWxsX2h0bWwpCgoKZGVmIF9wcm9jZXNzKAogICAgdGV4dDogc3RyLAogICAgbW9kZWw6IHBhLkFuYWx5emVyRW5naW5lLAogICAgc2NvcmVfdGhyZXNob2xkOiBmbG9hdCwKICAgIGVudGl0aWVzOiBsaXN0W3N0cl0gPSBOb25lLAogICAgZW50aXRpZXNfb3BlcmF0b3JfbWFwOiBkaWN0ID0gTm9uZSwKICAgIGlzX2Z1bGxfdGV4dDogYm9vbCA9IFRydWUsCikgLT4gdHVwbGVbc3RyLCBsaXN0XToKICAgICIiIgogICAgUHJvY2VzcyB0aGUgdGV4dCBvZiBzdHIgdXNpbmcgdGhlIG1vZGVsLgoKICAgIDpwYXJhbSB0ZXh0OiAgICAgICAgICAgICAgICAgIFRleHQgdG8gcHJvY2VzcwogICAgOnBhcmFtIG1vZGVsOiAgICAgICAgICAgICAgICAgTW9kZWwgdG8gdXNlIGZvciBwcm9jZXNzaW5nCiAgICA6cGFyYW0gZW50aXRpZXM6ICAgICAgICAgICAgICBFbnRpdGllcyB0byByZWNvZ25pemUKICAgIDpwYXJhbSBlbnRpdGllc19vcGVyYXRvcl9tYXA6IFRoZSBlbnRpdHlfb3BlcmF0b3JfbWFwIGlzIGEgZGljdGlvbmFyeSB0aGF0IG1hcHMgZW50aXR5IHRvIG9wZXJhdG9yIG5hbWUgYW5kIG9wZXJhdG9yIHBhcmFtcy4KICAgIDpwYXJhbSBzY29yZV90aHJlc2hvbGQ6ICAgICAgIFRoZSBzY29yZSB0aHJlc2hvbGQgdG8gdXNlIGZvciByZWNvZ25pdGlvbgogICAgOnBhcmFtIGlzX2Z1bGxfdGV4dDogICAgICAgICAgV2hldGhlciB0byByZXR1cm4gdGhlIGZ1bGwgdGV4dCBvciBqdXN0IHRoZSBhbm5vdGF0ZWQgdGV4dAoKICAgIDpyZXR1cm5zOiBBIHR1cGxlIG9mOgoKICAgICAgICAgICAgICAqIHRoZSBhbm9ueW1pemVkIHRleHQKICAgICAgICAgICAgICAqIHRoZSBsaXN0IG9mIFByZXNpZGlvIFJlY29nbml6ZXJSZXN1bHQgY29uc3RydWN0ZWQgZnJvbSBhbmFseXNpcwogICAgIiIiCgogICAgIyBnZXQgdGhlIGFuYWx5emVyIGVuZ2luZQogICAgYW5hbHl6ZXIgPSBtb2RlbAoKICAgICMgYW5hbHl6ZSB0aGUgdGV4dCB0aGF0IGNhbiBiZSB1c2VkIGZvciBhbm9ueW1pemF0aW9uCiAgICByZXN1bHRzID0gYW5hbHl6ZXIuYW5hbHl6ZSgKICAgICAgICB0ZXh0PXRleHQsCiAgICAgICAgbGFuZ3VhZ2U9ImVuIiwKICAgICAgICBlbnRpdGllcz1lbnRpdGllcywKICAgICAgICBzY29yZV90aHJlc2hvbGQ9c2NvcmVfdGhyZXNob2xkLAogICAgICAgIHJldHVybl9kZWNpc2lvbl9wcm9jZXNzPVRydWUsCiAgICApCgogICAgIyBhbm9ueW1pemUgdGhlIHRleHQsIHJlcGxhY2UgdGhlIHBpaSBlbnRpdGllcyB3aXRoIHRoZSBsYWJlbHMKICAgIGFub255bWl6ZWRfdGV4dCA9IF9hbm9ueW1pemUodGV4dCwgcmVzdWx0cywgZW50aXRpZXNfb3BlcmF0b3JfbWFwLCBpc19mdWxsX3RleHQpCgogICAgcmV0dXJuIGFub255bWl6ZWRfdGV4dCwgcmVzdWx0cwoKCmRlZiBfZ2V0X3NpbmdsZV9odG1sKAogICAgdGV4dDogc3RyLCByZXN1bHRzOiBsaXN0W3BhLlJlY29nbml6ZXJSZXN1bHRdLCBpc19mdWxsX2h0bWw6IGJvb2wgPSBUcnVlCik6CiAgICAiIiIKICAgIEdlbmVyYXRlIHRoZSBodG1sIGZvciBhIHNpbmdsZSB0eHQgZmlsZS4KCiAgICA6cGFyYW0gdGV4dDogICAgICAgICBUaGUgdGV4dCBmb3IgYW5hbHlzaXMuCiAgICA6cGFyYW0gcmVzdWx0czogICAgICBUaGUgbGlzdCBvZiBQcmVzaWRpbyBSZWNvZ25pemVyUmVzdWx0IGNvbnN0cnVjdGVkIGZyb20gYW5hbHlzaXMuCiAgICA6cGFyYW0gaXNfZnVsbF9odG1sOiBXaGV0aGVyIGdlbmVyYXRlIGZ1bGwgaHRtbCBvciBub3QuCgogICAgOnJldHVybnM6IFRoZSBodG1sIHN0cmluZyBmb3IgYSBzaW5nbGUgdHh0IGZpbGUuCiAgICAiIiIKICAgICMgY29udmVydCB0aGUgcmVzdWx0cyB0byB0b2tlbnMgdG8gZ2VuZXJhdGUgdGhlIGh0bWwKICAgIHRva2VucyA9IF9hbm5vdGF0ZSh0ZXh0LCByZXN1bHRzLCBpc19mdWxsX2h0bWwpCiAgICBodG1sID0gYXRfdXRpbC5nZXRfYW5ub3RhdGVkX2h0bWwoKnRva2VucykKCiAgICAjIGF2b2lkIHRoZSBlcnJvciBkdXJpbmcgcmVuZGVyaW5nIG9mIHRoZSBcbiBpbiB0aGUgaHRtbAogICAgYmFja3NsYXNoX2NoYXIgPSAiXFwiCgogICAgaHRtbF9zdHIgPSBmIjxwPntodG1sLnJlcGxhY2UoJ3tiYWNrc2xhc2hfY2hhcn1uJywgJzxicj4nKX08L3A+IgoKICAgIHJldHVybiBodG1sX3N0cgoKCmRlZiBfZ2V0X3NpbmdsZV9qc29uKHJlc3VsdHM6IGxpc3RbcGEuUmVjb2duaXplclJlc3VsdF0sIGlzX2Z1bGxfcmVwb3J0OiBib29sID0gVHJ1ZSk6CiAgICAiIiIKICAgIEdlbmVyYXRlIHRoZSBqc29uIGZvciBhIHNpbmdsZSB0eHQgZmlsZS4KCiAgICA6cGFyYW0gcmVzdWx0czogICAgICAgIFRoZSBsaXN0IG9mIFByZXNpZGlvIFJlY29nbml6ZXJSZXN1bHQgY29uc3RydWN0ZWQgZnJvbSBhbmFseXNpcy4KICAgIDpwYXJhbSBpc19mdWxsX3JlcG9ydDogV2hldGhlciBnZW5lcmF0ZSBmdWxsIGpzb24gb3Igbm90LgoKICAgIDpyZXR1cm5zOiBUaGUganNvbiBzdHJpbmcgZm9yIGEgc2luZ2xlIHR4dCBmaWxlLgogICAgIiIiCiAgICAjIGdlbmVyYXRlIHRoZSBzdGF0cyByZXBvcnQgaWYgbmVlZGVkCiAgICBpZiBub3QgaXNfZnVsbF9yZXBvcnQ6CiAgICAgICAgc3RhdHMgPSBbXQogICAgICAgICMgYWRkIHRoZSBzaW1wbGlmeSBzdGF0cyBsb2dpYyBoZXJlCiAgICAgICAgZm9yIGl0ZW0gaW4gcmVzdWx0czoKICAgICAgICAgICAgaXRlbS5hbmFseXNpc19leHBsYW5hdGlvbiA9IE5vbmUKICAgICAgICAgICAgc3RhdHMuYXBwZW5kKGl0ZW0pCiAgICBlbHNlOgogICAgICAgIHN0YXRzID0gcmVzdWx0cwoKICAgIHJldHVybiBzdGF0cwoKCmRlZiBfZ2V0X2FsbF9odG1sKAogICAgdHh0X2NvbnRlbnQ6IGRpY3QsCiAgICByZXNfZGljdDogZGljdCwKICAgIGlzX2Z1bGxfaHRtbDogYm9vbCA9IFRydWUsCik6CiAgICAiIiIKICAgIEdlbmVyYXRlIHRoZSBodG1sIGZvciBhbGwgdHh0IGZpbGVzLgoKICAgIDpwYXJhbSB0eHRfY29udGVudDogIFRoZSBkaWN0aW9uYXJ5IG9mIHR4dCBmaWxlIG5hbWUgYW5kIGNvbnRlbnQuCiAgICA6cGFyYW0gcmVzX2RpY3Q6ICAgICBUaGUgZGljdGlvbmFyeSBvZiB0eHQgZmlsZSBuYW1lIGFuZCB0aGUgbGlzdCBvZiBQcmVzaWRpbyBSZWNvZ25pemVyUmVzdWx0IGNvbnN0cnVjdGVkIGZyb20gYW5hbHlzaXMuCiAgICA6cGFyYW0gaXNfZnVsbF9odG1sOiBXaGV0aGVyIGdlbmVyYXRlIGZ1bGwgaHRtbCBvciBub3QuCgogICAgOnJldHVybnM6IFRoZSBodG1sIHN0cmluZyBmb3IgYWxsIHR4dCBmaWxlcy4KCiAgICAiIiIKICAgICMgVGhlc2UgYXJlIHBsYWNlaG9sZGVyIGZvciB0aGUgaHRtbCBzdHJpbmcKICAgIGh0bWxfaW5kZXggPSAiPGh0bWw+PGhlYWQ+PHRpdGxlPkhpZ2hsaWdodGVkIFBpaSBFbnRpdGllczwvdGl0bGU+PC9oZWFkPjxib2R5PjxoMT5IaWdobGlnaHRlZCBQaWkgRW50aXRpZXM8L2gxPjx1bD4iCiAgICBodG1sX2NvbnRlbnQgPSAiIgogICAgZm9yIHR4dF9maWxlLCByZXN1bHRzIGluIHJlc19kaWN0Lml0ZW1zKCk6CiAgICAgICAgdHh0ID0gdHh0X2NvbnRlbnRbdHh0X2ZpbGVdCiAgICAgICAgaHRtbF9pbmRleCArPSBmIjxsaT48YSBocmVmPScje3R4dF9maWxlfSc+e3R4dF9maWxlfTwvYT48L2xpPiIKICAgICAgICBodG1sX2NvbnRlbnQgKz0gZiI8bGk+PGgyPnt0eHRfZmlsZX08L2gyPjxwPntfZ2V0X3NpbmdsZV9odG1sKHR4dCwgcmVzdWx0cywgaXNfZnVsbF9odG1sKX08L3A+PC9saT4iCiAgICBodG1sX2luZGV4ICs9ICI8L3VsPiIKICAgIGh0bWxfcmVzID0gZiJ7aHRtbF9pbmRleH17aHRtbF9jb250ZW50fTwvYm9keT48L2h0bWw+IgoKICAgIHJldHVybiBodG1sX3JlcwoKCmRlZiBfZ2V0X2FsbF9ycHQocmVzX2RpY3Q6IGRpY3QsIGlzX2Z1bGxfcmVwb3J0OiBib29sID0gVHJ1ZSk6CiAgICAiIiIKICAgIEdlbmVyYXRlIHRoZSBzdGF0cyByZXBvcnQgZm9yIGFsbCB0eHQgZmlsZXMuCgogICAgOnBhcmFtIHJlc19kaWN0OiAgICAgICBUaGUgZGljdGlvbmFyeSBvZiB0eHQgZmlsZSBuYW1lIGFuZCB0aGUgbGlzdCBvZiBQcmVzaWRpbyBSZWNvZ25pemVyUmVzdWx0IGNvbnN0cnVjdGVkIGZyb20gYW5hbHlzaXMuCiAgICA6cGFyYW0gaXNfZnVsbF9yZXBvcnQ6IFdoZXRoZXIgZ2VuZXJhdGUgZnVsbCByZXBvcnQgb3Igbm90LgoKICAgIDpyZXR1cm5zOiBUaGUgc3RhdHMgcmVwb3J0IGZvciBhbGwgdHh0IGZpbGVzLgogICAgIiIiCiAgICAjIFRoZXNlIGFyZSBwbGFjZWhvbGRlciBmb3IgdGhlIGpzb24gcmVwb3J0CiAgICBzdGF0c19kaWN0ID0ge30KICAgIGZvciB0eHRfZmlsZSwgcmVzdWx0cyBpbiByZXNfZGljdC5pdGVtcygpOgogICAgICAgIG5ld19zdGF0cyA9IFtdCiAgICAgICAgZm9yIGl0ZW0gaW4gX2dldF9zaW5nbGVfanNvbihyZXN1bHRzLCBpc19mdWxsX3JlcG9ydCk6CiAgICAgICAgICAgIGlmIGlzX2Z1bGxfcmVwb3J0OgogICAgICAgICAgICAgICAgaXRlbS5hbmFseXNpc19leHBsYW5hdGlvbiA9IGl0ZW0uYW5hbHlzaXNfZXhwbGFuYXRpb24udG9fZGljdCgpCiAgICAgICAgICAgICAgICBuZXdfc3RhdHMuYXBwZW5kKGl0ZW0udG9fZGljdCgpKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgdG1wX2RpY3QgPSBpdGVtLnRvX2RpY3QoKQogICAgICAgICAgICAgICAgdG1wX2RpY3QucG9wKCJhbmFseXNpc19leHBsYW5hdGlvbiIpCiAgICAgICAgICAgICAgICB0bXBfZGljdC5wb3AoInJlY29nbml0aW9uX21ldGFkYXRhIikKICAgICAgICAgICAgICAgIG5ld19zdGF0cy5hcHBlbmQodG1wX2RpY3QpCiAgICAgICAgc3RhdHNfZGljdFt0eHRfZmlsZV0gPSBuZXdfc3RhdHMKICAgIHJldHVybiBzdGF0c19kaWN0CgoKZGVmIHJlY29nbml6ZV9waWkoCiAgICBjb250ZXh0OiBtbHJ1bi5NTENsaWVudEN0eCwKICAgIGlucHV0X3BhdGg6IHN0ciB8IHBhdGhsaWIuUGF0aCwKICAgIGh0bWxfa2V5OiBzdHIsCiAgICBzY29yZV90aHJlc2hvbGQ6IGZsb2F0LAogICAgb3V0cHV0X2RpcmVjdG9yeTogc3RyID0gTm9uZSwKICAgIGVudGl0aWVzOiBsaXN0WwogICAgICAgIHN0cgogICAgXSA9IE5vbmUsICAjIExpc3Qgb2YgZW50aXRpZXMgdG8gcmVjb2duaXplLCBkZWZhdWx0IGlzIHJlY29nbml6aW5nIGFsbAogICAgZW50aXR5X29wZXJhdG9yX21hcDogZGljdCA9IE5vbmUsCiAgICBtb2RlbDogc3RyID0gTm9uZSwKICAgIGdlbmVyYXRlX2pzb246IGJvb2wgPSBUcnVlLAogICAgZ2VuZXJhdGVfaHRtbDogYm9vbCA9IFRydWUsCiAgICBpc19mdWxsX3RleHQ6IGJvb2wgPSBUcnVlLAogICAgaXNfZnVsbF9odG1sOiBib29sID0gVHJ1ZSwKICAgIGlzX2Z1bGxfcmVwb3J0OiBib29sID0gVHJ1ZSwKKSAtPiB0dXBsZVtzdHIsIHBkLkRhdGFGcmFtZSwgZGljdCwgZGljdF0gfCB0dXBsZVtzdHIsIHBkLkRhdGFGcmFtZSwgZGljdF06CiAgICAiIiIKICAgIFdhbGsgdGhyb3VnaCB0aGUgaW5wdXQgcGF0aCwgcmVjb2duaXplIFBJSSBpbiB0ZXh0IGFuZCBzdG9yZSB0aGUgYW5vbnltaXplZCB0ZXh0IGluIHRoZSBvdXRwdXQgcGF0aC4KICAgIEdlbmVyYXRlIHRoZSBodG1sIHdpdGggZGlmZmVyZW50IGNvbG9ycyBmb3IgZWFjaCBlbnRpdHksIGpzb24gcmVwb3J0IG9mIHRoZSBleHBsYW5hdGlvbi4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgICAgIFRoZSBNTFJ1biBjb250ZXh0LiB0aGlzIGlzIG5lZWRlZCBmb3IgbG9nIHRoZSBhcnRpZmFjdHMuCiAgICA6cGFyYW0gaW5wdXRfcGF0aDogICAgICAgICAgIFRoZSBpbnB1dCBwYXRoIG9mIHRoZSB0ZXh0IGZpbGVzIG5lZWRzIHRvIGJlIGFuYWx5emVkLgogICAgOnBhcmFtIGh0bWxfa2V5OiAgICAgICAgICAgICBUaGUgaHRtbCBrZXkgZm9yIHRoZSBhcnRpZmFjdC4KICAgIDpwYXJhbSBzY29yZV90aHJlc2hvbGQ6ICAgICAgVGhlIHNjb3JlIHRocmVzaG9sZCB0byBtYXJrIHRoZSByZWNvZ25pdGlvbiBhcyB0cnVzdGVkLgogICAgOnBhcmFtIG91dHB1dF9kaXJlY3Rvcnk6ICAgICBUaGUgb3V0cHV0IGRpcmVjdG9yeSBwYXRoIHRvIHN0b3JlIHRoZSBhbm9ueW1pemVkIHRleHQuCiAgICA6cGFyYW0gZW50aXRpZXM6ICAgICAgICAgICAgIFRoZSBsaXN0IG9mIGVudGl0aWVzIHRvIHJlY29nbml6ZS4KICAgIDpwYXJhbSBlbnRpdHlfb3BlcmF0b3JfbWFwOiAgVGhlIG1hcCBvZiBlbnRpdHkgdG8gb3BlcmF0b3IgKG1hc2ssIHJlZGFjdCwgcmVwbGFjZSwga2VlcCwgaGFzaCwgYW5kIGl0cyBwYXJhbXMpCiAgICA6cGFyYW0gbW9kZWw6ICAgICAgICAgICAgICAgIFRoZSBtb2RlbCB0byB1c2UuIENhbiBiZSAic3BhY3kiLCAiZmxhaXIiLCAicGF0dGVybiIgb3IgIndob2xlIi4KICAgIDpwYXJhbSBnZW5lcmF0ZV9qc29uOiAgICAgICAgV2hldGhlciB0byBnZW5lcmF0ZSB0aGUganNvbiByZXBvcnQgb2YgdGhlIGV4cGxhbmF0aW9uLgogICAgOnBhcmFtIGdlbmVyYXRlX2h0bWw6ICAgICAgICBXaGV0aGVyIHRvIGdlbmVyYXRlIHRoZSBodG1sIHJlcG9ydCBvZiB0aGUgZXhwbGFuYXRpb24uCiAgICA6cGFyYW0gaXNfZnVsbF90ZXh0OiAgICAgICAgIFdoZXRoZXIgdG8gcmV0dXJuIHRoZSBmdWxsIHRleHQgb3Igb25seSB0aGUgbWFza2VkIHRleHQuCiAgICA6cGFyYW0gaXNfZnVsbF9odG1sOiAgICAgICAgIFdoZXRoZXIgdG8gcmV0dXJuIHRoZSBmdWxsIGh0bWwgb3IganVzdCB0aGUgYW5ub3RhdGVkIHRleHQKICAgIDpwYXJhbSBpc19mdWxsX3JlcG9ydDogICAgICAgV2hldGhlciB0byByZXR1cm4gdGhlIGZ1bGwgcmVwb3J0IG9yIGp1c3QgdGhlIHNjb3JlIGFuZCBzdGFydCwgZW5kIGluZGV4CgogICAgOnJldHVybnM6IEEgdHVwbGUgb2Y6CgogICAgICAgICAgICAgICogUGF0aCB0byB0aGUgb3V0cHV0IGRpcmVjdG9yeQogICAgICAgICAgICAgICogVGhlIGpzb24gcmVwb3J0IG9mIHRoZSBleHBsYW5hdGlvbiAoaWYgZ2VuZXJhdGVfanNvbiBpcyBUcnVlKQogICAgICAgICAgICAgICogQSBkaWN0aW9uYXJ5IG9mIGVycm9ycyBmaWxlcyB0aGF0IHdlcmUgbm90IHByb2Nlc3NlZAoKICAgICIiIgoKICAgICMgU2V0IG91dHB1dCBkaXJlY3RvcnkKICAgIGlmIG91dHB1dF9kaXJlY3RvcnkgaXMgTm9uZToKICAgICAgICBvdXRwdXRfZGlyZWN0b3J5ID0gdGVtcGZpbGUubWtkdGVtcCgpCgogICAgIyBDcmVhdGUgdGhlIG91dHB1dCBkaXJlY3Rvcnk6CiAgICBvdXRwdXRfZGlyZWN0b3J5ID0gcGF0aGxpYi5QYXRoKG91dHB1dF9kaXJlY3RvcnkpCiAgICBpZiBub3Qgb3V0cHV0X2RpcmVjdG9yeS5leGlzdHMoKToKICAgICAgICBvdXRwdXRfZGlyZWN0b3J5Lm1rZGlyKHBhcmVudHM9VHJ1ZSwgZXhpc3Rfb2s9VHJ1ZSkKCiAgICB0eHRfZmlsZXNfZGlyZWN0b3J5ID0gcGF0aGxpYi5QYXRoKGlucHV0X3BhdGgpCiAgICBzdWNjZXNzZXMgPSBbXQogICAgZXJyb3JzID0ge30KCiAgICByZXNfZGljdCA9IHt9CiAgICB0eHRfY29udGVudCA9IHt9CiAgICAjIExvYWQgdGhlIG1vZGVsOgogICAgYW5hbHl6ZXIgPSBfZ2V0X2FuYWx5emVyX2VuZ2luZShtb2RlbCwgZW50aXRpZXMpCiAgICBsb2dnZXIuaW5mbygiTW9kZWwgbG9hZGVkIikKICAgICMgR28gb3ZlciB0aGUgdGV4dCBmaWxlcyBpbiB0aGUgaW5wdXQgcGF0aCwgYW5hbHl6ZSBhbmQgYW5vbnltaXplIHRoZW06CiAgICBmb3IgdHh0X2ZpbGUgaW4gdHFkbSgKICAgICAgICBsaXN0KHR4dF9maWxlc19kaXJlY3RvcnkuZ2xvYigiKi50eHQiKSksCiAgICAgICAgZGVzYz0iUHJvY2Vzc2luZyBmaWxlcyIsCiAgICAgICAgdW5pdD0iZmlsZSIsCiAgICApOgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBMb2FkIHRoZSBzdHIgZnJvbSB0aGUgdGV4dCBmaWxlCiAgICAgICAgICAgIHRleHQgPSB0eHRfZmlsZS5yZWFkX3RleHQoKQogICAgICAgICAgICB0eHRfY29udGVudFtzdHIodHh0X2ZpbGUpXSA9IHRleHQKICAgICAgICAgICAgIyBQcm9jZXNzIHRoZSB0ZXh0IHRvIHJlY29naW56ZSB0aGUgcGlpIGVudGl0aWVzIGluIGl0CiAgICAgICAgICAgIGFub255bWl6ZWRfdGV4dCwgcmVzdWx0cyA9IF9wcm9jZXNzKAogICAgICAgICAgICAgICAgdGV4dD10ZXh0LAogICAgICAgICAgICAgICAgbW9kZWw9YW5hbHl6ZXIsCiAgICAgICAgICAgICAgICBlbnRpdGllcz1lbnRpdGllcywKICAgICAgICAgICAgICAgIGVudGl0aWVzX29wZXJhdG9yX21hcD1lbnRpdHlfb3BlcmF0b3JfbWFwLAogICAgICAgICAgICAgICAgc2NvcmVfdGhyZXNob2xkPXNjb3JlX3RocmVzaG9sZCwKICAgICAgICAgICAgICAgIGlzX2Z1bGxfdGV4dD1pc19mdWxsX3RleHQsCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmVzX2RpY3Rbc3RyKHR4dF9maWxlKV0gPSByZXN1bHRzCiAgICAgICAgICAgICMgU3RvcmUgdGhlIGFub255bWl6ZWQgdGV4dCBpbiB0aGUgb3V0cHV0IHBhdGgKICAgICAgICAgICAgb3V0cHV0X2ZpbGUgPSBvdXRwdXRfZGlyZWN0b3J5IC8gZiJ7dHh0X2ZpbGUuc3RlbX0udHh0IgogICAgICAgICAgICBvdXRwdXRfZmlsZS5wYXJlbnQubWtkaXIocGFyZW50cz1UcnVlLCBleGlzdF9vaz1UcnVlKQogICAgICAgICAgICB3aXRoIG9wZW4ob3V0cHV0X2ZpbGUsICJ3IikgYXMgZjoKICAgICAgICAgICAgICAgIGYud3JpdGUoYW5vbnltaXplZF90ZXh0KQogICAgICAgICAgICBzdWNjZXNzZXMuYXBwZW5kKFt0eHRfZmlsZS5uYW1lLCBvdXRwdXRfZmlsZS5uYW1lXSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGVycm9yc1tzdHIodHh0X2ZpbGUpXSA9IHN0cihlKQogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJFcnJvciBwcm9jZXNzaW5nIHt0eHRfZmlsZX06IHtlfSIpCgogICAgc3VjY2Vzc2VzID0gcGQuRGF0YUZyYW1lKAogICAgICAgIHN1Y2Nlc3NlcywKICAgICAgICBjb2x1bW5zPVsib3JpZ2luYWxfZmlsZSIsICJhbm9ueW1pemVkX2ZpbGUiXSwKICAgICkKCiAgICBpZiBnZW5lcmF0ZV9odG1sOgogICAgICAgICMgR2VuZXJhdGUgdGhlIGh0bWwgcmVwb3J0CiAgICAgICAgaHRtbF9yZXMgPSBfZ2V0X2FsbF9odG1sKHR4dF9jb250ZW50LCByZXNfZGljdCwgaXNfZnVsbF9odG1sKQogICAgICAgICMgU3RvcmUgdGhlIGh0bWwgcmVwb3J0IGluIHRoZSBjb250ZXh0CiAgICAgICAgYXJ0aV9odG1sID0gbWxydW4uYXJ0aWZhY3RzLkFydGlmYWN0KGJvZHk9aHRtbF9yZXMsIGZvcm1hdD0iaHRtbCIsIGtleT1odG1sX2tleSkKICAgICAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChhcnRpX2h0bWwpCiAgICBpZiBnZW5lcmF0ZV9qc29uOgogICAgICAgICMgR2VuZXJhdGUgdGhlIGpzb24gcmVwb3J0CiAgICAgICAganNvbl9yZXMgPSBfZ2V0X2FsbF9ycHQocmVzX2RpY3QsIGlzX2Z1bGxfcmVwb3J0KQogICAgICAgIHJldHVybiBzdHIob3V0cHV0X2RpcmVjdG9yeSksIHN1Y2Nlc3NlcywgZXJyb3JzLCBqc29uX3JlcwogICAgcmV0dXJuIHN0cihvdXRwdXRfZGlyZWN0b3J5KSwgc3VjY2Vzc2VzLCBlcnJvcnMK
    origin_filename: ''
    base_image: mlrun/mlrun
    code_origin: ''
    requirements:
    - nltk
    - pandas
    - presidio-anonymizer
    - presidio-analyzer
    - torch
    - flair@git+https://github.com/flairNLP/flair.git@d4ed67bf663e4066517f00397412510d90043653
    - st-annotated-text
    - https://huggingface.co/beki/en_spacy_pii_distilbert/resolve/main/en_spacy_pii_distilbert-any-py3-none-any.whl
  default_handler: recognize_pii
  disable_auto_mount: false
  image: ''
  command: ''
  entry_points:
    analyze:
      has_varargs: false
      outputs:
      - doc: The list of Presidio RecognizerResult constructed from the recognized
          Flair detections.
        type: list[pa.RecognizerResult]
      parameters:
      - name: self
      - name: text
        type: str
        doc: The text for analysis.
      - name: entities
        type: list[str]
        doc: The list of entities to recognize.
      - name: nlp_artifacts
        type: pa.nlp_engine.NlpArtifacts
        doc: Not used by this recognizer but needed for the interface.
        default: null
      doc: Analyze text and return the results.
      name: analyze
      lineno: 381
      has_kwargs: false
    recognize_pii:
      has_varargs: false
      outputs:
      - doc: 'A tuple of:'
        type: tuple[str, pd.DataFrame, dict, dict] | tuple[str, pd.DataFrame, dict]
      parameters:
      - name: context
        type: MLClientCtx
        doc: The MLRun context. this is needed for log the artifacts.
      - name: input_path
        doc: The input path of the text files needs to be analyzed.
      - name: html_key
        type: str
        doc: The html key for the artifact.
      - name: score_threshold
        type: float
        doc: The score threshold to mark the recognition as trusted.
      - name: output_directory
        type: str
        doc: The output directory path to store the anonymized text.
        default: null
      - name: entities
        type: list[str]
        doc: The list of entities to recognize.
        default: null
      - name: entity_operator_map
        type: dict
        doc: The map of entity to operator (mask, redact, replace, keep, hash, and
          its params)
        default: null
      - name: model
        type: str
        doc: The model to use. Can be "spacy", "flair", "pattern" or "whole".
        default: null
      - name: generate_json
        type: bool
        doc: Whether to generate the json report of the explanation.
        default: true
      - name: generate_html
        type: bool
        doc: Whether to generate the html report of the explanation.
        default: true
      - name: is_full_text
        type: bool
        doc: Whether to return the full text or only the masked text.
        default: true
      - name: is_full_html
        type: bool
        doc: Whether to return the full html or just the annotated text
        default: true
      - name: is_full_report
        type: bool
        doc: Whether to return the full report or just the score and start, end index
        default: true
      doc: 'Walk through the input path, recognize PII in text and store the anonymized
        text in the output path.

        Generate the html with different colors for each entity, json report of the
        explanation.'
      name: recognize_pii
      lineno: 845
      has_kwargs: false
  filename: pii_recognizer.py
  description: This function is used to recognize PII in a directory of text files
kind: job
metadata:
  name: pii-recognizer
  tag: ''
  categories:
  - data-preparation
  - NLP
verbose: false
