kind: job
metadata:
  name: sklearn-classifier
  tag: ''
  hash: fee9114a8b0dc29435f9629288caa50a8de6d95c
  project: ''
  labels:
    author: yjb
    stage: development
  categories:
  - models
  - classifier
spec:
  command: ''
  args: []
  image: mlrun/ml-models:0.4.5
  env: []
  default_handler: train_model
  description: ''
  build:
    functionSourceCode: aW1wb3J0IG9zCmltcG9ydCBqc29uCmZyb20gY2xvdWRwaWNrbGUgaW1wb3J0IGR1bXAKCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IHB5YXJyb3cucGFycXVldCBhcyBwcQoKZnJvbSBpbXBvcnRsaWIgaW1wb3J0IGltcG9ydF9tb2R1bGUKCiMgZnJvbSBza2xlYXJuLnByZXByb2Nlc3NpbmcgaW1wb3J0IFN0YW5kYXJkU2NhbGVyCmZyb20gc2tsZWFybi5tb2RlbF9zZWxlY3Rpb24gaW1wb3J0IHRyYWluX3Rlc3Rfc3BsaXQKZnJvbSBza2xlYXJuLm1ldHJpY3MgaW1wb3J0ICgKICAgIHJvY19hdWNfc2NvcmUsCiAgICBmMV9zY29yZSwKICAgIGF1YywKICAgIGF2ZXJhZ2VfcHJlY2lzaW9uX3Njb3JlLAogICAgcm9jX2N1cnZlLAogICAgY29uZnVzaW9uX21hdHJpeCwKKQpmcm9tIHNrbGVhcm4ucHJlcHJvY2Vzc2luZyBpbXBvcnQgbGFiZWxfYmluYXJpemUKCmltcG9ydCBtYXRwbG90bGliLnB5cGxvdCBhcyBwbHQKaW1wb3J0IHNlYWJvcm4gYXMgc25zCgpmcm9tIHllbGxvd2JyaWNrLmNsYXNzaWZpZXIgaW1wb3J0IENvbmZ1c2lvbk1hdHJpeAoKZnJvbSB0eXBpbmcgaW1wb3J0IFVuaW9uCgpmcm9tIG1scnVuLmV4ZWN1dGlvbiBpbXBvcnQgTUxDbGllbnRDdHgKZnJvbSBtbHJ1bi5kYXRhc3RvcmUgaW1wb3J0IERhdGFJdGVtCmZyb20gbWxydW4uYXJ0aWZhY3RzIGltcG9ydCBQbG90QXJ0aWZhY3QKCmltcG9ydCB3YXJuaW5ncwoKd2FybmluZ3Muc2ltcGxlZmlsdGVyKGFjdGlvbj0iaWdub3JlIiwgY2F0ZWdvcnk9RnV0dXJlV2FybmluZykKCgpkZWYgX2djZl9jbGVhcihwbHQpOgogICAgIiIiVXRpbGl0eSB0byBjbGVhciBtYXRwbG90bGliIGZpZ3VyZQoKICAgIFJ1biB0aGlzIGluc2lkZSBldmVyeSBwbG90IG1ldGhvZCBiZWZvcmUgY2FsbGluZyBhbnkgbWF0cGxvdGxpYgogICAgbWV0aG9kcwoKICAgIDpwYXJhbSBwbG90OiAgICBtYXRsb2JsaWIgZmlndXJlIG9iamVjdAogICAgIiIiCiAgICBwbHQuY2xhKCkKICAgIHBsdC5jbGYoKQogICAgcGx0LmNsb3NlKCkKCgpkZWYgX2NyZWF0ZV9jbGFzcyhwa2dfY2xhc3M6IHN0cik6CiAgICAiIiJDcmVhdGUgYSBjbGFzcyBmcm9tIGEgcGFja2FnZS5tb2R1bGUuY2xhc3Mgc3RyaW5nCgogICAgOnBhcmFtIHBrZ19jbGFzczogIGZ1bGwgY2xhc3MgbG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgZS5nLiAic2tsZWFybi5tb2RlbF9zZWxlY3Rpb24uR3JvdXBLRm9sZCIKICAgICIiIgogICAgc3BsaXRzID0gcGtnX2NsYXNzLnNwbGl0KCIuIikKICAgIGNsZmNsYXNzID0gc3BsaXRzWy0xXQogICAgcGtnX21vZHVsZSA9IHNwbGl0c1s6LTFdCiAgICBjbGFzc18gPSBnZXRhdHRyKGltcG9ydF9tb2R1bGUoIi4iLmpvaW4ocGtnX21vZHVsZSkpLCBjbGZjbGFzcykKICAgIHJldHVybiBjbGFzc18KCgpkZWYgX2NyZWF0ZV9mdW5jdGlvbihwa2dfZnVuYzogbGlzdCk6CiAgICAiIiJDcmVhdGUgYSBmdW5jdGlvbiBmcm9tIGEgcGFja2FnZS5tb2R1bGUuZmN1bnRpb24gc3RyaW5nCgogICAgOnBhcmFtIHBrZ19mdW5jOiAgZnVsbCBmdW5jdGlvbiBsb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgIGUuZy4gInNrbGVhcm4uZmVhdHVyZV9zZWxlY3Rpb24uZl9jbGFzc2lmIgogICAgIiIiCiAgICBzcGxpdHMgPSBwa2dfZnVuYy5zcGxpdCgiLiIpCiAgICBwa2dfbW9kdWxlID0gIi4iLmpvaW4oc3BsaXRzWzotMV0pCiAgICBjYl9mbmFtZSA9IHNwbGl0c1stMV0KICAgIHBrZ19tb2R1bGUgPSBfX2ltcG9ydF9fKHBrZ19tb2R1bGUsIGZyb21saXN0PVtjYl9mbmFtZV0pCiAgICBmdW5jdGlvbl8gPSBnZXRhdHRyKHBrZ19tb2R1bGUsIGNiX2ZuYW1lKQogICAgcmV0dXJuIGZ1bmN0aW9uXwoKCmRlZiB0cmFpbl9tb2RlbCgKICAgIGNvbnRleHQ6IE1MQ2xpZW50Q3R4LAogICAgZGF0YV9rZXk6IFVuaW9uW0RhdGFJdGVtLCBzdHJdLAogICAgc2FtcGxlOiBpbnQsCiAgICBsYWJlbF9jb2x1bW46IHN0ciwKICAgIGhvdF9lbmNvZGVfbGFiZWxzOiBib29sID0gRmFsc2UsCiAgICBtb2RlbF9rZXk6IHN0ciA9ICJtb2RlbCIsCiAgICB0ZXN0X3NpemU6IGZsb2F0ID0gMC4wNSwKICAgIHRyYWluX3ZhbF9zcGxpdDogZmxvYXQgPSAwLjc1LAogICAgdGVzdF9zZXRfa2V5OiBzdHIgPSAidGVzdF9zZXQiLAogICAgcm5nOiBpbnQgPSAxLAogICAgbW9kZWxzX2Rpcjogc3RyID0gIm1vZGVscyIsCiAgICBwbG90c19kaXI6IHN0ciA9ICJwbG90cyIsCiAgICBzY29yZV9tZXRob2Q6IHN0ciA9ICJtaWNybyIsCiAgICBjbGFzc19wYXJhbXM6IFVuaW9uW0RhdGFJdGVtLCBkaWN0XSA9IHt9LAogICAgZml0X3BhcmFtczogVW5pb25bRGF0YUl0ZW0sIGRpY3RdID0ge30sCikgLT4gTm9uZToKICAgICIiInRyYWluIGEgY2xhc3NpZmllci4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0gZGF0YV9rZXk6ICAgICAgICAgICgicmF3IikgbmFtZSBvZiByYXcgZGF0YSBmaWxlCiAgICA6cGFyYW0gc2FtcGxlOiAgICAgICAgICAgIFNlbGVjdHMgdGhlIGZpcnN0IG4gcm93cywgb3Igc2VsZWN0IGEgc2FtcGxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0aW5nIGZyb20gdGhlIGZpcnN0LiBJZiBuZWdhdGl2ZSA8LTEsIHNlbGVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhIHJhbmRvbSBzYW1wbGUKICAgIDpwYXJhbSBsYWJlbF9jb2x1bW46ICAgICAgZ3JvdW5kLXRydXRoICh5KSBsYWJlbHMKICAgIDpwYXJhbSBob3RfZW5jb2RlX2xhYmVsczogYmluYXJ5IGVuY29kZSBsYWJlbHMKICAgIDpwYXJhbSBtb2RlbF9rZXk6ICAgICAgICAgKCdtb2RlbCcpIG5hbWUgb2YgbW9kZWwgaW4gYXJ0aWZhY3Qgc3RvcmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyB0byBhIGRpcmVjdG9yeQogICAgOnBhcmFtIHRlc3Rfc2l6ZTogICAgICAgICAoMC4wNSkgdGVzdCBzZXQgc2l6ZQogICAgOnBhcmFtIHRyYWluX3ZhbF9zcGxpdDogICAoMC43NSkgT25jZSB0aGUgdGVzdCBzZXQgaGFzIGJlZW4gcmVtb3ZlZCB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhaW5pbmcgc2V0IGdldHMgdGhpcyBwcm9wb3J0aW9uLgogICAgOnBhcmFtIHRlc3Rfc2V0X2tleTogICAgICBzdG9yZSB0aGUgdGVzdCBkYXRhIHNldCB1bmRlciB0aGlzIGtleSBpbiB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJ0aWZhY3Qgc3RvcmUKICAgIDpwYXJhbSBybmc6ICAgICAgICAgICAgICAgKDEpIHNrbGVhcm4gcm5nIHNlZWQKICAgIDpwYXJhbSBtb2RlbHNfZGlyOiAgICAgICAgbW9kZWxzIHN1YmZvbGRlciBvbiBhcnRpZmFjdCBwYXRoCiAgICA6cGFyYW0gcGxvdHNfZGlyOiAgICAgICAgIHBsb3Qgc3ViZm9sZGVyIG9uIGFydGlmYWN0IHBhdGgKICAgIDpwYXJhbSBzY29yZV9tZXRob2Q6ICAgICAgZm9yIG11bHRpY2xhc3MgY2xhc3NpZmljYXRpb24KICAgIDpwYXJhbSBjbGFzc19wYXJhbXM6ICAgICAgc2Npa2l0LWxlYXJuIGNsYXNzaWZpZXIgcGFyYW1zLCBlaXRoZXIgaW5wdXQgYXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGljdCBvciBEYXRhSXRlbSBmcm9tIGEgcHJlY2VkaW5nIEt1YmVmbG93CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpcGVsaW5lIHN0ZXAuCiAgICA6cGFyYW0gZml0X3BhcmFtczogICAgICAgIHNjaWtpdC1sZWFybiBmaXQgcGFyYW1ldGVycywgZWl0aGVyIGlucHV0IGFzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgZGljdCBvciBEYXRhSXRlbSBmcm9tIGEgcHJlY2VkaW5nIEt1YmVmbG93CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpcGVsaW5lIHN0ZXAKICAgICIiIgoKICAgICMgVE9ETzogdGhpcyBhbmQgb3RoZXIgcGlwZWxpbmUgc2V0dXBzIHNob3VsZCBiZSBkb25lIGVsc2V3aGVyZQogICAgYmFzZV9wYXRoID0gY29udGV4dC5hcnRpZmFjdF9wYXRoCiAgICBvcy5tYWtlZGlycyhiYXNlX3BhdGgsIGV4aXN0X29rPVRydWUpCiAgICBvcy5tYWtlZGlycyhvcy5wYXRoLmpvaW4oYmFzZV9wYXRoLCBtb2RlbHNfZGlyKSwgZXhpc3Rfb2s9VHJ1ZSkKICAgIG9zLm1ha2VkaXJzKG9zLnBhdGguam9pbihiYXNlX3BhdGgsIHBsb3RzX2RpciksIGV4aXN0X29rPVRydWUpCgogICAgIyBleHRyYWN0IGZpbGUgbmFtZSBmcm9tIERhdGFJdGVtCiAgICBzcmNmaWxlcGF0aCA9IHN0cihkYXRhX2tleSkKCiAgICAjIGdldCBhbGwgZGF0YSBvciBhIHNhbXBsZQogICAgaWYgKHNhbXBsZSA9PSAtMSkgb3IgKHNhbXBsZSA+PSAxKToKICAgICAgICAjIGdldCBhbGwgcm93cywgb3IgY29udGlndW91cyBzYW1wbGUgc3RhcnRpbmcgYXQgcm93IDEuCiAgICAgICAgcmF3ID0gcHEucmVhZF90YWJsZShzcmNmaWxlcGF0aCkudG9fcGFuZGFzKCkuZHJvcG5hKCkKICAgICAgICBsYWJlbHMgPSByYXcucG9wKGxhYmVsX2NvbHVtbikKICAgICAgICByYXcgPSByYXcuaWxvY1s6c2FtcGxlLCA6XQogICAgICAgIGxhYmVscyA9IGxhYmVscy5pbG9jWzpzYW1wbGVdCiAgICBlbHNlOgogICAgICAgICMgZ3JhYiBhIHJhbmRvbSBzYW1wbGUKICAgICAgICByYXcgPSBwcS5yZWFkX3RhYmxlKHNyY2ZpbGVwYXRoKS50b19wYW5kYXMoKS5kcm9wbmEoKS5zYW1wbGUoc2FtcGxlICogLTEpCiAgICAgICAgbGFiZWxzID0gcmF3LnBvcChsYWJlbF9jb2x1bW4pCgogICAgIyB0aGlzIHVzZWQgYnkgcGxvdHRpbmcgbWV0aG9kcywKICAgICMgVE9ETzogc2hvdWxkIGJlIHBhcnQgb2YgZGF0YSdzIG1ldGFkYXRhCiAgICBjb250ZXh0LmhlYWRlciA9IHJhdy5jb2x1bW5zLnZhbHVlcwoKICAgICMgZG91YmxlIHNwbGl0IHRvIGdlbmVyYXRlIDMgZGF0YSBzZXRzOiB0cmFpbiwgdmFsaWRhdGlvbiBhbmQgdGVzdAogICAgIyB3aXRoIHh0ZXN0LHl0ZXN0IHNldCBhc2lkZQogICAgIyBUT0RPOiAgZmluZCBhIGJldHRlciBwYWNrYWdlZCBpbXBsZW1lbnRhdGlvbiBvZiBkb3VibGUgc3BsaXQKICAgIHgsIHh0ZXN0LCB5LCB5dGVzdCA9IHRyYWluX3Rlc3Rfc3BsaXQoCiAgICAgICAgcmF3LCBsYWJlbHMsIHRlc3Rfc2l6ZT10ZXN0X3NpemUsIHJhbmRvbV9zdGF0ZT1ybmcKICAgICkKCiAgICB4dHJhaW4sIHh2YWxpZCwgeXRyYWluLCB5dmFsaWQgPSB0cmFpbl90ZXN0X3NwbGl0KAogICAgICAgIHgsIHksIHRyYWluX3NpemU9dHJhaW5fdmFsX3NwbGl0LCByYW5kb21fc3RhdGU9cm5nCiAgICApCgogICAgIyBzZXQtYXNpZGUgdGVzdF9zZXQKICAgIHRlc3Rfc2V0ID0gcGQuY29uY2F0KAogICAgICAgIFsKICAgICAgICAgICAgcGQuRGF0YUZyYW1lKGRhdGE9eHRlc3QsIGNvbHVtbnM9Y29udGV4dC5oZWFkZXIpLAogICAgICAgICAgICBwZC5EYXRhRnJhbWUoZGF0YT15dGVzdCwgY29sdW1ucz1bbGFiZWxfY29sdW1uXSksCiAgICAgICAgXSwKICAgICAgICBheGlzPTEsCiAgICApCiAgICBmaWxlcGF0aCA9IG9zLnBhdGguam9pbihiYXNlX3BhdGgsIHRlc3Rfc2V0X2tleSArICIucHF0IikKICAgIHRlc3Rfc2V0LnRvX3BhcnF1ZXQoZmlsZXBhdGgsIGluZGV4PUZhbHNlKQogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QodGVzdF9zZXRfa2V5LCBsb2NhbF9wYXRoPXRlc3Rfc2V0X2tleSArICIucHF0IikKCiAgICAjIGRvIHdlIGJpbmFyaXplIHRoZSBsYWJlbHM6CiAgICBpZiBob3RfZW5jb2RlX2xhYmVsczoKICAgICAgICBjbGFzc2VzID0gbGlzdChyYW5nZSh4dHJhaW4uc2hhcGVbMV0pKQogICAgICAgIHl0cmFpbmIgPSBsYWJlbF9iaW5hcml6ZSh5dHJhaW4sIGNsYXNzZXM9Y2xhc3NlcykKICAgICAgICB5dmFsaWRiID0gbGFiZWxfYmluYXJpemUoeXZhbGlkLCBjbGFzc2VzPWNsYXNzZXMpCgogICAgaWYgaXNpbnN0YW5jZShjbGFzc19wYXJhbXMsIERhdGFJdGVtKToKICAgICAgICBjbGFzc19wYXJhbXMgPSBqc29uLmxvYWRzKGNsYXNzX3BhcmFtcy5nZXQoKSkKICAgICAgICBmaXRfcGFyYW1zID0ganNvbi5sb2FkcyhmaXRfcGFyYW1zLmdldCgpKQoKICAgIENsYXNzaWZpZXJDbGFzcyA9IF9jcmVhdGVfY2xhc3MoY2xhc3NfcGFyYW1zKQogICAgbW9kZWwgPSBDbGFzc2lmaWVyQ2xhc3MoKipjbGFzc19wYXJhbXMpCiAgICAjIGxvb3Agb3ZlciBjYWxsYmFja3MgYW5kIGNyZWF0ZSBmdW5jdGlvbnM6CiAgICBjYWxsYmFjayA9IF9jcmVhdGVfZnVuY3Rpb24oZml0X3BhcmFtc1siY2FsbGJhY2tzIl0pCgogICAgIyBldmFsX3NldD1bKHh0cmFpbiwgeXRyYWluKSwgKHh2YWxpZCwgeXZhbGlkKV0sCiAgICAjIGV2YWxfbWV0cmljPSJhdWMiLAogICAgIyBjYWxsYmFja3M9Y2FsbGJhY2tzLAoKICAgIG1vZGVsLmZpdCh4dHJhaW4sIHl0cmFpbiwgKipmaXRfcGFyYW1zKQoKICAgICMgc2F2ZSBtb2RlbAogICAgZmlsZXBhdGggPSBvcy5wYXRoLmpvaW4oYmFzZV9wYXRoLCBmInttb2RlbHNfZGlyfS97bW9kZWxfa2V5fS5wa2wiKQogICAgZHVtcChtb2RlbCwgb3BlbihmaWxlcGF0aCwgIndiIikpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChtb2RlbF9rZXksIGxvY2FsX3BhdGg9bW9kZWxzX2RpcikKCiAgICAjIGNvbXB1dGUgdmFsaWRhdGlvbiBtZXRyaWNzCiAgICB5cHJlZCA9IG1vZGVsLnByZWRpY3QoeHZhbGlkKQogICAgeV9zY29yZSA9IG1vZGVsLnByZWRpY3RfcHJvYmEoeHZhbGlkKQoKICAgIGF2ZXJhZ2VfcHJlY2lzaW9uID0gYXZlcmFnZV9wcmVjaXNpb25fc2NvcmUoeXZhbGlkYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeV9zY29yZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZlcmFnZT1zY29yZV9tZXRob2QpCgogICAgY29udGV4dC5sb2dfcmVzdWx0KGYiYWNjdXJhY3kiLCBmbG9hdChtb2RlbC5zY29yZSh4dmFsaWQsIHl2YWxpZCkpKQogICAgY29udGV4dC5sb2dfcmVzdWx0KGYicm9jYXVjIiwgcm9jX2F1Y19zY29yZSh5dmFsaWRiLCB5X3Njb3JlKSkKICAgIGNvbnRleHQubG9nX3Jlc3VsdChmImYxX3Njb3JlIiwgZjFfc2NvcmUoeXZhbGlkLCB5cHJlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZlcmFnZT1zY29yZV9tZXRob2QpKQogICAgY29udGV4dC5sb2dfcmVzdWx0KGYiYXZnX3ByZWNzY29yZSIsIGF2ZXJhZ2VfcHJlY2lzaW9uKQoKICAgICMgdmFsaWRhdGlvbiBwbG90cwogICAgcGxvdF9yb2MoY29udGV4dCwgeXZhbGlkYiwgeV9zY29yZSwga2V5PSJyb2MiKQogICAgIyBUT0RPOiByZXBsYWNlIHdpdGggc2tsZWFybiBvciB5ZWxsb3dicmljayBjbGFzc2lmaWNhdGlvbiByZXBvcnQ6CiAgICBwbG90X2NvbmZ1c2lvbl9tYXRyaXgoY29udGV4dCwgeXZhbGlkLCB5cHJlZCwga2V5PSJjb25mdXNpb24iLCBmbXQ9InBuZyIpCiAgICAjIFRPRE86IGFkZCBzb21lIG1vcmUgaGVyZSAoU0hBUEUuLi4pCiAgICBpZiBoYXNhdHRyKG1vZGVsLCAiZmVhdHVyZV9pbXBvcnRhbmNlc18iKToKICAgICAgICBwbG90X2ltcG9ydGFuY2UoY29udGV4dCwgbW9kZWwsIGtleT1mImZlYXRpbXAiKQoKICAgICMgcGxvdCB0cmFpbmluZyBoaXN0b3J5IG1ldHJpY3MKIyAgICAgaWYgInRyYWluaW5nIiBpbiBldmFsc19yZXN1bHQ6CiMgICAgICAgICB0cmFpbl9hdWMgPSBucC5hc2FycmF5KGV2YWxzX3Jlc3VsdFsidHJhaW5pbmciXVsiYXVjIl0sIGR0eXBlPW5wLmZsb2F0KQojICAgICAgICAgdHJhaW5fbG9nbG9zcyA9IG5wLmFzYXJyYXkoZXZhbHNfcmVzdWx0WyJ0cmFpbmluZyJdWyJiaW5hcnlfbG9nbG9zcyJdLCBkdHlwZT1ucC5mbG9hdCkKIyAgICAgICAgIHZhbF9hdWMgPSBucC5hc2FycmF5KGV2YWxzX3Jlc3VsdFsidmFsaWRfMSJdWyJhdWMiXSwgZHR5cGU9bnAuZmxvYXQpCiMgICAgICAgICB2YWxfbG9nbG9zcyA9IG5wLmFzYXJyYXkoZXZhbHNfcmVzdWx0WyJ2YWxpZF8xIl1bImJpbmFyeV9sb2dsb3NzIl0sIGR0eXBlPW5wLmZsb2F0KQoKIyAgICAgcGxvdF92YWxpZGF0aW9uKAojICAgICAgICAgY29udGV4dCwKIyAgICAgICAgIFsodHJhaW5fYXVjLCB2YWxfYXVjKSwgKHRyYWluX2xvZ2xvc3MsIHZhbF9sb2dsb3NzKV0sCiMgICAgICAgICBrZXk9Imhpc3RvcnkiLAojICAgICAgICAgdGl0bGU9InRyYWluaW5nIG1ldHJpY3MiKQoKIyAgICAgCgoKZGVmIHBsb3RfdmFsaWRhdGlvbigKICAgIGNvbnRleHQ6IE1MQ2xpZW50Q3R4LAogICAgbWV0cmljcywKICAgIGtleTogc3RyID0gInRyYWluaW5nLWhpc3RvcnkiLAogICAgdGl0bGU6IHN0ciA9ICJhdWMgYW5kIGxvZ2xvc3MiLAogICAgcGxvdHNfZGlyOiBzdHIgPSAicGxvdHMiLAogICAgZm10PSJwbmciLAopOgogICAgIiIiUGxvdCB0cmFpbiBhbmQgdmFsaWRhdGlvbiBsb3NzIGN1cnZlcwoKICAgIFRoZXNlIGN1cnZlcyByZXByZXNlbnQgdGhlIHRyYWluaW5nIHJvdW5kIG1ldHJpY3MgZnJvbSB0aGUgdHJhaW5pbmcKICAgIGFuZCB2YWxpZGF0aW9uIHNldHMuCgogICAgVE9ETzogcmVmYWN0b3IgdG8gdGFrZSBwYXJhbXMgZGljdCBmb3IgcGxvdCBvcHRpb25zCiAgICAKICAgIDpwYXJhbSBjb250ZXh0OiAgICBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0gbWV0cmljczogICAgdHJhaW4vdm9saWRhdGlvbiBtZXRyaWNzIGFzIHR1cGxlcwogICAgOnBhcmFtIGtleTo6ICAgICAgIGtleSBvZiB2YWxpZGF0aW9uIHBsb3QgaW4gYXJ0aWZhY3Qgc3RvcmUKICAgICIiIgogICAgX2djZl9jbGVhcihwbHQpCgogICAgIyBnZW5lcmF0ZSBwbG90CiAgICBmb3IgbWV0cmljIGluIG1ldHJpY3M6CiAgICAgICAgcGx0LnBsb3QobWV0cmljWzBdKQogICAgICAgIHBsdC5wbG90KG1ldHJpY1sxXSkKCiAgICBwbHQudGl0bGUoZiJ0cmFpbmluZyBoaXN0b3J5IC0ge3RpdGxlfSIpCiAgICBwbHQueGxhYmVsKCJlcG9jaCIpCiAgICBwbHQueWxhYmVsKCIiKQogICAgcGx0LmxlZ2VuZChbImF1Yzp0cmFpbiIsICJhdWM6dmFsaWQiLCAibG9nbG9zczp0cmFpbiIsICJsb2dsb3NzOnZhbGlkIl0pCgogICAgIyBzYXZlIGZpZ3VyZSBhbmQgbG9nIGFydGlmYWN0CiAgICBmbmFtZSA9IGYie3Bsb3RzX2Rpcn0ve2tleX0ue2ZtdH0iCiAgICBwbHQuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oY29udGV4dC5hcnRpZmFjdF9wYXRoLCBmbmFtZSkpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3Qoa2V5LCBib2R5PXBsdC5nY2YoKSksIGxvY2FsX3BhdGg9Zm5hbWUpCgoKZGVmIHBsb3Rfcm9jKAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICB5X2xhYmVscywKICAgIHlfcHJvYnMsCiAgICBrZXk9InJvYyIsCiAgICBwbG90c19kaXI6IHN0ciA9ICJwbG90cyIsCiAgICBmbXQ9InBuZyIsCik6CiAgICAiIiJQbG90IGFuIFJPQyBjdXJ2ZSBmcm9tIHRlc3QgZGF0YSBzYXZlZCBpbiBhbiBhcnRpZmFjdCBzdG9yZS4KCiAgICBUT0RPOiByZWZhY3RvciB0byB0YWtlIHBhcmFtcyBkaWN0IGZvciBwbG90IG9wdGlvbnMKCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0geV9sYWJlbHM6ICAgICAgICB0ZXN0IGRhdGEgbGFiZWxzCiAgICA6cGFyYW0geV9wcm9iczogICAgICAgICBtb2RlbCBwcmVkaWN0ZWQgcHJvYmFiaWxpdGllcyB1c2luZyB0ZXN0IGZlYXR1cmVzCiAgICA6cGFyYW0ga2V5OiAgICAgICAgICAgICBrZXkgb2Ygcm9jIHBsb3QgaW4gYXJ0aWZhY3Qgc3RvcmUKICAgIDpwYXJhbSBwbG90c19kaXI6ICAgICAgIHJlbGF0aXZlIHBhdGggb2YgcGxvdHMgaW4gYXJ0aWZhY3QgcGF0aAogICAgIiIiCiAgICBfZ2NmX2NsZWFyKHBsdCkKCiAgICBmcHIgPSBkaWN0KCkKICAgIHRwciA9IGRpY3QoKQogICAgcm9jX2F1YyA9IGRpY3QoKQogICAgcGx0LnBsb3QoWzAsIDFdLCBbMCwgMV0sICJrLS0iKQogICAgcGx0LnhsYWJlbCgiZmFsc2UgcG9zaXRpdmUgcmF0ZSIpCiAgICBwbHQueWxhYmVsKCJ0cnVlIHBvc2l0aXZlIHJhdGUiKQogICAgcGx0LnRpdGxlKCJyb2MgY3VydmUiKQogICAgcGx0LmxlZ2VuZChsb2M9ImJlc3QiKQogICAgIyBzaW5nbGUgUk9DIG9yIG11dGxpcGxlOgogICAgZm9yIGkgaW4gcmFuZ2UoeV9sYWJlbHMuc2hhcGVbMV0pOgogICAgICAgIGZwcltpXSwgdHByW2ldLCBfID0gcm9jX2N1cnZlKHlfbGFiZWxzWzosIGldLCB5X3Byb2JzWzosIGldKQogICAgICAgIHJvY19hdWNbaV0gPSBhdWMoZnByW2ldLCB0cHJbaV0pCiAgICAgICAgcGx0LnBsb3QoZnByW2ldLCB0cHJbaV0sIGxhYmVsPWYiY2xhc3Mge2l9IikKCiAgICBmaWcgPSBwbHQuZ2NmKCkKICAgIGZuYW1lID0gZiJ7cGxvdHNfZGlyfS97a2V5fS57Zm10fSIKICAgIGZpZy5zYXZlZmlnKG9zLnBhdGguam9pbihjb250ZXh0LmFydGlmYWN0X3BhdGgsIGZuYW1lKSkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KFBsb3RBcnRpZmFjdChrZXksIGJvZHk9ZmlnKSwgbG9jYWxfcGF0aD1mbmFtZSkKCgpkZWYgcGxvdF9jb25mdXNpb25fbWF0cml4KAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBsYWJlbHMsCiAgICBwcmVkaWN0aW9ucywKICAgIGtleTogc3RyID0gImNvbmZ1c2lvbl9tYXRyaXgiLAogICAgcGxvdHNfZGlyOiBzdHIgPSAicGxvdHMiLAogICAgY29sb3JtYXA6IHN0ciA9ICJCbHVlcyIsCiAgICBmbXQ6IHN0ciA9ICJwbmciLAopOgogICAgIiIiQ3JlYXRlIGEgY29uZnVzaW9uIG1hdHJpeC4KICAgIFBsb3QgYW5kIHNhdmUgYSBjb25mdXNpb24gbWF0cml4IHVzaW5nIHRlc3QgZGF0YSBmcm9tIGEKICAgIG1vZGVsbGluZSBzdGVwLgoKICAgIFRPRE86IGZpeCBsYWJlbCBhbGlnbm1lbnQKICAgIFRPRE86IGNvbnNpZGVyIHVzaW5nIGFub3RoZXIgcGFja2FnZWQgdmVyc2lvbgogICAgVE9ETzogcmVmYWN0b3IgdG8gdGFrZSBwYXJhbXMgZGljdCBmb3IgcGxvdCBvcHRpb25zCgogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgZnVuY3Rpb24gY29udGV4dAogICAgOnBhcmFtIGxhYmVsczogICAgICAgICAgdmFsaWRhdGlvbiBkYXRhIGdyb3VuZC10cnV0aCBsYWJlbHMKICAgIDpwYXJhbSBwcmVkaWN0aW9uczogICAgIHZhbGlkYXRpb24gZGF0YSBwcmVkaWN0aW9ucwogICAgOnBhcmFtIGNvbG9ybWFwOiAgICAgICAgY29sb3VybWFwIGZvciBjb25mdXNpb24gbWF0cml4CiAgICA6cGFyYW0ga2V5OiAgICAgICAgICAgICBzdHIKICAgICIiIgogICAgX2djZl9jbGVhcihwbHQpCgogICAgY20gPSBjb25mdXNpb25fbWF0cml4KGxhYmVscywgcHJlZGljdGlvbnMsIHNhbXBsZV93ZWlnaHQ9Tm9uZSkKICAgICMgICAgICAgICAgICAgICAgICAgICBub3JtYWxpemU9ImFsbCIpICAjIHBhcmFtZXRlciBhdmFpbGFibGUgc2tsZWFybiA+IHYwLjIyCiAgICBzbnMuaGVhdG1hcChjbSwgYW5ub3Q9VHJ1ZSwgY21hcD0iQmx1ZXMiKQoKICAgIGZpZyA9IHBsdC5nY2YoKQogICAgZmlnLnNhdmVmaWcob3MucGF0aC5qb2luKGNvbnRleHQuYXJ0aWZhY3RfcGF0aCwgZiJ7cGxvdHNfZGlyfS97a2V5fS57Zm10fSIpKQogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoCiAgICAgICAgUGxvdEFydGlmYWN0KGtleSwgYm9keT1maWcpLCBsb2NhbF9wYXRoPWYie3Bsb3RzX2Rpcn0ve2tleX0ue2ZtdH0iCiAgICApCgogICAgX2djZl9jbGVhcihwbHQpCgoKZGVmIHBsb3RfaW1wb3J0YW5jZSgKICAgIGNvbnRleHQsCiAgICBtb2RlbCwKICAgIGtleTogc3RyID0gImZlYXR1cmUtaW1wb3J0YW5jZXMiLAogICAgcGxvdHNfZGlyOiBzdHIgPSAicGxvdHMiLAogICAgZm10OiBzdHIgPSAicG5nIiwKKToKICAgICIiIkRpc3BsYXkgZXN0aW1hdGVkIGZlYXR1cmUgaW1wb3J0YW5jZXMuCiAgICA6cGFyYW0gY29udGV4dDogICAgIGZ1bmN0aW9uIGNvbnRleHQKICAgIDpwYXJhbSBtb2RlbDogICAgICAgZml0dGVkIGxpZ2h0Z2JtIG1vZGVsCiAgICAiIiIKICAgIF9nY2ZfY2xlYXIocGx0KQoKICAgICMgY3JlYXRlIGEgZmVhdHVyZSBpbXBvcnRhbmNlIHRhYmxlIHdpdGggZGVzaXJlZCBsYWJlbHMKICAgIHppcHBlZCA9IHppcChtb2RlbC5mZWF0dXJlX2ltcG9ydGFuY2VzXywgY29udGV4dC5oZWFkZXIpCgogICAgZmVhdHVyZV9pbXAgPSBwZC5EYXRhRnJhbWUoc29ydGVkKHppcHBlZCksIGNvbHVtbnM9WyJmcmVxIiwgImZlYXR1cmUiXSkKICAgIGZlYXR1cmVfaW1wLnNvcnRfdmFsdWVzKGJ5PSJmcmVxIiwgYXNjZW5kaW5nPUZhbHNlLCBpbnBsYWNlPVRydWUpCgogICAgcGx0LmZpZ3VyZShmaWdzaXplPSgyMCwgMTApKQogICAgc25zLmJhcnBsb3QoeD0iZnJlcSIsIHk9ImZlYXR1cmUiLCBkYXRhPWZlYXR1cmVfaW1wKQogICAgcGx0LnRpdGxlKCJmZWF0dXJlcyIpCiAgICBwbHQudGlnaHRfbGF5b3V0KCkKCiAgICBmaWcgPSBwbHQuZ2NmKCkKICAgIGZuYW1lID0gZiJ7cGxvdHNfZGlyfS97a2V5fS57Zm10fSIKICAgIGZpZy5zYXZlZmlnKG9zLnBhdGguam9pbihjb250ZXh0LmFydGlmYWN0X3BhdGgsIGZuYW1lKSkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KAogICAgICAgIFBsb3RBcnRpZmFjdChmIntrZXl9LntmbXR9IiwgYm9keT1maWcpLCBsb2NhbF9wYXRoPWYie3Bsb3RzX2Rpcn0ve2tleX0ue2ZtdH0iCiAgICApCgogICAgIyBmZWF0dXJlIGltcG9ydGFuY2VzIGFyZSBhbHNvIHNhdmVkIGFzIGEgdGFibGU6CiAgICBmZWF0dXJlX2ltcC50b19jc3Yob3MucGF0aC5qb2luKGNvbnRleHQuYXJ0aWZhY3RfcGF0aCwga2V5ICsgIi5jc3YiKSkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KGtleSArICIuY3N2IiwgbG9jYWxfcGF0aD1rZXkgKyAiLmNzdiIpCgogICAgX2djZl9jbGVhcihwbHQpCgo=
    commands: []
    code_origin: https://github.com/mlrun/functions.git#b0ba922e10fa0af2fcf2e04cce51eb7d9243bf25:sklearn_classifier/sklearn_classifier.py
