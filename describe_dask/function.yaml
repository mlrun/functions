kind: job
metadata:
  name: describe-dask
  tag: ''
  hash: 7d2a6da618f5786929c500778fadb5587e578f9d
  project: ''
  labels:
    author: yjb
  categories:
  - analysis
spec:
  command: ''
  args: []
  image: mlrun/ml-models
  env: []
  default_handler: summarize
  entry_points:
    summarize:
      name: summarize
      doc: 'Summarize a table


        Connects to dask client through the function context, or through an optional

        user-supplied scheduler.'
      parameters:
      - name: context
        type: MLClientCtx
        doc: the function context
      - name: dask_key
        type: str
        doc: key of dataframe in dask client "datasets" attribute
        default: dask_key
      - name: label_column
        type: str
        doc: ground truth column label
        default: labels
      - name: class_labels
        type: List[str]
        doc: label for each class in tables and plots
      - name: plot_hist
        type: bool
        doc: (True) set this to False for large tables
        default: true
      - name: plots_dest
        type: str
        doc: destination folder of summary plots (relative to artifact_path)
        default: plots
      - name: alt_scheduler
        type: str
        doc: (None) an alternative scheduler file to connect with
      outputs: []
      lineno: 25
  description: describe and visualizes dataset stats
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IHdhcm5pbmdzCndhcm5pbmdzLnNpbXBsZWZpbHRlcihhY3Rpb249Imlnbm9yZSIsIGNhdGVnb3J5PUZ1dHVyZVdhcm5pbmcpCgppbXBvcnQgb3MKaW1wb3J0IG51bXB5IGFzIG5wCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IG1hdHBsb3RsaWIucHlwbG90IGFzIHBsdAppbXBvcnQgc2VhYm9ybiBhcyBzbnMKCmltcG9ydCBkYXNrCmltcG9ydCBkYXNrLmRhdGFmcmFtZSBhcyBkZApmcm9tIGRhc2suZGlzdHJpYnV0ZWQgaW1wb3J0IENsaWVudAoKZnJvbSBtbHJ1bi5leGVjdXRpb24gaW1wb3J0IE1MQ2xpZW50Q3R4CmZyb20gbWxydW4uZGF0YXN0b3JlIGltcG9ydCBEYXRhSXRlbQpmcm9tIG1scnVuLmFydGlmYWN0cyBpbXBvcnQgUGxvdEFydGlmYWN0LCBUYWJsZUFydGlmYWN0CmZyb20gbWxydW4ubWx1dGlscyBpbXBvcnQgZ2NmX2NsZWFyCgpmcm9tIHR5cGluZyBpbXBvcnQgTGlzdAoKcGQuc2V0X29wdGlvbigiZGlzcGxheS5mbG9hdF9mb3JtYXQiLCBsYW1iZGEgeDogIiUuMmYiICUgeCkKCmRlZiBzdW1tYXJpemUoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIGRhc2tfa2V5OiBzdHIgPSAiZGFza19rZXkiLAogICAgbGFiZWxfY29sdW1uOiBzdHIgPSAibGFiZWxzIiwKICAgIGNsYXNzX2xhYmVsczogTGlzdFtzdHJdID0gW10sCiAgICBwbG90X2hpc3Q6IGJvb2wgPSBUcnVlLAogICAgcGxvdHNfZGVzdDogc3RyID0gInBsb3RzIiwKICAgIGFsdF9zY2hlZHVsZXI6IHN0ciA9IE5vbmUKKSAtPiBOb25lOgogICAgIiIiU3VtbWFyaXplIGEgdGFibGUKICAgIAogICAgQ29ubmVjdHMgdG8gZGFzayBjbGllbnQgdGhyb3VnaCB0aGUgZnVuY3Rpb24gY29udGV4dCwgb3IgdGhyb3VnaCBhbiBvcHRpb25hbAogICAgdXNlci1zdXBwbGllZCBzY2hlZHVsZXIuCgogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgdGhlIGZ1bmN0aW9uIGNvbnRleHQKICAgIDpwYXJhbSBkYXNrX2tleTogICAgICAgIGtleSBvZiBkYXRhZnJhbWUgaW4gZGFzayBjbGllbnQgImRhdGFzZXRzIiBhdHRyaWJ1dGUKICAgIDpwYXJhbSBsYWJlbF9jb2x1bW46ICAgIGdyb3VuZCB0cnV0aCBjb2x1bW4gbGFiZWwKICAgIDpwYXJhbSBjbGFzc19sYWJlbHM6ICAgIGxhYmVsIGZvciBlYWNoIGNsYXNzIGluIHRhYmxlcyBhbmQgcGxvdHMKICAgIDpwYXJhbSBwbG90X2hpc3Q6ICAgICAgIChUcnVlKSBzZXQgdGhpcyB0byBGYWxzZSBmb3IgbGFyZ2UgdGFibGVzCiAgICA6cGFyYW0gcGxvdHNfZGVzdDogICAgICBkZXN0aW5hdGlvbiBmb2xkZXIgb2Ygc3VtbWFyeSBwbG90cyAocmVsYXRpdmUgdG8gYXJ0aWZhY3RfcGF0aCkKICAgIDpwYXJhbSBhbHRfc2NoZWR1bGVyOiAgIChOb25lKSBhbiBhbHRlcm5hdGl2ZSBzY2hlZHVsZXIgZmlsZSB0byBjb25uZWN0IHdpdGgKICAgICIiIgogICAgaWYgYWx0X3NjaGVkdWxlcjoKICAgICAgICBkYXNrX2NsaWVudCA9IENsaWVudChzY2hlZHVsZXJfZmlsZT1zdHIoYWx0X3NjaGVkdWxlcikpCiAgICBlbGlmIGhhc2F0dHIoY29udGV4dCwgImRhc2tfY2xpZW50Iik6CiAgICAgICAgZGFza19jbGllbnQgPSBDbGllbnQoc2NoZWR1bGVyX2ZpbGU9c3RyKGNvbnRleHQuZGFza19jbGllbnQpKQogICAgZWxzZToKICAgICAgICByYWlzZSBFeGNlcHRpb24oIm5vIGRhc2tfY2xpZW50IG9yIHNjaGVkdWxlciBmaWxlISIpCiAgICAgICAgCiAgICBpZiBkYXNrX2tleSBpbiBkYXNrX2NsaWVudC5kYXRhc2V0czoKICAgICAgICB0YWJsZSA9IGRhc2tfY2xpZW50LmdldF9kYXRhc2V0KGRhc2tfa2V5KQogICAgZWxzZToKICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYib25seSB0aGVzZSBkYXRhc2V0cyBhcmUgYXZhaWxhYmxlIHtkYXNrX2NsaWVudC5kYXRhc2V0c30gaW4gY2xpZW50IHtkYXNrX2NsaWVudH0iKQogICAgICAgIHJhaXNlIEV4Y2VwdGlvbigiZGF0YXNldCBub3QgZm91bmQgb24gZGFzayBjbHVzdGVyIikKICAgIGhlYWRlciA9IHRhYmxlLmNvbHVtbnMudmFsdWVzCiAgICAKICAgIGdjZl9jbGVhcihwbHQpCiAgICB0YWJsZSA9IHRhYmxlLmNvbXB1dGUoKQogICAgc25zcGx0ID0gc25zLnBhaXJwbG90KHRhYmxlLCBodWU9bGFiZWxfY29sdW1uLCBkaWFnX2t3cz17J2J3JzogMS41fSkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KFBsb3RBcnRpZmFjdCgnaGlzdG9ncmFtcycsICBib2R5PXBsdC5nY2YoKSksIAogICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfcGF0aD1mIntwbG90c19kZXN0fS9oaXN0Lmh0bWwiKQoKICAgIGdjZl9jbGVhcihwbHQpICAgCiAgICBsYWJlbHMgPSB0YWJsZS5wb3AobGFiZWxfY29sdW1uKQogICAgaWYgbm90IGNsYXNzX2xhYmVsczoKICAgICAgICBjbGFzc19sYWJlbHMgPSBsYWJlbHMudW5pcXVlKCkKICAgIGJhbGFuY2ViYXIgPSBsYWJlbHMudmFsdWVfY291bnRzKG5vcm1hbGl6ZT1UcnVlKS5zb3J0X2luZGV4KCkucGxvdChraW5kPSdiYXInLCB0aXRsZT0nY2xhc3MgaW1iYWxhbmNlIC0gbGFiZWxzJykKICAgIGJhbGFuY2ViYXIuc2V0X3hsYWJlbCgnY2xhc3MnKQogICAgYmFsYW5jZWJhci5zZXRfeWxhYmVsKCJwcm9wb3J0aW9uIG9mIHRvdGFsIikKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KFBsb3RBcnRpZmFjdCgiaW1iYWxhbmNlIiwgYm9keT1wbHQuZ2NmKCkpLCBsb2NhbF9wYXRoPWYie3Bsb3RzX2Rlc3R9L2ltYmFsYW5jZS5odG1sIikKICAgICAKICAgIGdjZl9jbGVhcihwbHQpCiAgICB0Ymxjb3JyID0gdGFibGUuY29ycigpCiAgICBheCA9IHBsdC5heGVzKCkKICAgIHNucy5oZWF0bWFwKHRibGNvcnIsIGF4PWF4LCBhbm5vdD1GYWxzZSwgY21hcD1wbHQuY20uUmVkcykKICAgIGF4LnNldF90aXRsZSgiZmVhdHVyZXMgY29ycmVsYXRpb24iKQogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoUGxvdEFydGlmYWN0KCJjb3JyZWxhdGlvbiIsICBib2R5PXBsdC5nY2YoKSksIAogICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfcGF0aD1mIntwbG90c19kZXN0fS9jb3JyLmh0bWwiKQogICAgZ2NmX2NsZWFyKHBsdCkKCg==
    commands: []
    code_origin: https://github.com/yjb-ds/functions.git#bbaf91c5a14454dea6ba72cafa3f035608315b67:describe_dask.ipynb
