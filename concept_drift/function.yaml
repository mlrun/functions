kind: job
metadata:
  name: concept-drift
  tag: ''
  hash: 42bd669f5adcf6243fc5e6e34e2d3dfbe5cfb02f
  project: default
  labels:
    author: orz
    framework: sklearn
  categories:
  - machine-learning
  - model-serving
spec:
  command: ''
  args: []
  image: mlrun/ml-models
  env: []
  default_handler: concept_drift_deployer
  entry_points:
    concept_drift_deployer:
      name: concept_drift_deployer
      doc: "Deploy a streaming Concept Drift detector on a labeled stream\n   This\
        \ function is the Deployment step for the Streaming Concept Drift Detector.\n\
        \   It will load the selected drift detectors and initialize them with the\n\
        \   base_dataset's statistics.  Then it will deploy the concept_drift_streaming\n\
        \   function and pass the models to it for streaming concept-drift detection\
        \ on top\n   of a labeled stream."
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context
        default: ''
      - name: base_dataset
        type: DataItem
        doc: Dataset containing label_col and prediction_col to initialize the detectors
        default: ''
      - name: input_stream
        type: str
        doc: labeled stream to track. Should contain label_col and prediction_col
        default: ''
      - name: consumer_group
        type: str
        default: ''
      - name: output_stream
        type: str
        doc: Output stream to push the detector's alerts
        default: ''
      - name: output_tsdb
        type: str
        doc: Output TSDB table to allow analysis and display
        default: ''
      - name: tsdb_batch_size
        type: int
        doc: Batch size of alerts to buffer before pushing to the TSDB
        default: ''
      - name: callbacks
        type: list
        doc: Additional rest endpoints to send the alert data to
        default: ''
      - name: models
        type: list
        doc: List of the detectors to deploy Defaults to ['ddm', 'eddm', 'pagehinkley'].
        default:
        - ddm
        - eddm
        - pagehinkley
      - name: models_dest
        doc: Location for saving the detectors Defaults to 'models' (in relation to
          artifact_path).
        default: models
      - name: pagehinkley_threshold
        type: float
        doc: Drift level threshold for PH detector Defaults to 10.
        default: 10
      - name: ddm_warning_level
        type: float
        doc: Warning level alert for DDM detector Defaults to 2.
        default: 2
      - name: ddm_out_control_level
        type: float
        doc: Drift level alert for DDM detector Defaults to 3.
        default: 3
      - name: label_col
        doc: Label column to be used on base_dataset and input_stream Defaults to
          'label'.
        default: label
      - name: prediction_col
        doc: Prediction column to be used on base_dataset and input_stream Defaults
          to 'prediction'.
        default: prediction
      - name: hub_url
        type: str
        doc: hub_url in case the default is not used, concept_drift_streaming will
          be loaded by this url Defaults to mlconf.hub_url.
        default: <_ast.Name object at 0x7f0e8c6b3050>
      - name: fn_tag
        type: str
        doc: hub tag to use Defaults to 'master'
        default: master
      outputs:
      - default: ''
      lineno: 15
  description: Deploy a streaming Concept Drift detector on a labeled stream
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IHNrbXVsdGlmbG93LmRyaWZ0X2RldGVjdGlvbiAgIyBXZSB3aWxsIGdyYWIgb3VyIFBILCBERE0sIEVERE0gYWxnb3JpdGhtcyBmcm9tIGhlcmUKaW1wb3J0IG51bXB5IGFzIG5wCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IG9zCmZyb20gY2xvdWRwaWNrbGUgaW1wb3J0IGR1bXBzLCBsb2FkLCBkdW1wCgpmcm9tIG51Y2xpby50cmlnZ2VycyBpbXBvcnQgVjNJT1N0cmVhbVRyaWdnZXIKZnJvbSBtbHJ1biBpbXBvcnQgRGF0YUl0ZW0sIGltcG9ydF9mdW5jdGlvbiwgbWxjb25mLCBNTENsaWVudEN0eCwgbW91bnRfdjNpbwoKaW1wb3J0IHJhbmRvbQoKCmRlZiBjb25jZXB0X2RyaWZ0X2RlcGxveWVyKAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBiYXNlX2RhdGFzZXQ6IERhdGFJdGVtLAogICAgaW5wdXRfc3RyZWFtOiBzdHIsCiAgICBjb25zdW1lcl9ncm91cDogc3RyLAogICAgb3V0cHV0X3N0cmVhbTogc3RyLAogICAgb3V0cHV0X3RzZGI6IHN0ciwKICAgIHRzZGJfYmF0Y2hfc2l6ZTogaW50LAogICAgY2FsbGJhY2tzOiBsaXN0LAogICAgbW9kZWxzOiBsaXN0ID0gWyJkZG0iLCAiZWRkbSIsICJwYWdlaGlua2xleSJdLAogICAgbW9kZWxzX2Rlc3Q9Im1vZGVscyIsCiAgICBwYWdlaGlua2xleV90aHJlc2hvbGQ6IGZsb2F0ID0gMTAsCiAgICBkZG1fd2FybmluZ19sZXZlbDogZmxvYXQgPSAyLAogICAgZGRtX291dF9jb250cm9sX2xldmVsOiBmbG9hdCA9IDMsCiAgICBsYWJlbF9jb2w9ImxhYmVsIiwKICAgIHByZWRpY3Rpb25fY29sPSJwcmVkaWN0aW9uIiwKICAgIGh1Yl91cmw6IHN0ciA9IG1sY29uZi5odWJfdXJsLAogICAgZm5fdGFnOiBzdHIgPSAibWFzdGVyIiwKKToKICAgICIiIkRlcGxveSBhIHN0cmVhbWluZyBDb25jZXB0IERyaWZ0IGRldGVjdG9yIG9uIGEgbGFiZWxlZCBzdHJlYW0KICAgICAgIFRoaXMgZnVuY3Rpb24gaXMgdGhlIERlcGxveW1lbnQgc3RlcCBmb3IgdGhlIFN0cmVhbWluZyBDb25jZXB0IERyaWZ0IERldGVjdG9yLgogICAgICAgSXQgd2lsbCBsb2FkIHRoZSBzZWxlY3RlZCBkcmlmdCBkZXRlY3RvcnMgYW5kIGluaXRpYWxpemUgdGhlbSB3aXRoIHRoZQogICAgICAgYmFzZV9kYXRhc2V0J3Mgc3RhdGlzdGljcy4gIFRoZW4gaXQgd2lsbCBkZXBsb3kgdGhlIGNvbmNlcHRfZHJpZnRfc3RyZWFtaW5nCiAgICAgICBmdW5jdGlvbiBhbmQgcGFzcyB0aGUgbW9kZWxzIHRvIGl0IGZvciBzdHJlYW1pbmcgY29uY2VwdC1kcmlmdCBkZXRlY3Rpb24gb24gdG9wCiAgICAgICBvZiBhIGxhYmVsZWQgc3RyZWFtLgoKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgIE1MUnVuIGNvbnRleHQKICAgIDpwYXJhbSBiYXNlX2RhdGFzZXQ6ICAgIERhdGFzZXQgY29udGFpbmluZyBsYWJlbF9jb2wgYW5kIHByZWRpY3Rpb25fY29sIHRvIGluaXRpYWxpemUgdGhlIGRldGVjdG9ycwogICAgOnBhcmFtIGlucHV0X3N0cmVhbTogICAgbGFiZWxlZCBzdHJlYW0gdG8gdHJhY2suCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG91bGQgY29udGFpbiBsYWJlbF9jb2wgYW5kIHByZWRpY3Rpb25fY29sCiAgICA6cGFyYW0gb3V0cHV0X3N0cmVhbTogICBPdXRwdXQgc3RyZWFtIHRvIHB1c2ggdGhlIGRldGVjdG9yJ3MgYWxlcnRzCiAgICA6cGFyYW0gb3V0cHV0X3RzZGI6ICAgICBPdXRwdXQgVFNEQiB0YWJsZSB0byBhbGxvdyBhbmFseXNpcyBhbmQgZGlzcGxheQogICAgOnBhcmFtIHRzZGJfYmF0Y2hfc2l6ZTogQmF0Y2ggc2l6ZSBvZiBhbGVydHMgdG8gYnVmZmVyIGJlZm9yZSBwdXNoaW5nIHRvIHRoZSBUU0RCCiAgICA6cGFyYW0gY2FsbGJhY2tzOiAgICAgICBBZGRpdGlvbmFsIHJlc3QgZW5kcG9pbnRzIHRvIHNlbmQgdGhlIGFsZXJ0IGRhdGEgdG8KICAgIDpwYXJhbSBtb2RlbHM6ICAgICAgICAgIExpc3Qgb2YgdGhlIGRldGVjdG9ycyB0byBkZXBsb3kKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHRzIHRvIFsnZGRtJywgJ2VkZG0nLCAncGFnZWhpbmtsZXknXS4KICAgIDpwYXJhbSBtb2RlbHNfZGVzdDogICAgIExvY2F0aW9uIGZvciBzYXZpbmcgdGhlIGRldGVjdG9ycwogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdHMgdG8gJ21vZGVscycgKGluIHJlbGF0aW9uIHRvIGFydGlmYWN0X3BhdGgpLgogICAgOnBhcmFtIHBhZ2VoaW5rbGV5X3RocmVzaG9sZDogIERyaWZ0IGxldmVsIHRocmVzaG9sZCBmb3IgUEggZGV0ZWN0b3IgRGVmYXVsdHMgdG8gMTAuCiAgICA6cGFyYW0gZGRtX3dhcm5pbmdfbGV2ZWw6ICAgICAgV2FybmluZyBsZXZlbCBhbGVydCBmb3IgRERNIGRldGVjdG9yIERlZmF1bHRzIHRvIDIuCiAgICA6cGFyYW0gZGRtX291dF9jb250cm9sX2xldmVsOiAgRHJpZnQgbGV2ZWwgYWxlcnQgZm9yIERETSBkZXRlY3RvciBEZWZhdWx0cyB0byAzLgogICAgOnBhcmFtIGxhYmVsX2NvbDogICAgICAgTGFiZWwgY29sdW1uIHRvIGJlIHVzZWQgb24gYmFzZV9kYXRhc2V0IGFuZCBpbnB1dF9zdHJlYW0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHRzIHRvICdsYWJlbCcuCiAgICA6cGFyYW0gcHJlZGljdGlvbl9jb2w6ICBQcmVkaWN0aW9uIGNvbHVtbiB0byBiZSB1c2VkIG9uIGJhc2VfZGF0YXNldCBhbmQgaW5wdXRfc3RyZWFtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0cyB0byAncHJlZGljdGlvbicuCiAgICA6cGFyYW0gaHViX3VybDogICAgICAgICBodWJfdXJsIGluIGNhc2UgdGhlIGRlZmF1bHQgaXMgbm90IHVzZWQsIGNvbmNlcHRfZHJpZnRfc3RyZWFtaW5nIHdpbGwgYmUgbG9hZGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBieSB0aGlzIHVybAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdHMgdG8gbWxjb25mLmh1Yl91cmwuCiAgICA6cGFyYW0gZm5fdGFnOiAgICAgICAgICBodWIgdGFnIHRvIHVzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdHMgdG8gJ21hc3RlcicKICAgICIiIgoKICAgIG1sY29uZi5kYnBhdGggPSBtbGNvbmYuZGJwYXRoIG9yICJodHRwOi8vbWxydW4tYXBpOjgwODAiCiAgICBtbGNvbmYuaHViX3VybCA9IGh1Yl91cmwKICAgIGZuID0gaW1wb3J0X2Z1bmN0aW9uKHVybD0iaHViOi8vY29uY2VwdF9kcmlmdF9zdHJlYW1pbmciKQoKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIkxvYWRpbmcgYmFzZSBkYXRhc2V0IikKICAgIGJhc2VfZGYgPSBiYXNlX2RhdGFzZXQuYXNfZGYoKQogICAgZXJyb3Jfc3RyZWFtID0gbnAud2hlcmUoCiAgICAgICAgYmFzZV9kZltwcmVkaWN0aW9uX2NvbF0udmFsdWVzID09IGJhc2VfZGZbbGFiZWxfY29sXS52YWx1ZXMsIDAsIDEKICAgICkKCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCJDcmVhdGluZyBtb2RlbHMiKQogICAgbW9kZWxzID0gWwogICAgICAgIG1vZGVsLnN0cmlwKCkKICAgICAgICBmb3IgbW9kZWwgaW4gb3MuZ2V0ZW52KCJtb2RlbHMiLCAicGFnZWhpbmtsZXksIGRkbSwgZWRkbSIpLnNwbGl0KCIsIikKICAgIF0KICAgIG1vZGVscyA9IHsKICAgICAgICAiZWRkbSI6IHNrbXVsdGlmbG93LmRyaWZ0X2RldGVjdGlvbi5FRERNKCksCiAgICAgICAgInBhZ2VoaW5rbGV5Ijogc2ttdWx0aWZsb3cuZHJpZnRfZGV0ZWN0aW9uLlBhZ2VIaW5rbGV5KAogICAgICAgICAgICBtaW5faW5zdGFuY2VzPWxlbihlcnJvcl9zdHJlYW0pLCB0aHJlc2hvbGQ9cGFnZWhpbmtsZXlfdGhyZXNob2xkCiAgICAgICAgKSwKICAgICAgICAiZGRtIjogc2ttdWx0aWZsb3cuZHJpZnRfZGV0ZWN0aW9uLkRETSgKICAgICAgICAgICAgbWluX251bV9pbnN0YW5jZXM9bGVuKGVycm9yX3N0cmVhbSksCiAgICAgICAgICAgIHdhcm5pbmdfbGV2ZWw9ZGRtX3dhcm5pbmdfbGV2ZWwsCiAgICAgICAgICAgIG91dF9jb250cm9sX2xldmVsPWRkbV9vdXRfY29udHJvbF9sZXZlbCwKICAgICAgICApLAogICAgfQoKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIlN0cmVhbWluZyBkYXRhIHRvIG1vZGVscyIpCiAgICBmb3IgaSBpbiByYW5nZShsZW4oZXJyb3Jfc3RyZWFtKSk6CiAgICAgICAgZm9yIG1vZGVsX25hbWUsIG1vZGVsIGluIG1vZGVscy5pdGVtcygpOgogICAgICAgICAgICBtb2RlbC5hZGRfZWxlbWVudChlcnJvcl9zdHJlYW1baV0pCgogICAgY29udGV4dC5sb2dnZXIuaW5mbygiTG9nZ2luZyByZWFkeSBtb2RlbHMiKQogICAgZm9yIG5hbWUsIG1vZGVsIGluIG1vZGVscy5pdGVtcygpOgogICAgICAgIGRhdGEgPSBkdW1wcyhtb2RlbCkKICAgICAgICBtb2RlbF9maWxlID0gZiJ7bmFtZX0ucGtsIgogICAgICAgIGNvbnRleHQubG9nX21vZGVsKAogICAgICAgICAgICBmIntuYW1lfV9jb25jZXB0X2RyaWZ0IiwKICAgICAgICAgICAgYm9keT1kYXRhLAogICAgICAgICAgICBsYWJlbHM9eyJmcmFtZXdvcmsiOiAic2ttdWx0aWZsb3ciLCAid29ya2Zsb3ciOiAiY29uY2VwdC1kcmlmdCJ9LAogICAgICAgICAgICBtb2RlbF9maWxlPW1vZGVsX2ZpbGUsCiAgICAgICAgICAgIG1vZGVsX2Rpcj1tb2RlbHNfZGVzdCwKICAgICAgICAgICAgdGFnPSJsYXRlc3QiLAogICAgICAgICkKICAgICAgICBmbi5zZXRfZW52cygKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgZiJ7bmFtZX1fbW9kZWxfcGF0aCI6IG9zLnBhdGguam9pbigKICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmFydGlmYWN0X3BhdGgsIG1vZGVsc19kZXN0LCBtb2RlbF9maWxlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIH0KICAgICAgICApCgogICAgY29udGV4dC5sb2dnZXIuaW5mbygiRGVwbG95aW5nIENvbmNlcHQgRHJpZnQgU3RyZWFtaW5nIGZ1bmN0aW9uIikKICAgIGZuLnNldF9lbnZzKAogICAgICAgIHsKICAgICAgICAgICAgImxhYmVsX2NvbCI6IGxhYmVsX2NvbCwKICAgICAgICAgICAgInByZWRpY3Rpb25fY29sIjogcHJlZGljdGlvbl9jb2wsCiAgICAgICAgICAgICJkcmlmdF9zdHJlYW0iOiBvdXRwdXRfc3RyZWFtLAogICAgICAgICAgICAidHNkYl90YWJsZSI6IG91dHB1dF90c2RiLAogICAgICAgICAgICAicGFnZWhpbmtsZXlfdGhyZXNob2xkIjogcGFnZWhpbmtsZXlfdGhyZXNob2xkLAogICAgICAgICAgICAiZGRtX3dhcm5pbmdfbGV2ZWwiOiBkZG1fd2FybmluZ19sZXZlbCwKICAgICAgICAgICAgImRkbV9vdXRfY29udHJvbCI6IGRkbV9vdXRfY29udHJvbF9sZXZlbCwKICAgICAgICB9CiAgICApCiAgICBmbi5hZGRfdjNpb19zdHJlYW1fdHJpZ2dlcihzdHJlYW1fcGF0aCA9IGlucHV0X3N0cmVhbSwgbmFtZSA9ICdzdHJlYW0nLCBncm91cCA9IGNvbnN1bWVyX2dyb3VwKQogICAgZm4uYXBwbHkobW91bnRfdjNpbygpKQogICAgZm4uZGVwbG95KHByb2plY3Q9Y29udGV4dC5wcm9qZWN0KQo=
    commands:
    - python -m pip install scikit-multiflow
    code_origin: https://github.com/daniels290813/functions.git#d96059851b5d51fd4583e982483eb973fccc47d2:/User/test/functions/concept_drift/concept_drift.py
    origin_filename: /User/test/functions/concept_drift/concept_drift.py
  disable_auto_mount: false
  affinity: null
verbose: false
