kind: job
metadata:
  name: sklearn-classifier
  tag: ''
  hash: c61b4b98298143c71495d870a78d652d0c4075bf
  project: ''
  labels:
    author: yjb
    stage: development
  categories:
  - models
  - classifier
spec:
  command: ''
  args: []
  image: mlrun/ml-models:0.4.5
  env: []
  default_handler: train_model
  description: ''
  image_pull_policy: Always
  build:
    functionSourceCode: aW1wb3J0IGpzb24KaW1wb3J0IG9zCmZyb20gaW1wb3J0bGliIGltcG9ydCBpbXBvcnRfbW9kdWxlCmZyb20gaW5zcGVjdCBpbXBvcnQgZ2V0ZnVsbGFyZ3NwZWMsIEZ1bGxBcmdTcGVjCmZyb20gY2xvdWRwaWNrbGUgaW1wb3J0IGR1bXAsIGxvYWQKaW1wb3J0IGl0ZXJ0b29scwoKaW1wb3J0IHNrbGVhcm4KaW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgcHlhcnJvdyBhcyBwYQppbXBvcnQgcHlhcnJvdy5wYXJxdWV0IGFzIHBxCmltcG9ydCBudW1weSBhcyBucAppbXBvcnQgbWF0cGxvdGxpYi5weXBsb3QgYXMgcGx0CmltcG9ydCBzZWFib3JuIGFzIHNucwoKZnJvbSBza2xlYXJuLnV0aWxzLnRlc3RpbmcgaW1wb3J0IGFsbF9lc3RpbWF0b3JzCmZyb20gc2tsZWFybi5kYXRhc2V0cyBpbXBvcnQgbWFrZV9jbGFzc2lmaWNhdGlvbgpmcm9tIHNrbGVhcm4ucHJlcHJvY2Vzc2luZyBpbXBvcnQgbGFiZWxfYmluYXJpemUKZnJvbSBza2xlYXJuLm1vZGVsX3NlbGVjdGlvbiBpbXBvcnQgdHJhaW5fdGVzdF9zcGxpdApmcm9tIHNrbGVhcm4gaW1wb3J0IG1ldHJpY3MKCmZyb20gdHlwaW5nIGltcG9ydCBVbmlvbiwgTGlzdCwgQW55LCBPcHRpb25hbApmcm9tIG1scnVuLmV4ZWN1dGlvbiBpbXBvcnQgTUxDbGllbnRDdHgKZnJvbSBtbHJ1bi5kYXRhc3RvcmUgaW1wb3J0IERhdGFJdGVtCmZyb20gbWxydW4uYXJ0aWZhY3RzIGltcG9ydCBQbG90QXJ0aWZhY3QKCnNrdmVyc2lvbiA9IHNrbGVhcm4uX192ZXJzaW9uX18KCmltcG9ydCB3YXJuaW5ncwoKd2FybmluZ3Muc2ltcGxlZmlsdGVyKGFjdGlvbj0iaWdub3JlIiwgY2F0ZWdvcnk9RnV0dXJlV2FybmluZykKCgpkZWYgX2djZl9jbGVhcihwbHQpOgogICAgIiIiVXRpbGl0eSB0byBjbGVhciBtYXRwbG90bGliIGZpZ3VyZQoKICAgIFJ1biB0aGlzIGluc2lkZSBldmVyeSBwbG90IG1ldGhvZCBiZWZvcmUgY2FsbGluZyBhbnkgbWF0cGxvdGxpYgogICAgbWV0aG9kcwoKICAgIDpwYXJhbSBwbG90OiAgICBtYXRsb2JsaWIgZmlndXJlIG9iamVjdAogICAgIiIiCiAgICBwbHQuY2xhKCkKICAgIHBsdC5jbGYoKQogICAgcGx0LmNsb3NlKCkKCgpkZWYgX2NyZWF0ZV9jbGFzcyhwa2dfY2xhc3M6IHN0cik6CiAgICAiIiJDcmVhdGUgYSBjbGFzcyBmcm9tIGEgcGFja2FnZS5tb2R1bGUuY2xhc3Mgc3RyaW5nCgogICAgOnBhcmFtIHBrZ19jbGFzczogIGZ1bGwgY2xhc3MgbG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgZS5nLiAic2tsZWFybi5tb2RlbF9zZWxlY3Rpb24uR3JvdXBLRm9sZCIKICAgICIiIgogICAgc3BsaXRzID0gcGtnX2NsYXNzLnNwbGl0KCIuIikKICAgIGNsZmNsYXNzID0gc3BsaXRzWy0xXQogICAgcGtnX21vZHVsZSA9IHNwbGl0c1s6LTFdCiAgICBjbGFzc18gPSBnZXRhdHRyKGltcG9ydF9tb2R1bGUoIi4iLmpvaW4ocGtnX21vZHVsZSkpLCBjbGZjbGFzcykKICAgIHJldHVybiBjbGFzc18KCmRlZiBfY3JlYXRlX2Z1bmN0aW9uKHBrZ19mdW5jOiBsaXN0KToKICAgICIiIkNyZWF0ZSBhIGZ1bmN0aW9uIGZyb20gYSBwYWNrYWdlLm1vZHVsZS5mdW5jdGlvbiBzdHJpbmcKCiAgICA6cGFyYW0gcGtnX2Z1bmM6ICBmdWxsIGZ1bmN0aW9uIGxvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgZS5nLiAic2tsZWFybi5mZWF0dXJlX3NlbGVjdGlvbi5mX2NsYXNzaWYiCiAgICAiIiIKICAgIHNwbGl0cyA9IHBrZ19mdW5jLnNwbGl0KCIuIikKICAgIHBrZ19tb2R1bGUgPSAiLiIuam9pbihzcGxpdHNbOi0xXSkKICAgIGNiX2ZuYW1lID0gc3BsaXRzWy0xXQogICAgcGtnX21vZHVsZSA9IF9faW1wb3J0X18ocGtnX21vZHVsZSwgZnJvbWxpc3Q9W2NiX2ZuYW1lXSkKICAgIGZ1bmN0aW9uXyA9IGdldGF0dHIocGtnX21vZHVsZSwgY2JfZm5hbWUpCiAgICByZXR1cm4gZnVuY3Rpb25fCgpkZWYgZ2V0X21vZGVsX2NvbmZpZ3MoCiAgICBteV9tb2RlbHM6IFVuaW9uW3N0ciwgTGlzdFtzdHJdXSwKICAgIGNsYXNzX2tleSA9ICJDTEFTUyIsCiAgICBmaXRfa2V5ID0gIkZJVCIsCiAgICBtZXRhX2tleSA9ICJNRVRBIiwKKSAtPiBVbmlvbltkaWN0LCBMaXN0W2RpY3RdXToKICAgICIiImJ1aWxkIHNrbGVhcm4gbW9kZWwgY29uZmlndXJhdGlvbiBwYXJhbWV0ZXJzCiAgICAKICAgIFRha2UgKGZ1bGwpIGNsYXNzIG5hbWUgb2YgYW4gc2Npa2l0LWxlYXJuIG1vZGVsIAogICAgYW5kIHJldHJpZXZlIGl0cyBgY2xhc3NgIGFuZCBgZml0YCBwYXJhbWV0ZXJzIGFuZAogICAgdGhlaXIgZGVmYXVsdCB2YWx1ZXMuCiAgICAKICAgIEFsc28gcmV0dXJucyBzb21lIHVzZWZ1bCBtZXRhZGF0YSB2YWx1ZXMgZm9yIHRoZSBjbGFzcwogICAgIiIiCiAgICAjIGdldCBhIGxpc3Qgb2YgYWxsIHNrbGVhcm4gZXN0aW1hdG9ycwogICAgZXN0aW1hdG9ycyA9IGFsbF9lc3RpbWF0b3JzKCkKICAgIGRlZiBfZ2V0X2VzdGltYXRvcihwa2dfY2xhc3MpOgogICAgICAgICIiImZpbmQgYSBzcGVjaWZpYyBjbGFzcyBpbiBhIGxpc3Qgb2Ygc2tsZWFybiBlc3RpbWF0b3JzIiIiCiAgICAgICAgbXlfY2xhc3MgPSBwa2dfY2xhc3Muc3BsaXQoJy4nKVstMV0KICAgICAgICByZXR1cm4gbGlzdChmaWx0ZXIobGFtYmRhIHg6IHhbMF0gPT0gbXlfY2xhc3MsIGVzdGltYXRvcnMpKVswXQoKICAgICMgZmluZCBlc3RpbWF0b3JzIGNvcnJlc3BvbmRpbmcgdG8gbXlfbW9kZWxzIGxpc3QKICAgIG15X2VzdGltYXRvcnMgPSBbXQogICAgbXlfbW9kZWxzID0gW215X21vZGVsc10gaWYgaXNpbnN0YW5jZShteV9tb2RlbHMsIHN0cikgZWxzZSBteV9tb2RlbHMKICAgIGZvciBtb2RlbCBpbiBteV9tb2RlbHM6CiAgICAgICAgZXN0aW1hdG9yX25hbWUsIGVzdGltYXRvcl9jbGFzcyA9IF9nZXRfZXN0aW1hdG9yKG1vZGVsKQogICAgICAgIG15X2VzdGltYXRvcnMuYXBwZW5kKChlc3RpbWF0b3JfbmFtZSwgZXN0aW1hdG9yX2NsYXNzKSkKCiAgICAjIGdldCBjbGFzcyBhbmQgZml0IHNwZWNzCiAgICBlc3RpbWF0b3Jfc3BlY3MgPSBbXQogICAgZm9yIGFuX2VzdGltYXRvciBpbiBteV9lc3RpbWF0b3JzOgogICAgICAgIGVzdGltYXRvcl9zcGVjcy5hcHBlbmQoKGFuX2VzdGltYXRvclswXSwgIyBtb2RlbCBvbmx5IG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRmdWxsYXJnc3BlYyhhbl9lc3RpbWF0b3JbMV0pLCAjIGNsYXNzIHBhcmFtcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldGZ1bGxhcmdzcGVjKGFuX2VzdGltYXRvclsxXS5maXQpLCAjIGZpdCBwYXJhbXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbl9lc3RpbWF0b3JbMV0pKSAjIHBhY2thZ2UubW9kdWxlLm1vZGVsCgogICAgbW9kZWxfY29uZmlncyA9IFtdCgogICAgZm9yIGVzdGltYXRvciBpbiBlc3RpbWF0b3Jfc3BlY3M6CiAgICAgICAgbW9kZWxfanNvbiA9IHtjbGFzc19rZXk6IHt9LCBmaXRfa2V5OiB7fX0KICAgICAgICBmaXRfcGFyYW1zID0ge30KCiAgICAgICAgZm9yIGksIGtleSBpbiBlbnVtZXJhdGUobW9kZWxfanNvbi5rZXlzKCkpOgogICAgICAgICAgICBmID0gZXN0aW1hdG9yW2krMV0KICAgICAgICAgICAgYXJnc19wYWlyZWQgPSBbXQogICAgICAgICAgICBkZWZzX3BhaXJlZCA9IFtdCgogICAgICAgICAgICAjIHJldmVyc2UgdGhlIGFyZ3Mgc2luY2UgdGhlcmUgYXJlIGZld2VyIGRlZmF1bHRzIHRoYW4gYXJncwogICAgICAgICAgICBhcmdzID0gZi5hcmdzCiAgICAgICAgICAgIGFyZ3MucmV2ZXJzZSgpCiAgICAgICAgICAgIG5fYXJncyA9IGxlbihhcmdzKQoKICAgICAgICAgICAgZGVmcyA9IGYuZGVmYXVsdHMKICAgICAgICAgICAgaWYgZGVmcyBpcyBOb25lOgogICAgICAgICAgICAgICAgZGVmcyA9IFtkZWZzXQogICAgICAgICAgICBkZWZzID0gbGlzdChkZWZzKQogICAgICAgICAgICBkZWZzLnJldmVyc2UoKQogICAgICAgICAgICBuX2RlZnMgPSBsZW4oZGVmcykKCiAgICAgICAgICAgIG5fc21hbGxlc3QgPSBtaW4obl9hcmdzLCBuX2RlZnMpCiAgICAgICAgICAgIG5fbGFyZ2VzdCA9IG1heChuX2FyZ3MsIG5fZGVmcykKCiAgICAgICAgICAgICMgYnVpbGQgMiBsaXN0cyB0aGF0IGNhbiBiZSBjb25jYXRlbmF0ZWQKICAgICAgICAgICAgZm9yIGl4IGluIHJhbmdlKG5fc21hbGxlc3QpOgogICAgICAgICAgICAgICAgaWYgYXJnc1tpeF0gaXMgbm90ICJzZWxmIjoKICAgICAgICAgICAgICAgICAgICBhcmdzX3BhaXJlZC5hcHBlbmQoYXJnc1tpeF0pCiAgICAgICAgICAgICAgICAgICAgZGVmc19wYWlyZWQuYXBwZW5kKGRlZnNbaXhdKQoKICAgICAgICAgICAgZm9yIGl4IGluIHJhbmdlKG5fc21hbGxlc3QsIG5fbGFyZ2VzdCk6CiAgICAgICAgICAgICAgICBpZiBpeCBpcyBub3QgMCBhbmQgYXJnc1tpeF0gaXMgbm90ICJzZWxmIjoKICAgICAgICAgICAgICAgICAgICBhcmdzX3BhaXJlZC5hcHBlbmQoYXJnc1tpeF0pCiAgICAgICAgICAgICAgICAgICAgZGVmc19wYWlyZWQuYXBwZW5kKE5vbmUpCiAgICAgICAgICAgICAgICMgY29uY2F0ZW5hdGUgbGlzdHMgaW50byBhcHByb3ByaWF0ZSBzdHJ1Y3R1cmUKICAgICAgICAgICAgbW9kZWxfanNvbltrZXldID0gZGljdCh6aXAocmV2ZXJzZWQoYXJnc19wYWlyZWQpLCByZXZlcnNlZChkZWZzX3BhaXJlZCkpKQoKICAgICAgICBtb2RlbF9qc29uW21ldGFfa2V5XSA9IHt9CiAgICAgICAgbW9kZWxfanNvblttZXRhX2tleV1bJ3NrbGVhcm5fdmVyc2lvbiddID0gc2t2ZXJzaW9uCiAgICAgICAgbW9kZWxfanNvblttZXRhX2tleV1bJ2NsYXNzJ10gPSAnLicuam9pbihbZXN0aW1hdG9yWzNdLl9fbW9kdWxlX18sIGVzdGltYXRvclswXV0pCiAgICAgICAgbW9kZWxfY29uZmlncy5hcHBlbmQobW9kZWxfanNvbikKICAgIGlmIGxlbihtb2RlbF9jb25maWdzKSA9PSAxOgogICAgICAgICMgZG8gd2Ugd2FudCB0byBsb2cgdGhpcyBtb2RpZmllZCBtb2RlbCBhcyBhbiBhcnRpZmFjdD8KICAgICAgICByZXR1cm4gbW9kZWxfY29uZmlnc1swXQogICAgZWxzZToKICAgICAgICAjIGRvIHdlIHdhbnQgdG8gbG9nIHRoaXMgbW9kaWZpZWQgbW9kZWwgYXMgYW4gYXJ0aWZhY3Q/CiAgICAgICAgcmV0dXJuIG1vZGVsX2NvbmZpZ3MKCmRlZiB1cGRhdGVfbW9kZWxfY29uZmlnKAogICAgY29uZmlnOiBkaWN0LAogICAgbmV3X2NsYXNzOiBkaWN0LAogICAgbmV3X2ZpdDogZGljdCwKICAgIGNsYXNzX2tleTogc3RyID0gIkNMQVNTIiwKICAgIGZpdF9rZXk6IHN0ciA9ICJGSVQiCik6CiAgICAiIiJVcGRhdGUgbW9kZWwgY29uZmlnIGpzb24KICAgICAgICAKICAgIFRoaXMgZnVuY3Rpb24gaXMgZXNzZW50aWFsIHNpbmNlIHRoZXJlIGFyZSBtb2RpZmljYXRpb25zIGluIGNsYXNzCiAgICBhbmQgZml0IHBhcmFtcyB0aGF0IG11c3QgYmUgbWFkZSAoY2FsbGJhY2tzIGFyZSBhIGdvb2QgZXhhbXBsZSwgd2l0aG91dAogICAgd2hpY2ggdGhlcmUgaXMgbm8gdHJhaW5pbmcgaGlzdG9yeSBhdmFpbGFibGUpCiAgICAKICAgIFRPRE86ICBjdXJyZW50bHkgYSBtb2RlbCBjb25maWcgY29udGFpbnMgMiBrZXlzLCBidXQgdGhpcyB3aWxsIGxpa2VseQogICAgZXhwYW5kIHRvIGluY2x1ZGUgb3RoZXIgZnVuY3Rpb25zIGJleW9uZCBjbGFzcyBhbmQgZml0LiBTbyBuZWVkIHRvIGV4cGFuZCAKICAgIHRoaXMgdG8gYSBsaXN0IG9mIFR1cGxlKHN0ciwgZGljdCksIHdoZXJlIGBzdHJgIGNvcnJlc3BvbmRzIHRvIGEga2V5CiAgICBpbiB0aGUgbW9kZWwgY29uZmlnIGFuZCBgZGljdGAgY29udGFpbnMgdGhlIHBhcmFtcyBhbmQgdGhlaXIgbmV3IHZhbHVlcy4KICAgIAogICAgOnBhcmFtIGNvbmZpZzogICAgICBvcmlnaW5hbCBtb2RlbCBkZWZpbml0aW9uIGNvbnRhaW5pbmcgMiBrZXlzLCBDTEFTUyBhbmQgRklUCiAgICA6cGFyYW0gbmV3X2NsYXNzOiAgIG5ldyBjbGFzcyBrZXktdmFsdWVzCiAgICA6cGFyYW0gbmV3X2ZpdDogICAgIG5ldyBmaXQga2V5LXZhbHVlcwogICAgIiIiCiAgICBjb25maWdbY2xhc3Nfa2V5XS51cGRhdGUobmV3X2NsYXNzKQogICAgY29uZmlnW2ZpdF9rZXldLnVwZGF0ZShuZXdfZml0KQogICAgCiAgICByZXR1cm4gY29uZmlnCgpkZWYgdHJhaW5fbW9kZWwoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIG1vZGVsX3BrZ19jbGFzczogc3RyLAogICAgZGF0YV9rZXk6IFVuaW9uW0RhdGFJdGVtLCBzdHJdLAogICAgc2FtcGxlOiBpbnQsCiAgICBsYWJlbF9jb2x1bW46IHN0ciwKICAgIG1vZGVsX2tleTogc3RyID0gIm1vZGVsIiwKICAgIHRlc3Rfc2l6ZTogZmxvYXQgPSAwLjA1LAogICAgdHJhaW5fdmFsX3NwbGl0OiBmbG9hdCA9IDAuNzUsCiAgICB0ZXN0X3NldF9rZXk6IHN0ciA9ICJ0ZXN0X3NldCIsCiAgICBybmc6IGludCA9IDEsCiAgICBtb2RlbHNfZGlyOiBzdHIgPSAibW9kZWxzIiwKICAgIHBsb3RzX2Rpcjogc3RyID0gInBsb3RzIiwKICAgIHNjb3JlX21ldGhvZDogc3RyID0gIm1pY3JvIiwKICAgIGNsYXNzX3BhcmFtc191cGRhdGVzOiBVbmlvbltEYXRhSXRlbSwgZGljdF0gPSB7fSwKICAgIGZpdF9wYXJhbXNfdXBkYXRlczogVW5pb25bRGF0YUl0ZW0sIGRpY3RdID0ge30sCikgLT4gTm9uZToKICAgICIiInRyYWluIGEgY2xhc3NpZmllci4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0gbW9kZWxfcGtnX2NsYXNzOiAgIHRoZSBtb2RlbCB0byB0cmFpbiwgZS5nLCAnc2tsZWFybi5uZXVyYWxfbmV0d29ya3MuTUxQQ2xhc3NpZmllcicKICAgIDpwYXJhbSBkYXRhX2tleTogICAgICAgICAgKCJyYXciKSBuYW1lIG9mIHJhdyBkYXRhIGZpbGUKICAgIDpwYXJhbSBzYW1wbGU6ICAgICAgICAgICAgU2VsZWN0cyB0aGUgZmlyc3QgbiByb3dzLCBvciBzZWxlY3QgYSBzYW1wbGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRpbmcgZnJvbSB0aGUgZmlyc3QuIElmIG5lZ2F0aXZlIDwtMSwgc2VsZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgcmFuZG9tIHNhbXBsZQogICAgOnBhcmFtIGxhYmVsX2NvbHVtbjogICAgICBncm91bmQtdHJ1dGggKHkpIGxhYmVscwogICAgOnBhcmFtIG1vZGVsX2tleTogICAgICAgICAoJ21vZGVsJykgbmFtZSBvZiBtb2RlbCBpbiBhcnRpZmFjdCBzdG9yZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzIHRvIGEgZGlyZWN0b3J5CiAgICA6cGFyYW0gdGVzdF9zaXplOiAgICAgICAgICgwLjA1KSB0ZXN0IHNldCBzaXplCiAgICA6cGFyYW0gdHJhaW5fdmFsX3NwbGl0OiAgICgwLjc1KSBPbmNlIHRoZSB0ZXN0IHNldCBoYXMgYmVlbiByZW1vdmVkIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFpbmluZyBzZXQgZ2V0cyB0aGlzIHByb3BvcnRpb24uCiAgICA6cGFyYW0gdGVzdF9zZXRfa2V5OiAgICAgIHN0b3JlIHRoZSB0ZXN0IGRhdGEgc2V0IHVuZGVyIHRoaXMga2V5IGluIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnRpZmFjdCBzdG9yZQogICAgOnBhcmFtIHJuZzogICAgICAgICAgICAgICAoMSkgc2tsZWFybiBybmcgc2VlZAogICAgOnBhcmFtIG1vZGVsc19kaXI6ICAgICAgICBtb2RlbHMgc3ViZm9sZGVyIG9uIGFydGlmYWN0IHBhdGgKICAgIDpwYXJhbSBwbG90c19kaXI6ICAgICAgICAgcGxvdCBzdWJmb2xkZXIgb24gYXJ0aWZhY3QgcGF0aAogICAgOnBhcmFtIHNjb3JlX21ldGhvZDogICAgICBmb3IgbXVsdGljbGFzcyBjbGFzc2lmaWNhdGlvbgogICAgOnBhcmFtIGNsYXNzX3VwZGF0ZXM6ICAgICB1cGRhdGUgdGhlc2Ugc2Npa2l0LWxlYXJuIGNsYXNzaWZpZXIgcGFyYW1zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dCBhcyBhIGRpY3QKICAgIDpwYXJhbSBmaXRfdXBkYXRlczogICAgICAgdXBkYXRlIHNjaWtpdC1sZWFybiBmaXQgcGFyYW1ldGVycywgaW5wdXQgYXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSBkaWN0LgogICAgIiIiCiAgICBiYXNlX3BhdGggPSBjb250ZXh0LmFydGlmYWN0X3BhdGgKICAgIG9zLm1ha2VkaXJzKGJhc2VfcGF0aCwgZXhpc3Rfb2s9VHJ1ZSkKICAgIAogICAgIyBleHRyYWN0IGZpbGUgbmFtZSBmcm9tIERhdGFJdGVtCiAgICBzcmNmaWxlcGF0aCA9IHN0cihkYXRhX2tleSkKICAgIAogICAgIyBUT0RPOiB0aGlzIHNob3VsZCBiZSBwYXJ0IG9mIGRhdGEncyBtZXRhZGF0YSBkZWFsdCB3aXRoIGluIGFub3RoZXIgc3RlcCBnZXQgYSBkYXRhIHNldCwgc2FtcGxlLCBldGMuLi4KICAgICMgZ2V0IGFsbCBkYXRhIG9yIGEgc2FtcGxlCiAgICBpZiAoc2FtcGxlID09IC0xKSBvciAoc2FtcGxlID49IDEpOgogICAgICAgICMgZ2V0IGFsbCByb3dzLCBvciBjb250aWd1b3VzIHNhbXBsZSBzdGFydGluZyBhdCByb3cgMS4KICAgICAgICByYXcgPSBwcS5yZWFkX3RhYmxlKHNyY2ZpbGVwYXRoKS50b19wYW5kYXMoKS5kcm9wbmEoKQogICAgICAgIGxhYmVscyA9IHJhdy5wb3AobGFiZWxfY29sdW1uKQogICAgICAgIHJhdyA9IHJhdy5pbG9jWzpzYW1wbGUsIDpdCiAgICAgICAgbGFiZWxzID0gbGFiZWxzLmlsb2NbOnNhbXBsZV0KICAgIGVsc2U6CiAgICAgICAgIyBncmFiIGEgcmFuZG9tIHNhbXBsZQogICAgICAgIHJhdyA9IHBxLnJlYWRfdGFibGUoc3JjZmlsZXBhdGgpLnRvX3BhbmRhcygpLmRyb3BuYSgpLnNhbXBsZShzYW1wbGUgKiAtMSkKICAgICAgICBsYWJlbHMgPSByYXcucG9wKGxhYmVsX2NvbHVtbikKCiAgICAjIFRPRE86IHRoaXMgc2hvdWxkIGJlIHBhcnQgb2YgZGF0YSdzIG1ldGFkYXRhIGRlYWx0IHdpdGggaW4gYW5vdGhlciBzdGVwCiAgICBjb250ZXh0LmhlYWRlciA9IHJhdy5jb2x1bW5zLnZhbHVlcwogICAgCiAgICAjIFRPRE86IGFsbCBvZiB0aGlzIHNob3VsZCBiZSBwYXJ0IG9mIGEgc3BpdHRlciBjb21wb25lbnQgdGhhdCBkb2VzIGN2IHRvbywgZGVhbHQgd2l0aCBpbiBhbm90aGVyIHN0ZXAKICAgICMgbWFrZSBhIGhvdCBlbmNvZGUgY29weSBvZiBsYWJlbHMgYmVmb3JlIHRoZSBzcGxpdAogICAgeWIgPSBsYWJlbF9iaW5hcml6ZShsYWJlbHMsIGNsYXNzZXM9bGlzdChyYW5nZShyYXcuc2hhcGVbMV0pKSkKICAgICMgZG91YmxlIHNwbGl0IHRvIGdlbmVyYXRlIDMgZGF0YSBzZXRzOiB0cmFpbiwgdmFsaWRhdGlvbiBhbmQgdGVzdAogICAgIyB3aXRoIHh0ZXN0LHl0ZXN0IHNldCBhc2lkZQogICAgeCwgeHRlc3QsIHksIHl0ZXN0ID0gdHJhaW5fdGVzdF9zcGxpdChucC5jb25jYXRlbmF0ZShbcmF3LCB5Yl0sIGF4aXM9MSksIGxhYmVscywgdGVzdF9zaXplPXRlc3Rfc2l6ZSwgcmFuZG9tX3N0YXRlPXJuZykKICAgIHh0cmFpbiwgeHZhbGlkLCB5dHJhaW4sIHl2YWxpZCA9IHRyYWluX3Rlc3Rfc3BsaXQoeCwgeSwgdHJhaW5fc2l6ZT10cmFpbl92YWxfc3BsaXQsIHJhbmRvbV9zdGF0ZT1ybmcpCiAgICAjIGV4dHJhY3QgdGhlIGhvdF9lbmNvZGVkIGxhYmVscwogICAgeXRyYWluYiA9IHh0cmFpbls6LCAteWIuc2hhcGVbMV06XS5jb3B5KCkKICAgIHh0cmFpbiA9IHh0cmFpbls6LCA6LXliLnNoYXBlWzFdXS5jb3B5KCkKICAgICMgZXh0cmFjdCB0aGUgaG90X2VuY29kZWQgbGFiZWxzCiAgICB5dmFsaWRiID0geHZhbGlkWzosIC15Yi5zaGFwZVsxXTpdLmNvcHkoKQogICAgeHZhbGlkID0geHZhbGlkWzosIDoteWIuc2hhcGVbMV1dLmNvcHkoKQogICAgIyBleHRyYWN0IHRoZSBob3RfZW5jb2RlZCBsYWJlbHMKICAgIHl0ZXN0YiA9IHh0ZXN0WzosIC15Yi5zaGFwZVsxXTpdLmNvcHkoKQogICAgeHRlc3QgPSB4dGVzdFs6LCA6LXliLnNoYXBlWzFdXS5jb3B5KCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgIyBzZXQtYXNpZGUgdGVzdF9zZXQKICAgIHRlc3Rfc2V0ID0gcGQuY29uY2F0KAogICAgICAgIFtwZC5EYXRhRnJhbWUoZGF0YT14dGVzdCwgY29sdW1ucz1jb250ZXh0LmhlYWRlciksCiAgICAgICAgIHBkLkRhdGFGcmFtZShkYXRhPXl0ZXN0LCBjb2x1bW5zPVtsYWJlbF9jb2x1bW5dKV0sCiAgICAgICAgYXhpcz0xLCkKICAgIGZpbGVwYXRoID0gb3MucGF0aC5qb2luKGJhc2VfcGF0aCwgdGVzdF9zZXRfa2V5ICsgIi5wcXQiKQogICAgdGVzdF9zZXQudG9fcGFycXVldChmaWxlcGF0aCwgaW5kZXg9RmFsc2UpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdCh0ZXN0X3NldF9rZXksIGxvY2FsX3BhdGg9dGVzdF9zZXRfa2V5ICsgIi5wcXQiKQoKICAgICMgbG9hZCB0aGUgbW9kZWwgY29uZmlnCiAgICBtb2RlbF9jb25maWcgPSBnZXRfbW9kZWxfY29uZmlncyhtb2RlbF9wa2dfY2xhc3MpCiAgICAjIGdldCB1cGRhdGUgcGFyYW1zIGlmIGFueQogICAgaWYgaXNpbnN0YW5jZShjbGFzc19wYXJhbXNfdXBkYXRlcywgRGF0YUl0ZW0pOgogICAgICAgIGNsYXNzX3BhcmFtc191cGRhdGVzID0ganNvbi5sb2FkcyhjbGFzc19wYXJhbXNfdXBkYXRlcy5nZXQoKSkKICAgIGlmIGlzaW5zdGFuY2UoZml0X3BhcmFtc191cGRhdGVzLCBEYXRhSXRlbSk6CiAgICAgICAgZml0X3BhcmFtc191cGRhdGVzID0ganNvbi5sb2FkcyhmaXRfcGFyYW1zX3VwZGF0ZXMuZ2V0KCkpCiAgICAjIHVwZGF0ZSB0aGUgcGFyYW1ldGVycyAgICAgICAgICAgIAogICAgIyBhZGQgZGF0YSB0byBmaXQgcGFyYW1zCiAgICBmaXRfcGFyYW1zX3VwZGF0ZXMudXBkYXRlKHsnWCc6IHh0cmFpbiwneSc6IHl0cmFpbn0pCiAgICBtb2RlbF9jb25maWcgPSB1cGRhdGVfbW9kZWxfY29uZmlnKG1vZGVsX2NvbmZpZywgY2xhc3NfcGFyYW1zX3VwZGF0ZSwgZml0X3BhcmFtc191cGRhdGVzKQoKICAgICMgY3JlYXRlIGNsYXNzIGFuZCBmaXQKICAgIENsYXNzaWZpZXJDbGFzcyA9IF9jcmVhdGVfY2xhc3MobW9kZWxfY29uZmlnWyJNRVRBIl1bImNsYXNzIl0pCiAgICBtb2RlbCA9IENsYXNzaWZpZXJDbGFzcygqKmNsYXNzX3BhcmFtcykKICAgIG1vZGVsLmZpdCgqKmZpdF9wYXJhbXMpCgogICAgIyBzYXZlIG1vZGVsCiAgICBmaWxlcGF0aCA9IG9zLnBhdGguam9pbihiYXNlX3BhdGgsIGYie21vZGVsc19kaXJ9L3ttb2RlbF9rZXl9LnBrbCIpCiAgICBkdW1wKG1vZGVsLCBvcGVuKGZpbGVwYXRoLCAid2IiKSkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KG1vZGVsX2tleSwgbG9jYWxfcGF0aD1tb2RlbHNfZGlyKQoKICAgICMgY29tcHV0ZSB2YWxpZGF0aW9uIG1ldHJpY3MKICAgIHlwcmVkID0gbW9kZWwucHJlZGljdCh4dmFsaWQpCiAgICB5X3Njb3JlID0gbW9kZWwucHJlZGljdF9wcm9iYSh4dmFsaWQpCgogICAgYXZlcmFnZV9wcmVjaXNpb24gPSBhdmVyYWdlX3ByZWNpc2lvbl9zY29yZSh5dmFsaWRiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5X3Njb3JlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdmVyYWdlPXNjb3JlX21ldGhvZCkKCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJhY2N1cmFjeSIsIGZsb2F0KG1vZGVsLnNjb3JlKHh2YWxpZCwgeXZhbGlkKSkpCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJyb2NhdWMiLCByb2NfYXVjX3Njb3JlKHl2YWxpZGIsIHlfc2NvcmUpKQogICAgY29udGV4dC5sb2dfcmVzdWx0KGYiZjFfc2NvcmUiLCBmMV9zY29yZSh5dmFsaWQsIHlwcmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdmVyYWdlPXNjb3JlX21ldGhvZCkpCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJhdmdfcHJlY3Njb3JlIiwgYXZlcmFnZV9wcmVjaXNpb24pCgogICAgIyB2YWxpZGF0aW9uIHBsb3RzCiAgICAKICAgIHBsb3Rfcm9jKGNvbnRleHQsIHl2YWxpZGIsIHlfc2NvcmUpCiAgICBwbG90X2NvbmZ1c2lvbl9tYXRyaXgoY29udGV4dCwgeXZhbGlkLCB5cHJlZCwga2V5PSJjb25mdXNpb24iLCBmbXQ9InBuZyIpCgpkZWYgcGxvdF9yb2MoCiAgICBjb250ZXh0LAogICAgeV9sYWJlbHMsCiAgICB5X3Byb2JzLAogICAga2V5PSJyb2MiLAogICAgcGxvdHNfZGlyOiBzdHIgPSAicGxvdHMiLAogICAgZm10PSJwbmciLAogICAgeF9sYWJlbDogc3RyID0gImZhbHNlIHBvc2l0aXZlIHJhdGUiLAogICAgeV9sYWJlbDogc3RyID0gICJ0cnVlIHBvc2l0aXZlIHJhdGUiLAogICAgdGl0bGU6IHN0ciA9ICJyb2MgY3VydmUiLAogICAgbGVnZW5kX2xvYzogc3RyID0gImJlc3QiCik6CiAgICAiIiJwbG90IHJvYyBjdXJ2ZXMKICAgIAogICAgVE9ETzogIGFkZCBhdmVyYWdpbmcgbWV0aG9kIChhcyBzdHJpbmcpIHRoYXQgd2FzIHVzZWQgdG8gY3JlYXRlIHByb2JzLCAKICAgIGRpc3BsYXkgaW4gbGVnZW5kCiAgICAKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0geV9sYWJlbHM6ICAgICBncm91bmQgdHJ1dGggbGFiZWxzLCBob3QgZW5jb2RlZCBmb3IgbXVsdGljbGFzcyAgCiAgICA6cGFyYW0geV9wcm9iczogICAgICBtb2RlbCBwcmVkaWN0aW9uIHByb2JhYmlsaXRpZXMKICAgIDpwYXJhbSBrZXk6ICAgICAgICAgICgicm9jIikga2V5IG9mIHBsb3QgaW4gYXJ0aWZhY3Qgc3RvcmUKICAgIDpwYXJhbSBwbG90c19kaXI6ICAgICgicGxvdHMiKSBkZXN0aW5hdGlvbiBmb2xkZXIgcmVsYXRpdmUgcGF0aCB0byBhcnRpZmFjdCBwYXRoCiAgICA6cGFyYW0gZm10OiAgICAgICAgICAoInBuZyIpIHBsb3QgZm9ybWF0CiAgICA6cGFyYW0geF9sYWJlbDogICAgICAoImZhbHNlIHBvc2l0aXZlIHJhdGUiKSB4LWF4aXMgbGFiZWxzCiAgICA6cGFyYW0geV9sYWJlbDogICAgICAoInRydWUgcG9zaXRpdmUgcmF0ZSIpIHktYXhpcyBsYWJlbHMKICAgIDpwYXJhbSB0aXRsZTogICAgICAgICgicm9jIGN1cnZlIikgdGl0bGUgb2YgcGxvdAogICAgOnBhcmFtIGxlZ2VuZF9sb2M6ICAgKCJiZXN0IikgbG9jYXRpb24gb2YgcGxvdCBsZWdlbmQKICAgICIiIgogICAgIyBkb24ndCBib3RoZXIgaWYgdGhpcyBkb2Vzbid0IHdvcmsKICAgIGFzc2VydCB5X3Byb2JzLnNoYXBlID09IHlfbGFiZWxzLnNoYXBlCiAgICAKICAgICMgY2xlYXIgbWF0cGxvdGxpYiBjdXJyZW50IGZpZ3VyZQogICAgX2djZl9jbGVhcihwbHQpCiAgICAKICAgICMgZGF0YSBhY2N1bW11bGF0b3JzIGJ5IGNsYXNzCiAgICBmcHIgPSBkaWN0KCkKICAgIHRwciA9IGRpY3QoKQogICAgcm9jX2F1YyA9IGRpY3QoKQogICAgCiAgICAjIGRyYXcgNDUgZGVncmVlIGxpbmUKICAgIHBsdC5wbG90KFswLCAxXSwgWzAsIDFdLCAiay0tIikKICAgIAogICAgIyBsYWJlbGxpbmcKICAgIHBsdC54bGFiZWwoeF9sYWJlbCkKICAgIHBsdC55bGFiZWwoeV9sYWJlbCkKICAgIHBsdC50aXRsZSh0aXRsZSkKICAgIHBsdC5sZWdlbmQobG9jPWxlZ2VuZF9sb2MpCiAgICAKICAgICMgc2luZ2xlIFJPQyBvciBtdXRsaXBsZQogICAgZm9yIGkgaW4gcmFuZ2UoeV9sYWJlbHMuc2hhcGVbMV0pOgogICAgICAgIGZwcltpXSwgdHByW2ldLCBfID0gbWV0cmljcy5yb2NfY3VydmUoeV9sYWJlbHNbOiwgaV0sIHlfcHJvYnNbOiwgaV0sIHBvc19sYWJlbD0xKQogICAgICAgIHJvY19hdWNbaV0gPSBtZXRyaWNzLmF1YyhmcHJbaV0sIHRwcltpXSkKICAgICAgICBwbHQucGxvdChmcHJbaV0sIHRwcltpXSwgbGFiZWw9ZiJjbGFzcyB7aX0iKQoKICAgIGZuYW1lID0gZiJ7cGxvdHNfZGlyfS97a2V5fS57Zm10fSIKICAgIHBsdC5zYXZlZmlnKG9zLnBhdGguam9pbihjb250ZXh0LmFydGlmYWN0X3BhdGgsIGZuYW1lKSkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KFBsb3RBcnRpZmFjdChrZXksIGJvZHk9cGx0LmdjZigpKSwgbG9jYWxfcGF0aD1mbmFtZSkKICAgIAoKZGVmIHBsb3RfY29uZnVzaW9uX21hdHJpeCgKICAgIGNvbnRleHQ6IE1MQ2xpZW50Q3R4LAogICAgbGFiZWxzLAogICAgcHJlZGljdGlvbnMsCiAgICBrZXk6IHN0ciA9ICJjb25mdXNpb25fbWF0cml4IiwKICAgIHBsb3RzX2Rpcjogc3RyID0gInBsb3RzIiwKICAgIGNvbG9ybWFwOiBzdHIgPSAiQmx1ZXMiLAogICAgZm10OiBzdHIgPSAicG5nIiwKICAgIHNhbXBsZV93ZWlnaHQ9Tm9uZQopOgogICAgIiIiQ3JlYXRlIGEgY29uZnVzaW9uIG1hdHJpeC4KICAgIFBsb3QgYW5kIHNhdmUgYSBjb25mdXNpb24gbWF0cml4IHVzaW5nIHRlc3QgZGF0YSBmcm9tIGEKICAgIG1vZGVsbGluZSBzdGVwLgogICAgCiAgICBTZWUgaHR0cHM6Ly9zY2lraXQtbGVhcm4ub3JnL3N0YWJsZS9tb2R1bGVzL2dlbmVyYXRlZC9za2xlYXJuLm1ldHJpY3MuY29uZnVzaW9uX21hdHJpeC5odG1sCiAgICAKICAgIFRPRE86IGZpeCBsYWJlbCBhbGlnbm1lbnQKICAgIFRPRE86IGNvbnNpZGVyIHVzaW5nIGFub3RoZXIgcGFja2FnZWQgdmVyc2lvbgogICAgVE9ETzogcmVmYWN0b3IgdG8gdGFrZSBwYXJhbXMgZGljdCBmb3IgcGxvdCBvcHRpb25zCgogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgZnVuY3Rpb24gY29udGV4dAogICAgOnBhcmFtIGxhYmVsczogICAgICAgICAgdmFsaWRhdGlvbiBkYXRhIGdyb3VuZC10cnV0aCBsYWJlbHMKICAgIDpwYXJhbSBwcmVkaWN0aW9uczogICAgIHZhbGlkYXRpb24gZGF0YSBwcmVkaWN0aW9ucwogICAgOnBhcmFtIGtleTogICAgICAgICAgICAgc3RyCiAgICA6cGFyYW0gcGxvdHNfZGlyOiAgICAgICByZWxhdGl2ZSBwYXRoIG9mIHBsb3RzIGluIGFydGlmYWN0IHN0b3JlCiAgICA6cGFyYW0gY29sb3JtYXA6ICAgICAgICBjb2xvdXJtYXAgZm9yIGNvbmZ1c2lvbiBtYXRyaXgKICAgIDpwYXJhbSBmbXQ6ICAgICAgICAgICAgIHBsb3QgZm9ybWF0CiAgICA6cGFyYW0gc2FtcGxlX3dlaWdodDogICBzYW1wbGUgd2VpZ2h0cwogICAgIiIiCiAgICBfZ2NmX2NsZWFyKHBsdCkKICAgIAogICAgY20gPSBtZXRyaWNzLmNvbmZ1c2lvbl9tYXRyaXgobGFiZWxzLCBwcmVkaWN0aW9ucywgc2FtcGxlX3dlaWdodD1Ob25lKQogICAgc25zLmhlYXRtYXAoY20sIGFubm90PVRydWUsIGNtYXA9Y29sb3JtYXAsIHNxdWFyZT1UcnVlKQoKICAgIGZpZyA9IHBsdC5nY2YoKQogICAgZm5hbWUgPSBmIntwbG90c19kaXJ9L3trZXl9LntmbXR9IgogICAgZmlnLnNhdmVmaWcob3MucGF0aC5qb2luKGNvbnRleHQuYXJ0aWZhY3RfcGF0aCwgZm5hbWUpKQogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoUGxvdEFydGlmYWN0KGtleSwgYm9keT1maWcpLCBsb2NhbF9wYXRoPWZuYW1lKQo=
    commands: []
    code_origin: https://github.com/mlrun/functions.git#3e34c25f746a7e80c66d065dace3019c02cac8f6:sklearn_classifier/sklearn_classifier.py
