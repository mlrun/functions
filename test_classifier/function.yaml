kind: job
metadata:
  name: test-classifier
  tag: ''
  hash: b6f80b4f415323399a8ccdae2a5fc3f3f568738f
  project: ''
  categories: []
spec:
  command: ''
  args: []
  image: mlrun/ml-models:0.4.5
  env: []
  default_handler: test_classifier
  description: ''
  build:
    functionSourceCode: aW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCBpbXBvcnRsaWIKZnJvbSBjbG91ZHBpY2tsZSBpbXBvcnQgbG9hZAoKaW1wb3J0IG51bXB5IGFzIG5wCmltcG9ydCBwYW5kYXMgYXMgcGQKCmZyb20gc2tsZWFybi5wcmVwcm9jZXNzaW5nIGltcG9ydCBsYWJlbF9iaW5hcml6ZQoKZnJvbSBza2xlYXJuLm1ldHJpY3MgaW1wb3J0IChyb2NfYXVjX3Njb3JlLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdWMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZjFfc2NvcmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2ZXJhZ2VfcHJlY2lzaW9uX3Njb3JlLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb2NfY3VydmUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZ1c2lvbl9tYXRyaXgpCgpmcm9tIHNrbGVhcm4udXRpbHMubXVsdGljbGFzcyBpbXBvcnQgdW5pcXVlX2xhYmVscwoKaW1wb3J0IG1hdHBsb3RsaWIucHlwbG90IGFzIHBsdApmcm9tIG1hdHBsb3RsaWIuZmlndXJlIGltcG9ydCBGaWd1cmUKaW1wb3J0IHNlYWJvcm4gYXMgc25zCgpmcm9tIHR5cGluZyBpbXBvcnQgT3B0aW9uYWwsIFVuaW9uLCBMaXN0LCBUdXBsZQoKZnJvbSBtbHJ1bi5leGVjdXRpb24gaW1wb3J0IE1MQ2xpZW50Q3R4CmZyb20gbWxydW4uZGF0YXN0b3JlIGltcG9ydCBEYXRhSXRlbQpmcm9tIG1scnVuLmFydGlmYWN0cyBpbXBvcnQgVGFibGVBcnRpZmFjdCwgUGxvdEFydGlmYWN0CgppbXBvcnQgd2FybmluZ3MKd2FybmluZ3Muc2ltcGxlZmlsdGVyKGFjdGlvbj0iaWdub3JlIiwgY2F0ZWdvcnk9RnV0dXJlV2FybmluZykKCmRlZiBfZ2NmX2NsZWFyKHBsdCk6CiAgICBwbHQuY2xhKCkKICAgIHBsdC5jbGYoKQogICAgcGx0LmNsb3NlKCkgICAgICAgIAoKZGVmIHRlc3RfY2xhc3NpZmllcigKICAgIGNvbnRleHQ6IE1MQ2xpZW50Q3R4LAogICAgbW9kZWxzX2RpcjogVW5pb25bRGF0YUl0ZW0sIHN0cl0sIAogICAgdGVzdF9zZXQ6IERhdGFJdGVtLAogICAgbGFiZWxfY29sdW1uOiBzdHIsCiAgICBzY29yZV9tZXRob2Q6IHN0ciA9ICdtaWNybycsCiAgICBrZXk6IHN0ciA9ICIiCikgLT4gTm9uZToKICAgICIiIlRlc3Qgb25lIG9yIG1vcmUgY2xhc3NpZmllciBtb2RlbHMgYWdhaW5zdCBoZWxkLW91dCBkYXRhc2V0CiAgICAKICAgIFVzaW5nIGhlbGQtb3V0IHRlc3QgZmVhdHVyZXMsIGV2YWx1YXRlcyB0aGUgcGVmb3JtYW5jZSBvZiB0aGUgZXN0aW1hdGVkIG1vZGVsCiAgICAKICAgIENhbiBiZSBwYXJ0IG9mIGEga3ViZWZsb3cgcGlwZWxpbmUgYXMgYSB0ZXN0IHN0ZXAgdGhhdCBpcyBydW4gcG9zdCBFREEgYW5kIAogICAgdHJhaW5pbmcvdmFsaWRhdGlvbiBjeWNsZXMKICAgIAogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgdGhlIGZ1bmN0aW9uIGNvbnRleHQKICAgIDpwYXJhbSBtb2RlbHNfZGlyOiAgICAgIGFydGlmYWN0IG1vZGVscyByZXByZXNlbnRpbmcgYSBmb2xkZXIgb3IgYSBmb2xkZXIKICAgIDpwYXJhbSB0ZXN0X3NldDogICAgICAgIHRlc3QgZmVhdHVyZXMgYW5kIGxhYmVscwogICAgOnBhcmFtIGxhYmVsX2NvbHVtbjogICAgY29sdW1uIG5hbWUgZm9yIGdyb3VuZCB0cnV0aCBsYWJlbHMKICAgIDpwYXJhbSBzY29yZV9tZXRob2Q6ICAgICBmb3IgbXVsdGljbGFzcyBjbGFzc2lmaWNhdGlvbgogICAgOnBhcmFtIGtleTogICAgICAgICAgICAga2V5IGZvciByZXN1bHRzIGFydGlmYWN0CiAgICAiIiIKICAgIG9zLm1ha2VkaXJzKG9zLnBhdGguam9pbihjb250ZXh0LmFydGlmYWN0X3BhdGgsICJwbG90cyIpLCBleGlzdF9vaz1UcnVlKQoKICAgIHh0ZXN0ID0gcGQucmVhZF9jc3Yoc3RyKHRlc3Rfc2V0KSkKICAgIHl0ZXN0ID0geHRlc3QucG9wKGxhYmVsX2NvbHVtbikKCiAgICBjb250ZXh0LmhlYWRlciA9IGxpc3QoeHRlc3QuY29sdW1ucy52YWx1ZXMpCiAgICAKICAgIGRlZiBfZXZhbF9tb2RlbChtb2RlbCk6CiAgICAgICAgIyBlbmNsb3NlIGFsbCBleGNlcHQgbW9kZWwKICAgICAgICB5dGVzdGIgPSBsYWJlbF9iaW5hcml6ZSh5dGVzdCwgY2xhc3Nlcz1bMCwgMSwgMl0pCiAgICAgICAgY2xmID0gbG9hZChvcGVuKG9zLnBhdGguam9pbihzdHIobW9kZWxzX2RpciksIG1vZGVsKSwgInJiIikpCiAgICAgICAgaWYgY2FsbGFibGUoZ2V0YXR0cihjbGYsICJwcmVkaWN0X3Byb2JhIikpOgogICAgICAgICAgICB5X3Njb3JlID0gY2xmLnByZWRpY3RfcHJvYmEoeHRlc3QudmFsdWVzKQogICAgICAgICAgICB5cHJlZCA9IGNsZi5wcmVkaWN0KHh0ZXN0LnZhbHVlcykKICAgICAgICAgICAgcGxvdF9yb2MoY29udGV4dCwgeXRlc3RiLCB5X3Njb3JlLCBrZXk9ZiJyb2MiKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHlwcmVkID0gY2xmLnByZWRpY3QoeHRlc3QudmFsdWVzKSAjIHJlZmFjdG9yCiAgICAgICAgICAgIHlfc2NvcmUgPSBOb25lCiAgICAgICAgcGxvdF9jb25mdXNpb25fbWF0cml4KGNvbnRleHQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl0ZXN0LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5cHJlZCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3Nlcz1jb250ZXh0LmhlYWRlcls6LTFdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleT1mImNvbmZ1c2lvbiIpCiAgICAgICAgaWYgaGFzYXR0cihjbGYsICJmZWF0dXJlX2ltcG9ydGFuY2VzXyIpOgogICAgICAgICAgICBwcmludChjbGYpCiAgICAgICAgICAgIHBsb3RfaW1wb3J0YW5jZShjb250ZXh0LCBjbGYsIGtleT1mImZlYXRpbXAiKQogICAgICAgIGF2ZXJhZ2VfcHJlY2lzaW9uID0gYXZlcmFnZV9wcmVjaXNpb25fc2NvcmUoeXRlc3RiLCB5X3Njb3JlLCBhdmVyYWdlPXNjb3JlX21ldGhvZCkKICAgICAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJhY2N1cmFjeSIsIGZsb2F0KGNsZi5zY29yZSh4dGVzdC52YWx1ZXMsIHl0ZXN0LnZhbHVlcykpKQogICAgICAgIGNvbnRleHQubG9nX3Jlc3VsdChmInJvY2F1YyIsIHJvY19hdWNfc2NvcmUoeXRlc3RiLCB5X3Njb3JlKSkKICAgICAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJmMV9zY29yZSIsIGYxX3Njb3JlKHl0ZXN0LnZhbHVlcywgeXByZWQsIGF2ZXJhZ2U9c2NvcmVfbWV0aG9kKSkKICAgICAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJhdmdfcHJlY3Njb3JlIiwgYXZlcmFnZV9wcmVjaXNpb24pCgogICAgCiAgICBiZXN0X21vZGVsID0gTm9uZQogICAgZm9yIG1vZGVsIGluIG9zLmxpc3RkaXIoc3RyKG1vZGVsc19kaXIpKToKICAgICAgICBpZiBtb2RlbC5lbmRzd2l0aCgnLnBrbCcpOgogICAgICAgICAgICBfZXZhbF9tb2RlbChtb2RlbCkKICAgICAgICAgICAgIyBIQUNLOiB0aGVyZSBpcyBvbmx5IG9uZSBtb2RlbCBoZXJlCiAgICAgICAgICAgIGJlc3RfbW9kZWwgPSBtb2RlbAoKICAgICMgbG9nICdiZXN0IG1vZGVsJyBhcyBhcnRpZmFjdAogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoJ1RPREFZUy1NT0RFTFMtVEVTVC1SRVBPUlQnLCBsb2NhbF9wYXRoPWJlc3RfbW9kZWwpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdCgnREVQTE9ZJywgYm9keT1iJ3RydWUnLCBsb2NhbF9wYXRoPSdERVBMT1knKQ==
    commands: []
    code_origin: https://raw.githubusercontent.com/mlrun/functions/master/test_classifier/test_classifier.py
