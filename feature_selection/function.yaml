kind: job
metadata:
  name: feature-selection
  tag: ''
  hash: 82e4d43321eb2ce247dd6934ba7a2bed07d18907
  project: default
  labels:
    author: orz
  categories:
  - data-prep
  - ml
spec:
  command: ''
  args: []
  image: mlrun/ml-models
  env: []
  default_handler: feature_selection/feature_selection
  entry_points:
    show_values_on_bars:
      name: show_values_on_bars
      doc: ''
      parameters:
      - name: axs
        default: ''
      - name: h_v
        default: v
      - name: space
        default: 0.4
      outputs:
      - default: ''
      lineno: 24
    plot_stat:
      name: plot_stat
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: stat_name
        default: ''
      - name: stat_df
        default: ''
      outputs:
      - default: ''
      lineno: 46
    feature_selection:
      name: feature_selection
      doc: 'Applies selected feature selection statistical functions

        or models on our ''df_artifact''.


        Each statistical function or model will vote for it''s best K selected features.

        If a feature has >= ''min_votes'' votes, it will be selected.'
      parameters:
      - name: context
        doc: the function context
        default: ''
      - name: df_artifact
        default: ''
      - name: k
        doc: number of top features to select from each statistical function or model
        default: 2
      - name: min_votes
        doc: minimal number of votes (from a model or by statistical function) needed
          for a feature to be selected. Can be specified by percentage of votes or
          absolute number of votes
        default: 0.5
      - name: label_column
        type: str
        doc: ground-truth (y) labels
        default: Y
      - name: stat_filters
        doc: statistical functions to apply to the features (from sklearn.feature_selection)
        default:
        - f_classif
        - mutual_info_classif
        - chi2
        - f_regression
      - name: model_filters
        doc: models to use for feature evaluation, can be specified by model name
          (ex. LinearSVC), formalized json (contains 'CLASS', 'FIT', 'META') or a
          path to such json file.
        default:
          LinearSVC: LinearSVC
          LogisticRegression: LogisticRegression
          ExtraTreesClassifier: ExtraTreesClassifier
      - name: max_scaled_scores
        doc: produce feature scores table scaled with max_scaler
        default: true
      outputs:
      - default: ''
      lineno: 70
  description: Select features through multiple Statistical and Model filters
  build:
    functionSourceCode: aW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgbWF0cGxvdGxpYi5weXBsb3QgYXMgcGx0CmltcG9ydCBzZWFib3JuIGFzIHNucwppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IG9zCmltcG9ydCBqc29uCgojIEZlYXR1cmUgc2VsZWN0aW9uIHN0cmF0ZWdpZXMKZnJvbSBza2xlYXJuLmZlYXR1cmVfc2VsZWN0aW9uIGltcG9ydCBTZWxlY3RLQmVzdApmcm9tIHNrbGVhcm4uZmVhdHVyZV9zZWxlY3Rpb24gaW1wb3J0IFNlbGVjdEZyb21Nb2RlbAoKIyBTY2FsZSBmZWF0dXJlIHNjb3Jlcwpmcm9tIHNrbGVhcm4ucHJlcHJvY2Vzc2luZyBpbXBvcnQgTWluTWF4U2NhbGVyCgojIFNLTGVhcm4gZXN0aW1hdG9ycyBsaXN0CmZyb20gc2tsZWFybi51dGlscyBpbXBvcnQgYWxsX2VzdGltYXRvcnMKCiMgTUxSdW4gdXRpbHMKZnJvbSBtbHJ1bi5tbHV0aWxzLnBsb3RzIGltcG9ydCBnY2ZfY2xlYXIKZnJvbSBtbHJ1bi51dGlscy5oZWxwZXJzIGltcG9ydCBjcmVhdGVfY2xhc3MKZnJvbSBtbHJ1bi5hcnRpZmFjdHMgaW1wb3J0IFBsb3RBcnRpZmFjdAoKCmRlZiBzaG93X3ZhbHVlc19vbl9iYXJzKGF4cywgaF92PSJ2Iiwgc3BhY2U9MC40KToKICAgIGRlZiBfc2hvd19vbl9zaW5nbGVfcGxvdChheCk6CiAgICAgICAgaWYgaF92ID09ICJ2IjoKICAgICAgICAgICAgZm9yIHAgaW4gYXgucGF0Y2hlczoKICAgICAgICAgICAgICAgIF94ID0gcC5nZXRfeCgpICsgcC5nZXRfd2lkdGgoKSAvIDIKICAgICAgICAgICAgICAgIF95ID0gcC5nZXRfeSgpICsgcC5nZXRfaGVpZ2h0KCkKICAgICAgICAgICAgICAgIHZhbHVlID0gaW50KHAuZ2V0X2hlaWdodCgpKQogICAgICAgICAgICAgICAgYXgudGV4dChfeCwgX3ksIHZhbHVlLCBoYT0iY2VudGVyIikKICAgICAgICBlbGlmIGhfdiA9PSAiaCI6CiAgICAgICAgICAgIGZvciBwIGluIGF4LnBhdGNoZXM6CiAgICAgICAgICAgICAgICBfeCA9IHAuZ2V0X3goKSArIHAuZ2V0X3dpZHRoKCkgKyBmbG9hdChzcGFjZSkKICAgICAgICAgICAgICAgIF95ID0gcC5nZXRfeSgpICsgcC5nZXRfaGVpZ2h0KCkKICAgICAgICAgICAgICAgIHZhbHVlID0gaW50KHAuZ2V0X3dpZHRoKCkpCiAgICAgICAgICAgICAgICBheC50ZXh0KF94LCBfeSwgdmFsdWUsIGhhPSJsZWZ0IikKCiAgICBpZiBpc2luc3RhbmNlKGF4cywgbnAubmRhcnJheSk6CiAgICAgICAgZm9yIGlkeCwgYXggaW4gbnAubmRlbnVtZXJhdGUoYXhzKToKICAgICAgICAgICAgX3Nob3dfb25fc2luZ2xlX3Bsb3QoYXgpCiAgICBlbHNlOgogICAgICAgIF9zaG93X29uX3NpbmdsZV9wbG90KGF4cykKCgpkZWYgcGxvdF9zdGF0KGNvbnRleHQsCiAgICAgICAgICAgICAgc3RhdF9uYW1lLAogICAgICAgICAgICAgIHN0YXRfZGYpOgogICAgZ2NmX2NsZWFyKHBsdCkKCiAgICAjIEFkZCBjaGFydAogICAgYXggPSBwbHQuYXhlcygpCiAgICBzdGF0X2NoYXJ0ID0gc25zLmJhcnBsb3QoeD1zdGF0X25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeT0naW5kZXgnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE9c3RhdF9kZi5zb3J0X3ZhbHVlcyhzdGF0X25hbWUsIGFzY2VuZGluZz1GYWxzZSkucmVzZXRfaW5kZXgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBheD1heCkKICAgIHBsdC50aWdodF9sYXlvdXQoKQoKICAgIGZvciBwIGluIHN0YXRfY2hhcnQucGF0Y2hlczoKICAgICAgICB3aWR0aCA9IHAuZ2V0X3dpZHRoKCkKICAgICAgICBwbHQudGV4dCg1ICsgcC5nZXRfd2lkdGgoKSwgcC5nZXRfeSgpICsgMC41NSAqIHAuZ2V0X2hlaWdodCgpLAogICAgICAgICAgICAgICAgICd7OjEuMmZ9Jy5mb3JtYXQod2lkdGgpLAogICAgICAgICAgICAgICAgIGhhPSdjZW50ZXInLCB2YT0nY2VudGVyJykKCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3QoZid7c3RhdF9uYW1lfScsIGJvZHk9cGx0LmdjZigpKSwKICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX3BhdGg9b3MucGF0aC5qb2luKCdwbG90cycsICdmZWF0dXJlX3NlbGVjdGlvbicsIGYne3N0YXRfbmFtZX0uaHRtbCcpKQogICAgZ2NmX2NsZWFyKHBsdCkKCgpkZWYgZmVhdHVyZV9zZWxlY3Rpb24oY29udGV4dCwKICAgICAgICAgICAgICAgICAgICAgIGRmX2FydGlmYWN0LAogICAgICAgICAgICAgICAgICAgICAgaz0yLAogICAgICAgICAgICAgICAgICAgICAgbWluX3ZvdGVzPTAuNSwKICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX2NvbHVtbjogc3RyID0gJ1knLAogICAgICAgICAgICAgICAgICAgICAgc3RhdF9maWx0ZXJzPVsnZl9jbGFzc2lmJywgJ211dHVhbF9pbmZvX2NsYXNzaWYnLCAnY2hpMicsICdmX3JlZ3Jlc3Npb24nXSwKICAgICAgICAgICAgICAgICAgICAgIG1vZGVsX2ZpbHRlcnM9eydMaW5lYXJTVkMnOiAnTGluZWFyU1ZDJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdMb2dpc3RpY1JlZ3Jlc3Npb24nOiAnTG9naXN0aWNSZWdyZXNzaW9uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdFeHRyYVRyZWVzQ2xhc3NpZmllcic6ICdFeHRyYVRyZWVzQ2xhc3NpZmllcid9LAogICAgICAgICAgICAgICAgICAgICAgbWF4X3NjYWxlZF9zY29yZXM9VHJ1ZSk6CiAgICAiIiJBcHBsaWVzIHNlbGVjdGVkIGZlYXR1cmUgc2VsZWN0aW9uIHN0YXRpc3RpY2FsIGZ1bmN0aW9ucwogICAgb3IgbW9kZWxzIG9uIG91ciAnZGZfYXJ0aWZhY3QnLgoKICAgIEVhY2ggc3RhdGlzdGljYWwgZnVuY3Rpb24gb3IgbW9kZWwgd2lsbCB2b3RlIGZvciBpdCdzIGJlc3QgSyBzZWxlY3RlZCBmZWF0dXJlcy4KICAgIElmIGEgZmVhdHVyZSBoYXMgPj0gJ21pbl92b3Rlcycgdm90ZXMsIGl0IHdpbGwgYmUgc2VsZWN0ZWQuCgogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgICB0aGUgZnVuY3Rpb24gY29udGV4dAogICAgOnBhcmFtIGs6ICAgICAgICAgICAgICAgICBudW1iZXIgb2YgdG9wIGZlYXR1cmVzIHRvIHNlbGVjdCBmcm9tIGVhY2ggc3RhdGlzdGljYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gb3IgbW9kZWwKICAgIDpwYXJhbSBtaW5fdm90ZXM6ICAgICAgICAgbWluaW1hbCBudW1iZXIgb2Ygdm90ZXMgKGZyb20gYSBtb2RlbCBvciBieSBzdGF0aXN0aWNhbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbikgbmVlZGVkIGZvciBhIGZlYXR1cmUgdG8gYmUgc2VsZWN0ZWQuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENhbiBiZSBzcGVjaWZpZWQgYnkgcGVyY2VudGFnZSBvZiB2b3RlcyBvciBhYnNvbHV0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXIgb2Ygdm90ZXMKICAgIDpwYXJhbSBsYWJlbF9jb2x1bW46ICAgICAgZ3JvdW5kLXRydXRoICh5KSBsYWJlbHMKICAgIDpwYXJhbSBzdGF0X2ZpbHRlcnM6ICAgICAgc3RhdGlzdGljYWwgZnVuY3Rpb25zIHRvIGFwcGx5IHRvIHRoZSBmZWF0dXJlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZnJvbSBza2xlYXJuLmZlYXR1cmVfc2VsZWN0aW9uKQogICAgOnBhcmFtIG1vZGVsX2ZpbHRlcnM6ICAgICBtb2RlbHMgdG8gdXNlIGZvciBmZWF0dXJlIGV2YWx1YXRpb24sIGNhbiBiZSBzcGVjaWZpZWQgYnkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwgbmFtZSAoZXguIExpbmVhclNWQyksIGZvcm1hbGl6ZWQganNvbiAoY29udGFpbnMgJ0NMQVNTJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZJVCcsICdNRVRBJykgb3IgYSBwYXRoIHRvIHN1Y2gganNvbiBmaWxlLgogICAgOnBhcmFtIG1heF9zY2FsZWRfc2NvcmVzOiBwcm9kdWNlIGZlYXR1cmUgc2NvcmVzIHRhYmxlIHNjYWxlZCB3aXRoIG1heF9zY2FsZXIKICAgICIiIgoKICAgICMgUmVhZCBpbnB1dCBERgogICAgZGZfcGF0aCA9IHN0cihkZl9hcnRpZmFjdCkKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZidpbnB1dCBkYXRhc2V0IHtkZl9wYXRofScpCiAgICBpZiBkZl9wYXRoLmVuZHN3aXRoKCdjc3YnKToKICAgICAgICBkZiA9IHBkLnJlYWRfY3N2KGRmX3BhdGgpCiAgICBlbGlmIGRmX3BhdGguZW5kc3dpdGgoJ3BhcnF1ZXQnKSBvciBkZl9wYXRoLmVuZHN3aXRoKCdwcScpOgogICAgICAgIGRmID0gcGQucmVhZF9wYXJxdWV0KGRmX3BhdGgpCgogICAgIyBTZXQgZmVhdHVyZSB2ZWN0b3IgYW5kIGxhYmVscwogICAgeSA9IGRmLnBvcChsYWJlbF9jb2x1bW4pCiAgICBYID0gZGYKCiAgICAjIENyZWF0ZSBzZWxlY3RlZCBzdGF0aXN0aWNhbCBlc3RpbWF0b3JzCiAgICBzdGF0X2Z1bmN0aW9uc19saXN0ID0ge3N0YXRfbmFtZTogU2VsZWN0S0Jlc3QoY3JlYXRlX2NsYXNzKGYnc2tsZWFybi5mZWF0dXJlX3NlbGVjdGlvbi57c3RhdF9uYW1lfScpLCBrKQogICAgICAgICAgICAgICAgICAgICAgICAgICBmb3Igc3RhdF9uYW1lIGluIHN0YXRfZmlsdGVyc30KICAgIHJlcXVpcmVzX2FicyA9IFsnY2hpMiddCgogICAgIyBSdW4gc3RhdGlzdGljIGZpbHRlcnMKICAgIHNlbGVjdGVkX2ZlYXR1cmVzX2FnZyA9IHt9CiAgICBzdGF0c19kZiA9IHBkLkRhdGFGcmFtZShpbmRleD1YLmNvbHVtbnMpCiAgICBmb3Igc3RhdF9uYW1lLCBzdGF0X2Z1bmMgaW4gc3RhdF9mdW5jdGlvbnNfbGlzdC5pdGVtcygpOgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBDb21wdXRlIHN0YXRpc3RpY3MKICAgICAgICAgICAgcGFyYW1zID0gKFgsIHkpIGlmIHN0YXRfbmFtZSBpbiByZXF1aXJlc19hYnMgZWxzZSAoYWJzKFgpLCB5KQogICAgICAgICAgICBzdGF0ID0gc3RhdF9mdW5jLmZpdCgqcGFyYW1zKQoKICAgICAgICAgICAgIyBDb2xsZWN0IHN0YXQgZnVuY3Rpb24gcmVzdWx0cwogICAgICAgICAgICBzdGF0X2RmID0gcGQuRGF0YUZyYW1lKGluZGV4PVguY29sdW1ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5zPVtzdGF0X25hbWVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE9c3RhdC5zY29yZXNfKQogICAgICAgICAgICBwbG90X3N0YXQoY29udGV4dCwgc3RhdF9uYW1lLCBzdGF0X2RmKQogICAgICAgICAgICBzdGF0c19kZiA9IHN0YXRzX2RmLmpvaW4oc3RhdF9kZikKCiAgICAgICAgICAgICMgU2VsZWN0IEsgQmVzdCBmZWF0dXJlcwogICAgICAgICAgICBzZWxlY3RlZF9mZWF0dXJlcyA9IFguY29sdW1uc1tzdGF0X2Z1bmMuZ2V0X3N1cHBvcnQoKV0KICAgICAgICAgICAgc2VsZWN0ZWRfZmVhdHVyZXNfYWdnW3N0YXRfbmFtZV0gPSBzZWxlY3RlZF9mZWF0dXJlcwogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbyhmIkNvdWxkbid0IGNhbGN1bGF0ZSB7c3RhdF9uYW1lfSBiZWNhdXNlIG9mOiB7ZX0iKQoKICAgICMgQ3JlYXRlIG1vZGVscyBmcm9tIGNsYXNzIG5hbWUgLyBqc29uIGZpbGUgLyBqc29uIHBhcmFtcwogICAgYWxsX3NrbGVhcm5fZXN0aW1hdG9ycyA9IGRpY3QoYWxsX2VzdGltYXRvcnMoKSkgaWYgbGVuKG1vZGVsX2ZpbHRlcnMpID4gMCBlbHNlIHt9CiAgICBzZWxlY3RlZF9tb2RlbHMgPSB7fQogICAgZm9yIG1vZGVsX25hbWUsIG1vZGVsIGluIG1vZGVsX2ZpbHRlcnMuaXRlbXMoKToKICAgICAgICBpZiAnLmpzb24nIGluIG1vZGVsOgogICAgICAgICAgICBjdXJyZW50X21vZGVsID0ganNvbi5sb2FkKG9wZW4obW9kZWwsICdyJykpCiAgICAgICAgICAgIENsYXNzaWZpZXJDbGFzcyA9IGNyZWF0ZV9jbGFzcyhjdXJyZW50X21vZGVsWyJNRVRBIl1bImNsYXNzIl0pCiAgICAgICAgICAgIHNlbGVjdGVkX21vZGVsc1ttb2RlbF9uYW1lXSA9IENsYXNzaWZpZXJDbGFzcygqKmN1cnJlbnRfbW9kZWxbIkNMQVNTIl0pCiAgICAgICAgZWxpZiBtb2RlbCBpbiBhbGxfc2tsZWFybl9lc3RpbWF0b3JzOgogICAgICAgICAgICBzZWxlY3RlZF9tb2RlbHNbbW9kZWxfbmFtZV0gPSBhbGxfc2tsZWFybl9lc3RpbWF0b3JzW21vZGVsX25hbWVdKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjdXJyZW50X21vZGVsID0ganNvbi5sb2Fkcyhtb2RlbCkgaWYgaXNpbnN0YW5jZShtb2RlbCwgc3RyKSBlbHNlIGN1cnJlbnRfbW9kZWwKICAgICAgICAgICAgICAgIENsYXNzaWZpZXJDbGFzcyA9IGNyZWF0ZV9jbGFzcyhjdXJyZW50X21vZGVsWyJNRVRBIl1bImNsYXNzIl0pCiAgICAgICAgICAgICAgICBzZWxlY3RlZF9tb2RlbHNbbW9kZWxfbmFtZV0gPSBDbGFzc2lmaWVyQ2xhc3MoKipjdXJyZW50X21vZGVsWyJDTEFTUyJdKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYndW5hYmxlIHRvIGxvYWQge21vZGVsfScpCgogICAgIyBSdW4gbW9kZWwgZmlsdGVycwogICAgbW9kZWxzX2RmID0gcGQuRGF0YUZyYW1lKGluZGV4PVguY29sdW1ucykKICAgIGZvciBtb2RlbF9uYW1lLCBtb2RlbCBpbiBzZWxlY3RlZF9tb2RlbHMuaXRlbXMoKToKICAgICAgICAjIFRyYWluIG1vZGVsIGFuZCBnZXQgZmVhdHVyZSBpbXBvcnRhbmNlCiAgICAgICAgc2VsZWN0X2Zyb21fbW9kZWwgPSBTZWxlY3RGcm9tTW9kZWwobW9kZWwpLmZpdChYLCB5KQogICAgICAgIGZlYXR1cmVfaWR4ID0gc2VsZWN0X2Zyb21fbW9kZWwuZ2V0X3N1cHBvcnQoKQogICAgICAgIGZlYXR1cmVfbmFtZXMgPSBYLmNvbHVtbnNbZmVhdHVyZV9pZHhdCiAgICAgICAgc2VsZWN0ZWRfZmVhdHVyZXNfYWdnW21vZGVsX25hbWVdID0gZmVhdHVyZV9uYW1lcy50b2xpc3QoKQoKICAgICAgICAjIENvbGxlY3QgbW9kZWwgZmVhdHVyZSBpbXBvcnRhbmNlCiAgICAgICAgaWYgaGFzYXR0cihzZWxlY3RfZnJvbV9tb2RlbC5lc3RpbWF0b3JfLCAnY29lZl8nKToKICAgICAgICAgICAgc3RhdF9kZiA9IHNlbGVjdF9mcm9tX21vZGVsLmVzdGltYXRvcl8uY29lZl8KICAgICAgICBlbGlmIGhhc2F0dHIoc2VsZWN0X2Zyb21fbW9kZWwuZXN0aW1hdG9yXywgJ2ZlYXR1cmVfaW1wb3J0YW5jZXNfJyk6CiAgICAgICAgICAgIHN0YXRfZGYgPSBzZWxlY3RfZnJvbV9tb2RlbC5lc3RpbWF0b3JfLmZlYXR1cmVfaW1wb3J0YW5jZXNfCiAgICAgICAgc3RhdF9kZiA9IHBkLkRhdGFGcmFtZShpbmRleD1YLmNvbHVtbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5zPVttb2RlbF9uYW1lXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE9c3RhdF9kZlswXSkKICAgICAgICBtb2RlbHNfZGYgPSBtb2RlbHNfZGYuam9pbihzdGF0X2RmKQoKICAgICAgICBwbG90X3N0YXQoY29udGV4dCwgbW9kZWxfbmFtZSwgc3RhdF9kZikKCiAgICAjIENyZWF0ZSBmZWF0dXJlX3Njb3JlcyBERiB3aXRoIHN0YXQgJiBtb2RlbCBmaWx0ZXJzIHNjb3JlcwogICAgcmVzdWx0X21hdHJpeF9kZiA9IHBkLmNvbmNhdChbc3RhdHNfZGYsIG1vZGVsc19kZl0sIGF4aXM9MSwgc29ydD1GYWxzZSkKICAgIGNvbnRleHQubG9nX2RhdGFzZXQoa2V5PSdmZWF0dXJlX3Njb3JlcycsCiAgICAgICAgICAgICAgICAgICAgICAgIGRmPXJlc3VsdF9tYXRyaXhfZGYsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX3BhdGg9J2ZlYXR1cmVfc2NvcmVzLnBhcnF1ZXQnLAogICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ9J3BhcnF1ZXQnKQogICAgaWYgbWF4X3NjYWxlZF9zY29yZXM6CiAgICAgICAgbm9ybWFsaXplZF9kZiA9IHJlc3VsdF9tYXRyaXhfZGYucmVwbGFjZShbbnAuaW5mLCAtbnAuaW5mXSwgbnAubmFuKS52YWx1ZXMKICAgICAgICBtaW5fbWF4X3NjYWxlciA9IE1pbk1heFNjYWxlcigpCiAgICAgICAgbm9ybWFsaXplZF9kZiA9IG1pbl9tYXhfc2NhbGVyLmZpdF90cmFuc2Zvcm0obm9ybWFsaXplZF9kZikKICAgICAgICBub3JtYWxpemVkX2RmID0gcGQuRGF0YUZyYW1lKGRhdGE9bm9ybWFsaXplZF9kZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbnM9cmVzdWx0X21hdHJpeF9kZi5jb2x1bW5zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg9cmVzdWx0X21hdHJpeF9kZi5pbmRleCkKICAgICAgICBjb250ZXh0LmxvZ19kYXRhc2V0KGtleT0nbWF4X3NjYWxlZF9zY29yZXNfZmVhdHVyZV9zY29yZXMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGY9bm9ybWFsaXplZF9kZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX3BhdGg9J21heF9zY2FsZWRfc2NvcmVzX2ZlYXR1cmVfc2NvcmVzLnBhcnF1ZXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0PSdwYXJxdWV0JykKCiAgICAjIENyZWF0ZSBmZWF0dXJlIGNvdW50IERhdGFGcmFtZQogICAgZm9yIHRlc3RfbmFtZSBpbiBzZWxlY3RlZF9mZWF0dXJlc19hZ2c6CiAgICAgICAgcmVzdWx0X21hdHJpeF9kZlt0ZXN0X25hbWVdID0gWzEgaWYgeCBpbiBzZWxlY3RlZF9mZWF0dXJlc19hZ2dbdGVzdF9uYW1lXSBlbHNlIDAgZm9yIHggaW4gWC5jb2x1bW5zXQogICAgcmVzdWx0X21hdHJpeF9kZi5sb2NbOiwgJ251bV92b3RlcyddID0gcmVzdWx0X21hdHJpeF9kZi5zdW0oYXhpcz0xKQogICAgY29udGV4dC5sb2dfZGF0YXNldChrZXk9J3NlbGVjdGVkX2ZlYXR1cmVzX2NvdW50JywKICAgICAgICAgICAgICAgICAgICAgICAgZGY9cmVzdWx0X21hdHJpeF9kZiwKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfcGF0aD0nc2VsZWN0ZWRfZmVhdHVyZXNfY291bnQucGFycXVldCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdD0ncGFycXVldCcpCgogICAgIyBIb3cgbWFueSB2b3RlcyBhcmUgbmVlZGVkIGZvciBhIGZlYXR1cmUgdG8gYmUgc2VsZWN0ZWQ/CiAgICBpZiBpc2luc3RhbmNlKG1pbl92b3RlcywgaW50KToKICAgICAgICB2b3Rlc19uZWVkZWQgPSBtaW5fdm90ZXMKICAgIGVsc2U6CiAgICAgICAgbnVtX2ZpbHRlcnMgPSBsZW4oc3RhdF9maWx0ZXJzKSArIGxlbihtb2RlbF9maWx0ZXJzKQogICAgICAgIHZvdGVzX25lZWRlZCA9IGludChucC5mbG9vcihudW1fZmlsdGVycyAqIG1heChtaW4obWluX3ZvdGVzLCAxKSwgMCkpKQogICAgY29udGV4dC5sb2dnZXIuaW5mbyhmJ3ZvdGVzIG5lZWRlZCB0byBiZSBzZWxlY3RlZDoge3ZvdGVzX25lZWRlZH0nKQoKICAgICMgQ3JlYXRlIGZpbmFsIGZlYXR1cmUgZGF0YWZyYW1lCiAgICBzZWxlY3RlZF9mZWF0dXJlcyA9IHJlc3VsdF9tYXRyaXhfZGZbcmVzdWx0X21hdHJpeF9kZi5udW1fdm90ZXMgPj0gdm90ZXNfbmVlZGVkXS5pbmRleC50b2xpc3QoKQogICAgZ29vZF9mZWF0dXJlX2RmID0gZGYubG9jWzosIHNlbGVjdGVkX2ZlYXR1cmVzXQogICAgZmluYWxfZGYgPSBwZC5jb25jYXQoW2dvb2RfZmVhdHVyZV9kZiwgeV0sIGF4aXM9MSkKICAgIGNvbnRleHQubG9nX2RhdGFzZXQoa2V5PSdzZWxlY3RlZF9mZWF0dXJlcycsCiAgICAgICAgICAgICAgICAgICAgICAgIGRmPWZpbmFsX2RmLAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9wYXRoPSdzZWxlY3RlZF9mZWF0dXJlcy5wYXJxdWV0JywKICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0PSdwYXJxdWV0JykK
    commands:
    - python -m pip install mlrun sklearn
    code_origin: http://github.com/aviaIguazio/functions.git#9681d443b03d61a6f332ba32b9971663880ddaf6:feature_selection/feature_selection.py
  affinity: null
verbose: false
