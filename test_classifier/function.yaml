kind: job
metadata:
  name: test-classifier
  tag: ''
  hash: c4f402bb84862109aaa30d34490547be84ba8cba
  project: ''
  labels:
    author: yjb
    stage: development
  categories:
  - models
  - test
spec:
  command: ''
  args: []
  image: mlrun/ml-models:0.4.6
  env: []
  default_handler: test_classifier
  description: ''
  image_pull_policy: Always
  build:
    functionSourceCode: aW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCBpbXBvcnRsaWIKZnJvbSBjbG91ZHBpY2tsZSBpbXBvcnQgbG9hZAoKaW1wb3J0IG51bXB5IGFzIG5wCmltcG9ydCBwYW5kYXMgYXMgcGQKCmltcG9ydCBza2xlYXJuCmZyb20gc2tsZWFybiBpbXBvcnQgbWV0cmljcwpmcm9tIHNrbGVhcm4ucHJlcHJvY2Vzc2luZyBpbXBvcnQgbGFiZWxfYmluYXJpemUKZnJvbSBza2xlYXJuLnV0aWxzLm11bHRpY2xhc3MgaW1wb3J0IHVuaXF1ZV9sYWJlbHMKCmltcG9ydCBtYXRwbG90bGliLnB5cGxvdCBhcyBwbHQKZnJvbSBtYXRwbG90bGliLmZpZ3VyZSBpbXBvcnQgRmlndXJlCmltcG9ydCBzZWFib3JuIGFzIHNucwoKZnJvbSB0eXBpbmcgaW1wb3J0IE9wdGlvbmFsLCBVbmlvbiwgTGlzdCwgVHVwbGUKCmZyb20gbWxydW4uZXhlY3V0aW9uIGltcG9ydCBNTENsaWVudEN0eApmcm9tIG1scnVuLmRhdGFzdG9yZSBpbXBvcnQgRGF0YUl0ZW0KZnJvbSBtbHJ1bi5hcnRpZmFjdHMgaW1wb3J0IFRhYmxlQXJ0aWZhY3QsIFBsb3RBcnRpZmFjdAoKaW1wb3J0IHdhcm5pbmdzCndhcm5pbmdzLnNpbXBsZWZpbHRlcihhY3Rpb249Imlnbm9yZSIsIGNhdGVnb3J5PUZ1dHVyZVdhcm5pbmcpCgpkZWYgX2djZl9jbGVhcihwbHQpOgogICAgcGx0LmNsYSgpCiAgICBwbHQuY2xmKCkKICAgIHBsdC5jbG9zZSgpICAgICAgICAKCmRlZiB0ZXN0X2NsYXNzaWZpZXIoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIG1vZGVsc19kaXI6IFVuaW9uW0RhdGFJdGVtLCBzdHJdLCAKICAgIHRlc3Rfc2V0OiBEYXRhSXRlbSwKICAgIGxhYmVsX2NvbHVtbjogc3RyLAogICAgc2NvcmVfbWV0aG9kOiBzdHIgPSAnbWljcm8nLAogICAga2V5OiBzdHIgPSAiIiwKICAgIHBsb3RzX2Rpcjogc3RyID0gInBsb3RzIgopIC0+IE5vbmU6CiAgICAiIiJUZXN0IG9uZSBvciBtb3JlIGNsYXNzaWZpZXIgbW9kZWxzIGFnYWluc3QgaGVsZC1vdXQgZGF0YXNldAogICAgCiAgICBVc2luZyBoZWxkLW91dCB0ZXN0IGZlYXR1cmVzLCBldmFsdWF0ZXMgdGhlIHBlZm9ybWFuY2Ugb2YgdGhlIGVzdGltYXRlZCBtb2RlbAogICAgCiAgICBDYW4gYmUgcGFydCBvZiBhIGt1YmVmbG93IHBpcGVsaW5lIGFzIGEgdGVzdCBzdGVwIHRoYXQgaXMgcnVuIHBvc3QgRURBIGFuZCAKICAgIHRyYWluaW5nL3ZhbGlkYXRpb24gY3ljbGVzCiAgICAKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0gbW9kZWxzX2RpcjogICAgICBhcnRpZmFjdCBtb2RlbHMgcmVwcmVzZW50aW5nIGEgZm9sZGVyIG9yIGEgZm9sZGVyCiAgICA6cGFyYW0gdGVzdF9zZXQ6ICAgICAgICB0ZXN0IGZlYXR1cmVzIGFuZCBsYWJlbHMKICAgIDpwYXJhbSBsYWJlbF9jb2x1bW46ICAgIGNvbHVtbiBuYW1lIGZvciBncm91bmQgdHJ1dGggbGFiZWxzCiAgICA6cGFyYW0gc2NvcmVfbWV0aG9kOiAgICBmb3IgbXVsdGljbGFzcyBjbGFzc2lmaWNhdGlvbgogICAgOnBhcmFtIGtleTogICAgICAgICAgICAga2V5IGZvciByZXN1bHRzIGFydGlmYWN0IChtYXliZSBqdXN0IGEgZGlyIG9mIGFydGlmYWN0cyBmb3IgdGVzdCBsaWtlIHBsb3RzX2RpcikKICAgIDpwYXJhbSBwbG90c19kaXI6ICAgICAgIGRpciBmb3IgdGVzdCBwbG90cwogICAgIiIiCiAgICBvcy5tYWtlZGlycyhvcy5wYXRoLmpvaW4oY29udGV4dC5hcnRpZmFjdF9wYXRoLCBwbG90c19kaXIpLCBleGlzdF9vaz1UcnVlKQogICAgCiAgICB4dGVzdCA9IHBkLnJlYWRfcGFycXVldChzdHIodGVzdF9zZXQpKQogICAgeXRlc3QgPSB4dGVzdC5wb3AobGFiZWxfY29sdW1uKQogICAgCiAgICBjb250ZXh0LmhlYWRlciA9IGxpc3QoeHRlc3QuY29sdW1ucy52YWx1ZXMpCiAgICAKICAgIGRlZiBfZXZhbF9tb2RlbChtb2RlbCk6CiAgICAgICAgIyBlbmNsb3NlIGFsbCBleGNlcHQgbW9kZWwKICAgICAgICB5dGVzdGIgPSBsYWJlbF9iaW5hcml6ZSh5dGVzdCwgY2xhc3Nlcz1saXN0KHJhbmdlKHh0ZXN0LnNoYXBlWzFdKSkpCiAgICAgICAgY2xmID0gbG9hZChvcGVuKG9zLnBhdGguam9pbihzdHIobW9kZWxzX2RpciksIG1vZGVsKSwgInJiIikpCiAgICAgICAgaWYgY2FsbGFibGUoZ2V0YXR0cihjbGYsICJwcmVkaWN0X3Byb2JhIikpOgogICAgICAgICAgICB5X3Njb3JlID0gY2xmLnByZWRpY3RfcHJvYmEoeHRlc3QudmFsdWVzKQogICAgICAgICAgICB5cHJlZCA9IGNsZi5wcmVkaWN0KHh0ZXN0LnZhbHVlcykKICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbyhmInlfc2NvcmUuc2hhcGUge3lfc2NvcmUuc2hhcGV9IikKICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbyhmInl0ZXN0Yi5zaGFwZSB7eXRlc3RiLnNoYXBlfSIpCiAgICAgICAgICAgIHBsb3Rfcm9jKGNvbnRleHQsIHl0ZXN0YiwgeV9zY29yZSwga2V5PWYicm9jIiwgcGxvdHNfZGlyPXBsb3RzX2RpcikKICAgICAgICBlbHNlOgogICAgICAgICAgICB5cHJlZCA9IGNsZi5wcmVkaWN0KHh0ZXN0LnZhbHVlcykgIyByZWZhY3RvcgogICAgICAgICAgICB5X3Njb3JlID0gTm9uZQogICAgICAgIHBsb3RfY29uZnVzaW9uX21hdHJpeChjb250ZXh0LCB5dGVzdCwgeXByZWQsIGtleT0iY29uZnVzaW9uIiwgZm10PSJwbmciKQogICAgICAgIGlmIGhhc2F0dHIoY2xmLCAiZmVhdHVyZV9pbXBvcnRhbmNlc18iKToKICAgICAgICAgICAgcGxvdF9pbXBvcnRhbmNlKGNvbnRleHQsIGNsZiwga2V5PWYiZmVhdGltcCIpCiAgICAgICAgYXZlcmFnZV9wcmVjaXNpb24gPSBtZXRyaWNzLmF2ZXJhZ2VfcHJlY2lzaW9uX3Njb3JlKHl0ZXN0Yls6LDotMV0sIHlfc2NvcmUsIGF2ZXJhZ2U9c2NvcmVfbWV0aG9kKQogICAgICAgIGNvbnRleHQubG9nX3Jlc3VsdChmImFjY3VyYWN5IiwgZmxvYXQoY2xmLnNjb3JlKHh0ZXN0LnZhbHVlcywgeXRlc3QudmFsdWVzKSkpCiAgICAgICAgY29udGV4dC5sb2dfcmVzdWx0KGYicm9jYXVjIiwgbWV0cmljcy5yb2NfYXVjX3Njb3JlKHl0ZXN0YiwgeV9zY29yZSkpCiAgICAgICAgY29udGV4dC5sb2dfcmVzdWx0KGYiZjFfc2NvcmUiLCBtZXRyaWNzLmYxX3Njb3JlKHl0ZXN0LnZhbHVlcywgeXByZWQsIGF2ZXJhZ2U9c2NvcmVfbWV0aG9kKSkKICAgICAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJhdmdfcHJlY3Njb3JlIiwgYXZlcmFnZV9wcmVjaXNpb24pCgogICAgCiAgICBiZXN0X21vZGVsID0gTm9uZQogICAgZm9yIG1vZGVsIGluIG9zLmxpc3RkaXIoc3RyKG1vZGVsc19kaXIpKToKICAgICAgICBpZiBtb2RlbC5lbmRzd2l0aCgnLnBrbCcpOgogICAgICAgICAgICBfZXZhbF9tb2RlbChtb2RlbCkKICAgICAgICAgICAgIyBIQUNLOiB0aGVyZSBpcyBvbmx5IG9uZSBtb2RlbCBoZXJlCiAgICAgICAgICAgIGJlc3RfbW9kZWwgPSBtb2RlbAoKICAgICMgbG9nICdiZXN0IG1vZGVsJyBhcyBhcnRpZmFjdAogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoJ1RPREFZUy1NT0RFTFMtVEVTVC1SRVBPUlQnLCBsb2NhbF9wYXRoPWJlc3RfbW9kZWwpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdCgnREVQTE9ZJywgYm9keT1iJ3RydWUnLCBsb2NhbF9wYXRoPSdERVBMT1knKQogICAgCmRlZiBwbG90X3JvYygKICAgIGNvbnRleHQsCiAgICB5X2xhYmVscywKICAgIHlfcHJvYnMsCiAgICBrZXk9InJvYyIsCiAgICBwbG90c19kaXI6IHN0ciA9ICJwbG90cyIsCiAgICBmbXQ9InBuZyIsCiAgICBmcHJfbGFiZWw6IHN0ciA9ICJmYWxzZSBwb3NpdGl2ZSByYXRlIiwKICAgIHRwcl9sYWJlbDogc3RyID0gICJ0cnVlIHBvc2l0aXZlIHJhdGUiLAogICAgdGl0bGU6IHN0ciA9ICJyb2MgY3VydmUiLAogICAgbGVnZW5kX2xvYzogc3RyID0gImJlc3QiCik6CiAgICAiIiJwbG90IHJvYyBjdXJ2ZXMKICAgIAogICAgVE9ETzogIGFkZCBhdmVyYWdpbmcgbWV0aG9kIChhcyBzdHJpbmcpIHRoYXQgd2FzIHVzZWQgdG8gY3JlYXRlIHByb2JzLCAKICAgIGRpc3BsYXkgaW4gbGVnZW5kCiAgICAKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0geV9sYWJlbHM6ICAgICBncm91bmQgdHJ1dGggbGFiZWxzLCBob3QgZW5jb2RlZCBmb3IgbXVsdGljbGFzcyAgCiAgICA6cGFyYW0geV9wcm9iczogICAgICBtb2RlbCBwcmVkaWN0aW9uIHByb2JhYmlsaXRpZXMKICAgIDpwYXJhbSBrZXk6ICAgICAgICAgICgicm9jIikga2V5IG9mIHBsb3QgaW4gYXJ0aWZhY3Qgc3RvcmUKICAgIDpwYXJhbSBwbG90c19kaXI6ICAgICgicGxvdHMiKSBkZXN0aW5hdGlvbiBmb2xkZXIgcmVsYXRpdmUgcGF0aCB0byBhcnRpZmFjdCBwYXRoCiAgICA6cGFyYW0gZm10OiAgICAgICAgICAoInBuZyIpIHBsb3QgZm9ybWF0CiAgICA6cGFyYW0gZnByX2xhYmVsOiAgICAoImZhbHNlIHBvc2l0aXZlIHJhdGUiKSB4LWF4aXMgbGFiZWxzCiAgICA6cGFyYW0gdHByX2xhYmVsOiAgICAoInRydWUgcG9zaXRpdmUgcmF0ZSIpIHktYXhpcyBsYWJlbHMKICAgIDpwYXJhbSB0aXRsZTogICAgICAgICgicm9jIGN1cnZlIikgdGl0bGUgb2YgcGxvdAogICAgOnBhcmFtIGxlZ2VuZF9sb2M6ICAgKCJiZXN0IikgbG9jYXRpb24gb2YgcGxvdCBsZWdlbmQKICAgICIiIgogICAgICAgIyBjbGVhciBtYXRwbG90bGliIGN1cnJlbnQgZmlndXJlCiAgICBfZ2NmX2NsZWFyKHBsdCkKICAgIAogICAgIyBkcmF3IDQ1IGRlZ3JlZSBsaW5lCiAgICBwbHQucGxvdChbMCwgMV0sIFswLCAxXSwgImstLSIpCiAgICAKICAgICMgbGFiZWxsaW5nCiAgICBwbHQueGxhYmVsKGZwcl9sYWJlbCkKICAgIHBsdC55bGFiZWwodHByX2xhYmVsKQogICAgcGx0LnRpdGxlKHRpdGxlKQogICAgcGx0LmxlZ2VuZChsb2M9bGVnZW5kX2xvYykKICAgIAogICAgIyBzaW5nbGUgUk9DIG9yIG11dGxpcGxlCiAgICBpZiB5X2xhYmVscy5zaGFwZVsxXSA+IDE6CiAgICAgICAgIyBkYXRhIGFjY3VtbXVsYXRvcnMgYnkgY2xhc3MKICAgICAgICBmcHIgPSBkaWN0KCkKICAgICAgICB0cHIgPSBkaWN0KCkKICAgICAgICByb2NfYXVjID0gZGljdCgpCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoeV9sYWJlbHNbOiw6LTFdLnNoYXBlWzFdKToKICAgICAgICAgICAgZnByW2ldLCB0cHJbaV0sIF8gPSBtZXRyaWNzLnJvY19jdXJ2ZSh5X2xhYmVsc1s6LCBpXSwgeV9wcm9ic1s6LCBpXSwgcG9zX2xhYmVsPTEpCiAgICAgICAgICAgIHJvY19hdWNbaV0gPSBtZXRyaWNzLmF1YyhmcHJbaV0sIHRwcltpXSkKICAgICAgICAgICAgcGx0LnBsb3QoZnByW2ldLCB0cHJbaV0sIGxhYmVsPWYiY2xhc3Mge2l9IikKICAgIGVsc2U6CiAgICAgICAgZnByLCB0cHIsIF8gPSBtZXRyaWNzLnJvY19jdXJ2ZSh5X2xhYmVscywgeV9wcm9ic1s6LCAxXSwgcG9zX2xhYmVsPTEpCiAgICAgICAgcGx0LnBsb3QoZnByLCB0cHIsIGxhYmVsPWYicG9zaXRpdmUgY2xhc3MiKQogICAgICAgIAogICAgZm5hbWUgPSBmIntwbG90c19kaXJ9L3trZXl9LntmbXR9IgogICAgcGx0LnNhdmVmaWcob3MucGF0aC5qb2luKGNvbnRleHQuYXJ0aWZhY3RfcGF0aCwgZm5hbWUpKQogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoUGxvdEFydGlmYWN0KGtleSwgYm9keT1wbHQuZ2NmKCkpLCBsb2NhbF9wYXRoPWZuYW1lKQogICAgCgpkZWYgcGxvdF9jb25mdXNpb25fbWF0cml4KAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBsYWJlbHMsCiAgICBwcmVkaWN0aW9ucywKICAgIGtleTogc3RyID0gImNvbmZ1c2lvbl9tYXRyaXgiLAogICAgcGxvdHNfZGlyOiBzdHIgPSAicGxvdHMiLAogICAgY29sb3JtYXA6IHN0ciA9ICJCbHVlcyIsCiAgICBmbXQ6IHN0ciA9ICJwbmciLAogICAgc2FtcGxlX3dlaWdodD1Ob25lCik6CiAgICAiIiJDcmVhdGUgYSBjb25mdXNpb24gbWF0cml4LgogICAgUGxvdCBhbmQgc2F2ZSBhIGNvbmZ1c2lvbiBtYXRyaXggdXNpbmcgdGVzdCBkYXRhIGZyb20gYQogICAgbW9kZWxsaW5lIHN0ZXAuCiAgICAKICAgIFNlZSBodHRwczovL3NjaWtpdC1sZWFybi5vcmcvc3RhYmxlL21vZHVsZXMvZ2VuZXJhdGVkL3NrbGVhcm4ubWV0cmljcy5jb25mdXNpb25fbWF0cml4Lmh0bWwKICAgIAogICAgVE9ETzogZml4IGxhYmVsIGFsaWdubWVudAogICAgVE9ETzogY29uc2lkZXIgdXNpbmcgYW5vdGhlciBwYWNrYWdlZCB2ZXJzaW9uCiAgICBUT0RPOiByZWZhY3RvciB0byB0YWtlIHBhcmFtcyBkaWN0IGZvciBwbG90IG9wdGlvbnMKCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0gbGFiZWxzOiAgICAgICAgICB2YWxpZGF0aW9uIGRhdGEgZ3JvdW5kLXRydXRoIGxhYmVscwogICAgOnBhcmFtIHByZWRpY3Rpb25zOiAgICAgdmFsaWRhdGlvbiBkYXRhIHByZWRpY3Rpb25zCiAgICA6cGFyYW0ga2V5OiAgICAgICAgICAgICBzdHIKICAgIDpwYXJhbSBwbG90c19kaXI6ICAgICAgIHJlbGF0aXZlIHBhdGggb2YgcGxvdHMgaW4gYXJ0aWZhY3Qgc3RvcmUKICAgIDpwYXJhbSBjb2xvcm1hcDogICAgICAgIGNvbG91cm1hcCBmb3IgY29uZnVzaW9uIG1hdHJpeAogICAgOnBhcmFtIGZtdDogICAgICAgICAgICAgcGxvdCBmb3JtYXQKICAgIDpwYXJhbSBzYW1wbGVfd2VpZ2h0OiAgIHNhbXBsZSB3ZWlnaHRzCiAgICAiIiIKICAgIF9nY2ZfY2xlYXIocGx0KQogICAgCiAgICBjbSA9IG1ldHJpY3MuY29uZnVzaW9uX21hdHJpeChsYWJlbHMsIHByZWRpY3Rpb25zLCBzYW1wbGVfd2VpZ2h0PU5vbmUpCiAgICBzbnMuaGVhdG1hcChjbSwgYW5ub3Q9VHJ1ZSwgY21hcD1jb2xvcm1hcCwgc3F1YXJlPVRydWUpCgogICAgZmlnID0gcGx0LmdjZigpCiAgICBmbmFtZSA9IGYie3Bsb3RzX2Rpcn0ve2tleX0ue2ZtdH0iCiAgICBmaWcuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oY29udGV4dC5hcnRpZmFjdF9wYXRoLCBmbmFtZSkpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3Qoa2V5LCBib2R5PWZpZyksIGxvY2FsX3BhdGg9Zm5hbWUpCgpkZWYgcGxvdF9pbXBvcnRhbmNlKAogICAgY29udGV4dCwKICAgIG1vZGVsLAogICAga2V5OiBzdHIgPSAiZmVhdHVyZS1pbXBvcnRhbmNlcyIsCiAgICBmbXQgPSAicG5nIgopOgogICAgIiIiRGlzcGxheSBlc3RpbWF0ZWQgZmVhdHVyZSBpbXBvcnRhbmNlcy4KICAgIDpwYXJhbSBjb250ZXh0OiAgICAgZnVuY3Rpb24gY29udGV4dAogICAgOnBhcmFtIG1vZGVsOiAgICAgICBmaXR0ZWQgbGlnaHRnYm0gbW9kZWwKICAgICIiIgogICAgX2djZl9jbGVhcihwbHQpCiAgICAKICAgICMgY3JlYXRlIGEgZmVhdHVyZSBpbXBvcnRhbmNlIHRhYmxlIHdpdGggZGVzaXJlZCBsYWJlbHMKICAgIHppcHBlZCA9IHppcChtb2RlbC5mZWF0dXJlX2ltcG9ydGFuY2VzXywgY29udGV4dC5oZWFkZXIpCgogICAgZmVhdHVyZV9pbXAgPSBwZC5EYXRhRnJhbWUoc29ydGVkKHppcHBlZCksIGNvbHVtbnM9WyJmcmVxIiwiZmVhdHVyZSJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKS5zb3J0X3ZhbHVlcyhieT0iZnJlcSIsIGFzY2VuZGluZz1GYWxzZSkKCiAgICBwbHQuZmlndXJlKGZpZ3NpemU9KDIwLCAxMCkpCiAgICBzbnMuYmFycGxvdCh4PSJmcmVxIiwgeT0iZmVhdHVyZSIsIGRhdGE9ZmVhdHVyZV9pbXApCiAgICBwbHQudGl0bGUoImZlYXR1cmVzIikKICAgIHBsdC50aWdodF9sYXlvdXQoKQoKICAgIGZpZyA9IHBsdC5nY2YoKQogICAgb3MubWFrZWRpcnMob3MucGF0aC5qb2luKGNvbnRleHQuYXJ0aWZhY3RfcGF0aCwgInBsb3RzIiksIGV4aXN0X29rPVRydWUpCiAgICBmaWcuc2F2ZWZpZyhvcy5wYXRoLmpvaW4oY29udGV4dC5hcnRpZmFjdF9wYXRoLCBmInBsb3RzL3trZXl9LntmbXR9IikpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3QoZiJ7a2V5fS57Zm10fSIsIGJvZHk9ZmlnKSwgbG9jYWxfcGF0aD1mInBsb3RzL3trZXl9LntmbXR9IikKCiAgICAjIGZlYXR1cmUgaW1wb3J0YW5jZXMgYXJlIGFsc28gc2F2ZWQgYXMgYSB0YWJsZToKICAgIGZlYXR1cmVfaW1wLnRvX2Nzdihvcy5wYXRoLmpvaW4oY29udGV4dC5hcnRpZmFjdF9wYXRoLCBrZXkrIi5jc3YiKSkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KGtleSsiLmNzdiIsIGxvY2FsX3BhdGg9a2V5KyIuY3N2IikKCiAgICBfZ2NmX2NsZWFyKHBsdCkKCmRlZiBfcGxvdF9jb25mdXNpb25fbWF0cml4KHlfdHJ1ZSwgeV9wcmVkLCBjbGFzc2VzPVsibmVnIiwgInBvcyJdLCAKICAgICAgICAgICAgICAgICAgICAgICAgICBub3JtYWxpemU9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZT1Ob25lLAogICAgICAgICAgICAgICAgICAgICAgICAgIGNtYXA9cGx0LmNtLkJsdWVzKToKICAgICIiIlRoaXMgY2FuIGJlIGRlcHJlY2F0ZWQgb25jZSBpbnRlbCBweXRob24gdXBncmFkZXMgc2Npa2l0LWxlYXJuIHRvID4wLjIyCiAgICAKICAgIFRoaXMgZnVuY3Rpb24gcHJpbnRzIGFuZCBwbG90cyB0aGUgY29uZnVzaW9uIG1hdHJpeC4KICAgIE5vcm1hbGl6YXRpb24gY2FuIGJlIGFwcGxpZWQgYnkgc2V0dGluZyBgbm9ybWFsaXplPVRydWVgLgogICAgCiAgICBodHRwczovL3NjaWtpdC1sZWFybi5vcmcvMC4yMS9hdXRvX2V4YW1wbGVzL21vZGVsX3NlbGVjdGlvbi9wbG90X2NvbmZ1c2lvbl9tYXRyaXguaHRtbCNzcGh4LWdsci1hdXRvLWV4YW1wbGVzLW1vZGVsLXNlbGVjdGlvbi1wbG90LWNvbmZ1c2lvbi1tYXRyaXgtcHkKICAgICIiIgogICAgaWYgbm90IHRpdGxlOgogICAgICAgIGlmIG5vcm1hbGl6ZToKICAgICAgICAgICAgdGl0bGUgPSAiTm9ybWFsaXplZCBjb25mdXNpb24gbWF0cml4IgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRpdGxlID0gIkNvbmZ1c2lvbiBtYXRyaXgsIHdpdGhvdXQgbm9ybWFsaXphdGlvbiIKCiAgICAjIENvbXB1dGUgY29uZnVzaW9uIG1hdHJpeAogICAgY20gPSBjb25mdXNpb25fbWF0cml4KHlfdHJ1ZSwgeV9wcmVkKQogICAgIyBPbmx5IHVzZSB0aGUgbGFiZWxzIHRoYXQgYXBwZWFyIGluIHRoZSBkYXRhCiAgICAjY2xhc3NlcyA9IGNsYXNzZXNbdW5pcXVlX2xhYmVscyh5X3RydWUsIHlfcHJlZCldCiAgICBpZiBub3JtYWxpemU6CiAgICAgICAgY20gPSBjbS5hc3R5cGUoImZsb2F0IikgLyBjbS5zdW0oYXhpcz0xKVs6LCBucC5uZXdheGlzXQoKICAgIGZpZywgYXggPSBwbHQuc3VicGxvdHMoKQogICAgaW0gPSBheC5pbXNob3coY20sIGludGVycG9sYXRpb249Im5lYXJlc3QiLCBjbWFwPWNtYXApCiAgICBheC5maWd1cmUuY29sb3JiYXIoaW0sIGF4PWF4KQogICAgIyBXZSB3YW50IHRvIHNob3cgYWxsIHRpY2tzLi4uCiAgICBheC5zZXQoeHRpY2tzPW5wLmFyYW5nZShjbS5zaGFwZVsxXSksCiAgICAgICAgICAgeXRpY2tzPW5wLmFyYW5nZShjbS5zaGFwZVswXSksCiAgICAgICAgICAgIyAuLi4gYW5kIGxhYmVsIHRoZW0gd2l0aCB0aGUgcmVzcGVjdGl2ZSBsaXN0IGVudHJpZXMKICAgICAgICAgICB4dGlja2xhYmVscz1jbGFzc2VzLCB5dGlja2xhYmVscz1jbGFzc2VzLAogICAgICAgICAgIHRpdGxlPXRpdGxlLAogICAgICAgICAgIHlsYWJlbD0iVHJ1ZSBsYWJlbCIsCiAgICAgICAgICAgeGxhYmVsPSJQcmVkaWN0ZWQgbGFiZWwiKQoKICAgICMgUm90YXRlIHRoZSB0aWNrIGxhYmVscyBhbmQgc2V0IHRoZWlyIGFsaWdubWVudC4KICAgIHBsdC5zZXRwKGF4LmdldF94dGlja2xhYmVscygpLCByb3RhdGlvbj00NSwgaGE9InJpZ2h0IiwKICAgICAgICAgICAgIHJvdGF0aW9uX21vZGU9ImFuY2hvciIpCgogICAgIyBMb29wIG92ZXIgZGF0YSBkaW1lbnNpb25zIGFuZCBjcmVhdGUgdGV4dCBhbm5vdGF0aW9ucy4KICAgIGZtdCA9ICIuMmYiIGlmIG5vcm1hbGl6ZSBlbHNlICJkIgogICAgdGhyZXNoID0gY20ubWF4KCkgLyAyLgogICAgZm9yIGkgaW4gcmFuZ2UoY20uc2hhcGVbMF0pOgogICAgICAgIGZvciBqIGluIHJhbmdlKGNtLnNoYXBlWzFdKToKICAgICAgICAgICAgYXgudGV4dChqLCBpLCBmb3JtYXQoY21baSwgal0sIGZtdCksCiAgICAgICAgICAgICAgICAgICAgaG9yaXpvbnRhbGFsaWdubWVudD0iY2VudGVyIiwKICAgICAgICAgICAgICAgICAgICBjb2xvcj0id2hpdGUiIGlmIGNtW2ksIGpdID4gdGhyZXNoIGVsc2UgImJsYWNrIikKICAgIGZpZy50aWdodF9sYXlvdXQoKQogICAgcmV0dXJuIGF4ICAgIA==
    commands: []
    code_origin: /User/functions/test_classifier/function.yaml
