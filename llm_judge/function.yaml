kind: job
metadata:
  name: llm-judge
  tag: ''
  hash: 44c38ad1c6b6d5bcd2d94638d6d58e891dc87a5f
  project: ''
  labels:
    author: pgw
  categories:
  - machine-learning
  - monitoring
spec:
  command: ''
  args: []
  image: ''
  build:
    functionSourceCode: IyBDb3B5cmlnaHQgMjAyNCBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAojCiMgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQojIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiMgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiMgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAojIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgojCgppbXBvcnQgcmUKZnJvbSBhYmMgaW1wb3J0IEFCQywgYWJzdHJhY3RtZXRob2QKZnJvbSBmdW5jdG9vbHMgaW1wb3J0IHdyYXBzCmZyb20gdHlwaW5nIGltcG9ydCBBbnksIENsYXNzVmFyLCBEaWN0LCBMaXN0LCBUdXBsZSwgVW5pb24sIFR5cGUsIFR5cGVWYXIsIENhbGxhYmxlCmZyb20gZW51bSBpbXBvcnQgRW51bQppbXBvcnQgbXBpNHB5CmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IHRyYW5zZm9ybWVycwoKaW1wb3J0IG1scnVuCmZyb20gbWxydW4ubW9kZWwgaW1wb3J0IE1vZGVsT2JqCmZyb20gbWxydW4udXRpbHMgaW1wb3J0IGxvZ2dlcgppbXBvcnQgb3BlbmFpCmltcG9ydCBqc29uCmltcG9ydCBwYXRobGliCgojIFRoZXNlIHBybW9wdCBhcmUgdXNlZCB0byBnZW5lcmF0ZSB0aGUgZ3JhZGUgZm9yIExMTS1hcyBhIGp1ZGdlCgoiIiIKQG1pc2N7emhlbmcyMDIzanVkZ2luZywKICAgICAgdGl0bGU9e0p1ZGdpbmcgTExNLWFzLWEtanVkZ2Ugd2l0aCBNVC1CZW5jaCBhbmQgQ2hhdGJvdCBBcmVuYX0sCiAgICAgIGF1dGhvcj17TGlhbm1pbiBaaGVuZyBhbmQgV2VpLUxpbiBDaGlhbmcgYW5kIFlpbmcgU2hlbmcgYW5kIFNpeXVhbiBaaHVhbmcKICAgICAgYW5kIFpoYW5naGFvIFd1IGFuZCBZb25naGFvIFpodWFuZyBhbmQgWmkgTGluIGFuZCBaaHVvaGFuIExpCiAgICAgIGFuZCBEYWNoZW5nIExpIGFuZCBFcmljLiBQIFhpbmcgYW5kIEhhbyBaaGFuZyBhbmQgSm9zZXBoIEUuIEdvbnphbGV6CiAgICAgIGFuZCBJb24gU3RvaWNhfSwKICAgICAgeWVhcj17MjAyM30sCiAgICAgIGVwcmludD17MjMwNi4wNTY4NX0sCiAgICAgIGFyY2hpdmVQcmVmaXg9e2FyWGl2fSwKICAgICAgcHJpbWFyeUNsYXNzPXtjcy5DTH0KfQoiIiIKClNJTkdMRV9HUkFERV9QUk9NUFQgPSAiIiIKVGFzazoKUGxlYXNlIGFjdCBhcyBhbiBpbXBhcnRpYWwganVkZ2UgYW5kIGV2YWx1YXRlIHRoZSBxdWFsaXR5IG9mIHRoZSByZXNwb25zZSBwcm92aWRlZCBieSBhbgpBSSBhc3Npc3RhbnQgdG8gdGhlIHVzZXIgcXVlc3Rpb24gZGlzcGxheWVkIGJlbG93LiBZb3Ugd2lsbCBiZSBnaXZlbiB0aGUgZGVmaW5pdGlvbiBvZiB7bmFtZX0sIGdyYWRpbmcgcnVicmljLCBjb250ZXh0IGluZm9ybWF0aW9uLgpZb3VyIHRhc2sgaXMgdG8gZGV0ZXJtaW5lIGEgbnVtZXJpY2FsIHNjb3JlIG9mIHtuYW1lfSBmb3IgdGhlIHJlc3BvbnNlLiBZb3UgbXVzdCB1c2UgdGhlIGdyYWRpbmcgcnVicmljIHRvIGRldGVybWluZSB5b3VyIHNjb3JlLiBZb3UgbXVzdCBhbHNvIGdpdmUgYSBleHBsYW5hdGlvbiBhYm91dCBob3cgZGlkIHlvdSBkZXRlcm1pbmUgdGhlIHNjb3JlIHN0ZXAtYnktc3RlcC4gUGxlYXNlIHVzZSBjaGFpbiBvZiB0aGlua2luZy4KRXhhbXBsZXMgY291bGQgYmUgaW5jbHVkZWQgYmVibG93IGZvciB5b3VyIHJlZmVyZW5jZS4gTWFrZSBzdXJlIHlvdSB1bmRlcnN0YW5kIHRoZSBncmFkaW5nIHJ1YnJpYyBhbmQgdXNlIHRoZSBleGFtcGxlcyBiZWZvcmUgY29tcGxldGluZyB0aGUgdGFzay4KW0V4YW1wbGVzXToKe2V4YW1wbGVzfQpbVXNlciBRdWVzdGlvbl06CntxdWVzdGlvbn0KW1Jlc3BvbnNlXToKe2Fuc3dlcn0KW0RlZmluaXRpb24gb2Yge25hbWV9XToKe2RlZmluaXRpb259CltHcmFkaW5nIFJ1YnJpY106CntydWJyaWN9CllvdSBtdXN0IHJldHVybiB0aGUgZm9sbG93aW5nIGZpZWxkcyBpbiB5b3VyIG91dHB1dDoKLSBzY29yZTogYSBudW1lcmljYWwgc2NvcmUgb2Yge25hbWV9IGZvciB0aGUgcmVzcG9uc2UKLSBleHBsYW5hdGlvbjogYSBleHBsYW5hdGlvbiBhYm91dCBob3cgZGlkIHlvdSBkZXRlcm1pbmUgdGhlIHNjb3JlIHN0ZXAtYnktc3RlcApbT3V0cHV0XToKIiIiCgpQQUlSX0dSQURFX1BST01QVCA9ICIiIgpUYXNrOgpZb3VyIHRhc2sgaXMgdG8gZGV0ZXJtaW5lIHR3byBudW1lcmljYWwgc2NvcmUgb2Yge25hbWV9IGZvciB0aGUgcmVzcG9uc2VzIGZyb20gdHdvIEFJIGFzc2lzdGFudHMuIFlvdSBtdXN0IHVzZSB0aGUgZ3JhZGluZyBydWJyaWMgdG8gZGV0ZXJtaW5lIHlvdXIgc2NvcmVzLiBZb3UgbXVzdCBhbHNvIGdpdmUgYSBleHBsYW5hdGlvbiBhYm91dCBob3cgZGlkIHlvdSBkZXRlcm1pbmUgdGhlIHNjb3JlcyBzdGVwLWJ5LXN0ZXAuIFBsZWFzZSB1c2luZyBjaGFpbiBvZiB0aGlua2luZy4KRXhhbXBsZXMgY291bGQgYmUgaW5jbHVkZWQgYmVibG93IGZvciB5b3VyIHJlZmVyZW5jZS4gTWFrZSBzdXJlIHlvdSB1bmRlcnN0YW5kIHRoZSBncmFkaW5nIHJ1YnJpYyBhbmQgdXNlIHRoZSBleGFtcGxlcyBiZWZvcmUgY29tcGxldGluZyB0aGUgdGFzay4KW0V4YW1wbGVzXToKe2V4YW1wbGVzfQpbVXNlciBRdWVzdGlvbl06CntxdWVzdGlvbn0KW1Jlc3BvbnNlIG9mIGFzc2lzdGFudCBBXToKe2Fuc3dlckF9CltSZXNwb25zZSBvZiBhc3Npc3RhbnQgQl06CnthbnN3ZXJCfQpbRGVmaW5pdGlvbiBvZiB7bmFtZX1dOgp7ZGVmaW5pdGlvbn0KW0dyYWRpbmcgUnVicmljXToKe3J1YnJpY30KWW91IG11c3QgcmV0dXJuIHRoZSBmb2xsb3dpbmcgZmllbGRzIGluIHlvdXIgb3V0cHV0OgotIHNjb3JlIG9mIGFzc2lzdGFudCBhOiBhIG51bWVyaWNhbCBzY29yZSBvZiB7bmFtZX0gZm9yIHRoZSByZXNwb25zZQotIGV4cGxhbmF0aW9uIG9mIGFzc2lzdGFudCBhOiBhIGV4cGxhbmF0aW9uIGFib3V0IGhvdyBkaWQgeW91IGRldGVybWluZSB0aGUgc2NvcmUgc3RlcC1ieS1zdGVwCi0gc2NvcmUgb2YgYXNzaXN0YW50IGI6IGEgbnVtZXJpY2FsIHNjb3JlIG9mIHtuYW1lfSBmb3IgdGhlIHJlc3BvbnNlCi0gZXhwbGFuYXRpb24gb2YgYXNzaXN0YW50IGI6IGEgZXhwbGFuYXRpb24gYWJvdXQgaG93IGRpZCB5b3UgZGV0ZXJtaW5lIHRoZSBzY29yZSBzdGVwLWJ5LXN0ZXAKW091dHB1dF06CiIiIgoKUkVGX0dSQURFX1BST01QVCA9ICIiIgpUYXNrOgpZb3VyIHRhc2sgaXMgdG8gZGV0ZXJtaW5lIHR3byBudW1lcmljYWwgc2NvcmUgb2Yge25hbWV9IGZvciB0aGUgcmVzcG9uc2VzIGZyb20gdHdvIEFJIGFzc2lzdGFudHMgd2l0aCB0aGUgZ3JvdW5kIHRydXRoIG9mIHRoZSByZXNwb25zZS4gWW91IG11c3QgdXNlIHRoZSBncmFkaW5nIHJ1YnJpYyB0byBkZXRlcm1pbmUgeW91ciBzY29yZXMuIFlvdSBtdXN0IHVzZSB0aGUgZ3JvdW5kIHRydXRoIG9mIHRoZSByZXNwb25zZS4gWW91IG5lZWQgdG8gZ2l2ZSBhIGV4cGxhbmF0aW9uIGFib3V0IGhvdyBkaWQgeW91IGNvbXBhcmUgd2l0aCB0aGUgZ3JvdW5kIHRydXRoIG9mIHRoZSByZXNwb25zZSB0byBkZXRlcm1pbmUgdGhlIHNjb3JlcyBzdGVwLWJ5LXN0ZXAuIFBsZWFzZSB1c2luZyBjaGFpbiBvZiB0aGlua2luZy4KRXhhbXBsZXMgY291bGQgYmUgaW5jbHVkZWQgYmVibG93IGZvciB5b3VyIHJlZmVyZW5jZS4gTWFrZSBzdXJlIHlvdSB1bmRlcnN0YW5kIHRoZSBncmFkaW5nIHJ1YnJpYyBhbmQgdXNlIHRoZSBleGFtcGxlcyBiZWZvcmUgY29tcGxldGluZyB0aGUgdGFzay4KW0V4YW1wbGVzXToKe2V4YW1wbGVzfQpbVXNlciBRdWVzdGlvbl06CntxdWVzdGlvbn0KW1Jlc3BvbnNlIG9mIGFzc2lzdGFudCBBXToKe2Fuc3dlckF9CltSZXNwb25zZSBvZiBhc3Npc3RhbnQgQl06CnthbnN3ZXJCfQpbR3JvdW5kIHRydXRoIG9mIHRoZSByZXNwb25zZV06CntyZWZlcmVuY2V9CltEZWZpbml0aW9uIG9mIHtuYW1lfV06CntkZWZpbml0aW9ufQpbR3JhZGluZyBSdWJyaWNdOgp7cnVicmljfQpZb3UgbXVzdCByZXR1cm4gdGhlIGZvbGxvd2luZyBmaWVsZHMgaW4geW91ciBvdXRwdXQ6Ci0gc2NvcmUgb2YgYXNzaXN0YW50IGE6IGEgbnVtZXJpY2FsIHNjb3JlIG9mIHtuYW1lfSBmb3IgdGhlIHJlc3BvbnNlCi0gZXhwbGFuYXRpb24gb2YgYXNzaXN0YW50IGE6IGEgZXhwbGFuYXRpb24gYWJvdXQgaG93IGRpZCB5b3UgY29tcGFyZSB3aXRoIHRoZSBncm91bmQgdHJ1dGggb2YgdGhlIHJlc3BvbnNlIHRvIGRldGVybWluZSB0aGUgc2NvcmUgc3RlcC1ieS1zdGVwCi0gc2NvcmUgb2YgYXNzaXN0YW50IGI6IGEgbnVtZXJpY2FsIHNjb3JlIG9mIHtuYW1lfSBmb3IgdGhlIHJlc3BvbnNlCi0gZXhwbGFuYXRpb24gb2YgYXNzaXN0YW50IGI6IGEgZXhwbGFuYXRpb24gYWJvdXQgaG93IGRpZCB5b3UgY29tcGFyZSB3aXRoIHRoZSBncm91bmQgdHJ1dGggb2YgdGhlIHJlc3BvbnNlIHRvIGRldGVybWluZSB0aGUgc2NvcmUgc3RlcC1ieS1zdGVwCltPdXRwdXRdOgoiIiIKCgpkZWYgX2NoZWNrX21scnVuX2FuZF9vcGVuX21waSgpIC0+IFR1cGxlWyJtbHJ1bi5NTENsaWVudEN0eCIsICJtcGk0cHkuTVBJLkludHJhY29tbSJdOgogICAgaXNfbXBpID0gRmFsc2UKICAgIHRyeToKICAgICAgICBjb250ZXh0ID0gbWxydW4uZ2V0X29yX2NyZWF0ZV9jdHgobmFtZT0ibWxydW4iKQogICAgICAgIGlzX21waSA9IGNvbnRleHQubGFiZWxzLmdldCgia2luZCIsICJqb2IiKSA9PSAibXBpam9iIgoKICAgICAgICBpZiBpc19tcGk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZyb20gbXBpNHB5IGltcG9ydCBNUEkKCiAgICAgICAgICAgICAgICByZXR1cm4gY29udGV4dCwgTVBJLkNPTU1fV09STEQKICAgICAgICAgICAgZXhjZXB0IE1vZHVsZU5vdEZvdW5kRXJyb3IgYXMgbXBpNHB5X25vdF9mb3VuZDoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigKICAgICAgICAgICAgICAgICAgICAiVG8gZGlzdHJpYnV0ZSB0aGUgZnVuY3Rpb24gdXNpbmcgTUxSdW4ncyAnbXBpam9iJyB5b3UgbmVlZCB0byBoYXZlIGBtcGk0cHlgIHBhY2thZ2UgaW4geW91ciAiCiAgICAgICAgICAgICAgICAgICAgImludGVycHJldGVyLiBQbGVhc2UgcnVuIGBwaXAgaW5zdGFsbCBtcGk0cHlgIGFuZCBtYWtlIHN1cmUgeW91IGhhdmUgb3Blbi1tcGkuIgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcmFpc2UgbXBpNHB5X25vdF9mb3VuZAogICAgZXhjZXB0IE1vZHVsZU5vdEZvdW5kRXJyb3IgYXMgbW9kdWxlX25vdF9mb3VuZDoKICAgICAgICBpZiBpc19tcGk6CiAgICAgICAgICAgIHJhaXNlIG1vZHVsZV9ub3RfZm91bmQKICAgIHJldHVybiBOb25lLCBOb25lCgoKZGVmIF9vcGVuX21waV9oYW5kbGVyKAogICAgd29ya2VyX2lucHV0czogc3RyLAopOgogICAgIyBDaGVjayBmb3IgTUxSdW4gYW5kIE9wZW5NUEkgYXZhaWxhYmlsaXR5OgogICAgY29udGV4dCwgY29tbSA9IF9jaGVja19tbHJ1bl9hbmRfb3Blbl9tcGkoKQoKICAgIGRlZiBfZGVjb3JhdG9yKGhhbmRsZXIpOgogICAgICAgIGlmIGNvbW0gaXMgTm9uZSBvciBjb21tLkdldF9zaXplKCkgPT0gMToKICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIKCiAgICAgICAgQHdyYXBzKGhhbmRsZXIpCiAgICAgICAgZGVmIF93cmFwcGVyKCoqa3dhcmdzKToKICAgICAgICAgICAgIyBHZXQgdGhlIG9wZW4gbXBpIGVudmlyb25tZW50IHByb3BlcnRpZXM6CiAgICAgICAgICAgIHNpemUgPSBjb21tLkdldF9zaXplKCkKICAgICAgICAgICAgcmFuayA9IGNvbW0uR2V0X3JhbmsoKQogICAgICAgICAgICBzYW1wbGVfZGYgPSBrd2FyZ3Nbd29ya2VyX2lucHV0c10KCiAgICAgICAgICAgICMgR2l2ZSB0aGUgY29ycmVjdCBjaHVuayBvZiB0aGUgd29ya2VycyBpbnB1dHM6CiAgICAgICAgICAgIGV2ZW5fY2h1bmtfc2l6ZSA9IGxlbihzYW1wbGVfZGYpIC8vIHNpemUKICAgICAgICAgICAgY2h1bmtfc3RhcnQgPSByYW5rICogZXZlbl9jaHVua19zaXplCiAgICAgICAgICAgIGNodW5rX2VuZCA9ICgKICAgICAgICAgICAgICAgIChyYW5rICsgMSkgKiBldmVuX2NodW5rX3NpemUgaWYgcmFuayArIDEgPCBzaXplIGVsc2UgbGVuKHNhbXBsZV9kZikKICAgICAgICAgICAgKQogICAgICAgICAgICBsb2dnZXIuaW5mbygKICAgICAgICAgICAgICAgIGYiUmFuayAje3Jhbmt9OiBQcm9jZXNzaW5nIGlucHV0IGNodW5rIHNhbXBsZSBkYXRhZnJhbWUiCiAgICAgICAgICAgICAgICBmImZyb20gaW5kZXgge2NodW5rX3N0YXJ0fSB0byB7Y2h1bmtfZW5kfS4iCiAgICAgICAgICAgICkKICAgICAgICAgICAgc2FtcGxlX2RmID0gc2FtcGxlX2RmLmlsb2NbY2h1bmtfc3RhcnQ6Y2h1bmtfZW5kOiwgOl0KICAgICAgICAgICAga3dhcmdzW3dvcmtlcl9pbnB1dHNdID0gc2FtcGxlX2RmCgogICAgICAgICAgICAjIFJ1biB0aGUgd29ya2VyOgogICAgICAgICAgICBvdXRwdXQgPSBoYW5kbGVyKCoqa3dhcmdzKQoKICAgICAgICAgICAgIyBTZW5kIHRoZSBvdXRwdXQgdG8gdGhlIHJvb3QgcmFuayAocmFuayAjMCk6CiAgICAgICAgICAgIG91dHB1dCA9IGNvbW0uZ2F0aGVyKG91dHB1dCwgcm9vdD0wKQogICAgICAgICAgICBpZiByYW5rID09IDA6CiAgICAgICAgICAgICAgICAjIEpvaW4gdGhlIG91dHB1dHM6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiQ29sbGVjdGluZyBkYXRhIGZyb20gd29ya2VycyB0byByb290IHdvcmtlci4iKQogICAgICAgICAgICAgICAgZGF0YWZyYW1lID0gcGQuY29uY2F0KG9ianM9W2RmIGZvciBkZiwgXyBpbiBvdXRwdXRdLCBheGlzPTApCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YWZyYW1lCiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgIHJldHVybiBfd3JhcHBlcgoKICAgIHJldHVybiBfZGVjb3JhdG9yCgoKY2xhc3MgTExNSnVkZ2VCYXNlTWV0cmljKE1vZGVsT2JqLCBBQkMpOgogICAgIiIiCiAgICBCYXNlIGNsYXNzIG9mIHRoZSBtZXRyaWNzIHRoYXQgY29tcHV0ZWQgYnkgTExNIGFzIGEganVkZ2UKICAgIFdlIGRvbid0IG5lZWQgdGhlIHlfdHJ1ZSBhcyByZWZlcmVuY2UuIFRoZXNlIG1ldHJpY3MgYXJlIHVzZWQgZm9yIG1vcmUgb3Blbi1lbmRlZCBxdWVzdGlvbiBmb3IgdGhlIG1vZGVsCiAgICBhbmQgdGhlIGFsZ29yaXRobSBpcyBiYXNlZCBvbiB0aGUgcGFwZXIgaHR0cHM6Ly9hcnhpdi5vcmcvcGRmLzIzMDYuMDU2ODUucGRmCiAgICAiIiIKCiAgICBfZGljdF9maWVsZHMgPSBbCiAgICAgICAgIm5hbWUiLAogICAgICAgICJtb2RlbF9qdWRnZSIsCiAgICAgICAgInByb21wdF90ZW1wbGF0ZSIsCiAgICAgICAgInByb21wdF9jb25maWciLAogICAgICAgICJtb2RlbF9qdWRnZV9jb25maWciLAogICAgICAgICJ0b2tlbml6ZXJfanVkZ2VfY29uZmlnIiwKICAgICAgICAibW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnIiwKICAgIF0KICAgIGtpbmQgPSAibGxtX2p1ZGdlX21ldHJpYyIKICAgIGRlZmF1bHRfbmFtZTogQ2xhc3NWYXJbc3RyXSA9ICJsbG1fanVkZ2VfbWV0cmljIgoKICAgIGRlZiBfX2luaXRfXygKICAgICAgICBzZWxmLAogICAgICAgIG5hbWU6IHN0ciwKICAgICAgICBtb2RlbF9qdWRnZTogc3RyLAogICAgICAgIHByb21wdF90ZW1wbGF0ZTogc3RyLAogICAgICAgIHByb21wdF9jb25maWc6IERpY3Rbc3RyLCBBbnldLAogICAgICAgIG1vZGVsX2p1ZGdlX2NvbmZpZzogRGljdFtzdHIsIEFueV0gPSBOb25lLAogICAgICAgIHRva2VuaXplcl9qdWRnZV9jb25maWc6IERpY3Rbc3RyLCBBbnldID0gTm9uZSwKICAgICAgICBtb2RlbF9qdWRnZV9pbmZlcl9jb25maWc6IERpY3Rbc3RyLCBBbnldID0gTm9uZSwKICAgICk6CiAgICAgICAgIiIiCiAgICAgICAgVGhlc2UgbWV0cmljcyBhcmUgdXNlZCB0byBldmFsdWF0ZSB0aGUgbW9kZWwgcGVyZm9ybWFuY2Ugb24gYSBnaXZlbiBkYXRhc2V0CiAgICAgICAgOnBhcmFtIG5hbWU6IG5hbWUgb2YgdGhlIG1ldHJpYwogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZTogdGhlIG1vZGVsIGp1ZGdlIHRvIHVzZQogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZV9jb25maWc6IHRoZSBtb2RlbCBqdWRnZSBjb25maWcKICAgICAgICA6cGFyYW0gdG9rZW5pemVyX2p1ZGdlX2NvbmZpZzogdGhlIHRva2VuaXplciBqdWRnZSBjb25maWcKICAgICAgICA6cGFyYW0gbW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnOiB0aGUgbW9kZWwganVkZ2UgaW5mZXIgY29uZmlnCiAgICAgICAgOnBhcmFtIHByb21wdF90ZW1wbGF0ZTogdGhlIHByb21wdCB0ZW1wbGF0ZSB0byBmaWxsCiAgICAgICAgOnBhcmFtIHByb21wdF9jb25maWc6IHRoZSBwcm9tcHQgY29uZmlnIHRvIGZpbGwgdGhlIHRlbXBsYXRlIHdpdGgKICAgICAgICAiIiIKICAgICAgICBzZWxmLm5hbWUgPSBuYW1lIG9yIHNlbGYuZGVmYXVsdF9uYW1lCiAgICAgICAgc2VsZi5tb2RlbF9qdWRnZSA9IG1vZGVsX2p1ZGdlCiAgICAgICAgc2VsZi5tb2RlbF9qdWRnZV9jb25maWcgPSBtb2RlbF9qdWRnZV9jb25maWcKICAgICAgICBzZWxmLnRva2VuaXplcl9qdWRnZV9jb25maWcgPSB0b2tlbml6ZXJfanVkZ2VfY29uZmlnCiAgICAgICAgc2VsZi5tb2RlbF9qdWRnZV9pbmZlcl9jb25maWcgPSBtb2RlbF9qdWRnZV9pbmZlcl9jb25maWcKICAgICAgICBzZWxmLnByb21wdF90ZW1wbGF0ZSA9IHByb21wdF90ZW1wbGF0ZQogICAgICAgIHNlbGYucHJvbXB0X2NvbmZpZyA9IHByb21wdF9jb25maWcKCiAgICBkZWYgX2ZpbGxfcHJvbXB0KHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBGaWxsIHRoZSBwcm9tcHQgdGVtcGxhdGUgd2l0aCB0aGUgcHJvbXB0IGNvbmZpZwogICAgICAgIDpwYXJhbSBwcm9tcHRfdGVtcGxhdGU6IHRoZSBwcm9tcHQgdGVtcGxhdGUgdG8gZmlsbAogICAgICAgIDpwYXJhbSBwcm9tcHRfY29uZmlnOiB0aGUgcHJvbXB0IGNvbmZpZyB0byBmaWxsIHRoZSB0ZW1wbGF0ZSB3aXRoCiAgICAgICAgOnJldHVybnM6IHRoZSBmaWxsZWQgcHJvbXB0CiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oIkZpbGxpbmcgdGhlIHByb21wdCB0ZW1wbGF0ZSB3aXRoIHRoZSBwcm9tcHQgY29uZmlnIikKICAgICAgICByZXR1cm4gc2VsZi5wcm9tcHRfdGVtcGxhdGUuZm9ybWF0KCoqc2VsZi5wcm9tcHRfY29uZmlnKQoKICAgIEBhYnN0cmFjdG1ldGhvZAogICAgZGVmIF9wcmVwYXJlX2p1ZGdlKHNlbGYpIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgUHJlcGFyZSB0aGUganVkZ2UgbW9kZWwKICAgICAgICAiIiIKICAgICAgICBwYXNzCgogICAgQGFic3RyYWN0bWV0aG9kCiAgICBkZWYgX2NvbXB1dGVfb3Zlcl9vbmVfZGF0YShzZWxmLCBxdWVzdGlvbjogc3RyLCByZXNwb25zZTogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDb21wdXRlIHRoZSBtZXRyaWNzIG92ZXIgb25lIGRhdGEgcG9pbnQKICAgICAgICA6cGFyYW0gcXVlc3Rpb246IHRoZSBxdWVzdGlvbiB0byBjb21wdXRlIHRoZSBtZXRyaWNzIG92ZXIKICAgICAgICA6cGFyYW0gcmVzcG9uc2U6IHRoZSByZXNwb25zZSB0byBjb21wdXRlIHRoZSBtZXRyaWNzIG92ZXIKICAgICAgICA6cmV0dXJuczogdGhlIG1ldHJpY3Mgc2NvcmUgYW5kIHRoZSBleHBsYW5hdGlvbgogICAgICAgICIiIgogICAgICAgIHBhc3MKCiAgICBAYWJzdHJhY3RtZXRob2QKICAgIGRlZiBfY29tcHV0ZV9vdmVyX2RhdGEoCiAgICAgICAgc2VsZiwgc2FtcGxlX2RmOiBwZC5EYXRhRnJhbWUsIHRyYWluX2RmOiBwZC5EYXRhRnJhbWUgPSBOb25lCiAgICApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlciBvbmUgZGF0YSBwb2ludAogICAgICAgIDpwYXJhbSBxdWVzdGlvbjogdGhlIHF1ZXN0aW9uIHRvIGNvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlcgogICAgICAgIDpwYXJhbSByZXNwb25zZTogdGhlIHJlc3BvbnNlIHRvIGNvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlcgogICAgICAgIDpyZXR1cm5zOiB0aGUgbWV0cmljcyBzY29yZSBhbmQgdGhlIGV4cGxhbmF0aW9uCiAgICAgICAgIiIiCiAgICAgICAgcGFzcwoKICAgIEBhYnN0cmFjdG1ldGhvZAogICAgZGVmIF9leHRyYWN0X3Njb3JlX2V4cGxhbmF0aW9uKHNlbGYsIHJlc3VsdDogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBBYnN0cmFjdCB0aGUgc3RvcmUgb2YgdGhlIHJlc3VsdAogICAgICAgIDpwYXJhbSByZXN1bHQ6IHRoZSByZXN1bHQgdGV4dAogICAgICAgIDpyZXR1cm5zOiB0aGUgc3RvcmVkIHJlc3VsdAogICAgICAgICIiIgogICAgICAgIHBhc3MKCgpjbGFzcyBMTE1KdWRnZVNpbmdsZUdyYWRpbmcoTExNSnVkZ2VCYXNlTWV0cmljKToKICAgICIiIgogICAgQmFzZSBjbGFzcyBmb3IgTExNIGFzIGEganVkZ2UgdXNpbmcgc2luZ2xlIGdyYWRpbmcuCiAgICB5b3UgbmVlZCB0byBkZWZpbmUgdGhlIGRlZm5pdGlvbiBvZiB0aGUgbWV0cmljcyBhbmQgZ2l2ZSB0aGUgZ3JhZGluZyBvZiB0aGUgcnViaWMKICAgICIiIgoKICAgIF9kaWN0X2ZpZWxkcyA9IFsKICAgICAgICAibmFtZSIsCiAgICAgICAgIm1vZGVsX2p1ZGdlIiwKICAgICAgICAibW9kZWxfanVkZ2VfY29uZmlnIiwKICAgICAgICAibW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnIiwKICAgICAgICAicHJvbXB0X2NvbmZpZyIsCiAgICAgICAgInRva2VuaXplcl9qdWRnZV9jb25maWciLAogICAgICAgICJwcm9tcHRfdGVtcGxhdGUiLAogICAgXQogICAga2luZCA9ICJsbG1fanVkZ2Vfc2luZ2xlX2dyYWRpbmciCgogICAgZGVmIF9faW5pdF9fKAogICAgICAgIHNlbGYsCiAgICAgICAgbmFtZTogc3RyLAogICAgICAgIG1vZGVsX2p1ZGdlOiBzdHIsCiAgICAgICAgbW9kZWxfanVkZ2VfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwKICAgICAgICBtb2RlbF9qdWRnZV9pbmZlcl9jb25maWc6IERpY3Rbc3RyLCBBbnldLAogICAgICAgIHByb21wdF9jb25maWc6IERpY3Rbc3RyLCBBbnldLAogICAgICAgIHByb21wdF90ZW1wbGF0ZTogc3RyID0gU0lOR0xFX0dSQURFX1BST01QVCwKICAgICAgICB0b2tlbml6ZXJfanVkZ2VfY29uZmlnOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUsCiAgICApOgogICAgICAgICIiIgogICAgICAgIGluaXQgdGhlIGNsYXNzCiAgICAgICAgOnBhcmFtIG5hbWU6IG5hbWUgb2YgdGhlIG1ldHJpYwogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZTogdGhlIG1vZGVsIGp1ZGdlIHRvIHVzZQogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZV9jb25maWc6IHRoZSBtb2RlbCBqdWRnZSBjb25maWcKICAgICAgICA6cGFyYW0gdG9rZW5pemVyX2p1ZGdlX2NvbmZpZzogdGhlIHRva2VuaXplciBqdWRnZSBjb25maWcKICAgICAgICA6cGFyYW0gbW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnOiB0aGUgbW9kZWwganVkZ2UgaW5mZXIgY29uZmlnCiAgICAgICAgOnBhcmFtIHByb21wdF90ZW1wbGF0ZTogdGhlIHByb21wdCB0ZW1wbGF0ZSB0byBmaWxsCiAgICAgICAgOnBhcmFtIHByb21wdF9jb25maWc6IHRoZSBwcm9tcHQgY29uZmlnIHRvIGZpbGwgdGhlIHRlbXBsYXRlIHdpdGgKICAgICAgICAiIiIKICAgICAgICBzdXBlcigpLl9faW5pdF9fKAogICAgICAgICAgICBuYW1lLAogICAgICAgICAgICBtb2RlbF9qdWRnZSwKICAgICAgICAgICAgcHJvbXB0X3RlbXBsYXRlLAogICAgICAgICAgICBwcm9tcHRfY29uZmlnLAogICAgICAgICAgICBtb2RlbF9qdWRnZV9jb25maWcsCiAgICAgICAgICAgIHRva2VuaXplcl9qdWRnZV9jb25maWcsCiAgICAgICAgICAgIG1vZGVsX2p1ZGdlX2luZmVyX2NvbmZpZywKICAgICAgICApCgogICAgZGVmIF9wcmVwYXJlX2p1ZGdlKHNlbGYpIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgUHJlcGFyZSB0aGUganVkZ2UgbW9kZWwgaXQgd2lsbCBpbml0IHRoZSB0b2tlbml6ZXIgYW5kIHRoZSBtb2RlbAogICAgICAgICIiIgogICAgICAgIGxvZ2dlci5pbmZvKGYiUHJlcGFyaW5nIHRoZSBqdWRnZSBtb2RlbCB7c2VsZi5tb2RlbF9qdWRnZX0iKQogICAgICAgIHNlbGYudG9rZW5pemVyID0gdHJhbnNmb3JtZXJzLkF1dG9Ub2tlbml6ZXIuZnJvbV9wcmV0cmFpbmVkKAogICAgICAgICAgICBzZWxmLm1vZGVsX2p1ZGdlLCAqKnNlbGYudG9rZW5pemVyX2p1ZGdlX2NvbmZpZwogICAgICAgICkKICAgICAgICBzZWxmLm1vZGVsID0gdHJhbnNmb3JtZXJzLkF1dG9Nb2RlbEZvckNhdXNhbExNLmZyb21fcHJldHJhaW5lZCgKICAgICAgICAgICAgc2VsZi5tb2RlbF9qdWRnZSwgKipzZWxmLm1vZGVsX2p1ZGdlX2NvbmZpZwogICAgICAgICkKCiAgICBkZWYgX2NvbXB1dGVfb3Zlcl9vbmVfZGF0YShzZWxmLCBxdWVzdGlvbiwgcmVzcG9uc2UpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlciBvbmUgZGF0YSBwb2ludAogICAgICAgIDpwYXJhbSBxdWVzdGlvbjogdGhlIHF1ZXN0aW9uIHRvIGNvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlcgogICAgICAgIDpwYXJhbSByZXNwb25zZTogdGhlIHJlc3BvbnNlIHRvIGNvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlcgogICAgICAgIDpyZXR1cm5zOiB0aGUgbWV0cmljcyBzY29yZSBhbmQgdGhlIGV4cGxhbmF0aW9uCiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oCiAgICAgICAgICAgIGYiQ29tcHV0aW5nIHRoZSBtZXRyaWNzIG92ZXIgb25lIGRhdGEgcG9pbnQgd2l0aCB7cXVlc3Rpb259IGFuZCB7cmVzcG9uc2V9IgogICAgICAgICkKICAgICAgICBzZWxmLnByb21wdF9jb25maWdbInF1ZXN0aW9uIl0gPSBxdWVzdGlvbgogICAgICAgIHNlbGYucHJvbXB0X2NvbmZpZ1siYW5zd2VyIl0gPSByZXNwb25zZQogICAgICAgIGlucHV0X2lkcyA9IHNlbGYudG9rZW5pemVyKHNlbGYuX2ZpbGxfcHJvbXB0KCksIHJldHVybl90ZW5zb3JzPSJwdCIpLmlucHV0X2lkcwogICAgICAgIG91dHB1dHMgPSBzZWxmLm1vZGVsLmdlbmVyYXRlKAogICAgICAgICAgICBpbnB1dF9pZHMsCiAgICAgICAgICAgIHBhZF90b2tlbl9pZD1zZWxmLnRva2VuaXplci5wYWRfdG9rZW5faWQsCiAgICAgICAgICAgIGVvc190b2tlbl9pZD1zZWxmLnRva2VuaXplci5lb3NfdG9rZW5faWQsCiAgICAgICAgICAgICoqc2VsZi5tb2RlbF9qdWRnZV9pbmZlcl9jb25maWcsCiAgICAgICAgKQoKICAgICAgICByZXNwb25zZV9pZHMgPSBvdXRwdXRzWzBdCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLnRva2VuaXplci5kZWNvZGUocmVzcG9uc2VfaWRzLCBza2lwX3NwZWNpYWxfdG9rZW5zPVRydWUpCiAgICAgICAgcmVzX2RpYyA9IHNlbGYuX2V4dHJhY3Rfc2NvcmVfZXhwbGFuYXRpb24ocmVzcG9uc2UpCiAgICAgICAgcmV0dXJuIHJlc19kaWMKCiAgICBAX29wZW5fbXBpX2hhbmRsZXIod29ya2VyX2lucHV0cz0ic2FtcGxlX2RmIikKICAgIGRlZiBfY29tcHV0ZV9vdmVyX2RhdGEoCiAgICAgICAgc2VsZiwgc2FtcGxlX2RmOiBwZC5EYXRhRnJhbWUsIHRyYWluX2RmOiBwZC5EYXRhRnJhbWUgPSBOb25lCiAgICApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlciBhbGwgZGF0YQogICAgICAgIDpwYXJhbSBzYW1wbGVfZGY6IHRoZSBzYW1wbGUgZGF0YWZyYW1lCiAgICAgICAgOnBhcmFtIHRyYWluX2RmOiB0aGUgdHJhaW4gZGF0YWZyYW1lCiAgICAgICAgOnJldHVybnM6IHRoZSBtZXRyaWNzIHNjb3JlIGFuZCB0aGUgZXhwbGFuYXRpb24KICAgICAgICAiIiIKICAgICAgICBzZWxmLl9wcmVwYXJlX2p1ZGdlKCkKICAgICAgICByZXNfZGYgPSBwZC5EYXRhRnJhbWUoY29sdW1ucz1bInF1ZXN0aW9uIiwgImFuc3dlciIsICJzY29yZSIsICJleHBsYW5hdGlvbiJdKQoKICAgICAgICBsb2dnZXIuaW5mbygiQ29tcHV0aW5nIHRoZSBtZXRyaWNzIG92ZXIgYWxsIGRhdGEiKQogICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihzYW1wbGVfZGYpKToKICAgICAgICAgICAgcmVzX2RpYyA9IHNlbGYuX2NvbXB1dGVfb3Zlcl9vbmVfZGF0YSgKICAgICAgICAgICAgICAgIHNhbXBsZV9kZi5sb2NbaSwgInF1ZXN0aW9uIl0sIHNhbXBsZV9kZi5sb2NbaSwgImFuc3dlciJdCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmVzX2RmLmxvY1tpXSA9IFsKICAgICAgICAgICAgICAgIHNhbXBsZV9kZi5sb2NbaSwgInF1ZXN0aW9uIl0sCiAgICAgICAgICAgICAgICBzYW1wbGVfZGYubG9jW2ksICJhbnN3ZXIiXSwKICAgICAgICAgICAgICAgIHJlc19kaWNbInNjb3JlIl0sCiAgICAgICAgICAgICAgICByZXNfZGljWyJleHBsYW5hdGlvbiJdLAogICAgICAgICAgICBdCgogICAgICAgIHJldHVybiByZXNfZGYKCiAgICBkZWYgX2V4dHJhY3Rfc2NvcmVfZXhwbGFuYXRpb24oc2VsZiwgcmVzdWx0OiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEFic3RyYWN0IHRoZSBzdG9yZSBvZiB0aGUgcmVzdWx0CiAgICAgICAgOnBhcmFtIHJlc3VsdDogdGhlIHJlc3VsdCB0byBzdG9yZQogICAgICAgIDpyZXR1cm5zOiB0aGUgc3RvcmVkIHJlc3VsdAogICAgICAgICIiIgogICAgICAgIGxvZ2dlci5pbmZvKGYiRXh0cmFjdGluZyB0aGUgc2NvcmUgYW5kIGV4cGxhbmF0aW9uIGZyb20ge3Jlc3VsdH0iKQogICAgICAgIHNjb3JlX3BhdHRlcm4gPSByIlxic2NvcmU6XHMqKFxkKylcYiIKICAgICAgICBleHBsYW5hdGlvbl9wYXR0ZXJuID0gciJleHBsYW5hdGlvbjpccyooLio/KVxzKig/PVxiU2NvcmU6fCQpIgoKICAgICAgICBzY29yZV9tYXRjaCA9IHJlLnNlYXJjaChzY29yZV9wYXR0ZXJuLCByZXN1bHQpCiAgICAgICAgc2NvcmUgPSBpbnQoc2NvcmVfbWF0Y2guZ3JvdXAoMSkpIGlmIHNjb3JlX21hdGNoIGVsc2UgTm9uZQoKICAgICAgICBleHBsYW5hdGlvbl9tYXRjaCA9IHJlLnNlYXJjaChleHBsYW5hdGlvbl9wYXR0ZXJuLCByZXN1bHQsIHJlLkRPVEFMTCkKICAgICAgICBleHBsYW5hdGlvbiA9IGV4cGxhbmF0aW9uX21hdGNoLmdyb3VwKDEpLnN0cmlwKCkgaWYgZXhwbGFuYXRpb25fbWF0Y2ggZWxzZSBOb25lCgogICAgICAgIHJldHVybiB7InNjb3JlIjogc2NvcmUsICJleHBsYW5hdGlvbiI6IGV4cGxhbmF0aW9ufQoKCmNsYXNzIExMTUp1ZGdlUGFpcndpc2VHcmFkaW5nKExMTUp1ZGdlQmFzZU1ldHJpYyk6CiAgICAiIiIKICAgIEJhc2UgY2xhc3MgZm9yIExMTSBhcyBhIGp1ZGdlIHVzaW5nIHBhaXJ3aXNlIGdyYWRpbmcuCiAgICB5b3UgbmVlZCB0byBkZWZpbmUgdGhlIGRlZm5pdGlvbiBvZiB0aGUgbWV0cmljcyBhbmQgZ2l2ZSB0aGUgZ3JhZGluZyBvZiB0aGUgcnViaWMKICAgIHlvdSBuZWVkIHRvIGdpdmUgYSBiYXNlIG1vZGVsIHRvIGNvbXBhcmUgdGhlIG1vZGVsIHRvCiAgICAiIiIKCiAgICBfZGljdF9maWVsZHMgPSBbCiAgICAgICAgIm5hbWUiLAogICAgICAgICJtb2RlbF9qdWRnZSIsCiAgICAgICAgIm1vZGVsX2p1ZGdlX2NvbmZpZyIsCiAgICAgICAgIm1vZGVsX2JlbmNoX21hcmsiLAogICAgICAgICJtb2RlbF9iZW5jaF9tYXJrX2NvbmZpZyIsCiAgICAgICAgIm1vZGVsX2JlbmNoX21hcmtfaW5mZXJfY29uZmlnIiwKICAgICAgICAidG9rZW5pemVyX2JlbmNoX21hcmtfY29uZmlnIiwKICAgICAgICAicHJvbXB0X3RlbXBsYXRlIiwKICAgICAgICAicHJvbXB0X2NvbmZpZyIsCiAgICAgICAgInRva2VuaXplcl9qdWRnZV9jb25maWciLAogICAgICAgICJtb2RlbF9qdWRnZV9pbmZlcl9jb25maWciLAogICAgXQogICAga2luZCA9ICJsbG1fanVkZ2VfcGFpcndpc2VfZ3JhZGluZyIKCiAgICBkZWYgX19pbml0X18oCiAgICAgICAgc2VsZiwKICAgICAgICBuYW1lOiBzdHIsCiAgICAgICAgbW9kZWxfanVkZ2U6IHN0ciwKICAgICAgICBtb2RlbF9qdWRnZV9jb25maWc6IERpY3Rbc3RyLCBBbnldLAogICAgICAgIG1vZGVsX2JlbmNoX21hcms6IHN0ciwKICAgICAgICBtb2RlbF9iZW5jaF9tYXJrX2NvbmZpZzogRGljdFtzdHIsIEFueV0sCiAgICAgICAgbW9kZWxfYmVuY2hfbWFya19pbmZlcl9jb25maWc6IERpY3Rbc3RyLCBBbnldLAogICAgICAgIHRva2VuaXplcl9iZW5jaF9tYXJrX2NvbmZpZzogRGljdFtzdHIsIEFueV0sCiAgICAgICAgcHJvbXB0X2NvbmZpZzogRGljdFtzdHIsIEFueV0sCiAgICAgICAgcHJvbXB0X3RlbXBsYXRlOiBzdHIgPSBQQUlSX0dSQURFX1BST01QVCwKICAgICAgICB0b2tlbml6ZXJfanVkZ2VfY29uZmlnOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUsCiAgICAgICAgbW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUsCiAgICApOgogICAgICAgICIiIgogICAgICAgIGluaXQgdGhlIGNsYXNzCiAgICAgICAgOnBhcmFtIG5hbWU6IG5hbWUgb2YgdGhlIG1ldHJpYwogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZTogdGhlIG1vZGVsIGp1ZGdlIHRvIHVzZQogICAgICAgIDpwYXJhbSB0b2tlbml6ZXJfanVkZ2VfY29uZmlnOiB0aGUgdG9rZW5pemVyIGp1ZGdlIGNvbmZpZwogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZV9jb25maWc6IHRoZSBtb2RlbCBqdWRnZSBjb25maWcKICAgICAgICA6cGFyYW0gbW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnOiB0aGUgbW9kZWwganVkZ2UgaW5mZXIgY29uZmlnCiAgICAgICAgOnBhcmFtIG1vZGVsX2JlbmNoX21hcms6IHRoZSBtb2RlbCBiZW5jaCBtYXJrIHRvIHVzZQogICAgICAgIDpwYXJhbSBtb2RlbF9iZW5jaF9tYXJrX2NvbmZpZzogdGhlIG1vZGVsIGJlbmNoIG1hcmsgY29uZmlnCiAgICAgICAgOnBhcmFtIG1vZGVsX2JlbmNoX21hcmtfaW5mZXJfY29uZmlnOiB0aGUgbW9kZWwgYmVuY2ggbWFyayBpbmZlciBjb25maWcKICAgICAgICA6cGFyYW0gdG9rZW5pemVyX2JlbmNoX21hcmtfY29uZmlnOiB0aGUgdG9rZW5pemVyIGJlbmNoIG1hcmsgY29uZmlnCiAgICAgICAgOnBhcmFtIHByb21wdF90ZW1wbGF0ZTogdGhlIHByb21wdCB0ZW1wbGF0ZSB0byBmaWxsCiAgICAgICAgOnBhcmFtIHByb21wdF9jb25maWc6IHRoZSBwcm9tcHQgY29uZmlnIHRvIGZpbGwgdGhlIHRlbXBsYXRlIHdpdGgKICAgICAgICAiIiIKICAgICAgICBzdXBlcigpLl9faW5pdF9fKAogICAgICAgICAgICBuYW1lLAogICAgICAgICAgICBtb2RlbF9qdWRnZSwKICAgICAgICAgICAgcHJvbXB0X3RlbXBsYXRlLAogICAgICAgICAgICBwcm9tcHRfY29uZmlnLAogICAgICAgICAgICBtb2RlbF9qdWRnZV9jb25maWcsCiAgICAgICAgICAgIHRva2VuaXplcl9qdWRnZV9jb25maWcsCiAgICAgICAgICAgIG1vZGVsX2p1ZGdlX2luZmVyX2NvbmZpZywKICAgICAgICApCiAgICAgICAgc2VsZi5tb2RlbF9iZW5jaF9tYXJrID0gbW9kZWxfYmVuY2hfbWFyawogICAgICAgIHNlbGYubW9kZWxfYmVuY2hfbWFya19jb25maWcgPSBtb2RlbF9iZW5jaF9tYXJrX2NvbmZpZwogICAgICAgIHNlbGYubW9kZWxfYmVuY2hfbWFya19pbmZlcl9jb25maWcgPSBtb2RlbF9iZW5jaF9tYXJrX2luZmVyX2NvbmZpZwogICAgICAgIHNlbGYudG9rZW5pemVyX2JlbmNoX21hcmtfY29uZmlnID0gdG9rZW5pemVyX2JlbmNoX21hcmtfY29uZmlnCgogICAgZGVmIF9wcmVwYXJlX2p1ZGdlKHNlbGYpIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgaW5pdCB0aGUgdG9rZW5pemVyIGFuZCB0aGUgbW9kZWwKICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbyhmIlByZXBhcmluZyB0aGUganVkZ2UgbW9kZWwge3NlbGYubW9kZWxfanVkZ2V9IikKICAgICAgICBzZWxmLnRva2VuaXplciA9IHRyYW5zZm9ybWVycy5BdXRvVG9rZW5pemVyLmZyb21fcHJldHJhaW5lZCgKICAgICAgICAgICAgc2VsZi5tb2RlbF9qdWRnZSwgKipzZWxmLnRva2VuaXplcl9qdWRnZV9jb25maWcKICAgICAgICApCiAgICAgICAgc2VsZi5tb2RlbCA9IHRyYW5zZm9ybWVycy5BdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoCiAgICAgICAgICAgIHNlbGYubW9kZWxfanVkZ2UsICoqc2VsZi5tb2RlbF9qdWRnZV9jb25maWcKICAgICAgICApCgogICAgZGVmIF9wcmVwYXJlX2JlbmNoX21hcmtfbW9kZWwoc2VsZikgLT4gTm9uZToKICAgICAgICAiIiIKICAgICAgICBQcmVwYXJlIHRoZSBtb2RlbCB0aGF0IHVzZWQgZm9yIGJlbmNoIG1hcmtpbmcKICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbyhmIlByZXBhcmluZyB0aGUgYmVuY2ggbWFyayBtb2RlbCB7c2VsZi5tb2RlbF9iZW5jaF9tYXJrfSIpCiAgICAgICAgc2VsZi50b2tlbml6ZXJfYmVuY2hfbWFyayA9IHRyYW5zZm9ybWVycy5BdXRvVG9rZW5pemVyLmZyb21fcHJldHJhaW5lZCgKICAgICAgICAgICAgc2VsZi5tb2RlbF9iZW5jaF9tYXJrLCAqKnNlbGYudG9rZW5pemVyX2JlbmNoX21hcmtfY29uZmlnCiAgICAgICAgKQogICAgICAgIHNlbGYubW9kZWxfYmVuY2hfbWFyayA9IHRyYW5zZm9ybWVycy5BdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoCiAgICAgICAgICAgIHNlbGYubW9kZWxfYmVuY2hfbWFyaywgKipzZWxmLm1vZGVsX2JlbmNoX21hcmtfY29uZmlnCiAgICAgICAgKQoKICAgIGRlZiBfY29tcHV0ZV9iZW5jaF9tYXJrX3Jlc3BvbnNlKHNlbGYsIHF1ZXN0aW9uKSAtPiBzdHI6CiAgICAgICAgIiIiCiAgICAgICAgQ29tcHV0ZSB0aGUgcmVzcG9uc2Ugb2YgdGhlIGJlbmNoIG1hcmsgbW9kZWwKICAgICAgICA6cGFyYW0gcXVlc3Rpb246IHRoZSBxdWVzdGlvbiB0byBhc2sgdGhlIG1vZGVsCiAgICAgICAgOnJldHVybnM6IHRoZSByZXNwb25zZQogICAgICAgICIiIgogICAgICAgIGxvZ2dlci5pbmZvKGYiQ29tcHV0aW5nIHRoZSBiZW5jaCBtYXJrIHJlc3BvbnNlIGZvciB7cXVlc3Rpb259IikKICAgICAgICBpbnB1dF9pZHMgPSBzZWxmLnRva2VuaXplcl9iZW5jaF9tYXJrKHF1ZXN0aW9uLCByZXR1cm5fdGVuc29ycz0icHQiKS5pbnB1dF9pZHMKICAgICAgICBvdXRwdXRzID0gc2VsZi5tb2RlbF9iZW5jaF9tYXJrLmdlbmVyYXRlKAogICAgICAgICAgICBpbnB1dF9pZHMsCiAgICAgICAgICAgIHBhZF90b2tlbl9pZD1zZWxmLnRva2VuaXplcl9iZW5jaF9tYXJrLnBhZF90b2tlbl9pZCwKICAgICAgICAgICAgZW9zX3Rva2VuX2lkPXNlbGYudG9rZW5pemVyX2JlbmNoX21hcmsuZW9zX3Rva2VuX2lkLAogICAgICAgICAgICAqKnNlbGYubW9kZWxfYmVuY2hfbWFya19pbmZlcl9jb25maWcsCiAgICAgICAgKQoKICAgICAgICByZXNwb25zZV9pZHMgPSBvdXRwdXRzWzBdCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLnRva2VuaXplcl9iZW5jaF9tYXJrLmRlY29kZSgKICAgICAgICAgICAgcmVzcG9uc2VfaWRzLCBza2lwX3NwZWNpYWxfdG9rZW5zPVRydWUKICAgICAgICApCiAgICAgICAgbG9nZ2VyLmluZm8oZiJSZXNwb25zZSBvZiB0aGUgYmVuY2ggbWFyayBtb2RlbCBpcyB7cmVzcG9uc2V9IikKCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlCgogICAgZGVmIF9jb21wdXRlX292ZXJfb25lX2RhdGEoc2VsZiwgcXVlc3Rpb24sIHJlc3BvbnNlKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDb21wdXRlIHRoZSBtZXRyaWNzIG92ZXIgb25lIGRhdGEgcG9pbnQKICAgICAgICA6cGFyYW0ga3dhcmdzOiB0aGUgZGF0YSB0byBjb21wdXRlIHRoZSBtZXRyaWNzIG92ZXIKICAgICAgICA6cmV0dXJuczogdGhlIG1ldHJpY3Mgc2NvcmUgYW5kIHRoZSBleHBsYW5hdGlvbgogICAgICAgICIiIgogICAgICAgIGxvZ2dlci5pbmZvKGYiQ29tcHV0aW5nIHRoZSBtZXRyaWNzIG92ZXIge3F1ZXN0aW9ufSBhbmQge3Jlc3BvbnNlfSIpCiAgICAgICAgc2VsZi5wcm9tcHRfY29uZmlnWyJxdWVzdGlvbiJdID0gcXVlc3Rpb24KICAgICAgICBzZWxmLnByb21wdF9jb25maWdbImFuc3dlckEiXSA9IHJlc3BvbnNlCiAgICAgICAgc2VsZi5wcm9tcHRfY29uZmlnWyJhbnN3ZXJCIl0gPSBzZWxmLl9jb21wdXRlX2JlbmNoX21hcmtfcmVzcG9uc2UocXVlc3Rpb24pCiAgICAgICAgaW5wdXRfaWRzID0gc2VsZi50b2tlbml6ZXIoc2VsZi5fZmlsbF9wcm9tcHQoKSwgcmV0dXJuX3RlbnNvcnM9InB0IikuaW5wdXRfaWRzCiAgICAgICAgb3V0cHV0cyA9IHNlbGYubW9kZWwuZ2VuZXJhdGUoCiAgICAgICAgICAgIGlucHV0X2lkcywKICAgICAgICAgICAgcGFkX3Rva2VuX2lkPXNlbGYudG9rZW5pemVyLnBhZF90b2tlbl9pZCwKICAgICAgICAgICAgZW9zX3Rva2VuX2lkPXNlbGYudG9rZW5pemVyLmVvc190b2tlbl9pZCwKICAgICAgICAgICAgKipzZWxmLm1vZGVsX2p1ZGdlX2luZmVyX2NvbmZpZywKICAgICAgICApCgogICAgICAgIHJlc3BvbnNlX2lkcyA9IG91dHB1dHNbMF0KICAgICAgICByZXNwb25zZSA9IHNlbGYudG9rZW5pemVyLmRlY29kZShyZXNwb25zZV9pZHMsIHNraXBfc3BlY2lhbF90b2tlbnM9VHJ1ZSkKCiAgICAgICAgbG9nZ2VyLmluZm8oZiJSZXNwb25zZSBvZiB0aGUganVkZ2UgbW9kZWwgaXMge3Jlc3BvbnNlfSIpCiAgICAgICAgcmVzX2RpYyA9IHNlbGYuX2V4dHJhY3Rfc2NvcmVfZXhwbGFuYXRpb24ocmVzcG9uc2UpCiAgICAgICAgcmVzX2RpY1siYW5zd2VyQiJdID0gc2VsZi5wcm9tcHRfY29uZmlnWyJhbnN3ZXJCIl0KICAgICAgICByZXR1cm4gcmVzX2RpYwoKICAgIEBfb3Blbl9tcGlfaGFuZGxlcih3b3JrZXJfaW5wdXRzPSJzYW1wbGVfZGYiKQogICAgZGVmIF9jb21wdXRlX292ZXJfZGF0YSgKICAgICAgICBzZWxmLCBzYW1wbGVfZGY6IHBkLkRhdGFGcmFtZSwgdHJhaW5fZGY6IHBkLkRhdGFGcmFtZSA9IE5vbmUKICAgICkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ29tcHV0ZSB0aGUgbWV0cmljcyBvdmVyIGFsbCBkYXRhCiAgICAgICAgOnBhcmFtIHNhbXBsZV9kZjogdGhlIHNhbXBsZSBkYXRhZnJhbWUKICAgICAgICA6cGFyYW0gdHJhaW5fZGY6IHRoZSB0cmFpbiBkYXRhZnJhbWUKICAgICAgICA6cmV0dXJuczogdGhlIG1ldHJpY3Mgc2NvcmUgYW5kIHRoZSBleHBsYW5hdGlvbgogICAgICAgICIiIgogICAgICAgIHNlbGYuX3ByZXBhcmVfanVkZ2UoKQogICAgICAgIHNlbGYuX3ByZXBhcmVfYmVuY2hfbWFya19tb2RlbCgpCiAgICAgICAgcmVzX2RmID0gcGQuRGF0YUZyYW1lKAogICAgICAgICAgICBjb2x1bW5zPVsKICAgICAgICAgICAgICAgICJxdWVzdGlvbiIsCiAgICAgICAgICAgICAgICAiYW5zd2VyQSIsCiAgICAgICAgICAgICAgICAiYW5zd2VyQiIsCiAgICAgICAgICAgICAgICAic2NvcmVfb2ZfYXNzaXN0YW50X2EiLAogICAgICAgICAgICAgICAgImV4cGxhbmF0aW9uX29mX2Fzc2lzdGFudF9hIiwKICAgICAgICAgICAgICAgICJzY29yZV9vZl9hc3Npc3RhbnRfYiIsCiAgICAgICAgICAgICAgICAiZXhwbGFuYXRpb25fb2ZfYXNzaXN0YW50X2IiLAogICAgICAgICAgICBdCiAgICAgICAgKQoKICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oc2FtcGxlX2RmKSk6CiAgICAgICAgICAgIHJlc19kaWMgPSBzZWxmLl9jb21wdXRlX292ZXJfb25lX2RhdGEoCiAgICAgICAgICAgICAgICBzYW1wbGVfZGYubG9jW2ksICJxdWVzdGlvbiJdLAogICAgICAgICAgICAgICAgc2FtcGxlX2RmLmxvY1tpLCAiYW5zd2VyIl0sCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmVzX2RmLmxvY1tpXSA9IFsKICAgICAgICAgICAgICAgIHNhbXBsZV9kZi5sb2NbaSwgInF1ZXN0aW9uIl0sCiAgICAgICAgICAgICAgICBzYW1wbGVfZGYubG9jW2ksICJhbnN3ZXIiXSwKICAgICAgICAgICAgICAgIHJlc19kaWNbImFuc3dlckIiXSwKICAgICAgICAgICAgICAgIHJlc19kaWNbInNjb3JlX29mX2Fzc2lzdGFudF9hIl0sCiAgICAgICAgICAgICAgICByZXNfZGljWyJleHBsYW5hdGlvbl9vZl9hc3Npc3RhbnRfYSJdLAogICAgICAgICAgICAgICAgcmVzX2RpY1sic2NvcmVfb2ZfYXNzaXN0YW50X2IiXSwKICAgICAgICAgICAgICAgIHJlc19kaWNbImV4cGxhbmF0aW9uX29mX2Fzc2lzdGFudF9iIl0sCiAgICAgICAgICAgIF0KCiAgICAgICAgcmV0dXJuIHJlc19kZgoKICAgIGRlZiBfZXh0cmFjdF9zY29yZV9leHBsYW5hdGlvbihzZWxmLCByZXNwb25zZSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgRXh0cmFjdCB0aGUgc2NvcmUgYW5kIHRoZSBleHBsYW5hdGlvbiBmcm9tIHRoZSByZXNwb25zZQogICAgICAgIDpwYXJhbSByZXNwb25zZTogdGhlIHJlc3BvbnNlIHRvIGV4dHJhY3QgdGhlIHNjb3JlIGFuZCB0aGUgZXhwbGFuYXRpb24gZnJvbQogICAgICAgIDpyZXR1cm5zOiB0aGUgc2NvcmUgYW5kIHRoZSBleHBsYW5hdGlvbgogICAgICAgICIiIgogICAgICAgICMgRmluZCB0aGUgcG9zaXRpb24gb2YgdGhlICJbT3V0cHV0XToiIG1hcmtlcgogICAgICAgIG91dHB1dF9tYXJrZXJfaW5kZXggPSByZXNwb25zZS5maW5kKCJbT3V0cHV0XToiKQogICAgICAgIGlmIG91dHB1dF9tYXJrZXJfaW5kZXggPT0gLTE6CiAgICAgICAgICAgIHJldHVybiAiTm8gJ1tPdXRwdXRdOicgbWFya2VyIGZvdW5kIgoKICAgICAgICAjIEV4dHJhY3QgdGhlIHBhcnQgb2YgdGhlIHJlc3BvbnNlIGFmdGVyIHRoZSAiW091dHB1dF06IiBtYXJrZXIKICAgICAgICByZXNwb25zZV9hZnRlcl9vdXRwdXQgPSByZXNwb25zZVtvdXRwdXRfbWFya2VyX2luZGV4ICsgbGVuKCJbT3V0cHV0XToiKSA6XQoKICAgICAgICAjIEFkanVzdGVkIHBhdHRlcm4gdG8gbWF0Y2ggdGhlIHRleHQgZm9ybWF0IGFuZCBzZXBhcmF0ZSBsaW5lcwogICAgICAgIHBhdHRlcm4gPSByIi0gc2NvcmUgb2YgYXNzaXN0YW50IChbYWJBQl0pOiAoXGQpXHMqLSBleHBsYW5hdGlvbiBvZiBhc3Npc3RhbnQgXDE6ICguKj8pXHMqKD89LSBzY29yZSBvZiBhc3Npc3RhbnR8JCkiCiAgICAgICAgbWF0Y2hlcyA9IHJlLmZpbmRhbGwocGF0dGVybiwgcmVzcG9uc2VfYWZ0ZXJfb3V0cHV0LCByZS5ET1RBTEwpCgogICAgICAgIGlmIG1hdGNoZXM6CiAgICAgICAgICAgIHJlc3VsdF9kaWN0ID0ge30KICAgICAgICAgICAgZm9yIG1hdGNoIGluIG1hdGNoZXM6CiAgICAgICAgICAgICAgICBhc3Npc3RhbnQsIHNjb3JlLCBleHBsYW5hdGlvbiA9IG1hdGNoCiAgICAgICAgICAgICAgICByZXN1bHRfZGljdFtmInNjb3JlX29mX2Fzc2lzdGFudF97YXNzaXN0YW50fSIubG93ZXIoKV0gPSBpbnQoc2NvcmUpCiAgICAgICAgICAgICAgICByZXN1bHRfZGljdFsKICAgICAgICAgICAgICAgICAgICBmImV4cGxhbmF0aW9uX29mX2Fzc2lzdGFudF97YXNzaXN0YW50fSIubG93ZXIoKQogICAgICAgICAgICAgICAgXSA9IGV4cGxhbmF0aW9uLnN0cmlwKCkKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdF9kaWN0CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigKICAgICAgICAgICAgICAgICJObyBtYXRjaGVzIGZvdW5kIGFmdGVyICdbT3V0cHV0XTonIG1hcmtlci4gIgogICAgICAgICAgICAgICAgIlBsZWFzZSBjaGVjayB0aGUgZm9ybWF0IG9mIHRoZSByZXNwb25zZS4iCiAgICAgICAgICAgICkKCgpjbGFzcyBMTE1KdWRnZVJlZmVyZW5jZUdyYWRpbmcoTExNSnVkZ2VQYWlyd2lzZUdyYWRpbmcpOgogICAgIiIiCiAgICBMTE0gSnVkZ2UgUmVmZXJlbmNlIEdyYWRpbmcgY2xhc3MKICAgIHlvdSBuZWVkIHRvIGdpdmUgdGhlIG5hbWUgb2YgdGhlIG1ldHJpY3MsIGdpdmUgdGhlIGdyYWRpbmcgcnVicmljIGFuZCB0aGUgYmVuY2ggbWFyayBtb2RlbCB0byB1c2UKICAgIFRoaXMgY2xhc3MgcmVxdXJpZSB5b3Uga25vdyB0aGUgeV90cnVlIG9mIHRoZSByZXNwb25zZQogICAgIiIiCgogICAgX2RpY3RfZmllbGRzID0gWwogICAgICAgICJuYW1lIiwKICAgICAgICAibW9kZWxfanVkZ2UiLAogICAgICAgICJtb2RlbF9qdWRnZV9jb25maWciLAogICAgICAgICJtb2RlbF9qdWRnZV9pbmZlcl9jb25maWciLAogICAgICAgICJ0b2tlbml6ZXJfanVkZ2VfY29uZmlnIiwKICAgICAgICAibW9kZWxfYmVuY2hfbWFyayIsCiAgICAgICAgIm1vZGVsX2JlbmNoX21hcmtfY29uZmlnIiwKICAgICAgICAibW9kZWxfYmVuY2hfbWFya19pbmZlcl9jb25maWciLAogICAgICAgICJ0b2tlbml6ZXJfYmVuY2hfbWFya19jb25maWciLAogICAgICAgICJwcm9tcHRfdGVtcGxhdGUiLAogICAgICAgICJwcm9tcHRfY29uZmlnIiwKICAgIF0KICAgIGtpbmQgPSAibGxtX2p1ZGdlX3JlZmVyZW5jZV9ncmFkaW5nIgoKICAgIGRlZiBfX2luaXRfXygKICAgICAgICBzZWxmLAogICAgICAgIG5hbWU6IHN0ciwKICAgICAgICBtb2RlbF9qdWRnZTogc3RyLAogICAgICAgIG1vZGVsX2p1ZGdlX2NvbmZpZzogRGljdFtzdHIsIEFueV0sCiAgICAgICAgbW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwKICAgICAgICB0b2tlbml6ZXJfanVkZ2VfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwKICAgICAgICBtb2RlbF9iZW5jaF9tYXJrOiBzdHIsCiAgICAgICAgbW9kZWxfYmVuY2hfbWFya19jb25maWc6IERpY3Rbc3RyLCBBbnldLAogICAgICAgIHRva2VuaXplcl9iZW5jaF9tYXJrX2NvbmZpZzogRGljdFtzdHIsIEFueV0sCiAgICAgICAgbW9kZWxfYmVuY2hfbWFya19pbmZlcl9jb25maWc6IERpY3Rbc3RyLCBBbnldLAogICAgICAgIHByb21wdF9jb25maWc6IERpY3Rbc3RyLCBzdHJdLAogICAgICAgIHByb21wdF90ZW1wbGF0ZTogc3RyID0gUkVGX0dSQURFX1BST01QVCwKICAgICk6CiAgICAgICAgIiIiCiAgICAgICAgaW5pdCB0aGUgZ3JhZGluZyB3aXRoIHJlZmVyZW5jZSBjbGFzcwogICAgICAgIDpwYXJhbSBuYW1lOiB0aGUgbmFtZSBvZiB0aGUgbWV0cmljcwogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZTogdGhlIG1vZGVsIHRvIHVzZSBmb3IgZ3JhZGluZwogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZV9jb25maWc6IHRoZSBjb25maWcgb2YgdGhlIG1vZGVsIHRvIHVzZSBmb3IgZ3JhZGluZwogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZV9pbmZlcl9jb25maWc6IHRoZSBjb25maWcgb2YgdGhlIG1vZGVsIHRvIHVzZSBmb3IgaW5mZXJlbmNlCiAgICAgICAgOnBhcmFtIHRva2VuaXplcl9qdWRnZV9jb25maWc6IHRoZSBjb25maWcgb2YgdGhlIHRva2VuaXplciB0byB1c2UgZm9yIGdyYWRpbmcKICAgICAgICA6cGFyYW0gbW9kZWxfYmVuY2hfbWFyazogdGhlIG1vZGVsIHRvIHVzZSBmb3IgYmVuY2ggbWFya2luZwogICAgICAgIDpwYXJhbSBtb2RlbF9iZW5jaF9tYXJrX2NvbmZpZzogdGhlIGNvbmZpZyBvZiB0aGUgbW9kZWwgdG8gdXNlIGZvciBiZW5jaCBtYXJraW5nCiAgICAgICAgOnBhcmFtIHRva2VuaXplcl9iZW5jaF9tYXJrX2NvbmZpZzogdGhlIGNvbmZpZyBvZiB0aGUgdG9rZW5pemVyIHRvIHVzZSBmb3IgYmVuY2ggbWFya2luZwogICAgICAgIDpwYXJhbSBtb2RlbF9iZW5jaF9tYXJrX2luZmVyX2NvbmZpZzogdGhlIGNvbmZpZyBvZiB0aGUgbW9kZWwgdG8gdXNlIGZvciBpbmZlcmVuY2UKICAgICAgICA6cGFyYW0gcHJvbXB0X3RlbXBsYXRlOiB0aGUgdGVtcGxhdGUgb2YgdGhlIHByb21wdCB0byB1c2UKICAgICAgICA6cGFyYW0gcHJvbXB0X2NvbmZpZzogdGhlIGNvbmZpZyBvZiB0aGUgcHJvbXB0IHRvIHVzZQogICAgICAgICIiIgogICAgICAgIHN1cGVyKCkuX19pbml0X18oCiAgICAgICAgICAgIG5hbWUsCiAgICAgICAgICAgIG1vZGVsX2p1ZGdlLAogICAgICAgICAgICBtb2RlbF9qdWRnZV9jb25maWcsCiAgICAgICAgICAgIG1vZGVsX2JlbmNoX21hcmssCiAgICAgICAgICAgIG1vZGVsX2JlbmNoX21hcmtfY29uZmlnLAogICAgICAgICAgICBtb2RlbF9iZW5jaF9tYXJrX2luZmVyX2NvbmZpZywKICAgICAgICAgICAgdG9rZW5pemVyX2JlbmNoX21hcmtfY29uZmlnLAogICAgICAgICAgICBwcm9tcHRfY29uZmlnLAogICAgICAgICAgICBwcm9tcHRfdGVtcGxhdGUsCiAgICAgICAgICAgIHRva2VuaXplcl9qdWRnZV9jb25maWcsCiAgICAgICAgICAgIG1vZGVsX2p1ZGdlX2luZmVyX2NvbmZpZywKICAgICAgICApCgogICAgZGVmIF9jb21wdXRlX292ZXJfb25lX2RhdGEoc2VsZiwgcXVlc3Rpb24sIHJlc3BvbnNlLCByZWZlcmVuY2UpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlciBvbmUgZGF0YSBwb2ludAogICAgICAgIDpwYXJhbSBrd2FyZ3M6IHRoZSBkYXRhIHRvIGNvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlcgogICAgICAgIDpyZXR1cm5zOiB0aGUgbWV0cmljcyBzY29yZSBhbmQgdGhlIGV4cGxhbmF0aW9uCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5wcm9tcHRfY29uZmlnWyJyZWZlcmVuY2UiXSA9IHJlZmVyZW5jZQogICAgICAgIHJlc19kaWMgPSBzdXBlcigpLl9jb21wdXRlX292ZXJfb25lX2RhdGEocXVlc3Rpb24sIHJlc3BvbnNlKQogICAgICAgIHJldHVybiByZXNfZGljCgogICAgQF9vcGVuX21waV9oYW5kbGVyKHdvcmtlcl9pbnB1dHM9InNhbXBsZV9kZiIpCiAgICBkZWYgX2NvbXB1dGVfb3Zlcl9kYXRhKAogICAgICAgIHNlbGYsIHNhbXBsZV9kZjogcGQuRGF0YUZyYW1lLCB0cmFpbl9kZjogcGQuRGF0YUZyYW1lID0gTm9uZQogICAgKSAtPiBwZC5EYXRhRnJhbWU6CiAgICAgICAgIiIiCiAgICAgICAgQ29tcHV0ZSB0aGUgbWV0cmljcyBvdmVyIGEgZGF0YXNldAogICAgICAgIDpwYXJhbSBzYW1wbGVfZGY6IHRoZSBkYXRhIHRvIGNvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlcgogICAgICAgIDpyZXR1cm5zOiB0aGUgbWV0cmljcyBzY29yZSBhbmQgdGhlIGV4cGxhbmF0aW9uCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5fcHJlcGFyZV9qdWRnZSgpCiAgICAgICAgc2VsZi5fcHJlcGFyZV9iZW5jaF9tYXJrX21vZGVsKCkKICAgICAgICByZXNfZGYgPSBwZC5EYXRhRnJhbWUoCiAgICAgICAgICAgIGNvbHVtbnM9WwogICAgICAgICAgICAgICAgInF1ZXN0aW9uIiwKICAgICAgICAgICAgICAgICJhbnN3ZXJBIiwKICAgICAgICAgICAgICAgICJhbnN3ZXJCIiwKICAgICAgICAgICAgICAgICJyZWZlcmVuY2UiLAogICAgICAgICAgICAgICAgInNjb3JlX29mX2Fzc2lzdGFudF9hIiwKICAgICAgICAgICAgICAgICJleHBsYW5hdGlvbl9vZl9hc3Npc3RhbnRfYSIsCiAgICAgICAgICAgICAgICAic2NvcmVfb2ZfYXNzaXN0YW50X2IiLAogICAgICAgICAgICAgICAgImV4cGxhbmF0aW9uX29mX2Fzc2lzdGFudF9iIiwKICAgICAgICAgICAgXQogICAgICAgICkKCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKHNhbXBsZV9kZikpOgogICAgICAgICAgICByZXNfZGljID0gc2VsZi5fY29tcHV0ZV9vdmVyX29uZV9kYXRhKAogICAgICAgICAgICAgICAgc2FtcGxlX2RmLmxvY1tpLCAicXVlc3Rpb24iXSwKICAgICAgICAgICAgICAgIHNhbXBsZV9kZi5sb2NbaSwgImFuc3dlciJdLAogICAgICAgICAgICAgICAgc2FtcGxlX2RmLmxvY1tpLCAicmVmZXJlbmNlIl0sCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmVzX2RmLmxvY1tpXSA9IFsKICAgICAgICAgICAgICAgIHNhbXBsZV9kZi5sb2NbaSwgInF1ZXN0aW9uIl0sCiAgICAgICAgICAgICAgICBzYW1wbGVfZGYubG9jW2ksICJhbnN3ZXIiXSwKICAgICAgICAgICAgICAgIHNhbXBsZV9kZi5sb2NbaSwgInJlZmVyZW5jZSJdLAogICAgICAgICAgICAgICAgcmVzX2RpY1siYW5zd2VyQiJdLAogICAgICAgICAgICAgICAgcmVzX2RpY1sic2NvcmVfb2ZfYXNzaXN0YW50X2EiXSwKICAgICAgICAgICAgICAgIHJlc19kaWNbImV4cGxhbmF0aW9uX29mX2Fzc2lzdGFudF9hIl0sCiAgICAgICAgICAgICAgICByZXNfZGljWyJzY29yZV9vZl9hc3Npc3RhbnRfYiJdLAogICAgICAgICAgICAgICAgcmVzX2RpY1siZXhwbGFuYXRpb25fb2ZfYXNzaXN0YW50X2IiXSwKICAgICAgICAgICAgXQoKICAgICAgICByZXR1cm4gcmVzX2RmCgoKY2xhc3MgT1BFTkFJSnVkZ2VTaW5nbGVHcmFkaW5nKExMTUp1ZGdlU2luZ2xlR3JhZGluZyk6CiAgICAiIiIKICAgIFVzaW5nIEFQSSB0byBqdWRnZSB0aGUgcmVzcG9uc2UKICAgICIiIgoKICAgIF9kaWN0X2ZpZWxkcyA9IFsKICAgICAgICAibmFtZSIsCiAgICAgICAgIm1vZGVsX2p1ZGdlIiwKICAgICAgICAibW9kZWxfanVkZ2VfY29uZmlnIiwKICAgICAgICAicHJvbXB0X3RlbXBsYXRlIiwKICAgICAgICAicHJvbXB0X2NvbmZpZyIsCiAgICAgICAgIm1vZGVsX2p1ZGdlX2luZmVyX2NvbmZpZyIsCiAgICBdCiAgICBraW5kID0gIk9QRU5BSV9qdWRnZV9zaW5nbGVfZ3JhZGluZyIKCiAgICBkZWYgX19pbml0X18oCiAgICAgICAgc2VsZiwKICAgICAgICBuYW1lOiBzdHIsCiAgICAgICAgbW9kZWxfanVkZ2U6IHN0ciwKICAgICAgICBwcm9tcHRfY29uZmlnOiBEaWN0W3N0ciwgc3RyXSwKICAgICAgICBwcm9tcHRfdGVtcGxhdGU6IHN0ciA9IFNJTkdMRV9HUkFERV9QUk9NUFQsCiAgICAgICAgbW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUsCiAgICAgICAgbW9kZWxfanVkZ2VfY29uZmlnOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUsCiAgICApOgogICAgICAgICIiIgogICAgICAgIGluaXQgdGhlIGdyYWRpbmcgd2l0aCByZWZlcmVuY2UgY2xhc3MKICAgICAgICA6cGFyYW0gbmFtZTogdGhlIG5hbWUgb2YgdGhlIG1ldHJpY3MKICAgICAgICA6cGFyYW0gbW9kZWxfanVkZ2U6IHRoZSBtb2RlbCB0byB1c2UgZm9yIGdyYWRpbmcKICAgICAgICA6cGFyYW0gbW9kZWxfanVkZ2VfY29uZmlnOiB0aGUgY29uZmlnIG9mIHRoZSBtb2RlbCB0byB1c2UgZm9yIGdyYWRpbmcKICAgICAgICA6cGFyYW0gbW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnOiB0aGUgY29uZmlnIG9mIHRoZSBtb2RlbCB0byB1c2UgZm9yIGluZmVyZW5jZQogICAgICAgIDpwYXJhbSBwcm9tcHRfdGVtcGxhdGU6IHRoZSB0ZW1wbGF0ZSBvZiB0aGUgcHJvbXB0IHRvIHVzZQogICAgICAgIDpwYXJhbSBwcm9tcHRfY29uZmlnOiB0aGUgY29uZmlnIG9mIHRoZSBwcm9tcHQgdG8gdXNlCiAgICAgICAgIiIiCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygKICAgICAgICAgICAgbmFtZSwKICAgICAgICAgICAgbW9kZWxfanVkZ2UsCiAgICAgICAgICAgIG1vZGVsX2p1ZGdlX2NvbmZpZywKICAgICAgICAgICAgbW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnLAogICAgICAgICAgICBwcm9tcHRfY29uZmlnLAogICAgICAgICAgICBwcm9tcHRfdGVtcGxhdGUsCiAgICAgICAgKQoKICAgIGRlZiBfcHJlcGFyZV9qdWRnZShzZWxmKSAtPiBOb25lOgogICAgICAgICIiIgogICAgICAgIFByZXBhcmUgdGhlIGp1ZGdlIG1vZGVsCiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oIlByZXBhcmUgdGhlIG9wZW5BSSBtb2RlbCBhcyBqdWRnZSIpCgogICAgICAgIGlmIG5vdCBzZWxmLm1vZGVsX2p1ZGdlX2NvbmZpZzoKICAgICAgICAgICAgaW1wb3J0IG9zCiAgICAgICAgICAgIGZyb20gZG90ZW52IGltcG9ydCBsb2FkX2RvdGVudgogICAgICAgICAgICBsb2FkX2RvdGVudigpCiAgICAgICAgICAgIGFwaV9rZXkgPSBvcy5nZXRlbnYoIk9QRU5BSV9BUElfS0VZIikKICAgICAgICAgICAgYmFzZV91cmwgPSBvcy5nZXRlbnYoIk9QRU5BSV9BUElfQkFTRSIpCiAgICAgICAgICAgIE9QRU5BSV9KVURHRV9DT05GSUcgPSB7CiAgICAgICAgICAgICAgICAiYXBpX2tleSI6IGFwaV9rZXksCiAgICAgICAgICAgICAgICAiYmFzZV91cmwiOiBiYXNlX3VybCwKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLm1vZGVsX2p1ZGdlX2NvbmZpZyA9IE9QRU5BSV9KVURHRV9DT05GSUcKCiAgICAgICAgc2VsZi5tb2RlbCA9IG9wZW5haS5PcGVuQUkoCiAgICAgICAgICAgIGFwaV9rZXk9c2VsZi5tb2RlbF9qdWRnZV9jb25maWdbImFwaV9rZXkiXSwKICAgICAgICAgICAgYmFzZV91cmw9c2VsZi5tb2RlbF9qdWRnZV9jb25maWdbImJhc2VfdXJsIl0sCiAgICAgICAgKQoKICAgIGRlZiBfZXh0cmFjdF9zY29yZV9leHBsYW5hdGlvbihzZWxmLCByZXN1bHQ6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQWJzdHJhY3QgdGhlIHN0b3JlIG9mIHRoZSByZXN1bHQKICAgICAgICA6cGFyYW0gcmVzdWx0OiB0aGUgcmVzdWx0IHRvIHN0b3JlCiAgICAgICAgOnJldHVybnM6IHRoZSBzdG9yZWQgcmVzdWx0CiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oZiJFeHRyYWN0aW5nIHRoZSBzY29yZSBhbmQgZXhwbGFuYXRpb24gZnJvbSB7cmVzdWx0fSIpCiAgICAgICAgc2NvcmVfcGF0dGVybiA9IHInInNjb3JlIjpccyooXGQrKScKICAgICAgICBleHBsYW5hdGlvbl9wYXR0ZXJuID0gciciZXhwbGFuYXRpb24iOlxzKiIoW14iXSspIicKCiAgICAgICAgc2NvcmVfbWF0Y2ggPSByZS5zZWFyY2goc2NvcmVfcGF0dGVybiwgcmVzdWx0KQogICAgICAgIHNjb3JlID0gaW50KHNjb3JlX21hdGNoLmdyb3VwKDEpKSBpZiBzY29yZV9tYXRjaCBlbHNlIE5vbmUKCiAgICAgICAgZXhwbGFuYXRpb25fbWF0Y2ggPSByZS5zZWFyY2goZXhwbGFuYXRpb25fcGF0dGVybiwgcmVzdWx0LCByZS5ET1RBTEwpCiAgICAgICAgZXhwbGFuYXRpb24gPSBleHBsYW5hdGlvbl9tYXRjaC5ncm91cCgxKS5zdHJpcCgpIGlmIGV4cGxhbmF0aW9uX21hdGNoIGVsc2UgTm9uZQoKICAgICAgICByZXR1cm4geyJzY29yZSI6IHNjb3JlLCAiZXhwbGFuYXRpb24iOiBleHBsYW5hdGlvbn0KCiAgICBkZWYgX2NvbXB1dGVfb3Zlcl9vbmVfZGF0YShzZWxmLCBxdWVzdGlvbiwgcmVzcG9uc2UpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlciBvbmUgZGF0YSBwb2ludAogICAgICAgIDpwYXJhbSBrd2FyZ3M6IHRoZSBkYXRhIHRvIGNvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlcgogICAgICAgIDpyZXR1cm5zOiB0aGUgbWV0cmljcyBzY29yZSBhbmQgdGhlIGV4cGxhbmF0aW9uCiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oZiJDb21wdXRlIHRoZSBtZXRyaWNzIG92ZXIgb25lIGRhdGEgcG9pbnQgdXNpbmcgb3BlbkFJJ3MgbW9kZWwiKQogICAgICAgIHNlbGYucHJvbXB0X2NvbmZpZ1siYW5zd2VyIl0gPSByZXNwb25zZQogICAgICAgIHNlbGYucHJvbXB0X2NvbmZpZ1sicXVlc3Rpb24iXSA9IHF1ZXN0aW9uCiAgICAgICAgcHJvbXB0ID0gc2VsZi5fZmlsbF9wcm9tcHQoKQogICAgICAgIHJlcyA9IHNlbGYubW9kZWwuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUoCiAgICAgICAgICAgIG1vZGVsPXNlbGYubW9kZWxfanVkZ2UsIG1lc3NhZ2VzPVt7InJvbGUiOiAidXNlciIsICJjb250ZW50IjogcHJvbXB0fV0KICAgICAgICApCiAgICAgICAgcmVzX2RpYyA9IHNlbGYuX2V4dHJhY3Rfc2NvcmVfZXhwbGFuYXRpb24ocmVzLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50KQogICAgICAgIHJldHVybiByZXNfZGljCgoKY2xhc3MgT1BFTkFJSnVkZ2VQYWlyd2lzZUdyYWRpbmcoTExNSnVkZ2VQYWlyd2lzZUdyYWRpbmcpOgogICAgIiIiCiAgICBVc2luZyBBUEkgdG8ganVkZ2UgdGhlIHJlc3BvbnNlCiAgICAiIiIKCiAgICBfZGljdF9maWVsZHMgPSBbCiAgICAgICAgIm5hbWUiLAogICAgICAgICJtb2RlbF9qdWRnZSIsCiAgICAgICAgIm1vZGVsX2p1ZGdlX2NvbmZpZyIsCiAgICAgICAgIm1vZGVsX2JlbmNoX21hcmsiLAogICAgICAgICJtb2RlbF9iZW5jaF9tYXJrX2NvbmZpZyIsCiAgICAgICAgIm1vZGVsX2JlbmNoX21hcmtfaW5mZXJfY29uZmlnIiwKICAgICAgICAidG9rZW5pemVyX2JlbmNoX21hcmtfY29uZmlnIiwKICAgICAgICAicHJvbXB0X3RlbXBsYXRlIiwKICAgICAgICAicHJvbXB0X2NvbmZpZyIsCiAgICAgICAgIm1vZGVsX2p1ZGdlX2luZmVyX2NvbmZpZyIsCiAgICBdCiAgICBraW5kID0gIk9QRU5BSV9qdWRnZV9wYWlyX2dyYWRpbmciCgogICAgZGVmIF9faW5pdF9fKAogICAgICAgIHNlbGYsCiAgICAgICAgbmFtZTogc3RyLAogICAgICAgIG1vZGVsX2p1ZGdlOiBzdHIsCiAgICAgICAgbW9kZWxfYmVuY2hfbWFyazogc3RyLAogICAgICAgIG1vZGVsX2JlbmNoX21hcmtfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwKICAgICAgICBtb2RlbF9iZW5jaF9tYXJrX2luZmVyX2NvbmZpZzogRGljdFtzdHIsIEFueV0sCiAgICAgICAgdG9rZW5pemVyX2JlbmNoX21hcmtfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwKICAgICAgICBwcm9tcHRfY29uZmlnOiBEaWN0W3N0ciwgc3RyXSwKICAgICAgICBtb2RlbF9qdWRnZV9jb25maWc6IERpY3Rbc3RyLCBBbnldID0gTm9uZSwKICAgICAgICBtb2RlbF9qdWRnZV9pbmZlcl9jb25maWc6IERpY3Rbc3RyLCBBbnldID0gTm9uZSwKICAgICAgICBwcm9tcHRfdGVtcGxhdGU6IHN0ciA9IFBBSVJfR1JBREVfUFJPTVBULAogICAgKToKICAgICAgICAiIiIKICAgICAgICBpbml0IHRoZSBncmFkaW5nIHdpdGggcmVmZXJlbmNlIGNsYXNzCiAgICAgICAgOnBhcmFtIG5hbWU6IHRoZSBuYW1lIG9mIHRoZSBtZXRyaWNzCiAgICAgICAgOnBhcmFtIG1vZGVsX2p1ZGdlOiB0aGUgbW9kZWwgdG8gdXNlIGZvciBncmFkaW5nCiAgICAgICAgOnBhcmFtIG1vZGVsX2p1ZGdlX2NvbmZpZzogdGhlIGNvbmZpZyBvZiB0aGUgbW9kZWwgdG8gdXNlIGZvciBncmFkaW5nCiAgICAgICAgOnBhcmFtIG1vZGVsX2p1ZGdlX2luZmVyX2NvbmZpZzogdGhlIGNvbmZpZyBvZiB0aGUgbW9kZWwgdG8gdXNlIGZvciBpbmZlcmVuY2UKICAgICAgICA6cGFyYW0gcHJvbXB0X3RlbXBsYXRlOiB0aGUgdGVtcGxhdGUgb2YgdGhlIHByb21wdCB0byB1c2UKICAgICAgICA6cGFyYW0gcHJvbXB0X2NvbmZpZzogdGhlIGNvbmZpZyBvZiB0aGUgcHJvbXB0IHRvIHVzZQogICAgICAgICIiIgogICAgICAgIHN1cGVyKCkuX19pbml0X18oCiAgICAgICAgICAgIG5hbWUsCiAgICAgICAgICAgIG1vZGVsX2p1ZGdlLAogICAgICAgICAgICBtb2RlbF9qdWRnZV9jb25maWcsCiAgICAgICAgICAgIG1vZGVsX2JlbmNoX21hcmssCiAgICAgICAgICAgIG1vZGVsX2JlbmNoX21hcmtfY29uZmlnLAogICAgICAgICAgICBtb2RlbF9iZW5jaF9tYXJrX2luZmVyX2NvbmZpZywKICAgICAgICAgICAgdG9rZW5pemVyX2JlbmNoX21hcmtfY29uZmlnLAogICAgICAgICAgICBwcm9tcHRfY29uZmlnLAogICAgICAgICAgICBwcm9tcHRfdGVtcGxhdGUsCiAgICAgICAgICAgIG1vZGVsX2p1ZGdlX2luZmVyX2NvbmZpZywKICAgICAgICApCgogICAgZGVmIF9wcmVwYXJlX2p1ZGdlKHNlbGYpIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgUHJlcGFyZSB0aGUganVkZ2UgbW9kZWwKICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbygiUHJlcGFyZSB0aGUgb3BlbkFJIG1vZGVsIGFzIGp1ZGdlIikKICAgICAgICBpZiBub3Qgc2VsZi5tb2RlbF9qdWRnZV9jb25maWc6CiAgICAgICAgICAgIGltcG9ydCBvcwogICAgICAgICAgICBmcm9tIGRvdGVudiBpbXBvcnQgbG9hZF9kb3RlbnYKICAgICAgICAgICAgbG9hZF9kb3RlbnYoKQogICAgICAgICAgICBhcGlfa2V5ID0gb3MuZ2V0ZW52KCJPUEVOQUlfQVBJX0tFWSIpCiAgICAgICAgICAgIGJhc2VfdXJsID0gb3MuZ2V0ZW52KCJPUEVOQUlfQVBJX0JBU0UiKQogICAgICAgICAgICBPUEVOQUlfSlVER0VfQ09ORklHID0gewogICAgICAgICAgICAgICAgImFwaV9rZXkiOiBhcGlfa2V5LAogICAgICAgICAgICAgICAgImJhc2VfdXJsIjogYmFzZV91cmwsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2VsZi5tb2RlbF9qdWRnZV9jb25maWcgPSBPUEVOQUlfSlVER0VfQ09ORklHCiAgICAgICAgc2VsZi5tb2RlbCA9IG9wZW5haS5PcGVuQUkoCiAgICAgICAgICAgIGFwaV9rZXk9c2VsZi5tb2RlbF9qdWRnZV9jb25maWdbImFwaV9rZXkiXSwKICAgICAgICAgICAgYmFzZV91cmw9c2VsZi5tb2RlbF9qdWRnZV9jb25maWdbImJhc2VfdXJsIl0sCiAgICAgICAgKQoKICAgIGRlZiBfY29tcHV0ZV9vdmVyX29uZV9kYXRhKHNlbGYsIHF1ZXN0aW9uLCByZXNwb25zZSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ29tcHV0ZSB0aGUgbWV0cmljcyBvdmVyIG9uZSBkYXRhIHBvaW50CiAgICAgICAgOnBhcmFtIGt3YXJnczogdGhlIGRhdGEgdG8gY29tcHV0ZSB0aGUgbWV0cmljcyBvdmVyCiAgICAgICAgOnJldHVybnM6IHRoZSBtZXRyaWNzIHNjb3JlIGFuZCB0aGUgZXhwbGFuYXRpb24KICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbyhmIkNvbXB1dGluZyB0aGUgbWV0cmljcyBvdmVyIHtxdWVzdGlvbn0gYW5kIHtyZXNwb25zZX0iKQogICAgICAgIHNlbGYucHJvbXB0X2NvbmZpZ1sicXVlc3Rpb24iXSA9IHF1ZXN0aW9uCiAgICAgICAgc2VsZi5wcm9tcHRfY29uZmlnWyJhbnN3ZXJBIl0gPSByZXNwb25zZQogICAgICAgIHNlbGYucHJvbXB0X2NvbmZpZ1siYW5zd2VyQiJdID0gc2VsZi5fY29tcHV0ZV9iZW5jaF9tYXJrX3Jlc3BvbnNlKHF1ZXN0aW9uKQogICAgICAgIHByb21wdCA9IHNlbGYuX2ZpbGxfcHJvbXB0KCkKICAgICAgICByZXMgPSBzZWxmLm1vZGVsLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKAogICAgICAgICAgICBtb2RlbD1zZWxmLm1vZGVsX2p1ZGdlLCBtZXNzYWdlcz1beyJyb2xlIjogInVzZXIiLCAiY29udGVudCI6IHByb21wdH1dLAogICAgICAgICkKICAgICAgICByZXNfZGljID0gc2VsZi5fZXh0cmFjdF9zY29yZV9leHBsYW5hdGlvbihyZXMuY2hvaWNlc1swXS5tZXNzYWdlLmNvbnRlbnQpCiAgICAgICAgcmVzX2RpY1siYW5zd2VyQiJdID0gc2VsZi5wcm9tcHRfY29uZmlnWyJhbnN3ZXJCIl0KICAgICAgICByZXR1cm4gcmVzX2RpYwoKICAgIGRlZiBfZXh0cmFjdF9zY29yZV9leHBsYW5hdGlvbihzZWxmLCByZXNwb25zZSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgRXh0cmFjdCB0aGUgc2NvcmUgYW5kIHRoZSBleHBsYW5hdGlvbiBmcm9tIHRoZSByZXNwb25zZQogICAgICAgIDpwYXJhbSByZXNwb25zZTogdGhlIHJlc3BvbnNlIHRvIGV4dHJhY3QgdGhlIHNjb3JlIGFuZCB0aGUgZXhwbGFuYXRpb24gZnJvbQogICAgICAgIDpyZXR1cm5zOiB0aGUgc2NvcmUgYW5kIHRoZSBleHBsYW5hdGlvbgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzID0ganNvbi5sb2FkcyhyZXNwb25zZSkKICAgICAgICAgICAgcmVzdWx0X2RpY3QgPSB7fQogICAgICAgICAgICByZXN1bHRfZGljdFsic2NvcmVfb2ZfYXNzaXN0YW50X2EiXSA9IHJlc1sic2NvcmUgb2YgYXNzaXN0YW50IGEiXQogICAgICAgICAgICByZXN1bHRfZGljdFsic2NvcmVfb2ZfYXNzaXN0YW50X2IiXSA9IHJlc1sic2NvcmUgb2YgYXNzaXN0YW50IGIiXQogICAgICAgICAgICByZXN1bHRfZGljdFsiZXhwbGFuYXRpb25fb2ZfYXNzaXN0YW50X2EiXSA9IHJlc1sKICAgICAgICAgICAgICAgICJleHBsYW5hdGlvbiBvZiBhc3Npc3RhbnQgYSIKICAgICAgICAgICAgXQogICAgICAgICAgICByZXN1bHRfZGljdFsiZXhwbGFuYXRpb25fb2ZfYXNzaXN0YW50X2IiXSA9IHJlc1sKICAgICAgICAgICAgICAgICJleHBsYW5hdGlvbiBvZiBhc3Npc3RhbnQgYiIKICAgICAgICAgICAgXQogICAgICAgICAgICByZXR1cm4gcmVzdWx0X2RpY3QKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICMgQWRqdXN0ZWQgcGF0dGVybiB0byBtYXRjaCB0aGUgdGV4dCBmb3JtYXQgYW5kIHNlcGFyYXRlIGxpbmVzCiAgICAgICAgICAgIHBhdHRlcm4gPSByIi0/XHM/c2NvcmUgb2YgYXNzaXN0YW50IChbYS16QS1aXSspOiAoXGQrKS4qPy0/XHM/ZXhwbGFuYXRpb24gb2YgYXNzaXN0YW50IFthLXpBLVpdKzogKC4qPykoPz0tP1xzP3Njb3JlIG9mIGFzc2lzdGFudCBbYS16QS1aXSs6fCQpIgogICAgICAgICAgICBtYXRjaGVzID0gcmUuZmluZGFsbChwYXR0ZXJuLCByZXNwb25zZSwgcmUuRE9UQUxMKQoKICAgICAgICAgICAgaWYgbWF0Y2hlczoKICAgICAgICAgICAgICAgIHJlc3VsdF9kaWN0ID0ge30KICAgICAgICAgICAgICAgIGZvciBtYXRjaCBpbiBtYXRjaGVzOgogICAgICAgICAgICAgICAgICAgIGFzc2lzdGFudCwgc2NvcmUsIGV4cGxhbmF0aW9uID0gbWF0Y2gKICAgICAgICAgICAgICAgICAgICByZXN1bHRfZGljdFtmInNjb3JlX29mX2Fzc2lzdGFudF97YXNzaXN0YW50fSIubG93ZXIoKV0gPSBpbnQoc2NvcmUpCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0X2RpY3RbCiAgICAgICAgICAgICAgICAgICAgICAgIGYiZXhwbGFuYXRpb25fb2ZfYXNzaXN0YW50X3thc3Npc3RhbnR9Ii5sb3dlcigpCiAgICAgICAgICAgICAgICAgICAgXSA9IGV4cGxhbmF0aW9uLnN0cmlwKCkKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRfZGljdAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigKICAgICAgICAgICAgICAgICAgICAiTm8gbWF0Y2hlcyBmb3VuZCBhZnRlciAnW091dHB1dF06JyBtYXJrZXIuICIKICAgICAgICAgICAgICAgICAgICAiUGxlYXNlIGNoZWNrIHRoZSBmb3JtYXQgb2YgdGhlIHJlc3BvbnNlLiIKICAgICAgICAgICAgICAgICkKCgpjbGFzcyBPUEVOQUlKdWRnZVJlZmVyZW5jZUdyYWRpbmcoT1BFTkFJSnVkZ2VQYWlyd2lzZUdyYWRpbmcpOgogICAgIiIiCiAgICBPUEVOQUkgSnVkZ2UgUmVmZXJlbmNlIEdyYWRpbmcgY2xhc3MKICAgIHlvdSBuZWVkIHRvIGdpdmUgdGhlIG5hbWUgb2YgdGhlIG1ldHJpY3MsIGdpdmUgdGhlIGdyYWRpbmcgcnVicmljIGFuZCB0aGUgYmVuY2ggbWFyayBtb2RlbCB0byB1c2UKICAgIFRoaXMgY2xhc3MgcmVxdXJpZSB5b3Uga25vdyB0aGUgeV90cnVlIG9mIHRoZSByZXNwb25zZQogICAgIiIiCgogICAgX2RpY3RfZmllbGRzID0gWwogICAgICAgICJuYW1lIiwKICAgICAgICAibW9kZWxfanVkZ2UiLAogICAgICAgICJtb2RlbF9qdWRnZV9jb25maWciLAogICAgICAgICJtb2RlbF9iZW5jaF9tYXJrIiwKICAgICAgICAibW9kZWxfYmVuY2hfbWFya19jb25maWciLAogICAgICAgICJtb2RlbF9iZW5jaF9tYXJrX2luZmVyX2NvbmZpZyIsCiAgICAgICAgInRva2VuaXplcl9iZW5jaF9tYXJrX2NvbmZpZyIsCiAgICAgICAgInByb21wdF90ZW1wbGF0ZSIsCiAgICAgICAgInByb21wdF9jb25maWciLAogICAgICAgICJtb2RlbF9qdWRnZV9pbmZlcl9jb25maWciLAogICAgXQogICAga2luZCA9ICJPUEVOQUlfanVkZ2VfcmVmZXJlbmNlX2dyYWRpbmciCgogICAgZGVmIF9faW5pdF9fKAogICAgICAgIHNlbGYsCiAgICAgICAgbmFtZTogc3RyLAogICAgICAgIG1vZGVsX2p1ZGdlOiBzdHIsCiAgICAgICAgbW9kZWxfYmVuY2hfbWFyazogc3RyLAogICAgICAgIG1vZGVsX2JlbmNoX21hcmtfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwKICAgICAgICB0b2tlbml6ZXJfYmVuY2hfbWFya19jb25maWc6IERpY3Rbc3RyLCBBbnldLAogICAgICAgIG1vZGVsX2JlbmNoX21hcmtfaW5mZXJfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwKICAgICAgICBwcm9tcHRfY29uZmlnOiBEaWN0W3N0ciwgc3RyXSwKICAgICAgICBtb2RlbF9qdWRnZV9jb25maWc6IERpY3Rbc3RyLCBBbnldPU5vbmUsCiAgICAgICAgcHJvbXB0X3RlbXBsYXRlOiBzdHIgPSBSRUZfR1JBREVfUFJPTVBULAogICAgICAgIG1vZGVsX2p1ZGdlX2luZmVyX2NvbmZpZzogRGljdFtzdHIsIEFueV0gPSBOb25lLAogICAgKToKICAgICAgICAiIiIKICAgICAgICBpbml0IHRoZSBncmFkaW5nIHdpdGggcmVmZXJlbmNlIGNsYXNzCiAgICAgICAgOnBhcmFtIG5hbWU6IHRoZSBuYW1lIG9mIHRoZSBtZXRyaWNzCiAgICAgICAgOnBhcmFtIG1vZGVsX2p1ZGdlOiB0aGUgbW9kZWwgdG8gdXNlIGZvciBncmFkaW5nCiAgICAgICAgOnBhcmFtIG1vZGVsX2p1ZGdlX2NvbmZpZzogdGhlIGNvbmZpZyBvZiB0aGUgbW9kZWwgdG8gdXNlIGZvciBncmFkaW5nCiAgICAgICAgOnBhcmFtIG1vZGVsX2p1ZGdlX2luZmVyX2NvbmZpZzogdGhlIGNvbmZpZyBvZiB0aGUgbW9kZWwgdG8gdXNlIGZvciBpbmZlcmVuY2UKICAgICAgICA6cGFyYW0gbW9kZWxfYmVuY2hfbWFyazogdGhlIG1vZGVsIHRvIHVzZSBmb3IgYmVuY2ggbWFya2luZwogICAgICAgIDpwYXJhbSBtb2RlbF9iZW5jaF9tYXJrX2NvbmZpZzogdGhlIGNvbmZpZyBvZiB0aGUgbW9kZWwgdG8gdXNlIGZvciBiZW5jaCBtYXJraW5nCiAgICAgICAgOnBhcmFtIHRva2VuaXplcl9iZW5jaF9tYXJrX2NvbmZpZzogdGhlIGNvbmZpZyBvZiB0aGUgdG9rZW5pemVyIHRvIHVzZSBmb3IgYmVuY2ggbWFya2luZwogICAgICAgIDpwYXJhbSBtb2RlbF9iZW5jaF9tYXJrX2luZmVyX2NvbmZpZzogdGhlIGNvbmZpZyBvZiB0aGUgbW9kZWwgdG8gdXNlIGZvciBpbmZlcmVuY2UKICAgICAgICA6cGFyYW0gcHJvbXB0X3RlbXBsYXRlOiB0aGUgdGVtcGxhdGUgb2YgdGhlIHByb21wdCB0byB1c2UKICAgICAgICA6cGFyYW0gcHJvbXB0X2NvbmZpZzogdGhlIGNvbmZpZyBvZiB0aGUgcHJvbXB0IHRvIHVzZQogICAgICAgICIiIgogICAgICAgIHN1cGVyKCkuX19pbml0X18oCiAgICAgICAgICAgIG5hbWUsCiAgICAgICAgICAgIG1vZGVsX2p1ZGdlLAogICAgICAgICAgICBtb2RlbF9iZW5jaF9tYXJrLAogICAgICAgICAgICBtb2RlbF9iZW5jaF9tYXJrX2NvbmZpZywKICAgICAgICAgICAgbW9kZWxfYmVuY2hfbWFya19pbmZlcl9jb25maWcsCiAgICAgICAgICAgIHRva2VuaXplcl9iZW5jaF9tYXJrX2NvbmZpZywKICAgICAgICAgICAgcHJvbXB0X2NvbmZpZywKICAgICAgICAgICAgbW9kZWxfanVkZ2VfY29uZmlnLAogICAgICAgICAgICBtb2RlbF9qdWRnZV9pbmZlcl9jb25maWcsCiAgICAgICAgICAgIHByb21wdF90ZW1wbGF0ZSwKICAgICAgICApCgogICAgZGVmIF9jb21wdXRlX292ZXJfb25lX2RhdGEoc2VsZiwgcXVlc3Rpb24sIHJlc3BvbnNlLCByZWZlcmVuY2UpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlciBvbmUgZGF0YSBwb2ludAogICAgICAgIDpwYXJhbSBrd2FyZ3M6IHRoZSBkYXRhIHRvIGNvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlcgogICAgICAgIDpyZXR1cm5zOiB0aGUgbWV0cmljcyBzY29yZSBhbmQgdGhlIGV4cGxhbmF0aW9uCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5wcm9tcHRfY29uZmlnWyJyZWZlcmVuY2UiXSA9IHJlZmVyZW5jZQogICAgICAgIHJlc19kaWMgPSBzdXBlcigpLl9jb21wdXRlX292ZXJfb25lX2RhdGEocXVlc3Rpb24sIHJlc3BvbnNlKQogICAgICAgIHJldHVybiByZXNfZGljCgogICAgQF9vcGVuX21waV9oYW5kbGVyKHdvcmtlcl9pbnB1dHM9InNhbXBsZV9kZiIpCiAgICBkZWYgX2NvbXB1dGVfb3Zlcl9kYXRhKAogICAgICAgIHNlbGYsIHNhbXBsZV9kZjogcGQuRGF0YUZyYW1lLCB0cmFpbl9kZjogcGQuRGF0YUZyYW1lID0gTm9uZQogICAgKSAtPiBwZC5EYXRhRnJhbWU6CiAgICAgICAgIiIiCiAgICAgICAgQ29tcHV0ZSB0aGUgbWV0cmljcyBvdmVyIGEgZGF0YXNldAogICAgICAgIDpwYXJhbSBzYW1wbGVfZGY6IHRoZSBkYXRhIHRvIGNvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlcgogICAgICAgIDpyZXR1cm5zOiB0aGUgbWV0cmljcyBzY29yZSBhbmQgdGhlIGV4cGxhbmF0aW9uCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5fcHJlcGFyZV9qdWRnZSgpCiAgICAgICAgc2VsZi5fcHJlcGFyZV9iZW5jaF9tYXJrX21vZGVsKCkKICAgICAgICByZXNfZGYgPSBwZC5EYXRhRnJhbWUoCiAgICAgICAgICAgIGNvbHVtbnM9WwogICAgICAgICAgICAgICAgInF1ZXN0aW9uIiwKICAgICAgICAgICAgICAgICJhbnN3ZXJBIiwKICAgICAgICAgICAgICAgICJhbnN3ZXJCIiwKICAgICAgICAgICAgICAgICJyZWZlcmVuY2UiLAogICAgICAgICAgICAgICAgInNjb3JlX29mX2Fzc2lzdGFudF9hIiwKICAgICAgICAgICAgICAgICJleHBsYW5hdGlvbl9vZl9hc3Npc3RhbnRfYSIsCiAgICAgICAgICAgICAgICAic2NvcmVfb2ZfYXNzaXN0YW50X2IiLAogICAgICAgICAgICAgICAgImV4cGxhbmF0aW9uX29mX2Fzc2lzdGFudF9iIiwKICAgICAgICAgICAgXQogICAgICAgICkKCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKHNhbXBsZV9kZikpOgogICAgICAgICAgICByZXNfZGljID0gc2VsZi5fY29tcHV0ZV9vdmVyX29uZV9kYXRhKAogICAgICAgICAgICAgICAgc2FtcGxlX2RmLmxvY1tpLCAicXVlc3Rpb24iXSwKICAgICAgICAgICAgICAgIHNhbXBsZV9kZi5sb2NbaSwgImFuc3dlciJdLAogICAgICAgICAgICAgICAgc2FtcGxlX2RmLmxvY1tpLCAicmVmZXJlbmNlIl0sCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmVzX2RmLmxvY1tpXSA9IFsKICAgICAgICAgICAgICAgIHNhbXBsZV9kZi5sb2NbaSwgInF1ZXN0aW9uIl0sCiAgICAgICAgICAgICAgICBzYW1wbGVfZGYubG9jW2ksICJhbnN3ZXIiXSwKICAgICAgICAgICAgICAgIHNhbXBsZV9kZi5sb2NbaSwgInJlZmVyZW5jZSJdLAogICAgICAgICAgICAgICAgcmVzX2RpY1siYW5zd2VyQiJdLAogICAgICAgICAgICAgICAgcmVzX2RpY1sic2NvcmVfb2ZfYXNzaXN0YW50X2EiXSwKICAgICAgICAgICAgICAgIHJlc19kaWNbImV4cGxhbmF0aW9uX29mX2Fzc2lzdGFudF9hIl0sCiAgICAgICAgICAgICAgICByZXNfZGljWyJzY29yZV9vZl9hc3Npc3RhbnRfYiJdLAogICAgICAgICAgICAgICAgcmVzX2RpY1siZXhwbGFuYXRpb25fb2ZfYXNzaXN0YW50X2IiXSwKICAgICAgICAgICAgXQoKICAgICAgICByZXR1cm4gcmVzX2RmCgoKTWV0cmljc1R5cGVfZGljID0gewogICAgIkxMTUp1ZGdlU2luZ2xlR3JhZGluZyI6IExMTUp1ZGdlU2luZ2xlR3JhZGluZywKICAgICJMTE1KdWRnZVBhaXJ3aXNlR3JhZGluZyI6IExMTUp1ZGdlUGFpcndpc2VHcmFkaW5nLAogICAgIkxMTUp1ZGdlUmVmZXJlbmNlR3JhZGluZyI6IExMTUp1ZGdlUmVmZXJlbmNlR3JhZGluZywKICAgICJPUEVOQUlKdWRnZVNpbmdsZUdyYWRpbmciOiBPUEVOQUlKdWRnZVNpbmdsZUdyYWRpbmcsCiAgICAiT1BFTkFJSnVkZ2VQYWlyd2lzZUdyYWRpbmciOiBPUEVOQUlKdWRnZVBhaXJ3aXNlR3JhZGluZywKICAgICJPUEVOQUlKdWRnZVJlZmVyZW5jZUdyYWRpbmciOiBPUEVOQUlKdWRnZVJlZmVyZW5jZUdyYWRpbmcsCn0KCk1ldHJpY3NUeXBlID0gVHlwZVZhcigKICAgICJNZXRyaWNzVHlwZSIsCiAgICBMTE1KdWRnZVNpbmdsZUdyYWRpbmcsCiAgICBMTE1KdWRnZVBhaXJ3aXNlR3JhZGluZywKICAgIExMTUp1ZGdlUmVmZXJlbmNlR3JhZGluZywKICAgIE9QRU5BSUp1ZGdlU2luZ2xlR3JhZGluZywKICAgIE9QRU5BSUp1ZGdlUGFpcndpc2VHcmFkaW5nLAogICAgT1BFTkFJSnVkZ2VSZWZlcmVuY2VHcmFkaW5nLAopCgoKZGVmIF9nZXRfbWV0cmljcygKICAgIG1ldHJpY190eXBlOiBzdHIsCiAgICAqKmt3YXJnczogQW55LAopIC0+IE1ldHJpY3NUeXBlOgogICAgIiIiCiAgICBJbml0IHRoZSBtZXRyaWMgY2xhc3MgYmFzZWQgb24gZGlmZmVyZW50IHR5cGUgb2YgbWV0cmljcwogICAgOnBhcmFtIG1ldHJpY190eXBlOiB0aGUgdHlwZSBvZiB0aGUgbWV0cmljCiAgICA6cGFyYW0ga3dhcmdzOiB0aGUgY29uZmlnIG9mIHRoZSBtZXRyaWMKICAgIDpyZXR1cm5zOiB0aGUgbWV0cmljIG9iagogICAgIiIiCiAgICByZXR1cm4gTWV0cmljc1R5cGVfZGljW21ldHJpY190eXBlXSgqKmt3YXJncykKCgpkZWYgbGxtX2p1ZGdlKAogICAgaW5wdXRfcGF0aDogVW5pb25bc3RyLCBwYXRobGliLlBhdGhdLAogICAgKiprd2FyZ3MsCikgLT4gcGQuRGF0YUZyYW1lOgogICAgIiIiCiAgICBDb21wdXRlIHRoZSBtZXRyaWNzIG92ZXIgYSBkYXRhc2V0CgogICAgOnBhcmFtIGlucHV0X3BhdGg6IHRoZSBwYXRoIHRvIHRoZSBpbnB1dCBkYXRhCiAgICA6cGFyYW0ga3dhcmdzOiB0aGUgY29uZmlnIG9mIHRoZSBtZXRyaWMKCiAgICA6cmV0dXJuczogdGhlIG1ldHJpY3Mgc2NvcmUgYW5kIHRoZSBleHBsYW5hdGlvbgogICAgIiIiCiAgICBtZXRyaWMgPSBfZ2V0X21ldHJpY3MoKiprd2FyZ3MpCiAgICBzYW1wbGVfZGYgPSBwZC5yZWFkX2NzdihpbnB1dF9wYXRoKQogICAgcmVzX2RmID0gbWV0cmljLl9jb21wdXRlX292ZXJfZGF0YShzYW1wbGVfZGYpCiAgICByZXR1cm4gcmVzX2RmCg==
    base_image: mlrun/mlrun
    commands: []
    code_origin: ''
    origin_filename: ''
    requirements:
    - pytest==5.2.0
    - pandas
    - openai
    - mlrun==1.4.0
    - auto-gptq
    - openmpi
    - mpi4py
    - transformers
    - torch=2.0.0
    - accelerate
    - einops
    - optimum
  entry_points:
    llm_judge:
      name: llm_judge
      doc: Compute the metrics over a dataset
      parameters:
      - name: input_path
        type: Union[str, Path]
        doc: the path to the input data
      outputs:
      - doc: the metrics score and the explanation
        default: ''
      lineno: 1126
  description: This function is used to compute the metrics using llm as a judge
  default_handler: llm_judge
  disable_auto_mount: false
  clone_target_dir: ''
  env: []
  resources:
    requests:
      memory: 1Mi
      cpu: 25m
    limits:
      memory: 20Gi
      cpu: '2'
  priority_class_name: igz-workload-medium
  preemption_mode: prevent
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: app.iguazio.com/lifecycle
            operator: NotIn
            values:
            - preemptible
          - key: eks.amazonaws.com/capacityType
            operator: NotIn
            values:
            - SPOT
          - key: node-lifecycle
            operator: NotIn
            values:
            - spot
  tolerations: null
  security_context: {}
verbose: false
