kind: job
metadata:
  name: sklearn-classifier
  tag: latest
  hash: 6e25f3c83408bb865010527940f801024447a633
  project: ''
  labels:
    author: yjb
  categories:
  - models
  - classifier
spec:
  command: ''
  args: []
  image: mlrun/ml-models
  env: []
  default_handler: train_model
  entry_points:
    train_model:
      name: train_model
      doc: train a classifier.
      parameters:
      - name: context
        type: MLClientCtx
        doc: the function context
      - name: model_pkg_class
        type: str
        doc: the model to train, e.g, "sklearn.neural_networks.MLPClassifier",  or
          json model config
      - name: data_key
        type: str
        doc: ("data") name of raw data file
        default: data
      - name: sample
        type: int
        doc: Selects the first n rows, or select a sample starting from the first.
          If negative <-1, select a random sample
        default: <_ast.USub object at 0x7fba442f6910>
      - name: label_column
        type: str
        doc: ground-truth (y) labels
        default: labels
      - name: model_key
        type: str
        doc: ("model") name of model in artifact store, points to a directory
        default: model
      - name: test_size
        type: float
        doc: (0.05) test set size
        default: 0.05
      - name: train_val_split
        type: float
        doc: (0.75) Once the test set has been removed the training set gets this
          proportion.
        default: 0.75
      - name: test_set_key
        type: str
        doc: store the test data set under this key in the artifact store
        default: test_set
      - name: rng
        type: int
        doc: (1) sklearn rng seed
        default: 1
      - name: models_dir
        type: str
        doc: models subfolder on artifact path
        default: models
      - name: plots_dir
        type: str
        doc: plot subfolder on artifact path
        default: plots
      - name: score_method
        type: str
        doc: for multiclass classification
        default: micro
      - name: model_pkg_file
        type: str
        doc: json model config file
      outputs: []
      lineno: 29
    plot_roc:
      name: plot_roc
      doc: "plot roc curves\n\nTODO:  add averaging method (as string) that was used\
        \ to create probs, \ndisplay in legend"
      parameters:
      - name: context
        doc: the function context
      - name: y_labels
        doc: 'ground truth labels, hot encoded for multiclass  '
      - name: y_probs
        doc: model prediction probabilities
      - name: key
        doc: ("roc") key of plot in artifact store
        default: roc
      - name: plots_dir
        type: str
        doc: ("plots") destination folder relative path to artifact path
        default: plots
      - name: fmt
        doc: ("png") plot format
        default: png
      - name: fpr_label
        type: str
        doc: ("false positive rate") x-axis labels
        default: false positive rate
      - name: tpr_label
        type: str
        doc: ("true positive rate") y-axis labels
        default: true positive rate
      - name: title
        type: str
        doc: ("roc curve") title of plot
        default: roc curve
      - name: legend_loc
        type: str
        doc: ("best") location of plot legend
        default: best
      outputs: []
      lineno: 150
    plot_confusion_matrix:
      name: plot_confusion_matrix
      doc: 'Create a confusion matrix.

        Plot and save a confusion matrix using test data from a

        modelline step.


        See https://scikit-learn.org/stable/modules/generated/sklearn.metrics.confusion_matrix.html


        TODO: fix label alignment

        TODO: consider using another packaged version

        TODO: refactor to take params dict for plot options'
      parameters:
      - name: context
        type: MLClientCtx
        doc: function context
      - name: labels
        doc: validation data ground-truth labels
      - name: predictions
        doc: validation data predictions
      - name: key
        type: str
        doc: str
        default: confusion_matrix
      - name: plots_dir
        type: str
        doc: relative path of plots in artifact store
        default: plots
      - name: colormap
        type: str
        doc: colourmap for confusion matrix
        default: Blues
      - name: fmt
        type: str
        doc: plot format
        default: png
      - name: sample_weight
        doc: sample weights
      outputs: []
      lineno: 203
    _gcf_clear:
      name: _gcf_clear
      doc: 'Utility to clear matplotlib figure


        Run this inside every plot method before calling any matplotlib

        methods'
      parameters:
      - name: plt
      outputs: []
      lineno: 242
  description: train any classifier using scikit-learn's API
  image_pull_policy: Always
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlciBvbiAyMDIwLTAzLTI1IDIwOjM4CgppbXBvcnQganNvbgppbXBvcnQgb3MKCmZyb20gY2xvdWRwaWNrbGUgaW1wb3J0IGR1bXAsIGxvYWQKCmZyb20gc2tsZWFybiBpbXBvcnQgbWV0cmljcwppbXBvcnQgcGFuZGFzIGFzIHBkCmltcG9ydCBudW1weSBhcyBucAppbXBvcnQgbWF0cGxvdGxpYi5weXBsb3QgYXMgcGx0CmltcG9ydCBzZWFib3JuIGFzIHNucwoKZnJvbSBza2xlYXJuLnByZXByb2Nlc3NpbmcgaW1wb3J0IGxhYmVsX2JpbmFyaXplCmZyb20gc2tsZWFybi5tb2RlbF9zZWxlY3Rpb24gaW1wb3J0IHRyYWluX3Rlc3Rfc3BsaXQKZnJvbSBza2xlYXJuIGltcG9ydCBtZXRyaWNzCgpmcm9tIHR5cGluZyBpbXBvcnQgTGlzdApmcm9tIG1scnVuLmV4ZWN1dGlvbiBpbXBvcnQgTUxDbGllbnRDdHgKZnJvbSBtbHJ1bi5kYXRhc3RvcmUgaW1wb3J0IERhdGFJdGVtCmZyb20gbWxydW4uYXJ0aWZhY3RzIGltcG9ydCBQbG90QXJ0aWZhY3QKCmZyb20gdXRpbHMgaW1wb3J0IGdldF9tb2RlbF9jb25maWdzCgppbXBvcnQgd2FybmluZ3MKCndhcm5pbmdzLnNpbXBsZWZpbHRlcihhY3Rpb249Imlnbm9yZSIsIGNhdGVnb3J5PUZ1dHVyZVdhcm5pbmcpCgpkZWYgdHJhaW5fbW9kZWwoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIG1vZGVsX3BrZ19jbGFzczogc3RyID0gIiIsCiAgICBkYXRhX2tleTogc3RyID0gImRhdGEiLAogICAgc2FtcGxlOiBpbnQgPSAtMSwKICAgIGxhYmVsX2NvbHVtbjogc3RyID0gImxhYmVscyIsCiAgICBtb2RlbF9rZXk6IHN0ciA9ICJtb2RlbCIsCiAgICB0ZXN0X3NpemU6IGZsb2F0ID0gMC4wNSwKICAgIHRyYWluX3ZhbF9zcGxpdDogZmxvYXQgPSAwLjc1LAogICAgdGVzdF9zZXRfa2V5OiBzdHIgPSAidGVzdF9zZXQiLAogICAgcm5nOiBpbnQgPSAxLAogICAgbW9kZWxzX2Rpcjogc3RyID0gIm1vZGVscyIsCiAgICBwbG90c19kaXI6IHN0ciA9ICJwbG90cyIsCiAgICBzY29yZV9tZXRob2Q6IHN0ciA9ICJtaWNybyIsCiAgICBtb2RlbF9wa2dfZmlsZTogc3RyID0gIiIKKSAtPiBOb25lOgogICAgIiIidHJhaW4gYSBjbGFzc2lmaWVyLgoKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgICAgdGhlIGZ1bmN0aW9uIGNvbnRleHQKICAgIDpwYXJhbSBtb2RlbF9wa2dfY2xhc3M6ICAgdGhlIG1vZGVsIHRvIHRyYWluLCBlLmcsICJza2xlYXJuLm5ldXJhbF9uZXR3b3Jrcy5NTFBDbGFzc2lmaWVyIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGpzb24gbW9kZWwgY29uZmlnCiAgICA6cGFyYW0gZGF0YV9rZXk6ICAgICAgICAgICgiZGF0YSIpIG5hbWUgb2YgcmF3IGRhdGEgZmlsZQogICAgOnBhcmFtIHNhbXBsZTogICAgICAgICAgICBTZWxlY3RzIHRoZSBmaXJzdCBuIHJvd3MsIG9yIHNlbGVjdCBhIHNhbXBsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydGluZyBmcm9tIHRoZSBmaXJzdC4gSWYgbmVnYXRpdmUgPC0xLCBzZWxlY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSByYW5kb20gc2FtcGxlCiAgICA6cGFyYW0gbGFiZWxfY29sdW1uOiAgICAgIGdyb3VuZC10cnV0aCAoeSkgbGFiZWxzCiAgICA6cGFyYW0gbW9kZWxfa2V5OiAgICAgICAgICgibW9kZWwiKSBuYW1lIG9mIG1vZGVsIGluIGFydGlmYWN0IHN0b3JlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgdG8gYSBkaXJlY3RvcnkKICAgIDpwYXJhbSB0ZXN0X3NpemU6ICAgICAgICAgKDAuMDUpIHRlc3Qgc2V0IHNpemUKICAgIDpwYXJhbSB0cmFpbl92YWxfc3BsaXQ6ICAgKDAuNzUpIE9uY2UgdGhlIHRlc3Qgc2V0IGhhcyBiZWVuIHJlbW92ZWQgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYWluaW5nIHNldCBnZXRzIHRoaXMgcHJvcG9ydGlvbi4KICAgIDpwYXJhbSB0ZXN0X3NldF9rZXk6ICAgICAgc3RvcmUgdGhlIHRlc3QgZGF0YSBzZXQgdW5kZXIgdGhpcyBrZXkgaW4gdGhlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFydGlmYWN0IHN0b3JlCiAgICA6cGFyYW0gcm5nOiAgICAgICAgICAgICAgICgxKSBza2xlYXJuIHJuZyBzZWVkCiAgICA6cGFyYW0gbW9kZWxzX2RpcjogICAgICAgIG1vZGVscyBzdWJmb2xkZXIgb24gYXJ0aWZhY3QgcGF0aAogICAgOnBhcmFtIHBsb3RzX2RpcjogICAgICAgICBwbG90IHN1YmZvbGRlciBvbiBhcnRpZmFjdCBwYXRoCiAgICA6cGFyYW0gc2NvcmVfbWV0aG9kOiAgICAgIGZvciBtdWx0aWNsYXNzIGNsYXNzaWZpY2F0aW9uCiAgICA6cGFyYW0gbW9kZWxfcGtnX2ZpbGU6ICAgIGpzb24gbW9kZWwgY29uZmlnIGZpbGUKICAgICIiIgogICAgc3JjZmlsZXBhdGggPSBzdHIoZGF0YV9rZXkpCiAgICAKICAgIGlmIChzYW1wbGUgPT0gLTEpIG9yIChzYW1wbGUgPj0gMSk6CiAgICAgICAgcmF3ID0gcHEucmVhZF90YWJsZShzcmNmaWxlcGF0aCkudG9fcGFuZGFzKCkuZHJvcG5hKCkKICAgICAgICBsYWJlbHMgPSByYXcucG9wKGxhYmVsX2NvbHVtbikKICAgICAgICByYXcgPSByYXcuaWxvY1s6c2FtcGxlLCA6XQogICAgICAgIGxhYmVscyA9IGxhYmVscy5pbG9jWzpzYW1wbGVdCiAgICBlbHNlOgogICAgICAgIHJhdyA9IHBxLnJlYWRfdGFibGUoc3JjZmlsZXBhdGgpLnRvX3BhbmRhcygpLmRyb3BuYSgpLnNhbXBsZShzYW1wbGUgKiAtMSkKICAgICAgICBsYWJlbHMgPSByYXcucG9wKGxhYmVsX2NvbHVtbikKCiAgICBjb250ZXh0LmhlYWRlciA9IHJhdy5jb2x1bW5zLnZhbHVlcwogICAgCiAgICB5YiA9IGxhYmVsX2JpbmFyaXplKGxhYmVscywgY2xhc3Nlcz1sYWJlbHMudW5pcXVlKCkpICMgaWYgYmluYXJ5IDAvMSBsYWJlbHMsIHdpbGwgcmV0dXJuIGxhYmVscyBhcyBpcwogICAgCiAgICB4LCB4dGVzdCwgeSwgeXRlc3QgPSB0cmFpbl90ZXN0X3NwbGl0KG5wLmNvbmNhdGVuYXRlKFtyYXcsIHliXSwgYXhpcz0xKSwgbGFiZWxzLCB0ZXN0X3NpemU9dGVzdF9zaXplLCByYW5kb21fc3RhdGU9cm5nKQogICAgeHRyYWluLCB4dmFsaWQsIHl0cmFpbiwgeXZhbGlkID0gdHJhaW5fdGVzdF9zcGxpdCh4LCB5LCB0cmFpbl9zaXplPXRyYWluX3ZhbF9zcGxpdCwgcmFuZG9tX3N0YXRlPXJuZykKICAgIHl0cmFpbmIgPSB4dHJhaW5bOiwgLXliLnNoYXBlWzFdOl0uY29weSgpCiAgICB4dHJhaW4gPSB4dHJhaW5bOiwgOi15Yi5zaGFwZVsxXV0uY29weSgpCiAgICB5dmFsaWRiID0geHZhbGlkWzosIC15Yi5zaGFwZVsxXTpdLmNvcHkoKQogICAgeHZhbGlkID0geHZhbGlkWzosIDoteWIuc2hhcGVbMV1dLmNvcHkoKQogICAgeXRlc3RiID0geHRlc3RbOiwgLXliLnNoYXBlWzFdOl0uY29weSgpCiAgICB4dGVzdCA9IHh0ZXN0WzosIDoteWIuc2hhcGVbMV1dLmNvcHkoKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAKICAgIHRlc3Rfc2V0ID0gcGQuY29uY2F0KAogICAgICAgIFtwZC5EYXRhRnJhbWUoZGF0YT14dGVzdCwgY29sdW1ucz1jb250ZXh0LmhlYWRlciksCiAgICAgICAgIHBkLkRhdGFGcmFtZShkYXRhPXl0ZXN0LnZhbHVlcywgY29sdW1ucz1bbGFiZWxfY29sdW1uXSldLAogICAgICAgIGF4aXM9MSwpCiAgICBjb250ZXh0LmxvZ19kYXRhc2V0KHRlc3Rfc2V0X2tleSwgZGY9dGVzdF9zZXQsIGZvcm1hdD1maWxlX2V4dCwgaW5kZXg9RmFsc2UpCgogICAgaWYgbW9kZWxfcGtnX2ZpbGU6CiAgICAgICAgbW9kZWxfY29uZmlnID0ganNvbi5sb2Fkcyhtb2RlbF9wa2dfZmlsZS5nZXQoKSkKICAgIGVsaWYgbW9kZWxfcGtnX2NsYXNzOgogICAgICAgIG1vZGVsX2NvbmZpZyA9IGdldF9tb2RlbF9jb25maWdzKG1vZGVsX3BrZ19jbGFzcykKICAgIGVsc2U6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcignbW9kZWxfcGtnX2ZpbGUgb3IgbW9kZWxfcGtnX2NsYXNzIG11c3QgYmUgcHJvdmlkZWQnKQogICAgCiAgICBwcmludChsaXN0KGNvbnRleHQucGFyYW1ldGVycy5pdGVtcygpKSkKICAgIAogICAgZm9yIGssIHYgaW4gY29udGV4dC5wYXJhbWV0ZXJzLml0ZW1zKCk6CiAgICAgICAgaWYgay5zdGFydHN3aXRoKCdDTEFTU18nKToKICAgICAgICAgICAgbW9kZWxfY29uZmlnWydDTEFTUyddW2tbNjpdXSA9IHYKICAgICAgICBpZiBrLnN0YXJ0c3dpdGgoJ0ZJVF8nKToKICAgICAgICAgICAgbW9kZWxfY29uZmlnWydGSVQnXVtrWzQ6XV0gPSB2CgogICAgbW9kZWxfY29uZmlnWyJGSVQiXS51cGRhdGUoeyJYIjogeHRyYWluLCJ5IjogeXRyYWluLnZhbHVlc30pCiAgICAKICAgIENsYXNzaWZpZXJDbGFzcyA9IF9jcmVhdGVfY2xhc3MobW9kZWxfY29uZmlnWyJNRVRBIl1bImNsYXNzIl0pCiAgICBtb2RlbCA9IENsYXNzaWZpZXJDbGFzcygqKm1vZGVsX2NvbmZpZ1siQ0xBU1MiXSkKICAgIG1vZGVsLmZpdCgqKm1vZGVsX2NvbmZpZ1siRklUIl0pCgogICAgZmlsZXBhdGggPSBvcy5wYXRoLmpvaW4oYmFzZV9wYXRoLCBmInttb2RlbHNfZGlyfS97bW9kZWxfa2V5fS5wa2wiKQogICAgdHJ5OgogICAgICAgIGR1bXAobW9kZWwsIG9wZW4oZmlsZXBhdGgsICJ3YiIpKQogICAgICAgIGNvbnRleHQubG9nX2FydGlmYWN0KG1vZGVsX2tleSwgbG9jYWxfcGF0aD1tb2RlbHNfZGlyKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KCJTRVJJQUxJWkUgTU9ERUwgRVJST1I6Iiwgc3RyKGUpKQoKICAgIHlwcmVkID0gbW9kZWwucHJlZGljdCh4dmFsaWQpCiAgICB5X3Njb3JlID0gbW9kZWwucHJlZGljdF9wcm9iYSh4dmFsaWQpCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYieV9zY29yZS5zaGFwZSB7eV9zY29yZS5zaGFwZX0iKQogICAgY29udGV4dC5sb2dnZXIuaW5mbyhmInl2YWxpZGIuc2hhcGUge3l2YWxpZGIuc2hhcGV9IikKICAgIGlmIHl2YWxpZGIuc2hhcGVbMV0gPiAxOgogICAgICAgIGF2ZXJhZ2VfcHJlY2lzaW9uID0gbWV0cmljcy5hdmVyYWdlX3ByZWNpc2lvbl9zY29yZSh5dmFsaWRiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5X3Njb3JlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdmVyYWdlPXNjb3JlX21ldGhvZCkKICAgICAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJyb2NhdWMiLCBtZXRyaWNzLnJvY19hdWNfc2NvcmUoeXZhbGlkYiwgeV9zY29yZSkpCiAgICBlbHNlOgogICAgICAgIGF2ZXJhZ2VfcHJlY2lzaW9uID0gbWV0cmljcy5hdmVyYWdlX3ByZWNpc2lvbl9zY29yZSh5dmFsaWRiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5X3Njb3JlWzosIDFdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdmVyYWdlPXNjb3JlX21ldGhvZCkKICAgICAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJyb2NhdWMiLCBtZXRyaWNzLnJvY19hdWNfc2NvcmUoeXZhbGlkYiwgeV9zY29yZVs6LCAxXSkpCiAgICAgICAgCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJhdmdfcHJlY3Njb3JlIiwgYXZlcmFnZV9wcmVjaXNpb24pCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJhY2N1cmFjeSIsIGZsb2F0KG1vZGVsLnNjb3JlKHh2YWxpZCwgeXZhbGlkKSkpCiAgICBjb250ZXh0LmxvZ19yZXN1bHQoZiJmMV9zY29yZSIsIG1ldHJpY3MuZjFfc2NvcmUoeXZhbGlkLCB5cHJlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZlcmFnZT1zY29yZV9tZXRob2QpKQoKICAgIAogICAgcGxvdF9yb2MoY29udGV4dCwgeXZhbGlkYiwgeV9zY29yZSkKICAgIHBsb3RfY29uZnVzaW9uX21hdHJpeChjb250ZXh0LCB5dmFsaWQsIHlwcmVkLCBrZXk9ImNvbmZ1c2lvbiIsIGZtdD0icG5nIikKCmRlZiBwbG90X3JvYygKICAgIGNvbnRleHQsCiAgICB5X2xhYmVscywKICAgIHlfcHJvYnMsCiAgICBrZXk9InJvYyIsCiAgICBwbG90c19kaXI6IHN0ciA9ICJwbG90cyIsCiAgICBmbXQ9InBuZyIsCiAgICBmcHJfbGFiZWw6IHN0ciA9ICJmYWxzZSBwb3NpdGl2ZSByYXRlIiwKICAgIHRwcl9sYWJlbDogc3RyID0gICJ0cnVlIHBvc2l0aXZlIHJhdGUiLAogICAgdGl0bGU6IHN0ciA9ICJyb2MgY3VydmUiLAogICAgbGVnZW5kX2xvYzogc3RyID0gImJlc3QiCik6CiAgICAiIiJwbG90IHJvYyBjdXJ2ZXMKICAgIAogICAgVE9ETzogIGFkZCBhdmVyYWdpbmcgbWV0aG9kIChhcyBzdHJpbmcpIHRoYXQgd2FzIHVzZWQgdG8gY3JlYXRlIHByb2JzLCAKICAgIGRpc3BsYXkgaW4gbGVnZW5kCiAgICAKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0geV9sYWJlbHM6ICAgICBncm91bmQgdHJ1dGggbGFiZWxzLCBob3QgZW5jb2RlZCBmb3IgbXVsdGljbGFzcyAgCiAgICA6cGFyYW0geV9wcm9iczogICAgICBtb2RlbCBwcmVkaWN0aW9uIHByb2JhYmlsaXRpZXMKICAgIDpwYXJhbSBrZXk6ICAgICAgICAgICgicm9jIikga2V5IG9mIHBsb3QgaW4gYXJ0aWZhY3Qgc3RvcmUKICAgIDpwYXJhbSBwbG90c19kaXI6ICAgICgicGxvdHMiKSBkZXN0aW5hdGlvbiBmb2xkZXIgcmVsYXRpdmUgcGF0aCB0byBhcnRpZmFjdCBwYXRoCiAgICA6cGFyYW0gZm10OiAgICAgICAgICAoInBuZyIpIHBsb3QgZm9ybWF0CiAgICA6cGFyYW0gZnByX2xhYmVsOiAgICAoImZhbHNlIHBvc2l0aXZlIHJhdGUiKSB4LWF4aXMgbGFiZWxzCiAgICA6cGFyYW0gdHByX2xhYmVsOiAgICAoInRydWUgcG9zaXRpdmUgcmF0ZSIpIHktYXhpcyBsYWJlbHMKICAgIDpwYXJhbSB0aXRsZTogICAgICAgICgicm9jIGN1cnZlIikgdGl0bGUgb2YgcGxvdAogICAgOnBhcmFtIGxlZ2VuZF9sb2M6ICAgKCJiZXN0IikgbG9jYXRpb24gb2YgcGxvdCBsZWdlbmQKICAgICIiIgogICAgX2djZl9jbGVhcihwbHQpCiAgICAKICAgIHBsdC5wbG90KFswLCAxXSwgWzAsIDFdLCAiay0tIikKICAgIAogICAgcGx0LnhsYWJlbChmcHJfbGFiZWwpCiAgICBwbHQueWxhYmVsKHRwcl9sYWJlbCkKICAgIHBsdC50aXRsZSh0aXRsZSkKICAgIHBsdC5sZWdlbmQobG9jPWxlZ2VuZF9sb2MpCiAgICAKICAgIGlmIHlfbGFiZWxzLnNoYXBlWzFdID4gMToKICAgICAgICBmcHIgPSBkaWN0KCkKICAgICAgICB0cHIgPSBkaWN0KCkKICAgICAgICByb2NfYXVjID0gZGljdCgpCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoeV9sYWJlbHNbOiw6LTFdLnNoYXBlWzFdKToKICAgICAgICAgICAgZnByW2ldLCB0cHJbaV0sIF8gPSBtZXRyaWNzLnJvY19jdXJ2ZSh5X2xhYmVsc1s6LCBpXSwgeV9wcm9ic1s6LCBpXSwgcG9zX2xhYmVsPTEpCiAgICAgICAgICAgIHJvY19hdWNbaV0gPSBtZXRyaWNzLmF1YyhmcHJbaV0sIHRwcltpXSkKICAgICAgICAgICAgcGx0LnBsb3QoZnByW2ldLCB0cHJbaV0sIGxhYmVsPWYiY2xhc3Mge2l9IikKICAgIGVsc2U6CiAgICAgICAgZnByLCB0cHIsIF8gPSBtZXRyaWNzLnJvY19jdXJ2ZSh5X2xhYmVscywgeV9wcm9ic1s6LCAxXSwgcG9zX2xhYmVsPTEpCiAgICAgICAgcGx0LnBsb3QoZnByLCB0cHIsIGxhYmVsPWYicG9zaXRpdmUgY2xhc3MiKQogICAgICAgIAogICAgZm5hbWUgPSBmIntwbG90c19kaXJ9L3trZXl9Lmh0bWwiCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3Qoa2V5LCBib2R5PXBsdC5nY2YoKSksIGxvY2FsX3BhdGg9Zm5hbWUpCiAgICAKCmRlZiBwbG90X2NvbmZ1c2lvbl9tYXRyaXgoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIGxhYmVscywKICAgIHByZWRpY3Rpb25zLAogICAga2V5OiBzdHIgPSAiY29uZnVzaW9uX21hdHJpeCIsCiAgICBwbG90c19kaXI6IHN0ciA9ICJwbG90cyIsCiAgICBjb2xvcm1hcDogc3RyID0gIkJsdWVzIiwKICAgIGZtdDogc3RyID0gInBuZyIsCiAgICBzYW1wbGVfd2VpZ2h0PU5vbmUKKToKICAgICIiIkNyZWF0ZSBhIGNvbmZ1c2lvbiBtYXRyaXguCiAgICBQbG90IGFuZCBzYXZlIGEgY29uZnVzaW9uIG1hdHJpeCB1c2luZyB0ZXN0IGRhdGEgZnJvbSBhCiAgICBtb2RlbGxpbmUgc3RlcC4KICAgIAogICAgU2VlIGh0dHBzOi8vc2Npa2l0LWxlYXJuLm9yZy9zdGFibGUvbW9kdWxlcy9nZW5lcmF0ZWQvc2tsZWFybi5tZXRyaWNzLmNvbmZ1c2lvbl9tYXRyaXguaHRtbAogICAgCiAgICBUT0RPOiBmaXggbGFiZWwgYWxpZ25tZW50CiAgICBUT0RPOiBjb25zaWRlciB1c2luZyBhbm90aGVyIHBhY2thZ2VkIHZlcnNpb24KICAgIFRPRE86IHJlZmFjdG9yIHRvIHRha2UgcGFyYW1zIGRpY3QgZm9yIHBsb3Qgb3B0aW9ucwoKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgIGZ1bmN0aW9uIGNvbnRleHQKICAgIDpwYXJhbSBsYWJlbHM6ICAgICAgICAgIHZhbGlkYXRpb24gZGF0YSBncm91bmQtdHJ1dGggbGFiZWxzCiAgICA6cGFyYW0gcHJlZGljdGlvbnM6ICAgICB2YWxpZGF0aW9uIGRhdGEgcHJlZGljdGlvbnMKICAgIDpwYXJhbSBrZXk6ICAgICAgICAgICAgIHN0cgogICAgOnBhcmFtIHBsb3RzX2RpcjogICAgICAgcmVsYXRpdmUgcGF0aCBvZiBwbG90cyBpbiBhcnRpZmFjdCBzdG9yZQogICAgOnBhcmFtIGNvbG9ybWFwOiAgICAgICAgY29sb3VybWFwIGZvciBjb25mdXNpb24gbWF0cml4CiAgICA6cGFyYW0gZm10OiAgICAgICAgICAgICBwbG90IGZvcm1hdAogICAgOnBhcmFtIHNhbXBsZV93ZWlnaHQ6ICAgc2FtcGxlIHdlaWdodHMKICAgICIiIgogICAgX2djZl9jbGVhcihwbHQpCiAgICAKICAgIGNtID0gbWV0cmljcy5jb25mdXNpb25fbWF0cml4KGxhYmVscywgcHJlZGljdGlvbnMsIHNhbXBsZV93ZWlnaHQ9Tm9uZSkKICAgIHNucy5oZWF0bWFwKGNtLCBhbm5vdD1UcnVlLCBjbWFwPWNvbG9ybWFwLCBzcXVhcmU9VHJ1ZSkKCiAgICBmaWcgPSBwbHQuZ2NmKCkKICAgIGZuYW1lID0gZiJ7cGxvdHNfZGlyfS97a2V5fS5odG1sIgogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoUGxvdEFydGlmYWN0KGtleSwgYm9keT1maWcpLCBsb2NhbF9wYXRoPWZuYW1lKQoKICAgIApkZWYgX2djZl9jbGVhcihwbHQpOgogICAgIiIiVXRpbGl0eSB0byBjbGVhciBtYXRwbG90bGliIGZpZ3VyZQoKICAgIFJ1biB0aGlzIGluc2lkZSBldmVyeSBwbG90IG1ldGhvZCBiZWZvcmUgY2FsbGluZyBhbnkgbWF0cGxvdGxpYgogICAgbWV0aG9kcwoKICAgIDpwYXJhbSBwbG90OiAgICBtYXRsb2JsaWIgZmlndXJlIG9iamVjdAogICAgIiIiCiAgICBwbHQuY2xhKCkKICAgIHBsdC5jbGYoKQogICAgcGx0LmNsb3NlKCkKCg==
    commands: []
    code_origin: https://github.com/mlrun/functions.git#ba606c2476caf7c351cc0330687329bb83573dfd:sklearn_classifier.ipynb
