kind: job
metadata:
  name: azureml-utils
  tag: ''
  hash: 58a0ae140ed07f6dc1c52c70111cd3fbd35abf95
  project: default
  labels:
    author: yonish
  categories:
  - Utilities
  - machine-learning
  - model-training
spec:
  command: ''
  args: []
  image: mlrun/mlrun
  env: []
  default_handler: automl_train
  entry_points:
    init_compute:
      name: init_compute
      doc: 'Initialize Azure ML compute target to run experiment. Checks for

        existing compute target and creates new if does not exist.'
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context.
        default: ''
      - name: cpu_cluster_name
        type: str
        doc: Name of Azure ML compute target. Created if does not exist.
        default: ''
      - name: vm_size
        type: str
        doc: Azure machine type for compute target.
        default: STANDARD_D2_V2
      - name: max_nodes
        type: int
        doc: Maximum number of concurrent compute targets.
        default: 1
      outputs:
      - default: ''
        doc: Azure ML Compute Target.
        type: ComputeTarget
      lineno: 86
    register_dataset:
      name: register_dataset
      doc: 'Register dataset object (can be also an Iguazio FeatureVector) in Azure
        ML.

        Uploads parquet file to Azure blob storage and registers

        that file as a dataset in Azure ML.'
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context.
        default: ''
      - name: dataset_name
        type: str
        doc: Name of Azure dataset to register.
        default: ''
      - name: dataset_description
        type: str
        doc: Description of Azure dataset to register.
        default: ''
      - name: data
        type: DataItem
        doc: MLRun FeatureVector or dataset object to upload.
        default: ''
      - name: create_new_version
        type: bool
        doc: Register Azure dataset as new version. Must be used when modifying dataset
          schema.
        default: false
      outputs:
      - default: ''
      lineno: 122
    download_model:
      name: download_model
      doc: Download trained model from Azure ML to local filesystem.
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context.
        default: ''
      - name: model_name
        type: str
        doc: Name of trained and registered model.
        default: ''
      - name: model_version
        type: int
        doc: Version of model to download.
        default: ''
      - name: target_dir
        type: str
        doc: Target directory to download model.
        default: .
      outputs:
      - default: ''
      lineno: 199
    upload_model:
      name: upload_model
      doc: Upload pre-trained model from local filesystem to Azure ML.
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context.
        default: ''
      - name: model_name
        type: str
        doc: Name of trained and registered model.
        default: ''
      - name: model_path
        type: str
        doc: Path to file on local filesystem.
        default: ''
      - name: model_description
        type: str
        doc: Description of models.
        default: null
      - name: model_tags
        type: dict
        doc: KV pairs of model tags.
        default: null
      outputs:
      - default: ''
      lineno: 220
    submit_training_job:
      name: submit_training_job
      doc: 'Submit training job to Azure AutoML and download trained model

        when completed. Uses previously registered dataset for training.'
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context.
        default: ''
      - name: experiment
        type: Experiment
        doc: Azure experiment.
        default: ''
      - name: compute_target
        type: ComputeTarget
        doc: Azure compute target.
        default: ''
      - name: register_model_name
        type: str
        doc: Name of model to register in Azure.
        default: ''
      - name: registered_dataset_name
        type: str
        doc: Name of dataset registered in Azure ML.
        default: ''
      - name: label_column_name
        type: str
        doc: Name of target column in dataset.
        default: ''
      - name: automl_settings
        type: dict
        doc: JSON string of all Azure AutoML settings.
        default: ''
      - name: training_set
        type: DataItem
        doc: Training set to log with model. For model monitoring integration.
        default: ''
      - name: save_n_models
        type: int
        doc: How many of the top performing models to log.
        default: 3
      - name: show_output
        type: bool
        doc: Displaying Azure logs.
        default: true
      outputs:
      - default: ''
      lineno: 334
    automl_train:
      name: automl_train
      doc: 'Whole training flow for Azure AutoML. Registers dataset/feature vector,

        submits training job to Azure AutoML, and downloads trained model

        when completed.'
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context.
        default: ''
      - name: training_data
        type: DataItem
        doc: MLRun FeatureVector or dataset URI to upload. Will drop index before
          uploading when it is a FeatureVector.
        default: ''
      - name: experiment_name
        type: str
        doc: Name of experiment to create in Azure ML.
        default: ''
      - name: cpu_cluster_name
        type: str
        doc: Name of Azure ML compute target. Created if does not exist.
        default: ''
      - name: vm_size
        type: str
        doc: Azure machine type for compute target.
        default: STANDARD_D2_V2
      - name: max_nodes
        type: int
        doc: Maximum number of concurrent compute targets.
        default: 1
      - name: dataset_name
        type: str
        doc: Name of Azure dataset to register.
        default: ''
      - name: dataset_description
        type: str
        doc: Description of Azure dataset to register.
        default: ''
      - name: create_new_version
        type: bool
        doc: Register Azure dataset as new version. Must be used when modifying dataset
          schema.
        default: false
      - name: label_column_name
        type: str
        doc: Target column in dataset.
        default: ''
      - name: register_model_name
        type: str
        doc: Name of model to register in Azure.
        default: ''
      - name: save_n_models
        type: int
        doc: How many of the top performing models to log.
        default: 1
      - name: log_azure
        type: bool
        doc: Displaying Azure logs.
        default: true
      - name: automl_settings
        type: str
        doc: JSON string of all Azure AutoML settings.
        default: null
      outputs:
      - default: ''
      lineno: 454
  description: Azure AutoML integration in MLRun, including utils functions for training
    models on Azure AutoML platfrom.
  build:
    functionSourceCode: aW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCBsb2dnaW5nCmZyb20gdHlwaW5nIGltcG9ydCBUdXBsZSwgTGlzdAoKZnJvbSBtbHJ1biBpbXBvcnQgTUxDbGllbnRDdHgsIERhdGFJdGVtLCBnZXRfZGF0YWl0ZW0KaW1wb3J0IG1scnVuLmZlYXR1cmVfc3RvcmUgYXMgZl9zdG9yZQpmcm9tIG1scnVuLmFwaS5zY2hlbWFzIGltcG9ydCBPYmplY3RLaW5kCgpmcm9tIGF6dXJlbWwuY29yZS5hdXRoZW50aWNhdGlvbiBpbXBvcnQgU2VydmljZVByaW5jaXBhbEF1dGhlbnRpY2F0aW9uCmZyb20gYXp1cmVtbC5jb3JlLndvcmtzcGFjZSBpbXBvcnQgV29ya3NwYWNlCmZyb20gYXp1cmVtbC5jb3JlLmV4cGVyaW1lbnQgaW1wb3J0IEV4cGVyaW1lbnQKZnJvbSBhenVyZW1sLmNvcmUuZGF0YXNldCBpbXBvcnQgRGF0YXNldApmcm9tIGF6dXJlbWwuY29yZS5tb2RlbCBpbXBvcnQgTW9kZWwKZnJvbSBhenVyZW1sLmNvcmUuY29tcHV0ZSBpbXBvcnQgQ29tcHV0ZVRhcmdldCwgQW1sQ29tcHV0ZQpmcm9tIGF6dXJlbWwuY29yZS5jb21wdXRlX3RhcmdldCBpbXBvcnQgQ29tcHV0ZVRhcmdldEV4Y2VwdGlvbgpmcm9tIGF6dXJlbWwuY29yZS5zY3JpcHRfcnVuIGltcG9ydCBTY3JpcHRSdW4KCmZyb20gYXp1cmVtbC50cmFpbi5hdXRvbWwgaW1wb3J0IEF1dG9NTENvbmZpZwpmcm9tIGF6dXJlbWwudHJhaW4uYXV0b21sLnJ1biBpbXBvcnQgQXV0b01MUnVuCgoKZGVmIF9lbnZfb3Jfc2VjcmV0KGNvbnRleHQsIGtleSk6CiAgICBpZiBrZXkgaW4gb3MuZW52aXJvbjoKICAgICAgICByZXR1cm4gb3MuZW52aXJvbltrZXldCiAgICByZXR1cm4gY29udGV4dC5nZXRfc2VjcmV0KGtleSkKCgpkZWYgX2xvYWRfd29ya3NwYWNlKGNvbnRleHQ6IE1MQ2xpZW50Q3R4KSAtPiBXb3Jrc3BhY2U6CiAgICAiIiIKICAgIExvYWRpbmcgQXp1cmVNTCBXb3Jrc3BhY2Ugd2l0aCBBenVyZSBzZWNyZXRzLgoKICAgIDpwYXJhbSBjb250ZXh0OiBNTFJ1biBjb250ZXh0LgogICAgOnJldHVybnM6ICAgICAgIEF6dXJlTUwgV29ya3NwYWNlCiAgICAiIiIKCiAgICBpZiBoYXNhdHRyKGNvbnRleHQsICJfYXp1cmVfd29ya3NwYWNlIik6CiAgICAgICAgcmV0dXJuIGNvbnRleHQuX2F6dXJlX3dvcmtzcGFjZQoKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIkxvYWRpbmcgQXp1cmVNTCBXb3Jrc3BhY2UiKQogICAgIyBBenVyZSBzZXJ2aWNlIGF1dGhlbnRpY2F0aW9uOgogICAgc2VydmljZV9hdXRoZW50aWNhdGlvbiA9IFNlcnZpY2VQcmluY2lwYWxBdXRoZW50aWNhdGlvbigKICAgICAgICB0ZW5hbnRfaWQ9X2Vudl9vcl9zZWNyZXQoY29udGV4dCwgIkFaVVJFX1RFTkFOVF9JRCIpLAogICAgICAgIHNlcnZpY2VfcHJpbmNpcGFsX2lkPV9lbnZfb3Jfc2VjcmV0KGNvbnRleHQsICJBWlVSRV9TRVJWSUNFX1BSSU5DSVBBTF9JRCIpLAogICAgICAgIHNlcnZpY2VfcHJpbmNpcGFsX3Bhc3N3b3JkPV9lbnZfb3Jfc2VjcmV0KAogICAgICAgICAgICBjb250ZXh0LCAiQVpVUkVfU0VSVklDRV9QUklOQ0lQQUxfUEFTU1dPUkQiCiAgICAgICAgKSwKICAgICkKCiAgICAjIExvYWRpbmcgQXp1cmUgd29ya3NwYWNlOgogICAgd29ya3NwYWNlID0gV29ya3NwYWNlKAogICAgICAgIHN1YnNjcmlwdGlvbl9pZD1fZW52X29yX3NlY3JldChjb250ZXh0LCAiQVpVUkVfU1VCU0NSSVBUSU9OX0lEIiksCiAgICAgICAgcmVzb3VyY2VfZ3JvdXA9X2Vudl9vcl9zZWNyZXQoY29udGV4dCwgIkFaVVJFX1JFU09VUkNFX0dST1VQIiksCiAgICAgICAgd29ya3NwYWNlX25hbWU9X2Vudl9vcl9zZWNyZXQoY29udGV4dCwgIkFaVVJFX1dPUktTUEFDRV9OQU1FIiksCiAgICAgICAgYXV0aD1zZXJ2aWNlX2F1dGhlbnRpY2F0aW9uLAogICAgKQoKICAgIGNvbnRleHQuX2F6dXJlX3dvcmtzcGFjZSA9IHdvcmtzcGFjZQogICAgcmV0dXJuIHdvcmtzcGFjZQoKCmRlZiBfaW5pdF9leHBlcmltZW50KAogICAgY29udGV4dDogTUxDbGllbnRDdHgsIGV4cGVyaW1lbnRfbmFtZTogc3RyCikgLT4gVHVwbGVbV29ya3NwYWNlLCBFeHBlcmltZW50XToKICAgICIiIgogICAgSW5pdGlhbGl6ZSB3b3Jrc3BhY2UgYW5kIGV4cGVyaW1lbnQgaW4gQXp1cmUgTUwuIFVzZXMgU2VydmljZQogICAgUHJpbmNpcGFsIGF1dGhlbnRpY2F0aW9uIHZpYSBlbnZpcm9ubWVudCB2YXJpYWJsZXMuCgogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgTUxSdW4gY29udGV4dC4KICAgIDpwYXJhbSBleHBlcmltZW50X25hbWU6IE5hbWUgb2YgZXhwZXJpbWVudCB0byBjcmVhdGUgaW4gQXp1cmUgTUwuCiAgICA6cmV0dXJuczogICAgICAgICAgICAgICBBenVyZSBNTCBXb3Jrc3BhY2UgYW5kIEV4cGVyaW1lbnQuCiAgICAiIiIKCiAgICAjIEluaXRpYWxpemUgZXhwZXJpbWVudCB2aWEgU2VydmljZSBQcmluY2lwYWwgQXV0aGVudGljYXRpb246CiAgICAjIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL2F6dXJlL21hY2hpbmUtbGVhcm5pbmcvaG93LXRvLXNldHVwLWF1dGhlbnRpY2F0aW9uI3VzZS1zZXJ2aWNlLXByaW5jaXBhbC1hdXRoZW50aWNhdGlvbgoKICAgIHdvcmtzcGFjZSA9IF9sb2FkX3dvcmtzcGFjZShjb250ZXh0KQoKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJJbml0aWFsaXppbmcgQXp1cmVNTCBleHBlcmltZW50IHtleHBlcmltZW50X25hbWV9IikKICAgICMgQ3JlYXRpbmcgZXhwZXJpbWVudDoKICAgIGV4cGVyaW1lbnQgPSBFeHBlcmltZW50KHdvcmtzcGFjZSwgZXhwZXJpbWVudF9uYW1lKQoKICAgIHJldHVybiB3b3Jrc3BhY2UsIGV4cGVyaW1lbnQKCgpkZWYgaW5pdF9jb21wdXRlKAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBjcHVfY2x1c3Rlcl9uYW1lOiBzdHIsCiAgICB2bV9zaXplOiBzdHIgPSAiU1RBTkRBUkRfRDJfVjIiLAogICAgbWF4X25vZGVzOiBpbnQgPSAxLAopIC0+IENvbXB1dGVUYXJnZXQ6CiAgICAiIiIKICAgIEluaXRpYWxpemUgQXp1cmUgTUwgY29tcHV0ZSB0YXJnZXQgdG8gcnVuIGV4cGVyaW1lbnQuIENoZWNrcyBmb3IKICAgIGV4aXN0aW5nIGNvbXB1dGUgdGFyZ2V0IGFuZCBjcmVhdGVzIG5ldyBpZiBkb2VzIG5vdCBleGlzdC4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgTUxSdW4gY29udGV4dC4KICAgIDpwYXJhbSBjcHVfY2x1c3Rlcl9uYW1lOiBOYW1lIG9mIEF6dXJlIE1MIGNvbXB1dGUgdGFyZ2V0LiBDcmVhdGVkIGlmIGRvZXMgbm90IGV4aXN0LgogICAgOnBhcmFtIHZtX3NpemU6ICAgICAgICAgIEF6dXJlIG1hY2hpbmUgdHlwZSBmb3IgY29tcHV0ZSB0YXJnZXQuCiAgICA6cGFyYW0gbWF4X25vZGVzOiAgICAgICAgTWF4aW11bSBudW1iZXIgb2YgY29uY3VycmVudCBjb21wdXRlIHRhcmdldHMuCiAgICA6cmV0dXJuczogICAgICAgICAgICAgICAgQXp1cmUgTUwgQ29tcHV0ZSBUYXJnZXQuCiAgICAiIiIKCiAgICB3b3Jrc3BhY2UgPSBfbG9hZF93b3Jrc3BhY2UoY29udGV4dCkKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJJbml0aWFsaXppbmcgQXp1cmVNTCBjb21wdXRlIHRhcmdldCB7Y3B1X2NsdXN0ZXJfbmFtZX0iKQoKICAgICMgVmVyaWZ5IHRoYXQgY2x1c3RlciBkb2VzIG5vdCBleGlzdCBhbHJlYWR5OgogICAgdHJ5OgogICAgICAgIGNvbXB1dGVfdGFyZ2V0ID0gQ29tcHV0ZVRhcmdldCh3b3Jrc3BhY2U9d29ya3NwYWNlLCBuYW1lPWNwdV9jbHVzdGVyX25hbWUpCiAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygiRm91bmQgZXhpc3RpbmcgY2x1c3Rlciwgd2lsbCB1c2UgaXQuIikKICAgIGV4Y2VwdCBDb21wdXRlVGFyZ2V0RXhjZXB0aW9uOgogICAgICAgIGNvbXB1dGVfY29uZmlnID0gQW1sQ29tcHV0ZS5wcm92aXNpb25pbmdfY29uZmlndXJhdGlvbigKICAgICAgICAgICAgdm1fc2l6ZT12bV9zaXplLCBtYXhfbm9kZXM9bWF4X25vZGVzCiAgICAgICAgKQogICAgICAgIGNvbXB1dGVfdGFyZ2V0ID0gQ29tcHV0ZVRhcmdldC5jcmVhdGUoCiAgICAgICAgICAgIHdvcmtzcGFjZSwgY3B1X2NsdXN0ZXJfbmFtZSwgY29tcHV0ZV9jb25maWcKICAgICAgICApCgogICAgY29tcHV0ZV90YXJnZXQud2FpdF9mb3JfY29tcGxldGlvbihzaG93X291dHB1dD1UcnVlKQogICAgcmV0dXJuIGNvbXB1dGVfdGFyZ2V0CgoKZGVmIHJlZ2lzdGVyX2RhdGFzZXQoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIGRhdGFzZXRfbmFtZTogc3RyLAogICAgZGF0YXNldF9kZXNjcmlwdGlvbjogc3RyLAogICAgZGF0YTogRGF0YUl0ZW0sCiAgICBjcmVhdGVfbmV3X3ZlcnNpb246IGJvb2wgPSBGYWxzZSwKKToKICAgICIiIgogICAgUmVnaXN0ZXIgZGF0YXNldCBvYmplY3QgKGNhbiBiZSBhbHNvIGFuIElndWF6aW8gRmVhdHVyZVZlY3RvcikgaW4gQXp1cmUgTUwuCiAgICBVcGxvYWRzIHBhcnF1ZXQgZmlsZSB0byBBenVyZSBibG9iIHN0b3JhZ2UgYW5kIHJlZ2lzdGVycwogICAgdGhhdCBmaWxlIGFzIGEgZGF0YXNldCBpbiBBenVyZSBNTC4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgICAgICBNTFJ1biBjb250ZXh0LgogICAgOnBhcmFtIGRhdGFzZXRfbmFtZTogICAgICAgICAgTmFtZSBvZiBBenVyZSBkYXRhc2V0IHRvIHJlZ2lzdGVyLgogICAgOnBhcmFtIGRhdGFzZXRfZGVzY3JpcHRpb246ICAgRGVzY3JpcHRpb24gb2YgQXp1cmUgZGF0YXNldCB0byByZWdpc3Rlci4KICAgIDpwYXJhbSBkYXRhOiAgICAgICAgICAgICAgICAgIE1MUnVuIEZlYXR1cmVWZWN0b3Igb3IgZGF0YXNldCBvYmplY3QgdG8gdXBsb2FkLgogICAgOnBhcmFtIGNyZWF0ZV9uZXdfdmVyc2lvbjogICAgUmVnaXN0ZXIgQXp1cmUgZGF0YXNldCBhcyBuZXcgdmVyc2lvbi4gTXVzdCBiZSB1c2VkIHdoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmeWluZyBkYXRhc2V0IHNjaGVtYS4KICAgICIiIgoKICAgICMgdGVzdCBmb3IgQXp1cmUgc3RvcmFnZSBjb25uZWN0aW9uIGVudmlyb25tZW50IHZhcmlhYmxlIG9yIHNlY3JldDoKICAgIGFzc2VydCBfZW52X29yX3NlY3JldCgKICAgICAgICBjb250ZXh0LCAiQVpVUkVfU1RPUkFHRV9DT05ORUNUSU9OX1NUUklORyIKICAgICksICJBWlVSRV9TVE9SQUdFX0NPTk5FQ1RJT05fU1RSSU5HIHNlY3JldCBub3Qgc2V0IgoKICAgIGRhdGFfdHlwZSA9IGRhdGEuc3VmZml4CiAgICAjIENvbm5lY3QgdG8gQXp1cmVNTCBleHBlcmltZW50IGFuZCBkYXRhc3RvcmU6CiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCJDb25uZWN0aW5nIHRvIEF6dXJlTUwgZXhwZXJpbWVudCBkZWZhdWx0IGRhdGFzdG9yZSIpCgogICAgd29ya3NwYWNlID0gX2xvYWRfd29ya3NwYWNlKGNvbnRleHQpCiAgICBkYXRhc3RvcmUgPSB3b3Jrc3BhY2UuZ2V0X2RlZmF1bHRfZGF0YXN0b3JlKCkKCiAgICAjIEF6dXJlIGJsb2IgcGF0aCAoZGVmYXVsdCBkYXRhc3RvcmUgZm9yIHdvcmtzcGFjZSk6CiAgICBibG9iX3BhdGggPSBmImF6Oi8ve2RhdGFzdG9yZS5jb250YWluZXJfbmFtZX0ve2RhdGFzZXRfbmFtZX17ZGF0YV90eXBlfSIKCiAgICAjIFJldHJpZXZlIGRhdGEgc291cmNlIGFzIGRhdGFmcmFtZToKICAgIGlmIGRhdGEubWV0YSBhbmQgZGF0YS5tZXRhLmtpbmQgPT0gT2JqZWN0S2luZC5mZWF0dXJlX3ZlY3RvcjoKICAgICAgICAjIEZlYXR1cmVWZWN0b3IgY2FzZToKICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKAogICAgICAgICAgICBmIlJldHJpZXZpbmcgZmVhdHVyZSB2ZWN0b3IgYW5kIHVwbG9hZGluZyB0byBBenVyZSBibG9iIHN0b3JhZ2U6IHtibG9iX3BhdGh9IgogICAgICAgICkKICAgICAgICBmX3N0b3JlLmdldF9vZmZsaW5lX2ZlYXR1cmVzKGRhdGEubWV0YS51cmkpLnRvX3BhcnF1ZXQoYmxvYl9wYXRoKQogICAgZWxzZToKICAgICAgICAjIERhdGFJdGVtIGNhc2U6CiAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygKICAgICAgICAgICAgZiJSZXRyaWV2aW5nIGZlYXR1cmUgdmVjdG9yIGFuZCB1cGxvYWRpbmcgdG8gQXp1cmUgYmxvYiBzdG9yYWdlOiB7YmxvYl9wYXRofSIKICAgICAgICApCiAgICAgICAgZGF0YV9pbl9ieXRlcyA9IGRhdGEuZ2V0KCkKICAgICAgICBnZXRfZGF0YWl0ZW0oYmxvYl9wYXRoKS5wdXQoZGF0YV9pbl9ieXRlcykKCiAgICAjIFJlZ2lzdGVyIGRhdGFzZXQgaW4gQXp1cmVNTDoKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJSZWdpc3RlcmluZyBkYXRhc2V0IHtkYXRhc2V0X25hbWV9IGluIEF6dXJlIE1MIikKICAgIGlmIGRhdGFfdHlwZSA9PSAiLnBhcnF1ZXQiOgogICAgICAgIGRhdGFzZXQgPSBEYXRhc2V0LlRhYnVsYXIuZnJvbV9wYXJxdWV0X2ZpbGVzKAogICAgICAgICAgICBwYXRoPShkYXRhc3RvcmUsIGYie2RhdGFzZXRfbmFtZX0ucGFycXVldCIpLCB2YWxpZGF0ZT1GYWxzZQogICAgICAgICkKICAgIGVsc2U6CiAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygKICAgICAgICAgICAgZiJPcGVuU1NMIHZlcnNpb24gbXVzdCBiZSAxLjEuIE92ZXJyaWRpbmcgdGhlIE9wZW5TU0wgdmVyc2lvbiB0byAxLjEiCiAgICAgICAgKQogICAgICAgICMgT3BlblNTTCB2ZXJzaW9uIG11c3QgYmUgMS4xCiAgICAgICAgb3MuZW52aXJvblsiQ0xSX09QRU5TU0xfVkVSU0lPTl9PVkVSUklERSJdID0gIjEuMSIKICAgICAgICBkYXRhc2V0ID0gRGF0YXNldC5UYWJ1bGFyLmZyb21fZGVsaW1pdGVkX2ZpbGVzKAogICAgICAgICAgICBwYXRoPShkYXRhc3RvcmUsIGYie2RhdGFzZXRfbmFtZX17ZGF0YV90eXBlfSIpLCB2YWxpZGF0ZT1GYWxzZQogICAgICAgICkKCiAgICBkYXRhc2V0LnJlZ2lzdGVyKAogICAgICAgIHdvcmtzcGFjZT13b3Jrc3BhY2UsCiAgICAgICAgbmFtZT1kYXRhc2V0X25hbWUsCiAgICAgICAgZGVzY3JpcHRpb249ZGF0YXNldF9kZXNjcmlwdGlvbiwKICAgICAgICBjcmVhdGVfbmV3X3ZlcnNpb249Y3JlYXRlX25ld192ZXJzaW9uLAogICAgKQoKICAgICMgT3V0cHV0IHJlZ2lzdGVyZWQgZGF0YXNldCBuYW1lIGluIEF6dXJlOgogICAgY29udGV4dC5sb2dfcmVzdWx0KCJkYXRhc2V0X2Jsb2JfcGF0aCIsIGJsb2JfcGF0aCkKCgpkZWYgZG93bmxvYWRfbW9kZWwoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIG1vZGVsX25hbWU6IHN0ciwKICAgIG1vZGVsX3ZlcnNpb246IGludCwKICAgIHRhcmdldF9kaXI6IHN0ciA9ICIuIiwKKSAtPiBOb25lOgogICAgIiIiCiAgICBEb3dubG9hZCB0cmFpbmVkIG1vZGVsIGZyb20gQXp1cmUgTUwgdG8gbG9jYWwgZmlsZXN5c3RlbS4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgTUxSdW4gY29udGV4dC4KICAgIDpwYXJhbSBtb2RlbF9uYW1lOiAgICBOYW1lIG9mIHRyYWluZWQgYW5kIHJlZ2lzdGVyZWQgbW9kZWwuCiAgICA6cGFyYW0gbW9kZWxfdmVyc2lvbjogVmVyc2lvbiBvZiBtb2RlbCB0byBkb3dubG9hZC4KICAgIDpwYXJhbSB0YXJnZXRfZGlyOiAgICBUYXJnZXQgZGlyZWN0b3J5IHRvIGRvd25sb2FkIG1vZGVsLgogICAgIiIiCiAgICAjIExvYWRpbmcgd29ya3NwYWNlIGlmIG5vdCBwcm92aWRlZDoKICAgIHdvcmtzcGFjZSA9IF9sb2FkX3dvcmtzcGFjZShjb250ZXh0KQogICAgY29udGV4dC5sb2dnZXIuaW5mbyhmIkRvd25sb2FkaW5nIG1vZGVsIHttb2RlbF9uYW1lfTp7bW9kZWxfdmVyc2lvbn0iKQogICAgbW9kZWwgPSBNb2RlbCh3b3Jrc3BhY2UsIG1vZGVsX25hbWUsIHZlcnNpb249bW9kZWxfdmVyc2lvbikKICAgIG1vZGVsLmRvd25sb2FkKHRhcmdldF9kaXI9dGFyZ2V0X2RpciwgZXhpc3Rfb2s9VHJ1ZSkKCgpkZWYgdXBsb2FkX21vZGVsKAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBtb2RlbF9uYW1lOiBzdHIsCiAgICBtb2RlbF9wYXRoOiBzdHIsCiAgICBtb2RlbF9kZXNjcmlwdGlvbjogc3RyID0gTm9uZSwKICAgIG1vZGVsX3RhZ3M6IGRpY3QgPSBOb25lLAopIC0+IE5vbmU6CiAgICAiIiIKICAgIFVwbG9hZCBwcmUtdHJhaW5lZCBtb2RlbCBmcm9tIGxvY2FsIGZpbGVzeXN0ZW0gdG8gQXp1cmUgTUwuCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgIE1MUnVuIGNvbnRleHQuCiAgICA6cGFyYW0gbW9kZWxfbmFtZTogICAgICAgIE5hbWUgb2YgdHJhaW5lZCBhbmQgcmVnaXN0ZXJlZCBtb2RlbC4KICAgIDpwYXJhbSBtb2RlbF9wYXRoOiAgICAgICAgUGF0aCB0byBmaWxlIG9uIGxvY2FsIGZpbGVzeXN0ZW0uCiAgICA6cGFyYW0gbW9kZWxfZGVzY3JpcHRpb246IERlc2NyaXB0aW9uIG9mIG1vZGVscy4KICAgIDpwYXJhbSBtb2RlbF90YWdzOiAgICAgICAgS1YgcGFpcnMgb2YgbW9kZWwgdGFncy4KICAgICIiIgogICAgIyBMb2FkaW5nIHdvcmtzcGFjZSBpZiBub3QgcHJvdmlkZWQ6CiAgICB3b3Jrc3BhY2UgPSBfbG9hZF93b3Jrc3BhY2UoY29udGV4dCkKCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYiVXBsb2FkIG1vZGVsIHttb2RlbF9uYW1lfSBmcm9tIHttb2RlbF9wYXRofSIpCiAgICBNb2RlbC5yZWdpc3RlcigKICAgICAgICB3b3Jrc3BhY2U9d29ya3NwYWNlLAogICAgICAgIG1vZGVsX3BhdGg9bW9kZWxfcGF0aCwKICAgICAgICBtb2RlbF9uYW1lPW1vZGVsX25hbWUsCiAgICAgICAgZGVzY3JpcHRpb249bW9kZWxfZGVzY3JpcHRpb24sCiAgICAgICAgdGFncz1tb2RlbF90YWdzLAogICAgKQoKCmRlZiBfZ2V0X3RvcF9uX3J1bnMoCiAgICByZW1vdGVfcnVuOiBBdXRvTUxSdW4sIG46IGludCA9IDUsIHByaW1hcnlfbWV0cmljOiBzdHIgPSAiYWNjdXJhY3kiCikgLT4gTGlzdFtTY3JpcHRSdW5dOgogICAgIiIiCiAgICBHZXQgdG9wIE4gY29tcGxldGUgcnVucyBmcm9tIGV4cGVyaW1lbnQgc29ydGVkIGJ5IHByaW1hcnkgbWV0cmljLgoKICAgIDpwYXJhbSByZW1vdGVfcnVuOiAgICAgQXp1cmUgTUwgUnVuLgogICAgOnBhcmFtIG46ICAgICAgICAgICAgICBOdW1iZXIgb2YgdG9wIHJ1bnMgdG8gcmV0dXJuLgogICAgOnBhcmFtIHByaW1hcnlfbWV0cmljOiBNZXRyaWMgdG8gc29ydCBieS4KCiAgICA6cmV0dXJuczogICAgICAgICAgICAgIExpc3Qgb2YgdG9wIE4gcnVucyBzb3J0ZWQgYnkgcHJpbWFyeSBtZXRyaWMuCiAgICAiIiIKICAgICMgQ29sbGVjdCBhbGwgbW9kZWxzOgogICAgY29tcGxldGVfcnVucyA9IFsKICAgICAgICBydW4KICAgICAgICBmb3IgcnVuIGluIHJlbW90ZV9ydW4uZ2V0X2NoaWxkcmVuKHN0YXR1cz0iQ29tcGxldGVkIikKICAgICAgICBpZiBub3QgYW55KHMgaW4gcnVuLmlkIGZvciBzIGluIFsic2V0dXAiLCAid29ya2VyIl0pCiAgICBdCgogICAgIyBDaGVja2luZyB0aGF0IHRoZSByZXF1aXJlZCBudW1iZXIgb2YgcnVucyBhcmUgZG9uZToKICAgIGlmIGxlbihjb21wbGV0ZV9ydW5zKSA8IG46CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmIkV4cGVjdGVkIHtufSBydW5zIGJ1dCBvbmx5IHJlY2VpdmVkIHtsZW4oY29tcGxldGVfcnVucyl9IikKCiAgICAjIFNvcnRpbmcgYnkgdGhlIHByaW1hcnkgbWV0cmljOgogICAgc29ydGVkX3J1bnMgPSBzb3J0ZWQoCiAgICAgICAgY29tcGxldGVfcnVucywga2V5PWxhbWJkYSBydW46IHJ1bi5nZXRfbWV0cmljcygpW3ByaW1hcnlfbWV0cmljXSwgcmV2ZXJzZT1UcnVlCiAgICApCiAgICByZXR1cm4gc29ydGVkX3J1bnNbOm5dCgoKZGVmIF9nZXRfbW9kZWxfaHAoCiAgICBydW46IFNjcmlwdFJ1biwKKSAtPiBkaWN0OgogICAgIiIiCiAgICBHZXQgaHlwZXItcGFyYW1ldGVycyBvZiB0cmFpbmVkIEF6dXJlTUwgbW9kZWwuCiAgICBDb21iaW5lIHRoZSBoeXBlci1wYXJhbWV0ZXJzIG9mIHRoZSBkYXRhIHRyYW5zZm9ybWF0aW9uIGFuZCB0cmFpbmluZyB0byBhIGRpY3Rpb25hcnkuCiAgICBUaGUgcHJlZml4IG9mIHRoZSBkaWN0aW9uYXJ5IGtleXMgY29ycmVzcG9uZHMgdG8gJ2RhdGEgdHJhbnNmb3JtYXRpb24nIGFuZCAndHJhaW5pbmcnLgoKICAgIDpwYXJhbSBydW46IFJ1biBvYmplY3Qgb2YgQXp1cmVNTCB0cmFpbmVkIG1vZGVsLgoKICAgIDpyZXR1cm5zOiAgICBBIGRpY3Rpb25hcnkgYXMgZGVzY3JpYmVkIGluIHRoZSBkb2NzdHJpbmcuCiAgICAiIiIKCiAgICBzcGVjX2ZpZWxkID0gInBpcGVsaW5lX3NwZWMiCiAgICBpZiBzcGVjX2ZpZWxkIG5vdCBpbiBydW4ucHJvcGVydGllczoKICAgICAgICByZXR1cm4ge30KICAgIHNwZWNfc3RyaW5nID0gcnVuLnByb3BlcnRpZXNbc3BlY19maWVsZF0KICAgIHNwZWNfZGljdCA9IGpzb24ubG9hZHMoc3BlY19zdHJpbmcpCgogICAgaWYgIm9iamVjdHMiIG5vdCBpbiBzcGVjX2RpY3Q6CiAgICAgICAgIyBObyBoeXBlci1wYXJhbXMKICAgICAgICByZXR1cm4ge30KICAgIGhwX2RpY3RzID0gc3BlY19kaWN0WyJvYmplY3RzIl0KICAgICMgYWZ0ZXIgdHJhaW5pbmcgdGhlcmUgYXJlIHR3byBoeXBlci1wYXJhbWV0ZXJzIGRpY3RzIGluc2lkZSB0aGUgcnVuIG9iamVjdDoKICAgIGFzc2VydCAoCiAgICAgICAgbGVuKGhwX2RpY3RzKSA9PSAyCiAgICApLCAiYWZ0ZXIgdHJhaW5pbmcgdGhlcmUgYXJlIHR3byBoeXBlci1wYXJhbWV0ZXJzIGRpY3RzIGluc2lkZSB0aGUgcnVuIG9iamVjdCIKICAgIHJlc3VsdF9kaWN0ID0ge30KICAgIGRpY3Rfa2V5cyA9IFsKICAgICAgICBbImRhdGFfdHJhbnNfY2xhc3NfbmFtZSIsICJkYXRhX3RyYW5zX21vZHVsZSIsICJkYXRhX3RyYW5zX3NwZWNfY2xhc3MiXSwKICAgICAgICBbCiAgICAgICAgICAgICJ0cmFpbl9jbGFzc19uYW1lIiwKICAgICAgICAgICAgInRyYWluX21vZHVsZSIsCiAgICAgICAgICAgICJ0cmFpbl9wYXJhbV9rd2FyZ3NfQyIsCiAgICAgICAgICAgICJ0cmFpbl9wYXJhbV9rd2FyZ3NfY2xhc3Nfd2VpZ2h0IiwKICAgICAgICAgICAgInRyYWluX3NwZWNfY2xhc3MiLAogICAgICAgIF0sCiAgICBdCgogICAgIyBjcmVhdGluZyBoeXBlci1wYXJhbXMgZGljdCB3aXRoIGtleSBwcmVmaXhlcyBmb3IgZWFjaCBwYXJ0OgogICAga3dhcmdzX3ByZWZpeCA9ICJwYXJhbV9rd2FyZ3MiCiAgICBmb3IgZCwgbmFtZSwga2V5cyBpbiB6aXAoaHBfZGljdHMsIFsiZGF0YV90cmFucyIsICJ0cmFpbiJdLCBkaWN0X2tleXMpOgogICAgICAgIGZvciBrZXkgaW4ga2V5czoKCiAgICAgICAgICAgIGlmIGt3YXJnc19wcmVmaXggaW4ga2V5OgogICAgICAgICAgICAgICAgcmVzdWx0X2RpY3Rba2V5XSA9IGRba3dhcmdzX3ByZWZpeF1bCiAgICAgICAgICAgICAgICAgICAga2V5LnJlcGxhY2UoZiJ7bmFtZX1fe2t3YXJnc19wcmVmaXh9XyIsICIiKQogICAgICAgICAgICAgICAgXQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmVzdWx0X2RpY3Rba2V5XSA9IGRba2V5LnJlcGxhY2UoZiJ7bmFtZX1fIiwgIiIpXQogICAgICAgICAgICBpZiBub3QgcmVzdWx0X2RpY3Rba2V5XToKICAgICAgICAgICAgICAgIHJlc3VsdF9kaWN0W2tleV0gPSAnJwoKICAgIHJldHVybiByZXN1bHRfZGljdAoKCmRlZiBzdWJtaXRfdHJhaW5pbmdfam9iKAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBleHBlcmltZW50OiBFeHBlcmltZW50LAogICAgY29tcHV0ZV90YXJnZXQ6IENvbXB1dGVUYXJnZXQsCiAgICByZWdpc3Rlcl9tb2RlbF9uYW1lOiBzdHIsCiAgICByZWdpc3RlcmVkX2RhdGFzZXRfbmFtZTogc3RyLAogICAgbGFiZWxfY29sdW1uX25hbWU6IHN0ciwKICAgIGF1dG9tbF9zZXR0aW5nczogZGljdCwKICAgIHRyYWluaW5nX3NldDogRGF0YUl0ZW0sCiAgICBzYXZlX25fbW9kZWxzOiBpbnQgPSAzLAogICAgc2hvd19vdXRwdXQ6IGJvb2wgPSBUcnVlLAopIC0+IE5vbmU6CiAgICAiIiIKICAgIFN1Ym1pdCB0cmFpbmluZyBqb2IgdG8gQXp1cmUgQXV0b01MIGFuZCBkb3dubG9hZCB0cmFpbmVkIG1vZGVsCiAgICB3aGVuIGNvbXBsZXRlZC4gVXNlcyBwcmV2aW91c2x5IHJlZ2lzdGVyZWQgZGF0YXNldCBmb3IgdHJhaW5pbmcuCgogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgICAgICAgICBNTFJ1biBjb250ZXh0LgogICAgOnBhcmFtIGV4cGVyaW1lbnQ6ICAgICAgICAgICAgICBBenVyZSBleHBlcmltZW50LgogICAgOnBhcmFtIGNvbXB1dGVfdGFyZ2V0OiAgICAgICAgICBBenVyZSBjb21wdXRlIHRhcmdldC4KICAgIDpwYXJhbSByZWdpc3Rlcl9tb2RlbF9uYW1lOiAgICAgTmFtZSBvZiBtb2RlbCB0byByZWdpc3RlciBpbiBBenVyZS4KICAgIDpwYXJhbSByZWdpc3RlcmVkX2RhdGFzZXRfbmFtZTogTmFtZSBvZiBkYXRhc2V0IHJlZ2lzdGVyZWQgaW4gQXp1cmUgTUwuCiAgICA6cGFyYW0gbGFiZWxfY29sdW1uX25hbWU6ICAgICAgIE5hbWUgb2YgdGFyZ2V0IGNvbHVtbiBpbiBkYXRhc2V0LgogICAgOnBhcmFtIGF1dG9tbF9zZXR0aW5nczogICAgICAgICBKU09OIHN0cmluZyBvZiBhbGwgQXp1cmUgQXV0b01MIHNldHRpbmdzLgogICAgOnBhcmFtIHRyYWluaW5nX3NldDogICAgICAgICAgICBUcmFpbmluZyBzZXQgdG8gbG9nIHdpdGggbW9kZWwuIEZvciBtb2RlbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb25pdG9yaW5nIGludGVncmF0aW9uLgogICAgOnBhcmFtIHNob3dfb3V0cHV0OiAgICAgICAgICAgICBEaXNwbGF5aW5nIEF6dXJlIGxvZ3MuCiAgICA6cGFyYW0gc2F2ZV9uX21vZGVsczogICAgICAgICAgIEhvdyBtYW55IG9mIHRoZSB0b3AgcGVyZm9ybWluZyBtb2RlbHMgdG8gbG9nLgogICAgIiIiCiAgICAjIExvYWRpbmcgd29ya3NwYWNlIGlmIG5vdCBwcm92aWRlZDoKICAgIHdvcmtzcGFjZSA9IF9sb2FkX3dvcmtzcGFjZShjb250ZXh0KQoKICAgICMgU2V0dXAgZXhwZXJpbWVudDoKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIlNldHRpbmcgdXAgZXhwZXJpbWVudCBwYXJhbWV0ZXJzIikKICAgIGRhdGFzZXQgPSBEYXRhc2V0LmdldF9ieV9uYW1lKHdvcmtzcGFjZSwgbmFtZT1yZWdpc3RlcmVkX2RhdGFzZXRfbmFtZSkKCiAgICBhdXRvbWxfY29uZmlnID0gQXV0b01MQ29uZmlnKAogICAgICAgIGNvbXB1dGVfdGFyZ2V0PWNvbXB1dGVfdGFyZ2V0LAogICAgICAgIHRyYWluaW5nX2RhdGE9ZGF0YXNldCwKICAgICAgICB2ZXJib3NpdHk9bG9nZ2luZy5JTkZPLAogICAgICAgIGxhYmVsX2NvbHVtbl9uYW1lPWxhYmVsX2NvbHVtbl9uYW1lLAogICAgICAgICoqYXV0b21sX3NldHRpbmdzLAogICAgKQoKICAgICMgUnVuIGV4cGVyaW1lbnQgb24gQXp1cmVNTDoKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIlN1Ym1pdHRpbmcgYW5kIHJ1bm5pbmcgZXhwZXJpbWVudCIpCiAgICByZW1vdGVfcnVuID0gZXhwZXJpbWVudC5zdWJtaXQoYXV0b21sX2NvbmZpZywgc2hvd19vdXRwdXQ9c2hvd19vdXRwdXQpCiAgICByZW1vdGVfcnVuLndhaXRfZm9yX2NvbXBsZXRpb24oc2hvd19vdXRwdXQ9c2hvd19vdXRwdXQpCgogICAgIyBHZXQgdG9wIE4gcnVucyB0byBsb2c6CiAgICB0b3BfcnVucyA9IF9nZXRfdG9wX25fcnVucygKICAgICAgICByZW1vdGVfcnVuPXJlbW90ZV9ydW4sCiAgICAgICAgbj1zYXZlX25fbW9kZWxzLAogICAgICAgIHByaW1hcnlfbWV0cmljPWF1dG9tbF9zZXR0aW5nc1sicHJpbWFyeV9tZXRyaWMiXSwKICAgICkKCiAgICAjIEdldCB0cmFpbmluZyBzZXQgdG8gbG9nIHdpdGggbW9kZWw6CiAgICBmZWF0dXJlX3ZlY3RvciA9IE5vbmUKICAgIGlmIHRyYWluaW5nX3NldC5tZXRhIGFuZCB0cmFpbmluZ19zZXQubWV0YS5raW5kID09IE9iamVjdEtpbmQuZmVhdHVyZV92ZWN0b3I6CiAgICAgICAgZmVhdHVyZV92ZWN0b3IgPSB0cmFpbmluZ19zZXQubWV0YS51cmkKICAgIHRyYWluaW5nX3NldCA9IHRyYWluaW5nX3NldC5hc19kZigpCgogICAgIyBSZWdpc3RlciwgZG93bmxvYWQsIGFuZCBsb2cgbW9kZWxzOgogICAgZm9yIGksIHJ1biBpbiBlbnVtZXJhdGUodG9wX3J1bnMpOgogICAgICAgICMgUmVnaXN0ZXIgbW9kZWw6CiAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygiUmVnaXN0ZXJpbmcgbW9kZWwiKQogICAgICAgIG1vZGVsID0gcnVuLnJlZ2lzdGVyX21vZGVsKAogICAgICAgICAgICBtb2RlbF9uYW1lPXJlZ2lzdGVyX21vZGVsX25hbWUsIG1vZGVsX3BhdGg9Im91dHB1dHMvbW9kZWwucGtsIgogICAgICAgICkKICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKAogICAgICAgICAgICBmIlJlZ2lzdGVyZWQgbW9kZWwgd2l0aCBuYW1lICd7bW9kZWwubmFtZX0nLCBpZCAne21vZGVsLmlkfScsIHZlcnNpb24gJ3ttb2RlbC52ZXJzaW9ufSciCiAgICAgICAgKQoKICAgICAgICAjIERvd25sb2FkIG1vZGVsIGxvY2FsbHk6CiAgICAgICAgZG93bmxvYWRfbW9kZWwoCiAgICAgICAgICAgIGNvbnRleHQ9Y29udGV4dCwKICAgICAgICAgICAgbW9kZWxfbmFtZT1yZWdpc3Rlcl9tb2RlbF9uYW1lLAogICAgICAgICAgICBtb2RlbF92ZXJzaW9uPW1vZGVsLnZlcnNpb24sCiAgICAgICAgICAgIHRhcmdldF9kaXI9ZiIuL3ttb2RlbC52ZXJzaW9ufSIsCiAgICAgICAgKQoKICAgICAgICBtZXRyaWNzID0ge2subG93ZXIoKTogdmFsIGZvciBrLCB2YWwgaW4gcnVuLmdldF9tZXRyaWNzKCkuaXRlbXMoKX0KICAgICAgICBkZWwgbWV0cmljc1siY29uZnVzaW9uX21hdHJpeCJdCiAgICAgICAgZGVsIG1ldHJpY3NbImFjY3VyYWN5X3RhYmxlIl0KCiAgICAgICAgIyBDb2xsZWN0IG1vZGVsIGh5cGVyLXBhcmFtZXRlcnM6CiAgICAgICAgbW9kZWxfaHBfZGljdCA9IF9nZXRfbW9kZWxfaHAocnVuKQogICAgICAgIHdpdGggY29udGV4dC5nZXRfY2hpbGRfY29udGV4dCgqKm1vZGVsX2hwX2RpY3QpIGFzIGNoaWxkOgogICAgICAgICAgICAjIExvZyBtb2RlbDoKICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygKICAgICAgICAgICAgICAgIGYiTG9nZ2luZyB7bW9kZWxfaHBfZGljdFsndHJhaW5fY2xhc3NfbmFtZSddfSBtb2RlbCB0byBNTFJ1biIKICAgICAgICAgICAgKQogICAgICAgICAgICBjaGlsZC5sb2dfcmVzdWx0cyhtZXRyaWNzKQogICAgICAgICAgICBjaGlsZC5sb2dfbW9kZWwoCiAgICAgICAgICAgICAgICAibW9kZWwiLAogICAgICAgICAgICAgICAgZGJfa2V5PWYibW9kZWxfe2l9X3ttb2RlbF9ocF9kaWN0Wyd0cmFpbl9jbGFzc19uYW1lJ10ubG93ZXIoKX0iLAogICAgICAgICAgICAgICAgYXJ0aWZhY3RfcGF0aD1jb250ZXh0LmFydGlmYWN0X3N1YnBhdGgoIm1vZGVscyIpLAogICAgICAgICAgICAgICAgbWV0cmljcz1tZXRyaWNzLAogICAgICAgICAgICAgICAgbW9kZWxfZmlsZT1mInttb2RlbC52ZXJzaW9ufS9tb2RlbC5wa2wiLAogICAgICAgICAgICAgICAgdHJhaW5pbmdfc2V0PXRyYWluaW5nX3NldCwKICAgICAgICAgICAgICAgIGxhYmVsX2NvbHVtbj1sYWJlbF9jb2x1bW5fbmFtZSwKICAgICAgICAgICAgICAgIGZlYXR1cmVfdmVjdG9yPWZlYXR1cmVfdmVjdG9yLAogICAgICAgICAgICAgICAgZnJhbWV3b3JrPSJBenVyZU1MIiwKICAgICAgICAgICAgICAgIGFsZ29yaXRobT1tb2RlbF9ocF9kaWN0LmdldCgidHJhaW5fY2xhc3NfbmFtZSIpLAogICAgICAgICAgICApCiAgICAgICAgICAgIGlmIGkgPT0gMDoKICAgICAgICAgICAgICAgIGNoaWxkLm1hcmtfYXNfYmVzdCgpCgogICAgICAgICAgICBjb250ZXh0LmxvZ19tb2RlbCgKICAgICAgICAgICAgICAgIGYibW9kZWxfe2l9IiwKICAgICAgICAgICAgICAgIGRiX2tleT1mIm1vZGVsX3tpfV97bW9kZWxfaHBfZGljdFsndHJhaW5fY2xhc3NfbmFtZSddLmxvd2VyKCl9IiwKICAgICAgICAgICAgICAgIGFydGlmYWN0X3BhdGg9Y29udGV4dC5hcnRpZmFjdF9zdWJwYXRoKCJtb2RlbHMiKSwKICAgICAgICAgICAgICAgIG1ldHJpY3M9bWV0cmljcywKICAgICAgICAgICAgICAgIG1vZGVsX2ZpbGU9ZiJ7bW9kZWwudmVyc2lvbn0vbW9kZWwucGtsIiwKICAgICAgICAgICAgICAgIHRyYWluaW5nX3NldD10cmFpbmluZ19zZXQsCiAgICAgICAgICAgICAgICBsYWJlbF9jb2x1bW49bGFiZWxfY29sdW1uX25hbWUsCiAgICAgICAgICAgICAgICBmZWF0dXJlX3ZlY3Rvcj1mZWF0dXJlX3ZlY3RvciwKICAgICAgICAgICAgICAgIGZyYW1ld29yaz0iQXp1cmVNTCIsCiAgICAgICAgICAgICAgICBhbGdvcml0aG09bW9kZWxfaHBfZGljdC5nZXQoInRyYWluX2NsYXNzX25hbWUiKSwpCgoKZGVmIGF1dG9tbF90cmFpbigKICAgICMgTWxSdW4KICAgIGNvbnRleHQ6IE1MQ2xpZW50Q3R4LAogICAgdHJhaW5pbmdfZGF0YTogRGF0YUl0ZW0sCiAgICAjIEluaXQgZXhwZXJpbWVudCBhbmQgY29tcHV0ZQogICAgZXhwZXJpbWVudF9uYW1lOiBzdHIgPSAiIiwKICAgIGNwdV9jbHVzdGVyX25hbWU6IHN0ciA9ICIiLAogICAgdm1fc2l6ZTogc3RyID0gIlNUQU5EQVJEX0QyX1YyIiwKICAgIG1heF9ub2RlczogaW50ID0gMSwKICAgICMgUmVnaXN0ZXIgZGF0YXNldAogICAgZGF0YXNldF9uYW1lOiBzdHIgPSAiIiwKICAgIGRhdGFzZXRfZGVzY3JpcHRpb246IHN0ciA9ICIiLAogICAgY3JlYXRlX25ld192ZXJzaW9uOiBib29sID0gRmFsc2UsCiAgICBsYWJlbF9jb2x1bW5fbmFtZTogc3RyID0gIiIsCiAgICAjIFN1Ym1pdCB0cmFpbmluZyBqb2IKICAgIHJlZ2lzdGVyX21vZGVsX25hbWU6IHN0ciA9ICIiLAogICAgc2F2ZV9uX21vZGVsczogaW50ID0gMSwKICAgIGxvZ19henVyZTogYm9vbCA9IFRydWUsCiAgICBhdXRvbWxfc2V0dGluZ3M6IHN0ciA9IE5vbmUsCikgLT4gTm9uZToKICAgICIiIgogICAgV2hvbGUgdHJhaW5pbmcgZmxvdyBmb3IgQXp1cmUgQXV0b01MLiBSZWdpc3RlcnMgZGF0YXNldC9mZWF0dXJlIHZlY3RvciwKICAgIHN1Ym1pdHMgdHJhaW5pbmcgam9iIHRvIEF6dXJlIEF1dG9NTCwgYW5kIGRvd25sb2FkcyB0cmFpbmVkIG1vZGVsCiAgICB3aGVuIGNvbXBsZXRlZC4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgICAgICBNTFJ1biBjb250ZXh0LgoKICAgIDpwYXJhbSBleHBlcmltZW50X25hbWU6ICAgICAgIE5hbWUgb2YgZXhwZXJpbWVudCB0byBjcmVhdGUgaW4gQXp1cmUgTUwuCiAgICA6cGFyYW0gY3B1X2NsdXN0ZXJfbmFtZTogICAgICBOYW1lIG9mIEF6dXJlIE1MIGNvbXB1dGUgdGFyZ2V0LiBDcmVhdGVkIGlmIGRvZXMgbm90IGV4aXN0LgogICAgOnBhcmFtIHZtX3NpemU6ICAgICAgICAgICAgICAgQXp1cmUgbWFjaGluZSB0eXBlIGZvciBjb21wdXRlIHRhcmdldC4KICAgIDpwYXJhbSBtYXhfbm9kZXM6ICAgICAgICAgICAgIE1heGltdW0gbnVtYmVyIG9mIGNvbmN1cnJlbnQgY29tcHV0ZSB0YXJnZXRzLgoKICAgIDpwYXJhbSBkYXRhc2V0X25hbWU6ICAgICAgICAgIE5hbWUgb2YgQXp1cmUgZGF0YXNldCB0byByZWdpc3Rlci4KICAgIDpwYXJhbSBkYXRhc2V0X2Rlc2NyaXB0aW9uOiAgIERlc2NyaXB0aW9uIG9mIEF6dXJlIGRhdGFzZXQgdG8gcmVnaXN0ZXIuCiAgICA6cGFyYW0gdHJhaW5pbmdfZGF0YTogICAgICAgICBNTFJ1biBGZWF0dXJlVmVjdG9yIG9yIGRhdGFzZXQgVVJJIHRvIHVwbG9hZC4gV2lsbCBkcm9wCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCBiZWZvcmUgdXBsb2FkaW5nIHdoZW4gaXQgaXMgYSBGZWF0dXJlVmVjdG9yLgogICAgOnBhcmFtIGNyZWF0ZV9uZXdfdmVyc2lvbjogICAgUmVnaXN0ZXIgQXp1cmUgZGF0YXNldCBhcyBuZXcgdmVyc2lvbi4gTXVzdCBiZSB1c2VkIHdoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmeWluZyBkYXRhc2V0IHNjaGVtYS4KICAgIDpwYXJhbSBsYWJlbF9jb2x1bW5fbmFtZTogICAgIFRhcmdldCBjb2x1bW4gaW4gZGF0YXNldC4KCiAgICA6cGFyYW0gcmVnaXN0ZXJfbW9kZWxfbmFtZTogICBOYW1lIG9mIG1vZGVsIHRvIHJlZ2lzdGVyIGluIEF6dXJlLgogICAgOnBhcmFtIHNhdmVfbl9tb2RlbHM6ICAgICAgICAgSG93IG1hbnkgb2YgdGhlIHRvcCBwZXJmb3JtaW5nIG1vZGVscyB0byBsb2cuCiAgICA6cGFyYW0gbG9nX2F6dXJlOiAgICAgICAgICAgICBEaXNwbGF5aW5nIEF6dXJlIGxvZ3MuCiAgICA6cGFyYW0gYXV0b21sX3NldHRpbmdzOiAgICAgICBKU09OIHN0cmluZyBvZiBhbGwgQXp1cmUgQXV0b01MIHNldHRpbmdzLgogICAgIiIiCiAgICBpZiBub3QgYXV0b21sX3NldHRpbmdzOgogICAgICAgIGF1dG9tbF9zZXR0aW5ncyA9IHsKICAgICAgICAgICAgInRhc2siOiAiY2xhc3NpZmljYXRpb24iLAogICAgICAgICAgICAiZGVidWdfbG9nIjogImF1dG9tbF9lcnJvcnMubG9nIiwKICAgICAgICAgICAgIyAiZXhwZXJpbWVudF9leGl0X3Njb3JlIjogMC45LAogICAgICAgICAgICAiZW5hYmxlX2Vhcmx5X3N0b3BwaW5nIjogRmFsc2UsCiAgICAgICAgICAgICJhbGxvd2VkX21vZGVscyI6IFsiTG9naXN0aWNSZWdyZXNzaW9uIiwgIlNHRCIsICJTVk0iXSwKICAgICAgICAgICAgIml0ZXJhdGlvbnMiOiAzLAogICAgICAgICAgICAiaXRlcmF0aW9uX3RpbWVvdXRfbWludXRlcyI6IDIsCiAgICAgICAgICAgICJtYXhfY29uY3VycmVudF9pdGVyYXRpb25zIjogMiwKICAgICAgICAgICAgIm1heF9jb3Jlc19wZXJfaXRlcmF0aW9uIjogLTEsCiAgICAgICAgICAgICJuX2Nyb3NzX3ZhbGlkYXRpb25zIjogNSwKICAgICAgICAgICAgInByaW1hcnlfbWV0cmljIjogImFjY3VyYWN5IiwKICAgICAgICAgICAgImZlYXR1cml6YXRpb24iOiAib2ZmIiwKICAgICAgICAgICAgIm1vZGVsX2V4cGxhaW5hYmlsaXR5IjogRmFsc2UsCiAgICAgICAgICAgICJlbmFibGVfdm90aW5nX2Vuc2VtYmxlIjogRmFsc2UsCiAgICAgICAgICAgICJlbmFibGVfc3RhY2tfZW5zZW1ibGUiOiBGYWxzZSwKICAgICAgICB9CgogICAgIyBJbml0IGV4cGVyaW1lbnQgYW5kIGNvbXB1dGUKICAgIHdvcmtzcGFjZSwgZXhwZXJpbWVudCA9IF9pbml0X2V4cGVyaW1lbnQoCiAgICAgICAgY29udGV4dD1jb250ZXh0LCBleHBlcmltZW50X25hbWU9ZXhwZXJpbWVudF9uYW1lCiAgICApCgogICAgY29tcHV0ZV90YXJnZXQgPSBpbml0X2NvbXB1dGUoCiAgICAgICAgY29udGV4dD1jb250ZXh0LAogICAgICAgIGNwdV9jbHVzdGVyX25hbWU9Y3B1X2NsdXN0ZXJfbmFtZSwKICAgICAgICB2bV9zaXplPXZtX3NpemUsCiAgICAgICAgbWF4X25vZGVzPW1heF9ub2RlcywKICAgICkKCiAgICAjIFJlZ2lzdGVyIGRhdGFzZXQKICAgIHJlZ2lzdGVyX2RhdGFzZXQoCiAgICAgICAgY29udGV4dD1jb250ZXh0LAogICAgICAgIGRhdGFzZXRfbmFtZT1kYXRhc2V0X25hbWUsCiAgICAgICAgZGF0YXNldF9kZXNjcmlwdGlvbj1kYXRhc2V0X2Rlc2NyaXB0aW9uLAogICAgICAgIGRhdGE9dHJhaW5pbmdfZGF0YSwKICAgICAgICBjcmVhdGVfbmV3X3ZlcnNpb249Y3JlYXRlX25ld192ZXJzaW9uLAogICAgKQoKICAgICMgU3VibWl0IHRyYWluaW5nIGpvYgogICAgc3VibWl0X3RyYWluaW5nX2pvYigKICAgICAgICBjb250ZXh0LAogICAgICAgIGV4cGVyaW1lbnQ9ZXhwZXJpbWVudCwKICAgICAgICBjb21wdXRlX3RhcmdldD1jb21wdXRlX3RhcmdldCwKICAgICAgICByZWdpc3Rlcl9tb2RlbF9uYW1lPXJlZ2lzdGVyX21vZGVsX25hbWUsCiAgICAgICAgcmVnaXN0ZXJlZF9kYXRhc2V0X25hbWU9ZGF0YXNldF9uYW1lLAogICAgICAgIGxhYmVsX2NvbHVtbl9uYW1lPWxhYmVsX2NvbHVtbl9uYW1lLAogICAgICAgIGF1dG9tbF9zZXR0aW5ncz1hdXRvbWxfc2V0dGluZ3MsCiAgICAgICAgdHJhaW5pbmdfc2V0PXRyYWluaW5nX2RhdGEsCiAgICAgICAgc2hvd19vdXRwdXQ9bG9nX2F6dXJlLAogICAgICAgIHNhdmVfbl9tb2RlbHM9c2F2ZV9uX21vZGVscywKICAgICkK
    commands: []
    code_origin: https://github.com/mlrun/functions.git#479bbb2e63ca2aa15d842530b4dadcf4f6d03d5f:C:\Users\yonatans\projects\functions\azureml_utils\azureml_utils.py
    origin_filename: C:\Users\yonatans\projects\functions\azureml_utils\azureml_utils.py
  disable_auto_mount: false
  priority_class_name: ''
  affinity: null
verbose: false
