kind: job
metadata:
  name: arc-to-parquet
  tag: ''
  hash: 4c85d22e0f76eb0c44f82ebef3300db52f421158
  project: ''
  labels:
    author: yjb
    stage: development
  categories:
  - fileutils
  - compression
spec:
  command: ''
  args: []
  image: mlrun/ml-base:0.4.5
  env: []
  default_handler: arc_to_parquet
  description: ''
  build:
    functionSourceCode: IyBDb3B5cmlnaHQgMjAxOCBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAojCiMgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQojIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiMgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiMgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAojIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoKaW1wb3J0IHNzbAoKdHJ5OgogICAgX2NyZWF0ZV91bnZlcmlmaWVkX2h0dHBzX2NvbnRleHQgPSBzc2wuX2NyZWF0ZV91bnZlcmlmaWVkX2NvbnRleHQKZXhjZXB0IEF0dHJpYnV0ZUVycm9yOgogICAgIyBMZWdhY3kgUHl0aG9uIHRoYXQgZG9lc24idCB2ZXJpZnkgSFRUUFMgY2VydGlmaWNhdGVzIGJ5IGRlZmF1bHQKICAgICAgICBwYXNzCmVsc2U6CiAgICAjIEhhbmRsZSB0YXJnZXQgZW52aXJvbm1lbnQgdGhhdCBkb2VzbiJ0IHN1cHBvcnQgSFRUUFMgdmVyaWZpY2F0aW9uCiAgICBzc2wuX2NyZWF0ZV9kZWZhdWx0X2h0dHBzX2NvbnRleHQgPSBfY3JlYXRlX3VudmVyaWZpZWRfaHR0cHNfY29udGV4dAoKaW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCBudW1weSBhcyBucAppbXBvcnQgcGFuZGFzIGFzIHBkCmltcG9ydCBweWFycm93LnBhcnF1ZXQgYXMgcHEKaW1wb3J0IHB5YXJyb3cgYXMgcGEKZnJvbSBjbG91ZHBpY2tsZSBpbXBvcnQgZHVtcCwgbG9hZAoKZnJvbSBtbHJ1bi5leGVjdXRpb24gaW1wb3J0IE1MQ2xpZW50Q3R4CmZyb20gbWxydW4uZGF0YXN0b3JlIGltcG9ydCBEYXRhSXRlbQpmcm9tIG1scnVuLmFydGlmYWN0cyBpbXBvcnQgUGxvdEFydGlmYWN0LCBUYWJsZUFydGlmYWN0Cgpmcm9tIHR5cGluZyBpbXBvcnQgSU8sIEFueVN0ciwgVW5pb24sIExpc3QsIE9wdGlvbmFsCgpkZWYgYXJjX3RvX3BhcnF1ZXQoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIGFyY2hpdmVfdXJsOiBVbmlvbltzdHIsIERhdGFJdGVtXSwKICAgIGhlYWRlcjogT3B0aW9uYWxbTGlzdFtzdHJdXSA9IE5vbmUsCiAgICBjaHVua3NpemU6IGludCA9IDEwXzAwMCwKICAgIGR0eXBlPU5vbmUsCiAgICBlbmNvZGluZzogc3RyID0gImxhdGluLTEiLAogICAga2V5OiBzdHIgPSAiZGF0YSIsCiAgICBkYXRhc2V0OiBPcHRpb25hbFtzdHJdID0gTm9uZSwKICAgIHBhcnRfY29scyA9IFtdLAogICAgZmlsZV9leHQ6IHN0ciA9ICdwcXQnCikgLT4gTm9uZToKICAgICIiIk9wZW4gYSBmaWxlL29iamVjdCBhcmNoaXZlIGFuZCBzYXZlIGFzIGEgcGFycXVldCBmaWxlLgoKICAgIFBhcnRpdGlvbmluZyByZXF1aXJlcyBwcmVjaXNlIHNwZWNpZmljYXRpb24gb2YgY29sdW1uIHR5cGVzLgoKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgIGZ1bmN0aW9uIGNvbnRleHQKICAgIDpwYXJhbSBhcmNoaXZlX3VybDogIGFueSB2YWxpZCBzdHJpbmcgcGF0aCBjb25zaXN0ZW50IHdpdGggdGhlIHBhdGggdmFyaWFibGUKICAgICAgICAgICAgICAgICAgICAgICAgIG9mIHBhbmRhcy5yZWFkX2NzdiwgaW5jbHVkaW5nIHN0cmluZ3MgYXMgZmlsZSBwYXRocywgYXMgdXJscywgCiAgICAgICAgICAgICAgICAgICAgICAgICBwYXRobGliLlBhdGggb2JqZWN0cywgZXRjLi4uCiAgICA6cGFyYW0gaGVhZGVyOiAgICAgICBjb2x1bW4gbmFtZXMKICAgIDpwYXJhbSBjaHVua3NpemU6ICAgICgwKSByb3cgc2l6ZSByZXRyaWV2ZWQgcGVyIGl0ZXJhdGlvbgogICAgOnBhcmFtIGR0eXBlICAgICAgICAgZGVzdGluYXRpb24gZGF0YSB0eXBlIG9mIHNwZWNpZmllZCBjb2x1bW5zCiAgICA6cGFyYW0gZW5jb2RpbmcgICAgICAoImxhdGluLTgiKSBmaWxlIGVuY29kaW5nCiAgICA6cGFyYW0ga2V5OiAgICAgICAgICBrZXkgaW4gYXJ0aWZhY3Qgc3RvcmUgKHdoZW4gbG9nX2RhdGE9VHJ1ZSkKICAgIDpwYXJhbSBkYXRhc2V0OiAgICAgIChOb25lKSBpZiBub3QgTm9uZSB0aGVuICJ0YXJnZXRfcGF0aC9kYXRhc2V0IgogICAgICAgICAgICAgICAgICAgICAgICAgaXMgZm9sZGVyIGZvciBwYXJ0aXRpb25lZCBmaWxlcwogICAgOnBhcmFtIGZpbGVfZXh0OiAgICAgKHBxdCkgcGFycXVldCBmaWxlIGV4dGVuc2lvbgogICAgOnBhcmFtIHBhcnRfY29sczogICAgKFtdKSBsaXN0IG9mIHBhcnRpdGlvbmluZyBjb2x1bW5zCgogICAgIiIiCiAgICBiYXNlX3BhdGggPSBjb250ZXh0LmFydGlmYWN0X3BhdGgKICAgIG9zLm1ha2VkaXJzKGJhc2VfcGF0aCwgZXhpc3Rfb2s9VHJ1ZSkKCiAgICBpZiBkYXRhc2V0IGlzIG5vdCBOb25lOgogICAgICAgIGRlc3RfcGF0aCA9IG9zLnBhdGguam9pbihiYXNlX3BhdGgsIGRhdGFzZXQpCiAgICAgICAgZXhpc3RzID0gb3MucGF0aC5pc2RpcihkZXN0X3BhdGgpCiAgICBlbHNlOgogICAgICAgIGRlc3RfcGF0aCA9IG9zLnBhdGguam9pbihiYXNlX3BhdGgsIGtleStmIi57ZmlsZV9leHR9IikKICAgICAgICBleGlzdHMgPSBvcy5wYXRoLmlzZmlsZShkZXN0X3BhdGgpCgogICAgIyB0b2RvOiBtb3JlIGxvZ2ljIGZvciBoZWFkZXIKICAgIGlmIG5vdCBleGlzdHM6CiAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygiZGVzdGluYXRpb24gZmlsZSBkb2VzIG5vdCBleGlzdCwgZG93bmxvYWRpbmciKQogICAgICAgIHBxd3JpdGVyID0gTm9uZQogICAgICAgIGZvciBpLCBkZiBpbiBlbnVtZXJhdGUocGQucmVhZF9jc3YoYXJjaGl2ZV91cmwsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtzaXplPWNodW5rc2l6ZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lcz1oZWFkZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmNvZGluZz1lbmNvZGluZywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdHlwZT1kdHlwZSkpOgogICAgICAgICAgICB0YWJsZSA9IHBhLlRhYmxlLmZyb21fcGFuZGFzKGRmKQogICAgICAgICAgICBpZiBpID09IDA6CiAgICAgICAgICAgICAgICBpZiBkYXRhc2V0OgogICAgICAgICAgICAgICAgICAgICMganVzdCB3cml0ZSBoZWFkZXIgaGVyZQogICAgICAgICAgICAgICAgICAgIHBxLlBhcnF1ZXRXcml0ZXIob3MucGF0aC5qb2luKGJhc2VfcGF0aCwiaGVhZGVyLW9ubHkucHF0IiksIHRhYmxlLnNjaGVtYSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgIyBzdGFydCB3cml0aW5nIGZpbGUKICAgICAgICAgICAgICAgICAgICBwcXdyaXRlciA9IHBxLlBhcnF1ZXRXcml0ZXIoZGVzdF9wYXRoLCB0YWJsZS5zY2hlbWEpCiAgICAgICAgICAgICAgICBjb250ZXh0LmxvZ19hcnRpZmFjdCgiaGVhZGVyIiwgbG9jYWxfcGF0aD0iaGVhZGVyLW9ubHkucHF0IikKICAgICAgICAgICAgaWYgZGF0YXNldDoKICAgICAgICAgICAgICAgIHBxLndyaXRlX3RvX2RhdGFzZXQodGFibGUsIHJvb3RfcGF0aD1kZXN0X3BhdGgsIHBhcnRpdGlvbl9jb2xzPXBhcnRpdGlvbl9jb2xzKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHF3cml0ZXIud3JpdGVfdGFibGUodGFibGUpCiAgICAgICAgaWYgcHF3cml0ZXI6CiAgICAgICAgICAgIHBxd3JpdGVyLmNsb3NlKCkKCiAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbyhmInNhdmVkIHRhYmxlIHRvIHtkZXN0X3BhdGh9IikKICAgIGVsc2U6CiAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygiZGVzdGluYXRpb24gZmlsZSBhbHJlYWR5IGV4aXN0cyIpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChrZXksIGxvY2FsX3BhdGg9a2V5KyIucHF0IikK
    commands: []
    code_origin: https://github.com/mlrun/functions.git#b0ba922e10fa0af2fcf2e04cce51eb7d9243bf25:arc_to_parquet/arc_to_parquet.py
