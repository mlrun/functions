kind: job
metadata:
  name: describe-dask
  tag: ''
  hash: 7bf6075607be56b0d224845b2e1e0a5b2394dcb8
  project: ''
  labels:
    author: yjb
  categories:
  - analysis
spec:
  command: ''
  args: []
  image: mlrun/ml-models
  env: []
  default_handler: summarize
  entry_points:
    summarize:
      name: summarize
      doc: 'Summarize a table


        Connects to dask client through the function context, or through an optional

        user-supplied scheduler.'
      parameters:
      - name: context
        type: MLClientCtx
        doc: the function context
      - name: dask_key
        type: str
        doc: key of dataframe in dask client "datasets" attribute
        default: dask_key
      - name: label_column
        type: str
        doc: ground truth column label
        default: labels
      - name: class_labels
        type: List[str]
        doc: label for each class in tables and plots
      - name: plot_hist
        type: bool
        doc: (True) set this to False for large tables
        default: true
      - name: plots_dest
        type: str
        doc: destination folder of summary plots (relative to artifact_path)
        default: plots
      - name: alt_scheduler
        type: str
        doc: (None) an alternative scheduler file to connect with
      outputs: []
      lineno: 27
  description: describe and visualizes dataset stats
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlciBvbiAyMDIwLTA1LTAzIDEzOjEwCgppbXBvcnQgd2FybmluZ3MKd2FybmluZ3Muc2ltcGxlZmlsdGVyKGFjdGlvbj0iaWdub3JlIiwgY2F0ZWdvcnk9RnV0dXJlV2FybmluZykKCmltcG9ydCBvcwppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgbWF0cGxvdGxpYi5weXBsb3QgYXMgcGx0CmltcG9ydCBzZWFib3JuIGFzIHNucwoKaW1wb3J0IGRhc2sKaW1wb3J0IGRhc2suZGF0YWZyYW1lIGFzIGRkCmZyb20gZGFzay5kaXN0cmlidXRlZCBpbXBvcnQgQ2xpZW50Cgpmcm9tIG1scnVuLmV4ZWN1dGlvbiBpbXBvcnQgTUxDbGllbnRDdHgKZnJvbSBtbHJ1bi5kYXRhc3RvcmUgaW1wb3J0IERhdGFJdGVtCmZyb20gbWxydW4uYXJ0aWZhY3RzIGltcG9ydCBQbG90QXJ0aWZhY3QsIFRhYmxlQXJ0aWZhY3QKZnJvbSBtbHJ1bi5tbHV0aWxzIGltcG9ydCBnY2ZfY2xlYXIKCmZyb20geWVsbG93YnJpY2sgaW1wb3J0IENsYXNzQmFsYW5jZQoKZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QKCnBkLnNldF9vcHRpb24oImRpc3BsYXkuZmxvYXRfZm9ybWF0IiwgbGFtYmRhIHg6ICIlLjJmIiAlIHgpCgpkZWYgc3VtbWFyaXplKAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBkYXNrX2tleTogc3RyID0gImRhc2tfa2V5IiwKICAgIGxhYmVsX2NvbHVtbjogc3RyID0gImxhYmVscyIsCiAgICBjbGFzc19sYWJlbHM6IExpc3Rbc3RyXSA9IFtdLAogICAgcGxvdF9oaXN0OiBib29sID0gVHJ1ZSwKICAgIHBsb3RzX2Rlc3Q6IHN0ciA9ICJwbG90cyIsCiAgICBhbHRfc2NoZWR1bGVyOiBzdHIgPSBOb25lCikgLT4gTm9uZToKICAgICIiIlN1bW1hcml6ZSBhIHRhYmxlCiAgICAKICAgIENvbm5lY3RzIHRvIGRhc2sgY2xpZW50IHRocm91Z2ggdGhlIGZ1bmN0aW9uIGNvbnRleHQsIG9yIHRocm91Z2ggYW4gb3B0aW9uYWwKICAgIHVzZXItc3VwcGxpZWQgc2NoZWR1bGVyLgoKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0gZGFza19rZXk6ICAgICAgICBrZXkgb2YgZGF0YWZyYW1lIGluIGRhc2sgY2xpZW50ICJkYXRhc2V0cyIgYXR0cmlidXRlCiAgICA6cGFyYW0gbGFiZWxfY29sdW1uOiAgICBncm91bmQgdHJ1dGggY29sdW1uIGxhYmVsCiAgICA6cGFyYW0gY2xhc3NfbGFiZWxzOiAgICBsYWJlbCBmb3IgZWFjaCBjbGFzcyBpbiB0YWJsZXMgYW5kIHBsb3RzCiAgICA6cGFyYW0gcGxvdF9oaXN0OiAgICAgICAoVHJ1ZSkgc2V0IHRoaXMgdG8gRmFsc2UgZm9yIGxhcmdlIHRhYmxlcwogICAgOnBhcmFtIHBsb3RzX2Rlc3Q6ICAgICAgZGVzdGluYXRpb24gZm9sZGVyIG9mIHN1bW1hcnkgcGxvdHMgKHJlbGF0aXZlIHRvIGFydGlmYWN0X3BhdGgpCiAgICA6cGFyYW0gYWx0X3NjaGVkdWxlcjogICAoTm9uZSkgYW4gYWx0ZXJuYXRpdmUgc2NoZWR1bGVyIGZpbGUgdG8gY29ubmVjdCB3aXRoCiAgICAiIiIKICAgIGlmIGFsdF9zY2hlZHVsZXI6CiAgICAgICAgZGFza19jbGllbnQgPSBDbGllbnQoc2NoZWR1bGVyX2ZpbGU9c3RyKGFsdF9zY2hlZHVsZXIpKQogICAgZWxpZiBoYXNhdHRyKGNvbnRleHQsICJkYXNrX2NsaWVudCIpOgogICAgICAgIGRhc2tfY2xpZW50ID0gQ2xpZW50KHNjaGVkdWxlcl9maWxlPXN0cihjb250ZXh0LmRhc2tfY2xpZW50KSkKICAgIGVsc2U6CiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJvdXQgb2YgbHVjaywgbm8gZGFza19jbGllbnQgb3Igc2NoZWR1bGVyIGZpbGUhIikKICAgICAgICAKICAgIGlmIGRhc2tfa2V5IGluIGRhc2tfY2xpZW50LmRhdGFzZXRzOgogICAgICAgIHRhYmxlID0gZGFza19jbGllbnQuZ2V0X2RhdGFzZXQoZGFza19rZXkpCiAgICBlbHNlOgogICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJvbmx5IHRoZXNlIGRhdGFzZXRzIGFyZSBhdmFpbGFibGUge2Rhc2tfY2xpZW50LmRhdGFzZXRzfSBpbiBjbGllbnQge2Rhc2tfY2xpZW50fSIpCiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJkYXRhc2V0IG5vdCBmb3VuZCBvbiBkYXNrIGNsdXN0ZXIiKQogICAgaGVhZGVyID0gdGFibGUuY29sdW1ucy52YWx1ZXMKICAgIAogICAgZ2NmX2NsZWFyKHBsdCkKICAgIHRhYmxlID0gdGFibGUuY29tcHV0ZSgpCiAgICBzbnNwbHQgPSBzbnMucGFpcnBsb3QodGFibGUsIGh1ZT1sYWJlbF9jb2x1bW4sIGRpYWdfa3dzPXsnYncnOiAxLjV9KQogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoUGxvdEFydGlmYWN0KCdoaXN0b2dyYW1zJywgIGJvZHk9cGx0LmdjZigpKSwgCiAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9wYXRoPWYie3Bsb3RzX2Rlc3R9L2hpc3QuaHRtbCIpCgogICAgZ2NmX2NsZWFyKHBsdCkgICAKICAgIGxhYmVscyA9IHRhYmxlLnBvcChsYWJlbF9jb2x1bW4pCiAgICBpZiBub3QgY2xhc3NfbGFiZWxzOgogICAgICAgIGNsYXNzX2xhYmVscyA9IGxhYmVscy51bmlxdWUoKQogICAgY2xhc3NfYmFsYW5jZV9tb2RlbCA9IENsYXNzQmFsYW5jZShsYWJlbHM9Y2xhc3NfbGFiZWxzKQogICAgY2xhc3NfYmFsYW5jZV9tb2RlbC5maXQobGFiZWxzKSAgIAogICAgc2NhbGVfcG9zX3dlaWdodCA9IGNsYXNzX2JhbGFuY2VfbW9kZWwuc3VwcG9ydF9bMF0vY2xhc3NfYmFsYW5jZV9tb2RlbC5zdXBwb3J0X1sxXQogICAgY29udGV4dC5sb2dfcmVzdWx0KCJzY2FsZV9wb3Nfd2VpZ2h0IiwgZiJ7c2NhbGVfcG9zX3dlaWdodDowLjJmfSIpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3QoImltYmFsYW5jZSIsIGJvZHk9cGx0LmdjZigpKSwgCiAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9wYXRoPWYie3Bsb3RzX2Rlc3R9L2ltYmFsYW5jZS5odG1sIikKICAgIAogICAgZ2NmX2NsZWFyKHBsdCkKICAgIHRibGNvcnIgPSB0YWJsZS5jb3JyKCkKICAgIGF4ID0gcGx0LmF4ZXMoKQogICAgc25zLmhlYXRtYXAodGJsY29yciwgYXg9YXgsIGFubm90PUZhbHNlLCBjbWFwPXBsdC5jbS5SZWRzKQogICAgYXguc2V0X3RpdGxlKCJmZWF0dXJlcyBjb3JyZWxhdGlvbiIpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3QoImNvcnJlbGF0aW9uIiwgIGJvZHk9cGx0LmdjZigpKSwgCiAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9wYXRoPWYie3Bsb3RzX2Rlc3R9L2NvcnIuaHRtbCIpCiAgICBnY2ZfY2xlYXIocGx0KQoK
    commands: []
    code_origin: https://github.com/yjb-ds/functions.git#afd8f54914c11a427db2c5738dbb702e534a21a5:describe_dask.ipynb
