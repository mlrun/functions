kind: job
metadata:
  name: feature-selection
  tag: ''
  hash: 497d1347b8b06e4c26ea2968cf2273701982b831
  project: ''
  labels:
    author: orz
  categories:
  - data-preparation
  - machine-learning
spec:
  command: ''
  args: []
  image: mlrun/ml-models
  build:
    functionSourceCode: IyBDb3B5cmlnaHQgMjAxOSBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiMKIyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiMgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKIyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KIyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiMgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiMKaW1wb3J0IGpzb24KaW1wb3J0IG9zCgppbXBvcnQgbWF0cGxvdGxpYi5weXBsb3QgYXMgcGx0CmltcG9ydCBtbHJ1bgppbXBvcnQgbWxydW4uYXBpLnNjaGVtYXMKaW1wb3J0IG1scnVuLmZlYXR1cmVfc3RvcmUgYXMgZnMKaW1wb3J0IG51bXB5IGFzIG5wCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IHNlYWJvcm4gYXMgc25zCmZyb20gbWxydW4uYXJ0aWZhY3RzIGltcG9ydCBQbG90QXJ0aWZhY3QKZnJvbSBtbHJ1bi5kYXRhc3RvcmUudGFyZ2V0cyBpbXBvcnQgUGFycXVldFRhcmdldAojIE1MUnVuIHV0aWxzCmZyb20gbWxydW4udXRpbHMuaGVscGVycyBpbXBvcnQgY3JlYXRlX2NsYXNzCiMgRmVhdHVyZSBzZWxlY3Rpb24gc3RyYXRlZ2llcwpmcm9tIHNrbGVhcm4uZmVhdHVyZV9zZWxlY3Rpb24gaW1wb3J0IFNlbGVjdEZyb21Nb2RlbCwgU2VsZWN0S0Jlc3QKIyBTY2FsZSBmZWF0dXJlIHNjb3Jlc2dpdCBzdApmcm9tIHNrbGVhcm4ucHJlcHJvY2Vzc2luZyBpbXBvcnQgTWluTWF4U2NhbGVyCiMgU0tMZWFybiBlc3RpbWF0b3JzIGxpc3QKZnJvbSBza2xlYXJuLnV0aWxzIGltcG9ydCBhbGxfZXN0aW1hdG9ycwoKREVGQVVMVF9TVEFUX0ZJTFRFUlMgPSBbImZfY2xhc3NpZiIsICJtdXR1YWxfaW5mb19jbGFzc2lmIiwgImNoaTIiLCAiZl9yZWdyZXNzaW9uIl0KREVGQVVMVF9NT0RFTF9GSUxURVJTID0gewogICAgIkxpbmVhclNWQyI6ICJMaW5lYXJTVkMiLAogICAgIkxvZ2lzdGljUmVncmVzc2lvbiI6ICJMb2dpc3RpY1JlZ3Jlc3Npb24iLAogICAgIkV4dHJhVHJlZXNDbGFzc2lmaWVyIjogIkV4dHJhVHJlZXNDbGFzc2lmaWVyIiwKfQoKCmRlZiBfY2xlYXJfY3VycmVudF9maWd1cmUoKToKICAgICIiIgogICAgQ2xlYXIgbWF0cGxvdGxpYiBjdXJyZW50IGZpZ3VyZS4KICAgICIiIgogICAgcGx0LmNsYSgpCiAgICBwbHQuY2xmKCkKICAgIHBsdC5jbG9zZSgpCgoKZGVmIHNob3dfdmFsdWVzX29uX2JhcnMoYXhzLCBoX3Y9InYiLCBzcGFjZT0wLjQpOgogICAgZGVmIF9zaG93X29uX3NpbmdsZV9wbG90KGF4Xyk6CiAgICAgICAgaWYgaF92ID09ICJ2IjoKICAgICAgICAgICAgZm9yIHAgaW4gYXhfLnBhdGNoZXM6CiAgICAgICAgICAgICAgICBfeCA9IHAuZ2V0X3goKSArIHAuZ2V0X3dpZHRoKCkgLyAyCiAgICAgICAgICAgICAgICBfeSA9IHAuZ2V0X3koKSArIHAuZ2V0X2hlaWdodCgpCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGludChwLmdldF9oZWlnaHQoKSkKICAgICAgICAgICAgICAgIGF4Xy50ZXh0KF94LCBfeSwgdmFsdWUsIGhhPSJjZW50ZXIiKQogICAgICAgIGVsaWYgaF92ID09ICJoIjoKICAgICAgICAgICAgZm9yIHAgaW4gYXhfLnBhdGNoZXM6CiAgICAgICAgICAgICAgICBfeCA9IHAuZ2V0X3goKSArIHAuZ2V0X3dpZHRoKCkgKyBmbG9hdChzcGFjZSkKICAgICAgICAgICAgICAgIF95ID0gcC5nZXRfeSgpICsgcC5nZXRfaGVpZ2h0KCkKICAgICAgICAgICAgICAgIHZhbHVlID0gaW50KHAuZ2V0X3dpZHRoKCkpCiAgICAgICAgICAgICAgICBheF8udGV4dChfeCwgX3ksIHZhbHVlLCBoYT0ibGVmdCIpCgogICAgaWYgaXNpbnN0YW5jZShheHMsIG5wLm5kYXJyYXkpOgogICAgICAgIGZvciBpZHgsIGF4IGluIG5wLm5kZW51bWVyYXRlKGF4cyk6CiAgICAgICAgICAgIF9zaG93X29uX3NpbmdsZV9wbG90KGF4KQogICAgZWxzZToKICAgICAgICBfc2hvd19vbl9zaW5nbGVfcGxvdChheHMpCgoKZGVmIHBsb3Rfc3RhdChjb250ZXh0LCBzdGF0X25hbWUsIHN0YXRfZGYpOgogICAgX2NsZWFyX2N1cnJlbnRfZmlndXJlKCkKCiAgICAjIEFkZCBjaGFydAogICAgYXggPSBwbHQuYXhlcygpCiAgICBzdGF0X2NoYXJ0ID0gc25zLmJhcnBsb3QoCiAgICAgICAgeD1zdGF0X25hbWUsCiAgICAgICAgeT0iaW5kZXgiLAogICAgICAgIGRhdGE9c3RhdF9kZi5zb3J0X3ZhbHVlcyhzdGF0X25hbWUsIGFzY2VuZGluZz1GYWxzZSkucmVzZXRfaW5kZXgoKSwKICAgICAgICBheD1heCwKICAgICkKICAgIHBsdC50aWdodF9sYXlvdXQoKQoKICAgIGZvciBwIGluIHN0YXRfY2hhcnQucGF0Y2hlczoKICAgICAgICB3aWR0aCA9IHAuZ2V0X3dpZHRoKCkKICAgICAgICBwbHQudGV4dCgKICAgICAgICAgICAgNSArIHAuZ2V0X3dpZHRoKCksCiAgICAgICAgICAgIHAuZ2V0X3koKSArIDAuNTUgKiBwLmdldF9oZWlnaHQoKSwKICAgICAgICAgICAgIns6MS4yZn0iLmZvcm1hdCh3aWR0aCksCiAgICAgICAgICAgIGhhPSJjZW50ZXIiLAogICAgICAgICAgICB2YT0iY2VudGVyIiwKICAgICAgICApCgogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoCiAgICAgICAgUGxvdEFydGlmYWN0KGYie3N0YXRfbmFtZX0iLCBib2R5PXBsdC5nY2YoKSksCiAgICAgICAgbG9jYWxfcGF0aD1vcy5wYXRoLmpvaW4oInBsb3RzIiwgImZlYXR1cmVfc2VsZWN0aW9uIiwgZiJ7c3RhdF9uYW1lfS5odG1sIiksCiAgICApCiAgICBfY2xlYXJfY3VycmVudF9maWd1cmUoKQoKCmRlZiBmZWF0dXJlX3NlbGVjdGlvbigKICAgIGNvbnRleHQsCiAgICBkZl9hcnRpZmFjdCwKICAgIGs6IGludCA9IDUsCiAgICBtaW5fdm90ZXM6IGZsb2F0ID0gMC41LAogICAgbGFiZWxfY29sdW1uOiBzdHIgPSBOb25lLAogICAgc3RhdF9maWx0ZXJzOiBsaXN0ID0gTm9uZSwKICAgIG1vZGVsX2ZpbHRlcnM6IGRpY3QgPSBOb25lLAogICAgbWF4X3NjYWxlZF9zY29yZXM6IGJvb2wgPSBUcnVlLAogICAgc2FtcGxlX3JhdGlvOiBmbG9hdCA9IE5vbmUsCiAgICBvdXRwdXRfdmVjdG9yX25hbWU6IGZsb2F0ID0gTm9uZSwKICAgIGlnbm9yZV90eXBlX2Vycm9yczogYm9vbCA9IEZhbHNlLAogICAgaXNfZmVhdHVyZV92ZWN0b3I6IGJvb2wgPSBGYWxzZSwKKToKICAgICIiIgogICAgQXBwbGllcyBzZWxlY3RlZCBmZWF0dXJlIHNlbGVjdGlvbiBzdGF0aXN0aWNhbCBmdW5jdGlvbnMgb3IgbW9kZWxzIG9uIG91ciAnZGZfYXJ0aWZhY3QnLgoKICAgIEVhY2ggc3RhdGlzdGljYWwgZnVuY3Rpb24gb3IgbW9kZWwgd2lsbCB2b3RlIGZvciBpdCdzIGJlc3QgSyBzZWxlY3RlZCBmZWF0dXJlcy4KICAgIElmIGEgZmVhdHVyZSBoYXMgPj0gJ21pbl92b3Rlcycgdm90ZXMsIGl0IHdpbGwgYmUgc2VsZWN0ZWQuCgogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0LgogICAgOnBhcmFtIGRmX2FydGlmYWN0OiAgICAgICAgIGRhdGFmcmFtZSB0byBwYXNzIGFzIGlucHV0LgogICAgOnBhcmFtIGs6ICAgICAgICAgICAgICAgICAgIG51bWJlciBvZiB0b3AgZmVhdHVyZXMgdG8gc2VsZWN0IGZyb20gZWFjaCBzdGF0aXN0aWNhbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG9yIG1vZGVsLgogICAgOnBhcmFtIG1pbl92b3RlczogICAgICAgICAgIG1pbmltYWwgbnVtYmVyIG9mIHZvdGVzIChmcm9tIGEgbW9kZWwgb3IgYnkgc3RhdGlzdGljYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbikgbmVlZGVkIGZvciBhIGZlYXR1cmUgdG8gYmUgc2VsZWN0ZWQuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2FuIGJlIHNwZWNpZmllZCBieSBwZXJjZW50YWdlIG9mIHZvdGVzIG9yIGFic29sdXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyIG9mIHZvdGVzLgogICAgOnBhcmFtIGxhYmVsX2NvbHVtbjogICAgICAgIGdyb3VuZC10cnV0aCAoeSkgbGFiZWxzLgogICAgOnBhcmFtIHN0YXRfZmlsdGVyczogICAgICAgIHN0YXRpc3RpY2FsIGZ1bmN0aW9ucyB0byBhcHBseSB0byB0aGUgZmVhdHVyZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZnJvbSBza2xlYXJuLmZlYXR1cmVfc2VsZWN0aW9uKS4KICAgIDpwYXJhbSBtb2RlbF9maWx0ZXJzOiAgICAgICBtb2RlbHMgdG8gdXNlIGZvciBmZWF0dXJlIGV2YWx1YXRpb24sIGNhbiBiZSBzcGVjaWZpZWQgYnkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbCBuYW1lIChleC4gTGluZWFyU1ZDKSwgZm9ybWFsaXplZCBqc29uIChjb250YWlucyAnQ0xBU1MnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGSVQnLCAnTUVUQScpIG9yIGEgcGF0aCB0byBzdWNoIGpzb24gZmlsZS4KICAgIDpwYXJhbSBtYXhfc2NhbGVkX3Njb3JlczogICBwcm9kdWNlIGZlYXR1cmUgc2NvcmVzIHRhYmxlIHNjYWxlZCB3aXRoIG1heF9zY2FsZXIuCiAgICA6cGFyYW0gc2FtcGxlX3JhdGlvOiAgICAgICAgcGVyY2VudGFnZSBvZiB0aGUgZGF0YXNldCB0aGUgdXNlciB3aGlzaGVzIHRvIGNvbXB1dGUgdGhlIGZlYXR1cmUgc2VsZWN0aW9uIHByb2Nlc3Mgb24uCiAgICA6cGFyYW0gb3V0cHV0X3ZlY3Rvcl9uYW1lOiAgY3JlYXRlcyBhIG5ldyBmZWF0dXJlIHZlY3RvciBjb250YWluaW5nIG9ubHkgdGhlIGlkZW50aWZpZXMgZmVhdHVyZXMuCiAgICA6cGFyYW0gaWdub3JlX3R5cGVfZXJyb3JzOiAgc2tpcHMgZGF0YXR5cGVzIHRoYXQgYXJlIG5laXRoZXIgZmxvYXQgbm9yIGludCB3aXRoaW4gdGhlIGZlYXR1cmUgdmVjdG9yLgogICAgOnBhcmFtIGlzX2ZlYXR1cmVfdmVjdG9yOiAgIGJvb2wgc3RhdGluZyBpZiB0aGUgZGF0YSBpcyBwYXNzZWQgYXMgYSBmZWF0dXJlIHZlY3Rvci4KICAgICIiIgogICAgc3RhdF9maWx0ZXJzID0gc3RhdF9maWx0ZXJzIG9yIERFRkFVTFRfU1RBVF9GSUxURVJTCiAgICBtb2RlbF9maWx0ZXJzID0gbW9kZWxfZmlsdGVycyBvciBERUZBVUxUX01PREVMX0ZJTFRFUlMKICAgICMgQ2hlY2sgaWYgZGYubWV0YSBpcyB2YWxpZCwgaWYgaXQgaXMsIGxvb2sgZm9yIGEgZmVhdHVyZSB2ZWN0b3IKICAgIGlmIGRmX2FydGlmYWN0Lm1ldGE6CiAgICAgICAgaWYgZGZfYXJ0aWZhY3QubWV0YS5raW5kID09IG1scnVuLmFwaS5zY2hlbWFzLk9iamVjdEtpbmQuZmVhdHVyZV92ZWN0b3I6CiAgICAgICAgICAgIGlzX2ZlYXR1cmVfdmVjdG9yID0gVHJ1ZQoKICAgICMgTG9vayBpbnNpZGUgbWV0YS5zcGVjLmxhYmVsX2ZlYXR1cmUgdG8gaWRlbnRpZnkgdGhlIGxhYmVsX2NvbHVtbiBpZiB0aGUgdXNlciBkaWQgbm90IHNwZWNpZnkgaXQKICAgIGlmIGxhYmVsX2NvbHVtbiBpcyBOb25lOgogICAgICAgIGlmIGlzX2ZlYXR1cmVfdmVjdG9yOgogICAgICAgICAgICBsYWJlbF9jb2x1bW4gPSBkZl9hcnRpZmFjdC5tZXRhLnNwZWMubGFiZWxfZmVhdHVyZS5zcGxpdCgiLiIpWzFdCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiTm8gbGFiZWxfY29sdW1uIHdhcyBnaXZlbiwgcGxlYXNlIGFkZCBhIGxhYmVsX2NvbHVtbi4iKQoKICAgICMgVXNlIHRoZSBmZWF0dXJlIHZlY3RvciBhcyBkYXRhZnJhbWUKICAgIGRmID0gZGZfYXJ0aWZhY3QuYXNfZGYoKQoKICAgICMgRW5zdXJlIGsgaXMgbm90IGJpZ2dlciB0aGFuIHRoZSB0b3RhbCBudW1iZXIgb2YgZmVhdHVyZXMKICAgIGlmIGsgPiBkZi5zaGFwZVsxXToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKAogICAgICAgICAgICBmIksgY2Fubm90IGJlIGJpZ2dlciB0aGFuIHRoZSB0b3RhbCBudW1iZXIgb2YgZmVhdHVyZXMgKHtkZi5zaGFwZVsxXX0pLiBQbGVhc2UgY2hvb3NlIGEgc21hbGxlciBLLiIKICAgICAgICApCiAgICBlbGlmIGsgPCAxOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoIksgY2Fubm90IGJlIHNtYWxsZXIgdGhhbiAxLiBQbGVhc2UgY2hvb3NlIGEgYmlnZ2VyIEsuIikKCiAgICAjIENyZWF0ZSBhIHNhbXBsZSBkYXRhZnJhbWUgb2YgdGhlIG9yaWdpbmFsIGZlYXR1cmUgdmVjdG9yCiAgICBpZiBzYW1wbGVfcmF0aW86CiAgICAgICAgZGYgPSAoCiAgICAgICAgICAgIGRmLmdyb3VwYnkobGFiZWxfY29sdW1uKQogICAgICAgICAgICAuYXBwbHkobGFtYmRhIHg6IHguc2FtcGxlKGZyYWM9c2FtcGxlX3JhdGlvKSkKICAgICAgICAgICAgLnJlc2V0X2luZGV4KGRyb3A9VHJ1ZSkKICAgICAgICApCiAgICAgICAgZGYgPSBkZi5kcm9wbmEoKQoKICAgICMgU2V0IGZlYXR1cmUgdmVjdG9yIGFuZCBsYWJlbHMKICAgIHkgPSBkZi5wb3AobGFiZWxfY29sdW1uKQogICAgWCA9IGRmCgogICAgaWYgbnAub2JqZWN0IGluIGxpc3QoWC5kdHlwZXMpIGFuZCBpZ25vcmVfdHlwZV9lcnJvcnMgaXMgRmFsc2U6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigKICAgICAgICAgICAgZiJ7ZGYuc2VsZWN0X2R0eXBlcyhpbmNsdWRlPVsnb2JqZWN0J10pLmNvbHVtbnMudG9saXN0KCl9IGFyZSBuZWl0aGVyIGZsb2F0IG9yIGludC4iCiAgICAgICAgKQoKICAgICMgQ3JlYXRlIHNlbGVjdGVkIHN0YXRpc3RpY2FsIGVzdGltYXRvcnMKICAgIHN0YXRfZnVuY3Rpb25zX2xpc3QgPSB7CiAgICAgICAgc3RhdF9uYW1lOiBTZWxlY3RLQmVzdCgKICAgICAgICAgICAgc2NvcmVfZnVuYz1jcmVhdGVfY2xhc3MoZiJza2xlYXJuLmZlYXR1cmVfc2VsZWN0aW9uLntzdGF0X25hbWV9IiksIGs9awogICAgICAgICkKICAgICAgICBmb3Igc3RhdF9uYW1lIGluIHN0YXRfZmlsdGVycwogICAgfQogICAgcmVxdWlyZXNfYWJzID0gWyJjaGkyIl0KCiAgICAjIFJ1biBzdGF0aXN0aWMgZmlsdGVycwogICAgc2VsZWN0ZWRfZmVhdHVyZXNfYWdnID0ge30KICAgIHN0YXRzX2RmID0gcGQuRGF0YUZyYW1lKGluZGV4PVguY29sdW1ucykuZHJvcG5hKCkKCiAgICBmb3Igc3RhdF9uYW1lLCBzdGF0X2Z1bmMgaW4gc3RhdF9mdW5jdGlvbnNfbGlzdC5pdGVtcygpOgogICAgICAgIHRyeToKICAgICAgICAgICAgcGFyYW1zID0gKFgsIHkpIGlmIHN0YXRfbmFtZSBpbiByZXF1aXJlc19hYnMgZWxzZSAoYWJzKFgpLCB5KQogICAgICAgICAgICBzdGF0ID0gc3RhdF9mdW5jLmZpdCgqcGFyYW1zKQoKICAgICAgICAgICAgIyBDb2xsZWN0IHN0YXQgZnVuY3Rpb24gcmVzdWx0cwogICAgICAgICAgICBzdGF0X2RmID0gcGQuRGF0YUZyYW1lKAogICAgICAgICAgICAgICAgaW5kZXg9WC5jb2x1bW5zLCBjb2x1bW5zPVtzdGF0X25hbWVdLCBkYXRhPXN0YXQuc2NvcmVzXwogICAgICAgICAgICApCiAgICAgICAgICAgIHBsb3Rfc3RhdChjb250ZXh0LCBzdGF0X25hbWUsIHN0YXRfZGYpCiAgICAgICAgICAgIHN0YXRzX2RmID0gc3RhdHNfZGYuam9pbihzdGF0X2RmKQoKICAgICAgICAgICAgIyBTZWxlY3QgSyBCZXN0IGZlYXR1cmVzCiAgICAgICAgICAgIHNlbGVjdGVkX2ZlYXR1cmVzID0gWC5jb2x1bW5zW3N0YXRfZnVuYy5nZXRfc3VwcG9ydCgpXQogICAgICAgICAgICBzZWxlY3RlZF9mZWF0dXJlc19hZ2dbc3RhdF9uYW1lXSA9IHNlbGVjdGVkX2ZlYXR1cmVzCgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbyhmIkNvdWxkbid0IGNhbGN1bGF0ZSB7c3RhdF9uYW1lfSBiZWNhdXNlIG9mOiB7ZX0iKQoKICAgICMgQ3JlYXRlIG1vZGVscyBmcm9tIGNsYXNzIG5hbWUgLyBqc29uIGZpbGUgLyBqc29uIHBhcmFtcwogICAgYWxsX3NrbGVhcm5fZXN0aW1hdG9ycyA9IGRpY3QoYWxsX2VzdGltYXRvcnMoKSkgaWYgbGVuKG1vZGVsX2ZpbHRlcnMpID4gMCBlbHNlIHt9CiAgICBzZWxlY3RlZF9tb2RlbHMgPSB7fQogICAgZm9yIG1vZGVsX25hbWUsIG1vZGVsIGluIG1vZGVsX2ZpbHRlcnMuaXRlbXMoKToKICAgICAgICBpZiAiLmpzb24iIGluIG1vZGVsOgogICAgICAgICAgICBjdXJyZW50X21vZGVsID0ganNvbi5sb2FkKG9wZW4obW9kZWwsICJyIikpCiAgICAgICAgICAgIGNsYXNzaWZpZXJfY2xhc3MgPSBjcmVhdGVfY2xhc3MoY3VycmVudF9tb2RlbFsiTUVUQSJdWyJjbGFzcyJdKQogICAgICAgICAgICBzZWxlY3RlZF9tb2RlbHNbbW9kZWxfbmFtZV0gPSBjbGFzc2lmaWVyX2NsYXNzKCoqY3VycmVudF9tb2RlbFsiQ0xBU1MiXSkKICAgICAgICBlbGlmIG1vZGVsIGluIGFsbF9za2xlYXJuX2VzdGltYXRvcnM6CiAgICAgICAgICAgIHNlbGVjdGVkX21vZGVsc1ttb2RlbF9uYW1lXSA9IGFsbF9za2xlYXJuX2VzdGltYXRvcnNbbW9kZWxfbmFtZV0oKQoKICAgICAgICBlbHNlOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjdXJyZW50X21vZGVsID0ganNvbi5sb2Fkcyhtb2RlbCkKICAgICAgICAgICAgICAgIGNsYXNzaWZpZXJfY2xhc3MgPSBjcmVhdGVfY2xhc3MoY3VycmVudF9tb2RlbFsiTUVUQSJdWyJjbGFzcyJdKQogICAgICAgICAgICAgICAgc2VsZWN0ZWRfbW9kZWxzW21vZGVsX25hbWVdID0gY2xhc3NpZmllcl9jbGFzcygqKmN1cnJlbnRfbW9kZWxbIkNMQVNTIl0pCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJ1bmFibGUgdG8gbG9hZCB7bW9kZWx9IGJlY2F1c2Ugb2Y6IHtlfSIpCgogICAgIyBSdW4gbW9kZWwgZmlsdGVycwogICAgbW9kZWxzX2RmID0gcGQuRGF0YUZyYW1lKGluZGV4PVguY29sdW1ucykKICAgIGZvciBtb2RlbF9uYW1lLCBtb2RlbCBpbiBzZWxlY3RlZF9tb2RlbHMuaXRlbXMoKToKCiAgICAgICAgaWYgbW9kZWxfbmFtZSA9PSAiTG9naXN0aWNSZWdyZXNzaW9uIjoKICAgICAgICAgICAgbW9kZWwuc2V0X3BhcmFtcyhzb2x2ZXI9ImxpYmxpbmVhciIpCgogICAgICAgICMgVHJhaW4gbW9kZWwgYW5kIGdldCBmZWF0dXJlIGltcG9ydGFuY2UKICAgICAgICBzZWxlY3RfZnJvbV9tb2RlbCA9IFNlbGVjdEZyb21Nb2RlbChtb2RlbCkuZml0KFgsIHkpCiAgICAgICAgZmVhdHVyZV9pZHggPSBzZWxlY3RfZnJvbV9tb2RlbC5nZXRfc3VwcG9ydCgpCiAgICAgICAgZmVhdHVyZV9uYW1lcyA9IFguY29sdW1uc1tmZWF0dXJlX2lkeF0KICAgICAgICBzZWxlY3RlZF9mZWF0dXJlc19hZ2dbbW9kZWxfbmFtZV0gPSBmZWF0dXJlX25hbWVzLnRvbGlzdCgpCgogICAgICAgICMgQ29sbGVjdCBtb2RlbCBmZWF0dXJlIGltcG9ydGFuY2UKICAgICAgICBpZiBoYXNhdHRyKHNlbGVjdF9mcm9tX21vZGVsLmVzdGltYXRvcl8sICJjb2VmXyIpOgogICAgICAgICAgICBzdGF0X2RmID0gc2VsZWN0X2Zyb21fbW9kZWwuZXN0aW1hdG9yXy5jb2VmXwogICAgICAgIGVsaWYgaGFzYXR0cihzZWxlY3RfZnJvbV9tb2RlbC5lc3RpbWF0b3JfLCAiZmVhdHVyZV9pbXBvcnRhbmNlc18iKToKICAgICAgICAgICAgc3RhdF9kZiA9IHNlbGVjdF9mcm9tX21vZGVsLmVzdGltYXRvcl8uZmVhdHVyZV9pbXBvcnRhbmNlc18KCiAgICAgICAgc3RhdF9kZiA9IHBkLkRhdGFGcmFtZShpbmRleD1YLmNvbHVtbnMsIGNvbHVtbnM9W21vZGVsX25hbWVdLCBkYXRhPXN0YXRfZGZbMF0pCiAgICAgICAgbW9kZWxzX2RmID0gbW9kZWxzX2RmLmpvaW4oc3RhdF9kZikKCiAgICAgICAgcGxvdF9zdGF0KGNvbnRleHQsIG1vZGVsX25hbWUsIHN0YXRfZGYpCgogICAgIyBDcmVhdGUgZmVhdHVyZV9zY29yZXMgREYgd2l0aCBzdGF0ICYgbW9kZWwgZmlsdGVycyBzY29yZXMKICAgIHJlc3VsdF9tYXRyaXhfZGYgPSBwZC5jb25jYXQoW3N0YXRzX2RmLCBtb2RlbHNfZGZdLCBheGlzPTEsIHNvcnQ9RmFsc2UpCiAgICBjb250ZXh0LmxvZ19kYXRhc2V0KAogICAgICAgIGtleT0iZmVhdHVyZV9zY29yZXMiLAogICAgICAgIGRmPXJlc3VsdF9tYXRyaXhfZGYsCiAgICAgICAgbG9jYWxfcGF0aD0iZmVhdHVyZV9zY29yZXMucGFycXVldCIsCiAgICAgICAgZm9ybWF0PSJwYXJxdWV0IiwKICAgICkKICAgIGlmIG1heF9zY2FsZWRfc2NvcmVzOgogICAgICAgIG5vcm1hbGl6ZWRfZGYgPSByZXN1bHRfbWF0cml4X2RmLnJlcGxhY2UoW25wLmluZiwgLW5wLmluZl0sIG5wLm5hbikudmFsdWVzCiAgICAgICAgbWluX21heF9zY2FsZXIgPSBNaW5NYXhTY2FsZXIoKQogICAgICAgIG5vcm1hbGl6ZWRfZGYgPSBtaW5fbWF4X3NjYWxlci5maXRfdHJhbnNmb3JtKG5vcm1hbGl6ZWRfZGYpCiAgICAgICAgbm9ybWFsaXplZF9kZiA9IHBkLkRhdGFGcmFtZSgKICAgICAgICAgICAgZGF0YT1ub3JtYWxpemVkX2RmLAogICAgICAgICAgICBjb2x1bW5zPXJlc3VsdF9tYXRyaXhfZGYuY29sdW1ucywKICAgICAgICAgICAgaW5kZXg9cmVzdWx0X21hdHJpeF9kZi5pbmRleCwKICAgICAgICApCiAgICAgICAgY29udGV4dC5sb2dfZGF0YXNldCgKICAgICAgICAgICAga2V5PSJtYXhfc2NhbGVkX3Njb3Jlc19mZWF0dXJlX3Njb3JlcyIsCiAgICAgICAgICAgIGRmPW5vcm1hbGl6ZWRfZGYsCiAgICAgICAgICAgIGxvY2FsX3BhdGg9Im1heF9zY2FsZWRfc2NvcmVzX2ZlYXR1cmVfc2NvcmVzLnBhcnF1ZXQiLAogICAgICAgICAgICBmb3JtYXQ9InBhcnF1ZXQiLAogICAgICAgICkKCiAgICAjIENyZWF0ZSBmZWF0dXJlIGNvdW50IERhdGFGcmFtZQogICAgZm9yIHRlc3RfbmFtZSBpbiBzZWxlY3RlZF9mZWF0dXJlc19hZ2c6CiAgICAgICAgcmVzdWx0X21hdHJpeF9kZlt0ZXN0X25hbWVdID0gWwogICAgICAgICAgICAxIGlmIHggaW4gc2VsZWN0ZWRfZmVhdHVyZXNfYWdnW3Rlc3RfbmFtZV0gZWxzZSAwIGZvciB4IGluIFguY29sdW1ucwogICAgICAgIF0KICAgIHJlc3VsdF9tYXRyaXhfZGYubG9jWzosICJudW1fdm90ZXMiXSA9IHJlc3VsdF9tYXRyaXhfZGYuc3VtKGF4aXM9MSkKICAgIGNvbnRleHQubG9nX2RhdGFzZXQoCiAgICAgICAga2V5PSJzZWxlY3RlZF9mZWF0dXJlc19jb3VudCIsCiAgICAgICAgZGY9cmVzdWx0X21hdHJpeF9kZiwKICAgICAgICBsb2NhbF9wYXRoPSJzZWxlY3RlZF9mZWF0dXJlc19jb3VudC5wYXJxdWV0IiwKICAgICAgICBmb3JtYXQ9InBhcnF1ZXQiLAogICAgKQoKICAgICMgSG93IG1hbnkgdm90ZXMgYXJlIG5lZWRlZCBmb3IgYSBmZWF0dXJlIHRvIGJlIHNlbGVjdGVkPwogICAgaWYgaXNpbnN0YW5jZShtaW5fdm90ZXMsIGludCk6CiAgICAgICAgdm90ZXNfbmVlZGVkID0gbWluX3ZvdGVzCiAgICBlbHNlOgogICAgICAgIG51bV9maWx0ZXJzID0gbGVuKHN0YXRfZmlsdGVycykgKyBsZW4obW9kZWxfZmlsdGVycykKICAgICAgICB2b3Rlc19uZWVkZWQgPSBpbnQobnAuZmxvb3IobnVtX2ZpbHRlcnMgKiBtYXgobWluKG1pbl92b3RlcywgMSksIDApKSkKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJ2b3RlcyBuZWVkZWQgdG8gYmUgc2VsZWN0ZWQ6IHt2b3Rlc19uZWVkZWR9IikKCiAgICAjIENyZWF0ZSBmaW5hbCBmZWF0dXJlIGRhdGFmcmFtZQogICAgc2VsZWN0ZWRfZmVhdHVyZXMgPSByZXN1bHRfbWF0cml4X2RmWwogICAgICAgIHJlc3VsdF9tYXRyaXhfZGYubnVtX3ZvdGVzID49IHZvdGVzX25lZWRlZAogICAgXS5pbmRleC50b2xpc3QoKQogICAgZ29vZF9mZWF0dXJlX2RmID0gZGYubG9jWzosIHNlbGVjdGVkX2ZlYXR1cmVzXQogICAgZmluYWxfZGYgPSBwZC5jb25jYXQoW2dvb2RfZmVhdHVyZV9kZiwgeV0sIGF4aXM9MSkKICAgIGNvbnRleHQubG9nX2RhdGFzZXQoCiAgICAgICAga2V5PSJzZWxlY3RlZF9mZWF0dXJlcyIsCiAgICAgICAgZGY9ZmluYWxfZGYsCiAgICAgICAgbG9jYWxfcGF0aD0ic2VsZWN0ZWRfZmVhdHVyZXMucGFycXVldCIsCiAgICAgICAgZm9ybWF0PSJwYXJxdWV0IiwKICAgICkKCiAgICAjIENyZWF0aW5nIGEgbmV3IGZlYXR1cmUgdmVjdG9yIGNvbnRhaW5pbmcgb25seSB0aGUgaWRlbnRpZmllZCB0b3AgZmVhdHVyZXMKICAgIGlmIGlzX2ZlYXR1cmVfdmVjdG9yIGFuZCBkZl9hcnRpZmFjdC5tZXRhLnNwZWMuZmVhdHVyZXMgYW5kIG91dHB1dF92ZWN0b3JfbmFtZToKICAgICAgICAjIFNlbGVjdGluZyB0aGUgdG9wIEsgZmVhdHVyZXMgZnJvbSBvdXIgdG9wIGZlYXR1cmUgZGF0YWZyYW1lCiAgICAgICAgc2VsZWN0ZWRfZmVhdHVyZXMgPSByZXN1bHRfbWF0cml4X2RmLmhlYWQoaykuaW5kZXgKCiAgICAgICAgIyBNYXRjaCB0aGUgc2VsZWN0ZWQgZmVhdHVyZSBuYW1lcyB0byB0aGUgRlMgRmVhdHVyZSBhbm5vdGF0aW9ucwogICAgICAgIG1hdGNoZWRfc2VsZWN0aW9ucyA9IFsKICAgICAgICAgICAgZmVhdHVyZQogICAgICAgICAgICBmb3IgZmVhdHVyZSBpbiBsaXN0KGRmX2FydGlmYWN0Lm1ldGEuc3BlYy5mZWF0dXJlcykKICAgICAgICAgICAgZm9yIHNlbGVjdGVkIGluIGxpc3Qoc2VsZWN0ZWRfZmVhdHVyZXMpCiAgICAgICAgICAgIGlmIGZlYXR1cmUuZW5kc3dpdGgoc2VsZWN0ZWQpCiAgICAgICAgXQoKICAgICAgICAjIERlZmluaW5nIG91ciBuZXcgZmVhdHVyZSB2ZWN0b3IKICAgICAgICB0b3BfZmVhdHVyZXNfZnYgPSBmcy5GZWF0dXJlVmVjdG9yKAogICAgICAgICAgICBvdXRwdXRfdmVjdG9yX25hbWUsCiAgICAgICAgICAgIG1hdGNoZWRfc2VsZWN0aW9ucywKICAgICAgICAgICAgbGFiZWxfZmVhdHVyZT0ibGFiZWxzLmxhYmVsIiwKICAgICAgICAgICAgZGVzY3JpcHRpb249ImZlYXR1cmUgdmVjdG9yIGNvbXBvc2VkIHN0cmljdGx5IG9mIG91ciB0b3AgZmVhdHVyZXMiLAogICAgICAgICkKCiAgICAgICAgIyBTYXZpbmcKICAgICAgICB0b3BfZmVhdHVyZXNfZnYuc2F2ZSgpCiAgICAgICAgZnMuZ2V0X29mZmxpbmVfZmVhdHVyZXModG9wX2ZlYXR1cmVzX2Z2LCB0YXJnZXQ9UGFycXVldFRhcmdldCgpKQoKICAgICAgICAjIExvZ2dpbmcgb3VyIG5ldyBmZWF0dXJlIHZlY3RvciBVUkkKICAgICAgICBjb250ZXh0LmxvZ19yZXN1bHQoInRvcF9mZWF0dXJlc192ZWN0b3IiLCB0b3BfZmVhdHVyZXNfZnYudXJpKQo=
    commands: []
    code_origin: https://github.com/mlrun/functions.git#aca6d88bd126944b1904f26f2c808771a9420796:/Users/yonatanshelach/yoni/projects/functions/feature_selection/feature_selection.py
    origin_filename: /Users/yonatanshelach/yoni/projects/functions/feature_selection/feature_selection.py
  entry_points:
    show_values_on_bars:
      name: show_values_on_bars
      doc: ''
      parameters:
      - name: axs
        default: ''
      - name: h_v
        default: v
      - name: space
        default: 0.4
      outputs:
      - default: ''
      lineno: 53
    plot_stat:
      name: plot_stat
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: stat_name
        default: ''
      - name: stat_df
        default: ''
      outputs:
      - default: ''
      lineno: 75
    feature_selection:
      name: feature_selection
      doc: 'Applies selected feature selection statistical functions or models on
        our ''df_artifact''.


        Each statistical function or model will vote for it''s best K selected features.

        If a feature has >= ''min_votes'' votes, it will be selected.'
      parameters:
      - name: context
        doc: the function context.
        default: ''
      - name: df_artifact
        doc: dataframe to pass as input.
        default: ''
      - name: k
        type: int
        doc: number of top features to select from each statistical function or model.
        default: 5
      - name: min_votes
        type: float
        doc: minimal number of votes (from a model or by statistical function) needed
          for a feature to be selected. Can be specified by percentage of votes or
          absolute number of votes.
        default: 0.5
      - name: label_column
        type: str
        doc: ground-truth (y) labels.
        default: null
      - name: stat_filters
        type: list
        doc: statistical functions to apply to the features (from sklearn.feature_selection).
        default: null
      - name: model_filters
        type: dict
        doc: models to use for feature evaluation, can be specified by model name
          (ex. LinearSVC), formalized json (contains 'CLASS', 'FIT', 'META') or a
          path to such json file.
        default: null
      - name: max_scaled_scores
        type: bool
        doc: produce feature scores table scaled with max_scaler.
        default: true
      - name: sample_ratio
        type: float
        doc: percentage of the dataset the user whishes to compute the feature selection
          process on.
        default: null
      - name: output_vector_name
        type: float
        doc: creates a new feature vector containing only the identifies features.
        default: null
      - name: ignore_type_errors
        type: bool
        doc: skips datatypes that are neither float nor int within the feature vector.
        default: false
      - name: is_feature_vector
        type: bool
        doc: bool stating if the data is passed as a feature vector.
        default: false
      outputs:
      - default: ''
      lineno: 105
  description: Select features through multiple Statistical and Model filters
  default_handler: feature_selection
  disable_auto_mount: false
  env: []
  priority_class_name: ''
  preemption_mode: prevent
  affinity: null
  tolerations: null
  security_context: {}
verbose: false
