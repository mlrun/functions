kind: job
metadata:
  name: lgbm-job
spec:
  description: 'train an LGBMClassifier'
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlciBvbiAyMDIwLTAxLTIxIDIxOjQxCgpmcm9tIGlvIGltcG9ydCBCeXRlc0lPCmZyb20gb3MgaW1wb3J0IHBhdGgsIG1ha2VkaXJzCmltcG9ydCBqc29uCmZyb20gY2xvdWRwaWNrbGUgaW1wb3J0IGxvYWQsIGR1bXAKZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmZyb20gdXJsbGliLnJlcXVlc3QgaW1wb3J0IHVybHJldHJpZXZlCmZyb20gdHlwaW5nIGltcG9ydCBJTywgQW55U3RyLCBUeXBlVmFyLCBVbmlvbiwgTGlzdCwgT3B0aW9uYWwKCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IG51bXB5IGFzIG5wCmltcG9ydCBsaWdodGdibSBhcyBsZ2IKZnJvbSBza2xlYXJuLm1ldHJpY3MgaW1wb3J0IChyb2NfY3VydmUsIGNvbmZ1c2lvbl9tYXRyaXgpCmZyb20gc2tsZWFybi5tb2RlbF9zZWxlY3Rpb24gaW1wb3J0IHRyYWluX3Rlc3Rfc3BsaXQKCmltcG9ydCBtYXRwbG90bGliLnB5cGxvdCBhcyBwbHQKZnJvbSBtYXRwbG90bGliLmZpZ3VyZSBpbXBvcnQgRmlndXJlCmltcG9ydCBzZWFib3JuIGFzIHNucwoKaW1wb3J0IHB5YXJyb3cucGFycXVldCBhcyBwcQppbXBvcnQgcHlhcnJvdyBhcyBwYQpmcm9tIHB5YXJyb3cgaW1wb3J0IFRhYmxlCgpmcm9tIG1scnVuLmFydGlmYWN0cyBpbXBvcnQgVGFibGVBcnRpZmFjdCwgUGxvdEFydGlmYWN0CmZyb20gbWxydW4uZXhlY3V0aW9uIGltcG9ydCBNTENsaWVudEN0eApmcm9tIG1scnVuLmRhdGFzdG9yZSBpbXBvcnQgRGF0YUl0ZW0KCmRlZiBnZXRfY29udGV4dF90YWJsZShjdHh0YWJsZTogRGF0YUl0ZW0pIC0+IFRhYmxlOgogICAgIiIiZGVzZXJpYWxpemUgdGFibGUgaW4gYXJ0aWZhY3Qgc3RvcmUKICAgIAogICAgOnBhcmFtIGN0eHRhYmxlOiAgdGFibGUgaW4gdGhlIGFydGlmYWN0IHN0b3JlCiAgICAiIiIKICAgIGJsb2IgPSBCeXRlc0lPKGN0eHRhYmxlLmdldCgpKQogICAgcmV0dXJuIHBkLnJlYWRfcGFycXVldChibG9iLCBlbmdpbmU9J3B5YXJyb3cnKQoKZGVmIGxvZ19jb250ZXh0X3RhYmxlKAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICB0YXJnZXRfcGF0aDogc3RyLAogICAga2V5OiBzdHIsCiAgICB0YWJsZTogcGQuRGF0YUZyYW1lCikgLT4gTm9uZToKICAgICIiIkxvZyBhIHRhYmxlIGluIHRoZSBhcnRpZmFjdCBzdG9yZS4KICAgIAogICAgVGhlIHRhYmxlIGlzIHdyaXR0ZW4gYXMgYSBwYXJxdWV0IGZpbGUsIGFuZCBpdHMgdGFyZ2V0CiAgICBwYXRoIGlzIHNhdmVkIGluIHRoZSBjb250ZXh0LgogICAgCiAgICA6cGFyYW0gY29udGV4dDogICAgICB0aGUgZnVuY3Rpb24gY29udGV4dAogICAgOnBhcmFtIHRhcmdldF9wYXRoOiAgbG9jYXRpb24gKGZvbGRlcikgb2Ygb3VyIERhdGFJdGVtCiAgICA6cGFyYW0ga2V5OiAgICAgICAgICBuYW1lIG9mIHRoZSBvYmplY3QgaW4gdGhlIGFydGlmYWN0IHN0b3JlCiAgICA6cGFyYW0gdGFibGU6ICAgICAgICB0aGUgb2JqZWN0IHdlIHdpc2ggdG8gc3RvcmUKICAgICIiIgogICAgZmlsZXBhdGggPSBwYXRoLmpvaW4odGFyZ2V0X3BhdGgsIGtleSArICcucGFycXVldCcpCiAgICBwcS53cml0ZV90YWJsZShwYS5UYWJsZS5mcm9tX3BhbmRhcyh0YWJsZSksIGZpbGVwYXRoKSAgICAKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KGtleSwgdGFyZ2V0X3BhdGg9ZmlsZXBhdGgpCgpkZWYgbG9nX2xnYm1fbW9kZWwoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIG1vZGVsLAogICAgZGF0YSwKICAgIGhlYWRlcjogTGlzdCA9IFtdLAogICAgdGFyZ2V0X3BhdGg6IHN0ciA9ICcnLAogICAgbmFtZTogc3RyID0gJycsICAjIHdpdGggZmlsZSBleHRlbnNpb24KICAgIGtleTogc3RyID0gJ21vZGVsJywKICAgIGV4cF9sYWJlbHM6IGRpY3QgPSB7fQopOgogICAgIiIibG9nIGEgY2xhc3NpZmllciBtb2RlbCB0byB0aGUgYXJ0aWZhY3Qgc3RvcmUKICAgIAogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgIGZ1bmN0aW9uIGNvbnRleHQKICAgIDpwYXJhbSBtb2RlbDogICAgICAgICBlc3RpbWF0ZWQgbW9kZWwKICAgIDpwYXJhbSBoaXN0b3J5OiAgICAgICB0cmFpbmluZy12YWxpZGF0aW9uIG1ldHJpY3MKICAgIDpwYXJhbSBkYXRhOiAgICAgICAgICB0cmFpbiBhbmQgdGVzdCBkYXRhCiAgICA6cGFyYW0gaGVhZGVyOiAgICAgICAgZmVhdHVyZXMgbGFiZWxzCiAgICA6cGFyYW0gdGFyZ2V0X3BhdGg6ICAgZGVzdGludGlvbiBmb2xkZXIgZm9yIGZpbGUgYXJ0aWZhY3RzCiAgICA6cGFyYW0gbmFtZTogICAgICAgICAgbmFtZSBvZiBtb2RlbCBmaWxlIChvciwgcHJlZml4IHRvIG1vZGVsIGZpbGVzKQogICAgOnBhcmFtIGtleTogICAgICAgICAgIGtleSBvZiBtb2RlbCBpbiBhcnRpZmFjdCBzdG9yZQogICAgOnBhcmFtIGxhYmVsczogICAgICAgIG1vZGVsIGFydGlmYWN0IGxhYmVscwogICAgCiAgICBTYXZlIGFuIGVzdGltYXRlZCBtb2RlbCBhbG9uZyB3aXRoIG1ldGFkYXRhLCBpdCdzIHRyYWluaW5nLXZhbGlkYXRpb24gbWV0cmljcyAKICAgIGhpc3RvcnkgYW5kIHBsb3RzLCByb2MgY3VydmUsIGNvbmZ1c2lvbiBtYXRyaXggYW5kIGZlYXR1cmUgaW1wb3J0YW5jZXMuICAKICAgICIiIgogICAgZGVmIF9nY2ZfY2xlYXIocGx0KToKICAgICAgICBwbHQuY2xhKCkKICAgICAgICBwbHQuY2xmKCkKICAgICAgICBwbHQuY2xvc2UoKSAgICAgICAgCiAgICAKICAgIGRlZiBwbG90X3ZhbGlkYXRpb24odHJhaW5fbWV0cmljLCB2YWxpZF9tZXRyaWMpOgogICAgICAgICIiIlBsb3QgdHJhaW4gYW5kIHZhbGlkYXRpb24gbG9zcyBjdXJ2ZXMgZnJvbSBhIG1ldHJpY3MgdGFibGUgaW4gYW4KICAgICAgICBhcnRpZmFjdCBzdG9yZS4KCiAgICAgICAgVGhlc2UgY3VydmVzIHJlcHJlc2VudCB0aGUgdHJhaW5pbmcgcm91bmQgbG9zc2VzIGZyb20gdGhlIHRyYWluaW5nCiAgICAgICAgYW5kIHZhbGlkYXRpb24gc2V0cy4KICAgICAgICA6cGFyYW0gdHJhaW5fbWV0cmljOiAgICB0cmFpbiBtZXRyaWMKICAgICAgICA6cGFyYW0gdmFsaWRfbWV0cmljOiAgICB2YWxpZGF0aW9uIG1ldHJpYwogICAgICAgICIiIgogICAgICAgIHBsdC5wbG90KHRyYWluX21ldHJpYykKICAgICAgICBwbHQucGxvdCh2YWxpZF9tZXRyaWMpCiAgICAgICAgcGx0LnRpdGxlKCJ0cmFpbmluZyB2YWxpZGF0aW9uIHJlc3VsdHMiKQogICAgICAgIHBsdC54bGFiZWwoImVwb2NoIikKICAgICAgICBwbHQueWxhYmVsKCIiKQogICAgICAgIHBsdC5sZWdlbmQoWyJ0cmFpbiIsICJ2YWxpZCJdKQogICAgICAgIGZpZyA9IHBsdC5nY2YoKQoKICAgICAgICBwbG90cGF0aCA9IHBhdGguam9pbih0YXJnZXRfcGF0aCwgImhpc3RvcnkucG5nIikKICAgICAgICBwbHQuc2F2ZWZpZyhwbG90cGF0aCkKICAgICAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3QoJ3RyYWluaW5nLXZhbGlkYXRpb24tcGxvdCcsIGJvZHk9ZmlnLCB0YXJnZXRfcGF0aD1wbG90cGF0aCkpCgogICAgICAgIF9nY2ZfY2xlYXIocGx0KQoKICAgIGRlZiBwbG90X3JvYyh5X2xhYmVscywgeV9wcm9icyk6CiAgICAgICAgIiIiUGxvdCBhbiBST0MgY3VydmUgZnJvbSB0ZXN0IGRhdGEgc2F2ZWQgaW4gYW4gYXJ0aWZhY3Qgc3RvcmUuCiAgICAgICAgOnBhcmFtIHlfbGFiZWxzOiAgICAgICAgdGVzdCBkYXRhIGxhYmVscwogICAgICAgIDpwYXJhbSB5X3Byb2JzOiAgICAgICAgIHRlc3QgZGF0YSAKICAgICAgICAiIiIKICAgICAgICBmcHJfeGcsIHRwcl94ZywgXyA9IHJvY19jdXJ2ZSh5X2xhYmVscywgeV9wcm9icykKICAgICAgICBwbHQucGxvdChbMCwgMV0sIFswLCAxXSwgImstLSIpCiAgICAgICAgcGx0LnBsb3QoZnByX3hnLCB0cHJfeGcsIGxhYmVsPSJyb2MiKQogICAgICAgIHBsdC54bGFiZWwoImZhbHNlIHBvc2l0aXZlIHJhdGUiKQogICAgICAgIHBsdC55bGFiZWwoInRydWUgcG9zaXRpdmUgcmF0ZSIpCiAgICAgICAgcGx0LnRpdGxlKCJyb2MgY3VydmUiKQogICAgICAgIHBsdC5sZWdlbmQobG9jPSJiZXN0IikKICAgICAgICBmaWcgPSBwbHQuZ2NmKCkKCiAgICAgICAgcGxvdHBhdGggPSBwYXRoLmpvaW4odGFyZ2V0X3BhdGgsICJyb2MucG5nIikKICAgICAgICBmaWcuc2F2ZWZpZyhwbG90cGF0aCwgZm9ybWF0PWZtdCkKICAgICAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3QoJ3JvYycsIGJvZHk9ZmlnKSkKCiAgICAgICAgX2djZl9jbGVhcihwbHQpCgogICAgZGVmIHBsb3RfY29uZnVzaW9uX21hdHJpeChsYWJlbHMsIHByZWRpY3Rpb25zKToKICAgICAgICAiIiJDcmVhdGUgYSBjb25mdXNpb24gbWF0cml4LgogICAgICAgIFBsb3QgYW5kIHNhdmUgYSBjb25mdXNpb24gbWF0cml4IHVzaW5nIHRlc3QgZGF0YSBmcm9tIGEKICAgICAgICBwaXBlbGluZSBzdGVwLiAgVGhlIHBsb3QgaXMgZ2VuZXJhdGVkIHVzdW5nIGRlZmF1bHQgYXJndW1lbnRzLgogICAgICAgIFRoZSBwcmVzZW50IGV4YW1wbGUgY291bGQgYmUgZXh0ZW5kZWQgYnkgaW5jbHVkaW5nIGEgcGFyYW1ldGVycyBgZGljdGAKICAgICAgICB0aGF0IGlzIHBhc3NlZCB0aHJvdWdoIHRvIHNrbGVhcm4ncyBgY29uZnVzaW9uX21hdHJpeGAsCiAgICAgICAgYENvbmZ1c2lvbk1hdHJpeERpc3BsYXlgLCBhbmQgbWF0cGxvdGxpYiBgcGxvdGAuCiAgICAgICAgOnBhcmFtIGxhYmVsczogICAgICAgICAgdGVzdCBkYXRhIGxhYmVscwogICAgICAgIDpwYXJhbSBwcmVkaWN0aW9uczogICAgIHRlc3QgZGF0YSBwcmVkaWN0aW9ucwogICAgICAgICIiIgogICAgICAgIGNtID0gY29uZnVzaW9uX21hdHJpeChsYWJlbHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZWRpY3Rpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1wbGVfd2VpZ2h0PU5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVscz1heGlzbGFiZWxzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3JtYWxpemU9J2FsbCcpCiAgICAgICAgc25zLmhlYXRtYXAoY20sIGFubm90PVRydWUsIGNtYXA9IkJsdWVzIikKICAgICAgICBwbG90cGF0aCA9IHBhdGguam9pbih0YXJnZXRfcGF0aCwgImNvbmZ1c2lvbi5wbmciKQogICAgICAgIGZpZyA9IHBsdC5nY2YoKQogICAgICAgIGZpZy5zYXZlZmlnKHBsb3RwYXRoKQogICAgICAgIGNvbnRleHQubG9nX2FydGlmYWN0KFBsb3RBcnRpZmFjdCgnY29uZnVzaW9uX21hdHJpeCcsIGJvZHk9ZmlnKSkKCiAgICAgICAgX2djZl9jbGVhcihwbHQpCgogICAgZGVmIHBsb3RfaW1wb3J0YW5jZShtb2RlbCwgaGVhZGVyOiBMaXN0ID0gW10pOgogICAgICAgICIiIkRpc3BsYXkgZXN0aW1hdGVkIGZlYXR1cmUgaW1wb3J0YW5jZXMuCgogICAgICAgIDpwYXJhbSBtb2RlbDogICAgICAgZml0dGVkIGxpZ2h0Z2JtIG1vZGVsCiAgICAgICAgOnBhcmFtIGhlYWRlcjogICAgICBsaXN0IG9mIGZlYXR1cmUgbmFtZXMKICAgICAgICAiIiIKICAgICAgICB6aXBwZWQgPSB6aXAobW9kZWwuZmVhdHVyZV9pbXBvcnRhbmNlc18sIGhlYWRlcikKCiAgICAgICAgZmVhdHVyZV9pbXAgPSBwZC5EYXRhRnJhbWUoc29ydGVkKHppcHBlZCksIGNvbHVtbnM9WydmcmVxJywnZmVhdHVyZSddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLnNvcnRfdmFsdWVzKGJ5PSJmcmVxIiwgYXNjZW5kaW5nPUZhbHNlKQoKICAgICAgICBwbHQuZmlndXJlKGZpZ3NpemU9KDIwLCAxMCkpCiAgICAgICAgc25zLmJhcnBsb3QoeD0iZnJlcSIsIHk9ImZlYXR1cmUiLCBkYXRhPWZlYXR1cmVfaW1wKQogICAgICAgIHBsdC50aXRsZSgnTGlnaHRHQk0gRmVhdHVyZXMnKQogICAgICAgIHBsdC50aWdodF9sYXlvdXQoKQogICAgICAgIGZpZyA9IHBsdC5nY2YoKQogICAgICAgIHBsb3RwYXRoID0gcGF0aC5qb2luKHRhcmdldF9wYXRoLCAiZmVhdHVyZS1pbXBvcnRhbmNlcy5wbmciKQogICAgICAgIGZpZy5zYXZlZmlnKHBsb3RwYXRoKQogICAgICAgIGNvbnRleHQubG9nX2FydGlmYWN0KFBsb3RBcnRpZmFjdCgnZmVhdHVyZS1pbXBvcnRhbmNlcy1wbG90JywgYm9keT1maWcpKQoKICAgICAgICB0YWJsZXBhdGggPSBwYXRoLmpvaW4odGFyZ2V0X3BhdGgsICJmZWF0dXJlLWltcG9ydGFuY2VzLXRhYmxlLmNzdiIpCiAgICAgICAgZmVhdHVyZV9pbXAudG9fY3N2KHRhYmxlcGF0aCkKICAgICAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChUYWJsZUFydGlmYWN0KCdmZWF0dXJlLWltcG9ydGFuY2VzLXRhYmxlJywgdGFyZ2V0X3BhdGg9dGFibGVwYXRoKSkKCiAgICAgICAgX2djZl9jbGVhcihwbHQpCgogICAgaWYgY2FsbGFibGUoZ2V0YXR0cihtb2RlbCwgJ3ByZWRpY3RfcHJvYmEnKSk6CiAgICAgICAgeXByZWRfcHJvYnMgPSBtb2RlbC5wcmVkaWN0X3Byb2JhKGRhdGFbJ3h0ZXN0J10pWzosIDFdCiAgICAgICAgeXByZWQgPSBucC53aGVyZSh5cHJlZF9wcm9icyA+PSAwLjUsIDEsIDApCiAgICBlbHNlOgogICAgICAgIHlwcmVkID0gbW9kZWwucHJlZGljdChkYXRhWyd4dGVzdCddKQogICAgICAgIHlwcmVkX3Byb2JzID0gTm9uZQoKICAgIGNvbnRleHQubG9nX3Jlc3VsdCgidGVzdF9hY2N1cmFjeSIsIGZsb2F0KGNsZi5zY29yZShkYXRhWyd4dGVzdCddLCBkYXRhWyd5dGVzdCddKSkpCgogICAgbG9zcyA9IG5wLmFzYXJyYXkobW9kZWwuZXZhbHNfcmVzdWx0X1sndHJhaW4nXVsnYmluYXJ5X2xvZ2xvc3MnXSwgZHR5cGU9bnAuZmxvYXQpCiAgICB2YWxfbG9zcyA9IG5wLmFzYXJyYXkobW9kZWwuZXZhbHNfcmVzdWx0X1sndmFsaWQnXVsnYmluYXJ5X2xvZ2xvc3MnXSwgZHR5cGU9bnAuZmxvYXQpCgogICAgcGxvdF92YWxpZGF0aW9uKGxvc3MsIHZhbF9sb3NzKQogICAgaWYgeXByZWRfcHJvYnM6CiAgICAgICAgcGxvdF9yb2MoZGF0YVsneXRlc3QnXSwgeXByZWRfcHJvYnMpCiAgICBpZiB5cHJlZDoKICAgICAgICBwbG90X2NvbmZ1c2lvbl9tYXRyaXgoZGF0YVsneXRlc3QnXSwgeXByZWQpCiAgICBpZiBoYXNhdHRyKG1vZGVsLCAnZmVhdHVyZV9pbXBvcnRhbmNlc18nKToKICAgICAgICBwbG90X2ltcG9ydGFuY2UobW9kZWwsIGhlYWRlcikKICAgCiAgICBmaWxlcGF0aCA9IHBhdGguam9pbih0YXJnZXRfcGF0aCwgbmFtZSkKICAgIGR1bXAobW9kZWwsIG9wZW4oZmlsZXBhdGgsICd3YicpKQogICAgY29udGV4dC5sb2dfYXJ0aWZhY3Qoa2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3BhdGg9ZmlsZXBhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbHM9ZXhwX2xhYmVscykgICAgCgpkZWYgdHJhaW4oCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIHNyY19maWxlOiBzdHIsCiAgICBoZWFkZXI6IERhdGFJdGVtLAogICAgdGVzdF9zaXplOiBmbG9hdCA9IDAuMSwKICAgIHRyYWluX3ZhbF9zcGxpdDogZmxvYXQgPSAwLjc1LAogICAgc2FtcGxlOiBpbnQgPSAtMSwKICAgIHRhcmdldF9wYXRoOiBzdHIgPSAnJywKICAgIG5hbWU6IHN0ciA9ICcnLAogICAga2V5OiBzdHIgPSAnJywKICAgIGV4cF9sYWJlbHMgPSB7fSwgICMgJ2xpZ2h0Z2JtX3NrbGVhcm4nIGlmIHRoaXMgd2VyZSBhIHBpcGVsaW5lCiAgICB2ZXJib3NlOiBib29sID0gRmFsc2UsCiAgICByYW5kb21fc3RhdGUgPSBucC5yYW5kb20uUmFuZG9tU3RhdGUoMSksCiAgICAqKnNrbGVhcm5fcGFyYW1zCikgLT4gTm9uZToKICAgICIiIlRyYWluIGFuZCBzYXZlIGEgTGlnaHRHQk0gbW9kZWwuCiAgICAKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0gc3JjX2ZpbGU6ICAgICAgICAoJ3JhdycpIG5hbWUgb2YgcmF3IGRhdGEgZmlsZQogICAgOnBhcmFtIGhlYWRlcjogICAgICAgICAgaGVhZGVyIGFydGlmYWN0CiAgICA6cGFyYW0gdGVzdF9zaXplOiAgICAgICAoMC4xKSB0ZXN0IHNldCBzaXplCiAgICA6cGFyYW0gdHJhaW5fdmFsX3NwbGl0OiAoMC43NSkgT25jZSB0aGUgdGVzdCBzZXQgaGFzIGJlZW4gcmVtb3ZlZCB0aGUgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFpbmluZyBzZXQgZ2V0cyB0aGlzIHByb3BvcnRpb24uCiAgICA6cGFyYW0gc2FtcGxlOiAgICAgICAgICAoLTEpLiBTZWxlY3RzIHRoZSBmaXJzdCBuIHJvd3MsIG9yIHNlbGVjdCBhIHNhbXBsZSBzdGFydGluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSB0aGUgZmlyc3QuIElmIG5lZ2F0aXZlIDwtMSwgc2VsZWN0IGEgcmFuZG9tIHNhbXBsZSBmcm9tIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGVudGlyZSBmaWxlCiAgICA6cGFyYW0gdGFyZ2V0X3BhdGg6ICAgICBmb2xkZXIgbG9jYXRpb24gb2YgZmlsZXMKICAgIDpwYXJhbSBuYW1lOiAgICAgICAgICAgIGRlc3RpbmF0aW9uIG5hbWUgZm9yIG1vZGVsIGZpbGUKICAgIDpwYXJhbSBrZXk6ICAgICAgICAgICAgIGtleSBmb3IgbW9kZWwgYXJ0aWZhY3QKICAgIDpwYXJhbSBleHBfbGFiZWxzOiAgICAgIG1ldGFkYXRhIGRpY3QsIHNvbWUga2V5cyBhcmUgcmVxdWlyZWQgKHR5cGUsIGZyYW1ld29yaykuICd0eXBlJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXMgZWl0aGVyIGNsYXNzaWZpZXIgb3IgcmVncmVzc29yLCAnZnJhbWV3b3JrJyBjYW4gYmUgc2tsZWFybiBvciBub3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChza2xlYXJuIG1vZGVscyBoYXZlIGEgZ2VuZXJpYyBpbnRlcmZhY2UpCiAgICA6cGFyYW0gdmVyYm9zZSA6ICAgICAgICAoRmFsc2UpIHNob3cgbWV0cmljcyBmb3IgdHJhaW5pbmcvdmFsaWRhdGlvbiBzdGVwcy4KICAgIDpwYXJhbSByYW5kb21fc3RhdGU6ICAgICgxKSBza2xlYXJuIHJuZyBzZWVkCiAgICA6cGFyYW0gc2tsZWFybl9wYXJhbXMgICBza2xlYXJuIGtleXdvcmQgcGFyYW1zIAogICAgIiIiCiAgICBzcmNmaWxlcGF0aCA9IHBhdGguam9pbih0YXJnZXRfcGF0aCwgc3JjX2ZpbGUpCiAgICBpZiAoc2FtcGxlID09IC0xKSBvciAoc2FtcGxlID49IDEpOgogICAgICAgIHJhdyA9IHBxLnJlYWRfdGFibGUoc3JjZmlsZXBhdGgpLnRvX3BhbmRhcygpCiAgICAgICAgbGFiZWxzID0gcmF3LnBvcCgnbGFiZWxzJykKICAgICAgICByYXcgPSByYXcuaWxvY1s6c2FtcGxlLCA6XQogICAgICAgIGxhYmVscyA9IGxhYmVscy5pbG9jWzpzYW1wbGVdCiAgICBlbHNlOgogICAgICAgIHJhdyA9IHBxLnJlYWRfdGFibGUoc3JjZmlsZXBhdGgpLnRvX3BhbmRhcygpLnNhbXBsZShzYW1wbGUqLTEpCiAgICAgICAgbGFiZWxzID0gcmF3LnBvcCgnbGFiZWxzJykKCiAgICB4LCB4dGVzdCwgeSwgeXRlc3QgPSB0cmFpbl90ZXN0X3NwbGl0KHJhdywgbGFiZWxzLCB0cmFpbl9zaXplPTEtdGVzdF9zaXplLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZG9tX3N0YXRlPXJhbmRvbV9zdGF0ZSkKICAgCiAgICB4dHJhaW4sIHh2YWxpZCwgeXRyYWluLCB5dmFsaWQgPSB0cmFpbl90ZXN0X3NwbGl0KHgsIHksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFpbl9zaXplPXRyYWluX3ZhbF9zcGxpdCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmRvbV9zdGF0ZT1yYW5kb21fc3RhdGUpICAgICAgICAKICAgIAogICAgY2xmID0gbGdiLkxHQk1DbGFzc2lmaWVyKHJhbmRvbV9zdGF0ZT1yYW5kb21fc3RhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyYm9zZT1pbnQodmVyYm9zZSA9PSBUcnVlKSkKCiAgICBldmFsX3Jlc3VsdHMgPSBkaWN0KCkKCiAgICBjbGYuZml0KHh0cmFpbiwgCiAgICAgICAgICAgIHl0cmFpbiwKICAgICAgICAgICAgZXZhbF9zZXQ9Wyh4dmFsaWQsIHl2YWxpZCksICh4dHJhaW4sIHl0cmFpbildLAogICAgICAgICAgICBldmFsX25hbWVzPVsndmFsaWQnLCAndHJhaW4nXSwKICAgICAgICAgICAgY2FsbGJhY2tzPVtsZ2IucmVjb3JkX2V2YWx1YXRpb24oZXZhbF9yZXN1bHRzKV0sCiAgICAgICAgICAgIHZlcmJvc2U9dmVyYm9zZSkKICAgIAogICAgY29udGV4dC5sb2dfcmVzdWx0KCJ0cmFpbl9hY2N1cmFjeSIsIGZsb2F0KGNsZi5zY29yZSh4dHJhaW4sIHl0cmFpbikpKQogICAgCiAgICBsb2dfbGdibV9tb2RlbCgKICAgICAgICBjb250ZXh0LCAKICAgICAgICBjbGYsIAogICAgICAgIGRhdGEgPSB7J3h0ZXN0Jzp4dGVzdCwgJ3l0ZXN0Jzp5dGVzdH0sCiAgICAgICAgdGFyZ2V0X3BhdGg9dGFyZ2V0X3BhdGgsCiAgICAgICAgaGVhZGVyPWxvYWQob3BlbihzdHIoaGVhZGVyKSwgJ3JiJykpLAogICAgICAgIG5hbWU9bmFtZSwgCiAgICAgICAga2V5PWtleSwKICAgICAgICBleHBfbGFiZWxzPWV4cF9sYWJlbHMpCgo=
    base_image: python:3.6-jessie
    commands:
    - rm /conda/lib/python3.6/site-packages/seaborn* -rf
    - pip uninstall -y mlrun
    - pip install -U -q mlrun
    - pip install -U -q kfp
    - pip install -U -q pyarrow
    - pip install -U -q pandas
    - pip install -U -q matplotlib
    - pip install -U -q seaborn
    - pip install -U -q scikit-learn
    - pip install -U -q lightgbm
