kind: job
metadata:
  name: llm-judge
  tag: ''
  hash: 1a07676f0b3c61b661d0787f9d447ccb78cebcf7
  project: ''
  labels:
    author: pgw
  categories:
  - machine-learning
  - monitoring
spec:
  command: ''
  args: []
  image: ''
  build:
    functionSourceCode: IyBDb3B5cmlnaHQgMjAyNCBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAojCiMgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQojIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiMgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiMgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAojIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgojCgppbXBvcnQgcmUKZnJvbSBhYmMgaW1wb3J0IEFCQywgYWJzdHJhY3RtZXRob2QKZnJvbSBmdW5jdG9vbHMgaW1wb3J0IHdyYXBzCmZyb20gdHlwaW5nIGltcG9ydCBBbnksIENsYXNzVmFyLCBEaWN0LCBMaXN0LCBUdXBsZSwgVW5pb24sIFR5cGUsIFR5cGVWYXIsIENhbGxhYmxlCmZyb20gZW51bSBpbXBvcnQgRW51bQppbXBvcnQgbXBpNHB5CmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IHRyYW5zZm9ybWVycwoKaW1wb3J0IG1scnVuCmZyb20gbWxydW4ubW9kZWwgaW1wb3J0IE1vZGVsT2JqCmZyb20gbWxydW4udXRpbHMgaW1wb3J0IGxvZ2dlcgppbXBvcnQgb3BlbmFpCmltcG9ydCBqc29uCmltcG9ydCBwYXRobGliCgojIFRoZXNlIHBybW9wdCBhcmUgdXNlZCB0byBnZW5lcmF0ZSB0aGUgZ3JhZGUgZm9yIExMTS1hcyBhIGp1ZGdlCgoiIiIKQG1pc2N7emhlbmcyMDIzanVkZ2luZywKICAgICAgdGl0bGU9e0p1ZGdpbmcgTExNLWFzLWEtanVkZ2Ugd2l0aCBNVC1CZW5jaCBhbmQgQ2hhdGJvdCBBcmVuYX0sCiAgICAgIGF1dGhvcj17TGlhbm1pbiBaaGVuZyBhbmQgV2VpLUxpbiBDaGlhbmcgYW5kIFlpbmcgU2hlbmcgYW5kIFNpeXVhbiBaaHVhbmcKICAgICAgYW5kIFpoYW5naGFvIFd1IGFuZCBZb25naGFvIFpodWFuZyBhbmQgWmkgTGluIGFuZCBaaHVvaGFuIExpCiAgICAgIGFuZCBEYWNoZW5nIExpIGFuZCBFcmljLiBQIFhpbmcgYW5kIEhhbyBaaGFuZyBhbmQgSm9zZXBoIEUuIEdvbnphbGV6CiAgICAgIGFuZCBJb24gU3RvaWNhfSwKICAgICAgeWVhcj17MjAyM30sCiAgICAgIGVwcmludD17MjMwNi4wNTY4NX0sCiAgICAgIGFyY2hpdmVQcmVmaXg9e2FyWGl2fSwKICAgICAgcHJpbWFyeUNsYXNzPXtjcy5DTH0KfQoiIiIKClNJTkdMRV9HUkFERV9QUk9NUFQgPSAiIiIKVGFzazoKUGxlYXNlIGFjdCBhcyBhbiBpbXBhcnRpYWwganVkZ2UgYW5kIGV2YWx1YXRlIHRoZSBxdWFsaXR5IG9mIHRoZSByZXNwb25zZSBwcm92aWRlZCBieSBhbgpBSSBhc3Npc3RhbnQgdG8gdGhlIHVzZXIgcXVlc3Rpb24gZGlzcGxheWVkIGJlbG93LiBZb3Ugd2lsbCBiZSBnaXZlbiB0aGUgZGVmaW5pdGlvbiBvZiB7bmFtZX0sIGdyYWRpbmcgcnVicmljLCBjb250ZXh0IGluZm9ybWF0aW9uLgpZb3VyIHRhc2sgaXMgdG8gZGV0ZXJtaW5lIGEgbnVtZXJpY2FsIHNjb3JlIG9mIHtuYW1lfSBmb3IgdGhlIHJlc3BvbnNlLiBZb3UgbXVzdCB1c2UgdGhlIGdyYWRpbmcgcnVicmljIHRvIGRldGVybWluZSB5b3VyIHNjb3JlLiBZb3UgbXVzdCBhbHNvIGdpdmUgYSBleHBsYW5hdGlvbiBhYm91dCBob3cgZGlkIHlvdSBkZXRlcm1pbmUgdGhlIHNjb3JlIHN0ZXAtYnktc3RlcC4gUGxlYXNlIHVzZSBjaGFpbiBvZiB0aGlua2luZy4KRXhhbXBsZXMgY291bGQgYmUgaW5jbHVkZWQgYmVibG93IGZvciB5b3VyIHJlZmVyZW5jZS4gTWFrZSBzdXJlIHlvdSB1bmRlcnN0YW5kIHRoZSBncmFkaW5nIHJ1YnJpYyBhbmQgdXNlIHRoZSBleGFtcGxlcyBiZWZvcmUgY29tcGxldGluZyB0aGUgdGFzay4KW0V4YW1wbGVzXToKe2V4YW1wbGVzfQpbVXNlciBRdWVzdGlvbl06CntxdWVzdGlvbn0KW1Jlc3BvbnNlXToKe2Fuc3dlcn0KW0RlZmluaXRpb24gb2Yge25hbWV9XToKe2RlZmluaXRpb259CltHcmFkaW5nIFJ1YnJpY106CntydWJyaWN9CllvdSBtdXN0IHJldHVybiB0aGUgZm9sbG93aW5nIGZpZWxkcyBpbiB5b3VyIG91dHB1dDoKLSBzY29yZTogYSBudW1lcmljYWwgc2NvcmUgb2Yge25hbWV9IGZvciB0aGUgcmVzcG9uc2UKLSBleHBsYW5hdGlvbjogYSBleHBsYW5hdGlvbiBhYm91dCBob3cgZGlkIHlvdSBkZXRlcm1pbmUgdGhlIHNjb3JlIHN0ZXAtYnktc3RlcApbT3V0cHV0XToKIiIiCgpQQUlSX0dSQURFX1BST01QVCA9ICIiIgpUYXNrOgpZb3VyIHRhc2sgaXMgdG8gZGV0ZXJtaW5lIHR3byBudW1lcmljYWwgc2NvcmUgb2Yge25hbWV9IGZvciB0aGUgcmVzcG9uc2VzIGZyb20gdHdvIEFJIGFzc2lzdGFudHMuIFlvdSBtdXN0IHVzZSB0aGUgZ3JhZGluZyBydWJyaWMgdG8gZGV0ZXJtaW5lIHlvdXIgc2NvcmVzLiBZb3UgbXVzdCBhbHNvIGdpdmUgYSBleHBsYW5hdGlvbiBhYm91dCBob3cgZGlkIHlvdSBkZXRlcm1pbmUgdGhlIHNjb3JlcyBzdGVwLWJ5LXN0ZXAuIFBsZWFzZSB1c2luZyBjaGFpbiBvZiB0aGlua2luZy4KRXhhbXBsZXMgY291bGQgYmUgaW5jbHVkZWQgYmVibG93IGZvciB5b3VyIHJlZmVyZW5jZS4gTWFrZSBzdXJlIHlvdSB1bmRlcnN0YW5kIHRoZSBncmFkaW5nIHJ1YnJpYyBhbmQgdXNlIHRoZSBleGFtcGxlcyBiZWZvcmUgY29tcGxldGluZyB0aGUgdGFzay4KW0V4YW1wbGVzXToKe2V4YW1wbGVzfQpbVXNlciBRdWVzdGlvbl06CntxdWVzdGlvbn0KW1Jlc3BvbnNlIG9mIGFzc2lzdGFudCBBXToKe2Fuc3dlckF9CltSZXNwb25zZSBvZiBhc3Npc3RhbnQgQl06CnthbnN3ZXJCfQpbRGVmaW5pdGlvbiBvZiB7bmFtZX1dOgp7ZGVmaW5pdGlvbn0KW0dyYWRpbmcgUnVicmljXToKe3J1YnJpY30KWW91IG11c3QgcmV0dXJuIHRoZSBmb2xsb3dpbmcgZmllbGRzIGluIHlvdXIgb3V0cHV0OgotIHNjb3JlIG9mIGFzc2lzdGFudCBhOiBhIG51bWVyaWNhbCBzY29yZSBvZiB7bmFtZX0gZm9yIHRoZSByZXNwb25zZQotIGV4cGxhbmF0aW9uIG9mIGFzc2lzdGFudCBhOiBhIGV4cGxhbmF0aW9uIGFib3V0IGhvdyBkaWQgeW91IGRldGVybWluZSB0aGUgc2NvcmUgc3RlcC1ieS1zdGVwCi0gc2NvcmUgb2YgYXNzaXN0YW50IGI6IGEgbnVtZXJpY2FsIHNjb3JlIG9mIHtuYW1lfSBmb3IgdGhlIHJlc3BvbnNlCi0gZXhwbGFuYXRpb24gb2YgYXNzaXN0YW50IGI6IGEgZXhwbGFuYXRpb24gYWJvdXQgaG93IGRpZCB5b3UgZGV0ZXJtaW5lIHRoZSBzY29yZSBzdGVwLWJ5LXN0ZXAKW091dHB1dF06CiIiIgoKUkVGX0dSQURFX1BST01QVCA9ICIiIgpUYXNrOgpZb3VyIHRhc2sgaXMgdG8gZGV0ZXJtaW5lIHR3byBudW1lcmljYWwgc2NvcmUgb2Yge25hbWV9IGZvciB0aGUgcmVzcG9uc2VzIGZyb20gdHdvIEFJIGFzc2lzdGFudHMgd2l0aCB0aGUgZ3JvdW5kIHRydXRoIG9mIHRoZSByZXNwb25zZS4gWW91IG11c3QgdXNlIHRoZSBncmFkaW5nIHJ1YnJpYyB0byBkZXRlcm1pbmUgeW91ciBzY29yZXMuIFlvdSBtdXN0IHVzZSB0aGUgZ3JvdW5kIHRydXRoIG9mIHRoZSByZXNwb25zZS4gWW91IG5lZWQgdG8gZ2l2ZSBhIGV4cGxhbmF0aW9uIGFib3V0IGhvdyBkaWQgeW91IGNvbXBhcmUgd2l0aCB0aGUgZ3JvdW5kIHRydXRoIG9mIHRoZSByZXNwb25zZSB0byBkZXRlcm1pbmUgdGhlIHNjb3JlcyBzdGVwLWJ5LXN0ZXAuIFBsZWFzZSB1c2luZyBjaGFpbiBvZiB0aGlua2luZy4KRXhhbXBsZXMgY291bGQgYmUgaW5jbHVkZWQgYmVibG93IGZvciB5b3VyIHJlZmVyZW5jZS4gTWFrZSBzdXJlIHlvdSB1bmRlcnN0YW5kIHRoZSBncmFkaW5nIHJ1YnJpYyBhbmQgdXNlIHRoZSBleGFtcGxlcyBiZWZvcmUgY29tcGxldGluZyB0aGUgdGFzay4KW0V4YW1wbGVzXToKe2V4YW1wbGVzfQpbVXNlciBRdWVzdGlvbl06CntxdWVzdGlvbn0KW1Jlc3BvbnNlIG9mIGFzc2lzdGFudCBBXToKe2Fuc3dlckF9CltSZXNwb25zZSBvZiBhc3Npc3RhbnQgQl06CnthbnN3ZXJCfQpbR3JvdW5kIHRydXRoIG9mIHRoZSByZXNwb25zZV06CntyZWZlcmVuY2V9CltEZWZpbml0aW9uIG9mIHtuYW1lfV06CntkZWZpbml0aW9ufQpbR3JhZGluZyBSdWJyaWNdOgp7cnVicmljfQpZb3UgbXVzdCByZXR1cm4gdGhlIGZvbGxvd2luZyBmaWVsZHMgaW4geW91ciBvdXRwdXQ6Ci0gc2NvcmUgb2YgYXNzaXN0YW50IGE6IGEgbnVtZXJpY2FsIHNjb3JlIG9mIHtuYW1lfSBmb3IgdGhlIHJlc3BvbnNlCi0gZXhwbGFuYXRpb24gb2YgYXNzaXN0YW50IGE6IGEgZXhwbGFuYXRpb24gYWJvdXQgaG93IGRpZCB5b3UgY29tcGFyZSB3aXRoIHRoZSBncm91bmQgdHJ1dGggb2YgdGhlIHJlc3BvbnNlIHRvIGRldGVybWluZSB0aGUgc2NvcmUgc3RlcC1ieS1zdGVwCi0gc2NvcmUgb2YgYXNzaXN0YW50IGI6IGEgbnVtZXJpY2FsIHNjb3JlIG9mIHtuYW1lfSBmb3IgdGhlIHJlc3BvbnNlCi0gZXhwbGFuYXRpb24gb2YgYXNzaXN0YW50IGI6IGEgZXhwbGFuYXRpb24gYWJvdXQgaG93IGRpZCB5b3UgY29tcGFyZSB3aXRoIHRoZSBncm91bmQgdHJ1dGggb2YgdGhlIHJlc3BvbnNlIHRvIGRldGVybWluZSB0aGUgc2NvcmUgc3RlcC1ieS1zdGVwCltPdXRwdXRdOgoiIiIKCgpkZWYgX2NoZWNrX21scnVuX2FuZF9vcGVuX21waSgpIC0+IFR1cGxlWyJtbHJ1bi5NTENsaWVudEN0eCIsICJtcGk0cHkuTVBJLkludHJhY29tbSJdOgogICAgaXNfbXBpID0gRmFsc2UKICAgIHRyeToKICAgICAgICBjb250ZXh0ID0gbWxydW4uZ2V0X29yX2NyZWF0ZV9jdHgobmFtZT0ibWxydW4iKQogICAgICAgIGlzX21waSA9IGNvbnRleHQubGFiZWxzLmdldCgia2luZCIsICJqb2IiKSA9PSAibXBpam9iIgoKICAgICAgICBpZiBpc19tcGk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZyb20gbXBpNHB5IGltcG9ydCBNUEkKCiAgICAgICAgICAgICAgICByZXR1cm4gY29udGV4dCwgTVBJLkNPTU1fV09STEQKICAgICAgICAgICAgZXhjZXB0IE1vZHVsZU5vdEZvdW5kRXJyb3IgYXMgbXBpNHB5X25vdF9mb3VuZDoKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigKICAgICAgICAgICAgICAgICAgICAiVG8gZGlzdHJpYnV0ZSB0aGUgZnVuY3Rpb24gdXNpbmcgTUxSdW4ncyAnbXBpam9iJyB5b3UgbmVlZCB0byBoYXZlIGBtcGk0cHlgIHBhY2thZ2UgaW4geW91ciAiCiAgICAgICAgICAgICAgICAgICAgImludGVycHJldGVyLiBQbGVhc2UgcnVuIGBwaXAgaW5zdGFsbCBtcGk0cHlgIGFuZCBtYWtlIHN1cmUgeW91IGhhdmUgb3Blbi1tcGkuIgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcmFpc2UgbXBpNHB5X25vdF9mb3VuZAogICAgZXhjZXB0IE1vZHVsZU5vdEZvdW5kRXJyb3IgYXMgbW9kdWxlX25vdF9mb3VuZDoKICAgICAgICBpZiBpc19tcGk6CiAgICAgICAgICAgIHJhaXNlIG1vZHVsZV9ub3RfZm91bmQKICAgIHJldHVybiBOb25lLCBOb25lCgoKZGVmIG9wZW5fbXBpX2hhbmRsZXIoCiAgICB3b3JrZXJfaW5wdXRzOiBzdHIsCik6CiAgICAjIENoZWNrIGZvciBNTFJ1biBhbmQgT3Blbk1QSSBhdmFpbGFiaWxpdHk6CiAgICBjb250ZXh0LCBjb21tID0gX2NoZWNrX21scnVuX2FuZF9vcGVuX21waSgpCgogICAgZGVmIGRlY29yYXRvcihoYW5kbGVyKToKICAgICAgICBpZiBjb21tIGlzIE5vbmUgb3IgY29tbS5HZXRfc2l6ZSgpID09IDE6CiAgICAgICAgICAgIHJldHVybiBoYW5kbGVyCgogICAgICAgIEB3cmFwcyhoYW5kbGVyKQogICAgICAgIGRlZiB3cmFwcGVyKCoqa3dhcmdzKToKICAgICAgICAgICAgIyBHZXQgdGhlIG9wZW4gbXBpIGVudmlyb25tZW50IHByb3BlcnRpZXM6CiAgICAgICAgICAgIHNpemUgPSBjb21tLkdldF9zaXplKCkKICAgICAgICAgICAgcmFuayA9IGNvbW0uR2V0X3JhbmsoKQogICAgICAgICAgICBzYW1wbGVfZGYgPSBrd2FyZ3Nbd29ya2VyX2lucHV0c10KCiAgICAgICAgICAgICMgR2l2ZSB0aGUgY29ycmVjdCBjaHVuayBvZiB0aGUgd29ya2VycyBpbnB1dHM6CiAgICAgICAgICAgIGV2ZW5fY2h1bmtfc2l6ZSA9IGxlbihzYW1wbGVfZGYpIC8vIHNpemUKICAgICAgICAgICAgY2h1bmtfc3RhcnQgPSByYW5rICogZXZlbl9jaHVua19zaXplCiAgICAgICAgICAgIGNodW5rX2VuZCA9ICgKICAgICAgICAgICAgICAgIChyYW5rICsgMSkgKiBldmVuX2NodW5rX3NpemUgaWYgcmFuayArIDEgPCBzaXplIGVsc2UgbGVuKHNhbXBsZV9kZikKICAgICAgICAgICAgKQogICAgICAgICAgICBsb2dnZXIuaW5mbygKICAgICAgICAgICAgICAgIGYiUmFuayAje3Jhbmt9OiBQcm9jZXNzaW5nIGlucHV0IGNodW5rIHNhbXBsZSBkYXRhZnJhbWUiCiAgICAgICAgICAgICAgICBmImZyb20gaW5kZXgge2NodW5rX3N0YXJ0fSB0byB7Y2h1bmtfZW5kfS4iCiAgICAgICAgICAgICkKICAgICAgICAgICAgc2FtcGxlX2RmID0gc2FtcGxlX2RmLmlsb2NbY2h1bmtfc3RhcnQ6Y2h1bmtfZW5kOiwgOl0KICAgICAgICAgICAga3dhcmdzW3dvcmtlcl9pbnB1dHNdID0gc2FtcGxlX2RmCgogICAgICAgICAgICAjIFJ1biB0aGUgd29ya2VyOgogICAgICAgICAgICBvdXRwdXQgPSBoYW5kbGVyKCoqa3dhcmdzKQoKICAgICAgICAgICAgIyBTZW5kIHRoZSBvdXRwdXQgdG8gdGhlIHJvb3QgcmFuayAocmFuayAjMCk6CiAgICAgICAgICAgIG91dHB1dCA9IGNvbW0uZ2F0aGVyKG91dHB1dCwgcm9vdD0wKQogICAgICAgICAgICBpZiByYW5rID09IDA6CiAgICAgICAgICAgICAgICAjIEpvaW4gdGhlIG91dHB1dHM6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiQ29sbGVjdGluZyBkYXRhIGZyb20gd29ya2VycyB0byByb290IHdvcmtlci4iKQogICAgICAgICAgICAgICAgZGF0YWZyYW1lID0gcGQuY29uY2F0KG9ianM9W2RmIGZvciBkZiwgXyBpbiBvdXRwdXRdLCBheGlzPTApCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YWZyYW1lCiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgIHJldHVybiB3cmFwcGVyCgogICAgcmV0dXJuIGRlY29yYXRvcgoKCmNsYXNzIExMTUp1ZGdlQmFzZU1ldHJpYyhNb2RlbE9iaiwgQUJDKToKICAgICIiIgogICAgQmFzZSBjbGFzcyBvZiB0aGUgbWV0cmljcyB0aGF0IGNvbXB1dGVkIGJ5IExMTSBhcyBhIGp1ZGdlCiAgICBXZSBkb24ndCBuZWVkIHRoZSB5X3RydWUgYXMgcmVmZXJlbmNlLiBUaGVzZSBtZXRyaWNzIGFyZSB1c2VkIGZvciBtb3JlIG9wZW4tZW5kZWQgcXVlc3Rpb24gZm9yIHRoZSBtb2RlbAogICAgYW5kIHRoZSBhbGdvcml0aG0gaXMgYmFzZWQgb24gdGhlIHBhcGVyIGh0dHBzOi8vYXJ4aXYub3JnL3BkZi8yMzA2LjA1Njg1LnBkZgogICAgIiIiCgogICAgX2RpY3RfZmllbGRzID0gWwogICAgICAgICJuYW1lIiwKICAgICAgICAibW9kZWxfanVkZ2UiLAogICAgICAgICJwcm9tcHRfdGVtcGxhdGUiLAogICAgICAgICJwcm9tcHRfY29uZmlnIiwKICAgICAgICAibW9kZWxfanVkZ2VfY29uZmlnIiwKICAgICAgICAidG9rZW5pemVyX2p1ZGdlX2NvbmZpZyIsCiAgICAgICAgIm1vZGVsX2p1ZGdlX2luZmVyX2NvbmZpZyIsCiAgICBdCiAgICBraW5kID0gImxsbV9qdWRnZV9tZXRyaWMiCiAgICBkZWZhdWx0X25hbWU6IENsYXNzVmFyW3N0cl0gPSAibGxtX2p1ZGdlX21ldHJpYyIKCiAgICBkZWYgX19pbml0X18oCiAgICAgICAgc2VsZiwKICAgICAgICBuYW1lOiBzdHIsCiAgICAgICAgbW9kZWxfanVkZ2U6IHN0ciwKICAgICAgICBwcm9tcHRfdGVtcGxhdGU6IHN0ciwKICAgICAgICBwcm9tcHRfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwKICAgICAgICBtb2RlbF9qdWRnZV9jb25maWc6IERpY3Rbc3RyLCBBbnldID0gTm9uZSwKICAgICAgICB0b2tlbml6ZXJfanVkZ2VfY29uZmlnOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUsCiAgICAgICAgbW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUsCiAgICApOgogICAgICAgICIiIgogICAgICAgIFRoZXNlIG1ldHJpY3MgYXJlIHVzZWQgdG8gZXZhbHVhdGUgdGhlIG1vZGVsIHBlcmZvcm1hbmNlIG9uIGEgZ2l2ZW4gZGF0YXNldAogICAgICAgIDpwYXJhbSBuYW1lOiBuYW1lIG9mIHRoZSBtZXRyaWMKICAgICAgICA6cGFyYW0gbW9kZWxfanVkZ2U6IHRoZSBtb2RlbCBqdWRnZSB0byB1c2UKICAgICAgICA6cGFyYW0gbW9kZWxfanVkZ2VfY29uZmlnOiB0aGUgbW9kZWwganVkZ2UgY29uZmlnCiAgICAgICAgOnBhcmFtIHRva2VuaXplcl9qdWRnZV9jb25maWc6IHRoZSB0b2tlbml6ZXIganVkZ2UgY29uZmlnCiAgICAgICAgOnBhcmFtIG1vZGVsX2p1ZGdlX2luZmVyX2NvbmZpZzogdGhlIG1vZGVsIGp1ZGdlIGluZmVyIGNvbmZpZwogICAgICAgIDpwYXJhbSBwcm9tcHRfdGVtcGxhdGU6IHRoZSBwcm9tcHQgdGVtcGxhdGUgdG8gZmlsbAogICAgICAgIDpwYXJhbSBwcm9tcHRfY29uZmlnOiB0aGUgcHJvbXB0IGNvbmZpZyB0byBmaWxsIHRoZSB0ZW1wbGF0ZSB3aXRoCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5uYW1lID0gbmFtZSBvciBzZWxmLmRlZmF1bHRfbmFtZQogICAgICAgIHNlbGYubW9kZWxfanVkZ2UgPSBtb2RlbF9qdWRnZQogICAgICAgIHNlbGYubW9kZWxfanVkZ2VfY29uZmlnID0gbW9kZWxfanVkZ2VfY29uZmlnCiAgICAgICAgc2VsZi50b2tlbml6ZXJfanVkZ2VfY29uZmlnID0gdG9rZW5pemVyX2p1ZGdlX2NvbmZpZwogICAgICAgIHNlbGYubW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnID0gbW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnCiAgICAgICAgc2VsZi5wcm9tcHRfdGVtcGxhdGUgPSBwcm9tcHRfdGVtcGxhdGUKICAgICAgICBzZWxmLnByb21wdF9jb25maWcgPSBwcm9tcHRfY29uZmlnCgogICAgZGVmIGZpbGxfcHJvbXB0KHNlbGYpIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBGaWxsIHRoZSBwcm9tcHQgdGVtcGxhdGUgd2l0aCB0aGUgcHJvbXB0IGNvbmZpZwogICAgICAgIDpwYXJhbSBwcm9tcHRfdGVtcGxhdGU6IHRoZSBwcm9tcHQgdGVtcGxhdGUgdG8gZmlsbAogICAgICAgIDpwYXJhbSBwcm9tcHRfY29uZmlnOiB0aGUgcHJvbXB0IGNvbmZpZyB0byBmaWxsIHRoZSB0ZW1wbGF0ZSB3aXRoCiAgICAgICAgOnJldHVybnM6IHRoZSBmaWxsZWQgcHJvbXB0CiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oIkZpbGxpbmcgdGhlIHByb21wdCB0ZW1wbGF0ZSB3aXRoIHRoZSBwcm9tcHQgY29uZmlnIikKICAgICAgICByZXR1cm4gc2VsZi5wcm9tcHRfdGVtcGxhdGUuZm9ybWF0KCoqc2VsZi5wcm9tcHRfY29uZmlnKQoKICAgIEBhYnN0cmFjdG1ldGhvZAogICAgZGVmIHByZXBhcmVfanVkZ2Uoc2VsZikgLT4gTm9uZToKICAgICAgICAiIiIKICAgICAgICBQcmVwYXJlIHRoZSBqdWRnZSBtb2RlbAogICAgICAgICIiIgogICAgICAgIHBhc3MKCiAgICBAYWJzdHJhY3RtZXRob2QKICAgIGRlZiBjb21wdXRlX292ZXJfb25lX2RhdGEoc2VsZiwgcXVlc3Rpb246IHN0ciwgcmVzcG9uc2U6IHN0cikgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ29tcHV0ZSB0aGUgbWV0cmljcyBvdmVyIG9uZSBkYXRhIHBvaW50CiAgICAgICAgOnBhcmFtIHF1ZXN0aW9uOiB0aGUgcXVlc3Rpb24gdG8gY29tcHV0ZSB0aGUgbWV0cmljcyBvdmVyCiAgICAgICAgOnBhcmFtIHJlc3BvbnNlOiB0aGUgcmVzcG9uc2UgdG8gY29tcHV0ZSB0aGUgbWV0cmljcyBvdmVyCiAgICAgICAgOnJldHVybnM6IHRoZSBtZXRyaWNzIHNjb3JlIGFuZCB0aGUgZXhwbGFuYXRpb24KICAgICAgICAiIiIKICAgICAgICBwYXNzCgogICAgQGFic3RyYWN0bWV0aG9kCiAgICBkZWYgY29tcHV0ZV9vdmVyX2RhdGEoCiAgICAgICAgc2VsZiwgc2FtcGxlX2RmOiBwZC5EYXRhRnJhbWUsIHRyYWluX2RmOiBwZC5EYXRhRnJhbWUgPSBOb25lCiAgICApIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlciBvbmUgZGF0YSBwb2ludAogICAgICAgIDpwYXJhbSBxdWVzdGlvbjogdGhlIHF1ZXN0aW9uIHRvIGNvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlcgogICAgICAgIDpwYXJhbSByZXNwb25zZTogdGhlIHJlc3BvbnNlIHRvIGNvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlcgogICAgICAgIDpyZXR1cm5zOiB0aGUgbWV0cmljcyBzY29yZSBhbmQgdGhlIGV4cGxhbmF0aW9uCiAgICAgICAgIiIiCiAgICAgICAgcGFzcwoKICAgIEBhYnN0cmFjdG1ldGhvZAogICAgZGVmIGV4dHJhY3Rfc2NvcmVfZXhwbGFuYXRpb24oc2VsZiwgcmVzdWx0OiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEFic3RyYWN0IHRoZSBzdG9yZSBvZiB0aGUgcmVzdWx0CiAgICAgICAgOnBhcmFtIHJlc3VsdDogdGhlIHJlc3VsdCB0ZXh0CiAgICAgICAgOnJldHVybnM6IHRoZSBzdG9yZWQgcmVzdWx0CiAgICAgICAgIiIiCiAgICAgICAgcGFzcwoKCmNsYXNzIExMTUp1ZGdlU2luZ2xlR3JhZGluZyhMTE1KdWRnZUJhc2VNZXRyaWMpOgogICAgIiIiCiAgICBCYXNlIGNsYXNzIGZvciBMTE0gYXMgYSBqdWRnZSB1c2luZyBzaW5nbGUgZ3JhZGluZy4KICAgIHlvdSBuZWVkIHRvIGRlZmluZSB0aGUgZGVmbml0aW9uIG9mIHRoZSBtZXRyaWNzIGFuZCBnaXZlIHRoZSBncmFkaW5nIG9mIHRoZSBydWJpYwogICAgIiIiCgogICAgX2RpY3RfZmllbGRzID0gWwogICAgICAgICJuYW1lIiwKICAgICAgICAibW9kZWxfanVkZ2UiLAogICAgICAgICJtb2RlbF9qdWRnZV9jb25maWciLAogICAgICAgICJtb2RlbF9qdWRnZV9pbmZlcl9jb25maWciLAogICAgICAgICJwcm9tcHRfdGVtcGxhdGUiLAogICAgICAgICJwcm9tcHRfY29uZmlnIiwKICAgICAgICAidG9rZW5pemVyX2p1ZGdlX2NvbmZpZyIsCiAgICBdCiAgICBraW5kID0gImxsbV9qdWRnZV9zaW5nbGVfZ3JhZGluZyIKCiAgICBkZWYgX19pbml0X18oCiAgICAgICAgc2VsZiwKICAgICAgICBuYW1lOiBzdHIsCiAgICAgICAgbW9kZWxfanVkZ2U6IHN0ciwKICAgICAgICBtb2RlbF9qdWRnZV9jb25maWc6IERpY3Rbc3RyLCBBbnldLAogICAgICAgIG1vZGVsX2p1ZGdlX2luZmVyX2NvbmZpZzogRGljdFtzdHIsIEFueV0sCiAgICAgICAgcHJvbXB0X3RlbXBsYXRlOiBzdHIsCiAgICAgICAgcHJvbXB0X2NvbmZpZzogRGljdFtzdHIsIEFueV0sCiAgICAgICAgdG9rZW5pemVyX2p1ZGdlX2NvbmZpZzogRGljdFtzdHIsIEFueV0gPSBOb25lLAogICAgKToKICAgICAgICAiIiIKICAgICAgICBpbml0IHRoZSBjbGFzcwogICAgICAgIDpwYXJhbSBuYW1lOiBuYW1lIG9mIHRoZSBtZXRyaWMKICAgICAgICA6cGFyYW0gbW9kZWxfanVkZ2U6IHRoZSBtb2RlbCBqdWRnZSB0byB1c2UKICAgICAgICA6cGFyYW0gbW9kZWxfanVkZ2VfY29uZmlnOiB0aGUgbW9kZWwganVkZ2UgY29uZmlnCiAgICAgICAgOnBhcmFtIHRva2VuaXplcl9qdWRnZV9jb25maWc6IHRoZSB0b2tlbml6ZXIganVkZ2UgY29uZmlnCiAgICAgICAgOnBhcmFtIG1vZGVsX2p1ZGdlX2luZmVyX2NvbmZpZzogdGhlIG1vZGVsIGp1ZGdlIGluZmVyIGNvbmZpZwogICAgICAgIDpwYXJhbSBwcm9tcHRfdGVtcGxhdGU6IHRoZSBwcm9tcHQgdGVtcGxhdGUgdG8gZmlsbAogICAgICAgIDpwYXJhbSBwcm9tcHRfY29uZmlnOiB0aGUgcHJvbXB0IGNvbmZpZyB0byBmaWxsIHRoZSB0ZW1wbGF0ZSB3aXRoCiAgICAgICAgIiIiCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygKICAgICAgICAgICAgbmFtZSwKICAgICAgICAgICAgbW9kZWxfanVkZ2UsCiAgICAgICAgICAgIHByb21wdF90ZW1wbGF0ZSwKICAgICAgICAgICAgcHJvbXB0X2NvbmZpZywKICAgICAgICAgICAgbW9kZWxfanVkZ2VfY29uZmlnLAogICAgICAgICAgICB0b2tlbml6ZXJfanVkZ2VfY29uZmlnLAogICAgICAgICAgICBtb2RlbF9qdWRnZV9pbmZlcl9jb25maWcsCiAgICAgICAgKQoKICAgIGRlZiBwcmVwYXJlX2p1ZGdlKHNlbGYpIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgUHJlcGFyZSB0aGUganVkZ2UgbW9kZWwgaXQgd2lsbCBpbml0IHRoZSB0b2tlbml6ZXIgYW5kIHRoZSBtb2RlbAogICAgICAgICIiIgogICAgICAgIGxvZ2dlci5pbmZvKGYiUHJlcGFyaW5nIHRoZSBqdWRnZSBtb2RlbCB7c2VsZi5tb2RlbF9qdWRnZX0iKQogICAgICAgIHNlbGYudG9rZW5pemVyID0gdHJhbnNmb3JtZXJzLkF1dG9Ub2tlbml6ZXIuZnJvbV9wcmV0cmFpbmVkKAogICAgICAgICAgICBzZWxmLm1vZGVsX2p1ZGdlLCAqKnNlbGYudG9rZW5pemVyX2p1ZGdlX2NvbmZpZwogICAgICAgICkKICAgICAgICBzZWxmLm1vZGVsID0gdHJhbnNmb3JtZXJzLkF1dG9Nb2RlbEZvckNhdXNhbExNLmZyb21fcHJldHJhaW5lZCgKICAgICAgICAgICAgc2VsZi5tb2RlbF9qdWRnZSwgKipzZWxmLm1vZGVsX2p1ZGdlX2NvbmZpZwogICAgICAgICkKCiAgICBkZWYgY29tcHV0ZV9vdmVyX29uZV9kYXRhKHNlbGYsIHF1ZXN0aW9uLCByZXNwb25zZSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ29tcHV0ZSB0aGUgbWV0cmljcyBvdmVyIG9uZSBkYXRhIHBvaW50CiAgICAgICAgOnBhcmFtIHF1ZXN0aW9uOiB0aGUgcXVlc3Rpb24gdG8gY29tcHV0ZSB0aGUgbWV0cmljcyBvdmVyCiAgICAgICAgOnBhcmFtIHJlc3BvbnNlOiB0aGUgcmVzcG9uc2UgdG8gY29tcHV0ZSB0aGUgbWV0cmljcyBvdmVyCiAgICAgICAgOnJldHVybnM6IHRoZSBtZXRyaWNzIHNjb3JlIGFuZCB0aGUgZXhwbGFuYXRpb24KICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbygKICAgICAgICAgICAgZiJDb21wdXRpbmcgdGhlIG1ldHJpY3Mgb3ZlciBvbmUgZGF0YSBwb2ludCB3aXRoIHtxdWVzdGlvbn0gYW5kIHtyZXNwb25zZX0iCiAgICAgICAgKQogICAgICAgIHNlbGYucHJvbXB0X2NvbmZpZ1sicXVlc3Rpb24iXSA9IHF1ZXN0aW9uCiAgICAgICAgc2VsZi5wcm9tcHRfY29uZmlnWyJhbnN3ZXIiXSA9IHJlc3BvbnNlCiAgICAgICAgaW5wdXRfaWRzID0gc2VsZi50b2tlbml6ZXIoc2VsZi5maWxsX3Byb21wdCgpLCByZXR1cm5fdGVuc29ycz0icHQiKS5pbnB1dF9pZHMKICAgICAgICBvdXRwdXRzID0gc2VsZi5tb2RlbC5nZW5lcmF0ZSgKICAgICAgICAgICAgaW5wdXRfaWRzLAogICAgICAgICAgICBwYWRfdG9rZW5faWQ9c2VsZi50b2tlbml6ZXIucGFkX3Rva2VuX2lkLAogICAgICAgICAgICBlb3NfdG9rZW5faWQ9c2VsZi50b2tlbml6ZXIuZW9zX3Rva2VuX2lkLAogICAgICAgICAgICAqKnNlbGYubW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnLAogICAgICAgICkKCiAgICAgICAgcmVzcG9uc2VfaWRzID0gb3V0cHV0c1swXQogICAgICAgIHJlc3BvbnNlID0gc2VsZi50b2tlbml6ZXIuZGVjb2RlKHJlc3BvbnNlX2lkcywgc2tpcF9zcGVjaWFsX3Rva2Vucz1UcnVlKQogICAgICAgIHJlc19kaWMgPSBzZWxmLmV4dHJhY3Rfc2NvcmVfZXhwbGFuYXRpb24ocmVzcG9uc2UpCiAgICAgICAgcmV0dXJuIHJlc19kaWMKCiAgICBAb3Blbl9tcGlfaGFuZGxlcih3b3JrZXJfaW5wdXRzPSJzYW1wbGVfZGYiKQogICAgZGVmIGNvbXB1dGVfb3Zlcl9kYXRhKAogICAgICAgIHNlbGYsIHNhbXBsZV9kZjogcGQuRGF0YUZyYW1lLCB0cmFpbl9kZjogcGQuRGF0YUZyYW1lID0gTm9uZQogICAgKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDb21wdXRlIHRoZSBtZXRyaWNzIG92ZXIgYWxsIGRhdGEKICAgICAgICA6cGFyYW0gc2FtcGxlX2RmOiB0aGUgc2FtcGxlIGRhdGFmcmFtZQogICAgICAgIDpwYXJhbSB0cmFpbl9kZjogdGhlIHRyYWluIGRhdGFmcmFtZQogICAgICAgIDpyZXR1cm5zOiB0aGUgbWV0cmljcyBzY29yZSBhbmQgdGhlIGV4cGxhbmF0aW9uCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5wcmVwYXJlX2p1ZGdlKCkKICAgICAgICByZXNfZGYgPSBwZC5EYXRhRnJhbWUoY29sdW1ucz1bInF1ZXN0aW9uIiwgImFuc3dlciIsICJzY29yZSIsICJleHBsYW5hdGlvbiJdKQoKICAgICAgICBsb2dnZXIuaW5mbygiQ29tcHV0aW5nIHRoZSBtZXRyaWNzIG92ZXIgYWxsIGRhdGEiKQogICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihzYW1wbGVfZGYpKToKICAgICAgICAgICAgcmVzX2RpYyA9IHNlbGYuY29tcHV0ZV9vdmVyX29uZV9kYXRhKAogICAgICAgICAgICAgICAgc2FtcGxlX2RmLmxvY1tpLCAicXVlc3Rpb24iXSwgc2FtcGxlX2RmLmxvY1tpLCAiYW5zd2VyIl0KICAgICAgICAgICAgKQogICAgICAgICAgICByZXNfZGYubG9jW2ldID0gWwogICAgICAgICAgICAgICAgc2FtcGxlX2RmLmxvY1tpLCAicXVlc3Rpb24iXSwKICAgICAgICAgICAgICAgIHNhbXBsZV9kZi5sb2NbaSwgImFuc3dlciJdLAogICAgICAgICAgICAgICAgcmVzX2RpY1sic2NvcmUiXSwKICAgICAgICAgICAgICAgIHJlc19kaWNbImV4cGxhbmF0aW9uIl0sCiAgICAgICAgICAgIF0KCiAgICAgICAgcmV0dXJuIHJlc19kZgoKICAgIGRlZiBleHRyYWN0X3Njb3JlX2V4cGxhbmF0aW9uKHNlbGYsIHJlc3VsdDogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBBYnN0cmFjdCB0aGUgc3RvcmUgb2YgdGhlIHJlc3VsdAogICAgICAgIDpwYXJhbSByZXN1bHQ6IHRoZSByZXN1bHQgdG8gc3RvcmUKICAgICAgICA6cmV0dXJuczogdGhlIHN0b3JlZCByZXN1bHQKICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbyhmIkV4dHJhY3RpbmcgdGhlIHNjb3JlIGFuZCBleHBsYW5hdGlvbiBmcm9tIHtyZXN1bHR9IikKICAgICAgICBzY29yZV9wYXR0ZXJuID0gciJcYnNjb3JlOlxzKihcZCspXGIiCiAgICAgICAgZXhwbGFuYXRpb25fcGF0dGVybiA9IHIiZXhwbGFuYXRpb246XHMqKC4qPylccyooPz1cYlNjb3JlOnwkKSIKCiAgICAgICAgc2NvcmVfbWF0Y2ggPSByZS5zZWFyY2goc2NvcmVfcGF0dGVybiwgcmVzdWx0KQogICAgICAgIHNjb3JlID0gaW50KHNjb3JlX21hdGNoLmdyb3VwKDEpKSBpZiBzY29yZV9tYXRjaCBlbHNlIE5vbmUKCiAgICAgICAgZXhwbGFuYXRpb25fbWF0Y2ggPSByZS5zZWFyY2goZXhwbGFuYXRpb25fcGF0dGVybiwgcmVzdWx0LCByZS5ET1RBTEwpCiAgICAgICAgZXhwbGFuYXRpb24gPSBleHBsYW5hdGlvbl9tYXRjaC5ncm91cCgxKS5zdHJpcCgpIGlmIGV4cGxhbmF0aW9uX21hdGNoIGVsc2UgTm9uZQoKICAgICAgICByZXR1cm4geyJzY29yZSI6IHNjb3JlLCAiZXhwbGFuYXRpb24iOiBleHBsYW5hdGlvbn0KCgpjbGFzcyBMTE1KdWRnZVBhaXJ3aXNlR3JhZGluZyhMTE1KdWRnZUJhc2VNZXRyaWMpOgogICAgIiIiCiAgICBCYXNlIGNsYXNzIGZvciBMTE0gYXMgYSBqdWRnZSB1c2luZyBwYWlyd2lzZSBncmFkaW5nLgogICAgeW91IG5lZWQgdG8gZGVmaW5lIHRoZSBkZWZuaXRpb24gb2YgdGhlIG1ldHJpY3MgYW5kIGdpdmUgdGhlIGdyYWRpbmcgb2YgdGhlIHJ1YmljCiAgICB5b3UgbmVlZCB0byBnaXZlIGEgYmFzZSBtb2RlbCB0byBjb21wYXJlIHRoZSBtb2RlbCB0bwogICAgIiIiCgogICAgX2RpY3RfZmllbGRzID0gWwogICAgICAgICJuYW1lIiwKICAgICAgICAibW9kZWxfanVkZ2UiLAogICAgICAgICJtb2RlbF9qdWRnZV9jb25maWciLAogICAgICAgICJtb2RlbF9iZW5jaF9tYXJrIiwKICAgICAgICAibW9kZWxfYmVuY2hfbWFya19jb25maWciLAogICAgICAgICJtb2RlbF9iZW5jaF9tYXJrX2luZmVyX2NvbmZpZyIsCiAgICAgICAgInRva2VuaXplcl9iZW5jaF9tYXJrX2NvbmZpZyIsCiAgICAgICAgInByb21wdF90ZW1wbGF0ZSIsCiAgICAgICAgInByb21wdF9jb25maWciLAogICAgICAgICJ0b2tlbml6ZXJfanVkZ2VfY29uZmlnIiwKICAgICAgICAibW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnIiwKICAgIF0KICAgIGtpbmQgPSAibGxtX2p1ZGdlX3BhaXJ3aXNlX2dyYWRpbmciCgogICAgZGVmIF9faW5pdF9fKAogICAgICAgIHNlbGYsCiAgICAgICAgbmFtZTogc3RyLAogICAgICAgIG1vZGVsX2p1ZGdlOiBzdHIsCiAgICAgICAgbW9kZWxfanVkZ2VfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwKICAgICAgICBtb2RlbF9iZW5jaF9tYXJrOiBzdHIsCiAgICAgICAgbW9kZWxfYmVuY2hfbWFya19jb25maWc6IERpY3Rbc3RyLCBBbnldLAogICAgICAgIG1vZGVsX2JlbmNoX21hcmtfaW5mZXJfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwKICAgICAgICB0b2tlbml6ZXJfYmVuY2hfbWFya19jb25maWc6IERpY3Rbc3RyLCBBbnldLAogICAgICAgIHByb21wdF90ZW1wbGF0ZTogc3RyLAogICAgICAgIHByb21wdF9jb25maWc6IERpY3Rbc3RyLCBBbnldLAogICAgICAgIHRva2VuaXplcl9qdWRnZV9jb25maWc6IERpY3Rbc3RyLCBBbnldID0gTm9uZSwKICAgICAgICBtb2RlbF9qdWRnZV9pbmZlcl9jb25maWc6IERpY3Rbc3RyLCBBbnldID0gTm9uZSwKICAgICk6CiAgICAgICAgIiIiCiAgICAgICAgaW5pdCB0aGUgY2xhc3MKICAgICAgICA6cGFyYW0gbmFtZTogbmFtZSBvZiB0aGUgbWV0cmljCiAgICAgICAgOnBhcmFtIG1vZGVsX2p1ZGdlOiB0aGUgbW9kZWwganVkZ2UgdG8gdXNlCiAgICAgICAgOnBhcmFtIHRva2VuaXplcl9qdWRnZV9jb25maWc6IHRoZSB0b2tlbml6ZXIganVkZ2UgY29uZmlnCiAgICAgICAgOnBhcmFtIG1vZGVsX2p1ZGdlX2NvbmZpZzogdGhlIG1vZGVsIGp1ZGdlIGNvbmZpZwogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZV9pbmZlcl9jb25maWc6IHRoZSBtb2RlbCBqdWRnZSBpbmZlciBjb25maWcKICAgICAgICA6cGFyYW0gbW9kZWxfYmVuY2hfbWFyazogdGhlIG1vZGVsIGJlbmNoIG1hcmsgdG8gdXNlCiAgICAgICAgOnBhcmFtIG1vZGVsX2JlbmNoX21hcmtfY29uZmlnOiB0aGUgbW9kZWwgYmVuY2ggbWFyayBjb25maWcKICAgICAgICA6cGFyYW0gbW9kZWxfYmVuY2hfbWFya19pbmZlcl9jb25maWc6IHRoZSBtb2RlbCBiZW5jaCBtYXJrIGluZmVyIGNvbmZpZwogICAgICAgIDpwYXJhbSB0b2tlbml6ZXJfYmVuY2hfbWFya19jb25maWc6IHRoZSB0b2tlbml6ZXIgYmVuY2ggbWFyayBjb25maWcKICAgICAgICA6cGFyYW0gcHJvbXB0X3RlbXBsYXRlOiB0aGUgcHJvbXB0IHRlbXBsYXRlIHRvIGZpbGwKICAgICAgICA6cGFyYW0gcHJvbXB0X2NvbmZpZzogdGhlIHByb21wdCBjb25maWcgdG8gZmlsbCB0aGUgdGVtcGxhdGUgd2l0aAogICAgICAgICIiIgogICAgICAgIHN1cGVyKCkuX19pbml0X18oCiAgICAgICAgICAgIG5hbWUsCiAgICAgICAgICAgIG1vZGVsX2p1ZGdlLAogICAgICAgICAgICBwcm9tcHRfdGVtcGxhdGUsCiAgICAgICAgICAgIHByb21wdF9jb25maWcsCiAgICAgICAgICAgIG1vZGVsX2p1ZGdlX2NvbmZpZywKICAgICAgICAgICAgdG9rZW5pemVyX2p1ZGdlX2NvbmZpZywKICAgICAgICAgICAgbW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnLAogICAgICAgICkKICAgICAgICBzZWxmLm1vZGVsX2JlbmNoX21hcmsgPSBtb2RlbF9iZW5jaF9tYXJrCiAgICAgICAgc2VsZi5tb2RlbF9iZW5jaF9tYXJrX2NvbmZpZyA9IG1vZGVsX2JlbmNoX21hcmtfY29uZmlnCiAgICAgICAgc2VsZi5tb2RlbF9iZW5jaF9tYXJrX2luZmVyX2NvbmZpZyA9IG1vZGVsX2JlbmNoX21hcmtfaW5mZXJfY29uZmlnCiAgICAgICAgc2VsZi50b2tlbml6ZXJfYmVuY2hfbWFya19jb25maWcgPSB0b2tlbml6ZXJfYmVuY2hfbWFya19jb25maWcKCiAgICBkZWYgcHJlcGFyZV9qdWRnZShzZWxmKSAtPiBOb25lOgogICAgICAgICIiIgogICAgICAgIGluaXQgdGhlIHRva2VuaXplciBhbmQgdGhlIG1vZGVsCiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oZiJQcmVwYXJpbmcgdGhlIGp1ZGdlIG1vZGVsIHtzZWxmLm1vZGVsX2p1ZGdlfSIpCiAgICAgICAgc2VsZi50b2tlbml6ZXIgPSB0cmFuc2Zvcm1lcnMuQXV0b1Rva2VuaXplci5mcm9tX3ByZXRyYWluZWQoCiAgICAgICAgICAgIHNlbGYubW9kZWxfanVkZ2UsICoqc2VsZi50b2tlbml6ZXJfanVkZ2VfY29uZmlnCiAgICAgICAgKQogICAgICAgIHNlbGYubW9kZWwgPSB0cmFuc2Zvcm1lcnMuQXV0b01vZGVsRm9yQ2F1c2FsTE0uZnJvbV9wcmV0cmFpbmVkKAogICAgICAgICAgICBzZWxmLm1vZGVsX2p1ZGdlLCAqKnNlbGYubW9kZWxfanVkZ2VfY29uZmlnCiAgICAgICAgKQoKICAgIGRlZiBwcmVwYXJlX2JlbmNoX21hcmtfbW9kZWwoc2VsZikgLT4gTm9uZToKICAgICAgICAiIiIKICAgICAgICBQcmVwYXJlIHRoZSBtb2RlbCB0aGF0IHVzZWQgZm9yIGJlbmNoIG1hcmtpbmcKICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbyhmIlByZXBhcmluZyB0aGUgYmVuY2ggbWFyayBtb2RlbCB7c2VsZi5tb2RlbF9iZW5jaF9tYXJrfSIpCiAgICAgICAgc2VsZi50b2tlbml6ZXJfYmVuY2hfbWFyayA9IHRyYW5zZm9ybWVycy5BdXRvVG9rZW5pemVyLmZyb21fcHJldHJhaW5lZCgKICAgICAgICAgICAgc2VsZi5tb2RlbF9iZW5jaF9tYXJrLCAqKnNlbGYudG9rZW5pemVyX2JlbmNoX21hcmtfY29uZmlnCiAgICAgICAgKQogICAgICAgIHNlbGYubW9kZWxfYmVuY2hfbWFyayA9IHRyYW5zZm9ybWVycy5BdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoCiAgICAgICAgICAgIHNlbGYubW9kZWxfYmVuY2hfbWFyaywgKipzZWxmLm1vZGVsX2JlbmNoX21hcmtfY29uZmlnCiAgICAgICAgKQoKICAgIGRlZiBjb21wdXRlX2JlbmNoX21hcmtfcmVzcG9uc2Uoc2VsZiwgcXVlc3Rpb24pIC0+IHN0cjoKICAgICAgICAiIiIKICAgICAgICBDb21wdXRlIHRoZSByZXNwb25zZSBvZiB0aGUgYmVuY2ggbWFyayBtb2RlbAogICAgICAgIDpwYXJhbSBxdWVzdGlvbjogdGhlIHF1ZXN0aW9uIHRvIGFzayB0aGUgbW9kZWwKICAgICAgICA6cmV0dXJuczogdGhlIHJlc3BvbnNlCiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oZiJDb21wdXRpbmcgdGhlIGJlbmNoIG1hcmsgcmVzcG9uc2UgZm9yIHtxdWVzdGlvbn0iKQogICAgICAgIGlucHV0X2lkcyA9IHNlbGYudG9rZW5pemVyX2JlbmNoX21hcmsocXVlc3Rpb24sIHJldHVybl90ZW5zb3JzPSJwdCIpLmlucHV0X2lkcwogICAgICAgIG91dHB1dHMgPSBzZWxmLm1vZGVsX2JlbmNoX21hcmsuZ2VuZXJhdGUoCiAgICAgICAgICAgIGlucHV0X2lkcywKICAgICAgICAgICAgcGFkX3Rva2VuX2lkPXNlbGYudG9rZW5pemVyX2JlbmNoX21hcmsucGFkX3Rva2VuX2lkLAogICAgICAgICAgICBlb3NfdG9rZW5faWQ9c2VsZi50b2tlbml6ZXJfYmVuY2hfbWFyay5lb3NfdG9rZW5faWQsCiAgICAgICAgICAgICoqc2VsZi5tb2RlbF9iZW5jaF9tYXJrX2luZmVyX2NvbmZpZywKICAgICAgICApCgogICAgICAgIHJlc3BvbnNlX2lkcyA9IG91dHB1dHNbMF0KICAgICAgICByZXNwb25zZSA9IHNlbGYudG9rZW5pemVyX2JlbmNoX21hcmsuZGVjb2RlKAogICAgICAgICAgICByZXNwb25zZV9pZHMsIHNraXBfc3BlY2lhbF90b2tlbnM9VHJ1ZQogICAgICAgICkKICAgICAgICBsb2dnZXIuaW5mbyhmIlJlc3BvbnNlIG9mIHRoZSBiZW5jaCBtYXJrIG1vZGVsIGlzIHtyZXNwb25zZX0iKQoKICAgICAgICByZXR1cm4gcmVzcG9uc2UKCiAgICBkZWYgY29tcHV0ZV9vdmVyX29uZV9kYXRhKHNlbGYsIHF1ZXN0aW9uLCByZXNwb25zZSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ29tcHV0ZSB0aGUgbWV0cmljcyBvdmVyIG9uZSBkYXRhIHBvaW50CiAgICAgICAgOnBhcmFtIGt3YXJnczogdGhlIGRhdGEgdG8gY29tcHV0ZSB0aGUgbWV0cmljcyBvdmVyCiAgICAgICAgOnJldHVybnM6IHRoZSBtZXRyaWNzIHNjb3JlIGFuZCB0aGUgZXhwbGFuYXRpb24KICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbyhmIkNvbXB1dGluZyB0aGUgbWV0cmljcyBvdmVyIHtxdWVzdGlvbn0gYW5kIHtyZXNwb25zZX0iKQogICAgICAgIHNlbGYucHJvbXB0X2NvbmZpZ1sicXVlc3Rpb24iXSA9IHF1ZXN0aW9uCiAgICAgICAgc2VsZi5wcm9tcHRfY29uZmlnWyJhbnN3ZXJBIl0gPSByZXNwb25zZQogICAgICAgIHNlbGYucHJvbXB0X2NvbmZpZ1siYW5zd2VyQiJdID0gc2VsZi5jb21wdXRlX2JlbmNoX21hcmtfcmVzcG9uc2UocXVlc3Rpb24pCiAgICAgICAgaW5wdXRfaWRzID0gc2VsZi50b2tlbml6ZXIoc2VsZi5maWxsX3Byb21wdCgpLCByZXR1cm5fdGVuc29ycz0icHQiKS5pbnB1dF9pZHMKICAgICAgICBvdXRwdXRzID0gc2VsZi5tb2RlbC5nZW5lcmF0ZSgKICAgICAgICAgICAgaW5wdXRfaWRzLAogICAgICAgICAgICBwYWRfdG9rZW5faWQ9c2VsZi50b2tlbml6ZXIucGFkX3Rva2VuX2lkLAogICAgICAgICAgICBlb3NfdG9rZW5faWQ9c2VsZi50b2tlbml6ZXIuZW9zX3Rva2VuX2lkLAogICAgICAgICAgICAqKnNlbGYubW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnLAogICAgICAgICkKCiAgICAgICAgcmVzcG9uc2VfaWRzID0gb3V0cHV0c1swXQogICAgICAgIHJlc3BvbnNlID0gc2VsZi50b2tlbml6ZXIuZGVjb2RlKHJlc3BvbnNlX2lkcywgc2tpcF9zcGVjaWFsX3Rva2Vucz1UcnVlKQoKICAgICAgICBsb2dnZXIuaW5mbyhmIlJlc3BvbnNlIG9mIHRoZSBqdWRnZSBtb2RlbCBpcyB7cmVzcG9uc2V9IikKICAgICAgICByZXNfZGljID0gc2VsZi5leHRyYWN0X3Njb3JlX2V4cGxhbmF0aW9uKHJlc3BvbnNlKQogICAgICAgIHJlc19kaWNbImFuc3dlckIiXSA9IHNlbGYucHJvbXB0X2NvbmZpZ1siYW5zd2VyQiJdCiAgICAgICAgcmV0dXJuIHJlc19kaWMKCiAgICBAb3Blbl9tcGlfaGFuZGxlcih3b3JrZXJfaW5wdXRzPSJzYW1wbGVfZGYiKQogICAgZGVmIGNvbXB1dGVfb3Zlcl9kYXRhKAogICAgICAgIHNlbGYsIHNhbXBsZV9kZjogcGQuRGF0YUZyYW1lLCB0cmFpbl9kZjogcGQuRGF0YUZyYW1lID0gTm9uZQogICAgKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDb21wdXRlIHRoZSBtZXRyaWNzIG92ZXIgYWxsIGRhdGEKICAgICAgICA6cGFyYW0gc2FtcGxlX2RmOiB0aGUgc2FtcGxlIGRhdGFmcmFtZQogICAgICAgIDpwYXJhbSB0cmFpbl9kZjogdGhlIHRyYWluIGRhdGFmcmFtZQogICAgICAgIDpyZXR1cm5zOiB0aGUgbWV0cmljcyBzY29yZSBhbmQgdGhlIGV4cGxhbmF0aW9uCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5wcmVwYXJlX2p1ZGdlKCkKICAgICAgICBzZWxmLnByZXBhcmVfYmVuY2hfbWFya19tb2RlbCgpCiAgICAgICAgcmVzX2RmID0gcGQuRGF0YUZyYW1lKAogICAgICAgICAgICBjb2x1bW5zPVsKICAgICAgICAgICAgICAgICJxdWVzdGlvbiIsCiAgICAgICAgICAgICAgICAiYW5zd2VyQSIsCiAgICAgICAgICAgICAgICAiYW5zd2VyQiIsCiAgICAgICAgICAgICAgICAic2NvcmVfb2ZfYXNzaXN0YW50X2EiLAogICAgICAgICAgICAgICAgImV4cGxhbmF0aW9uX29mX2Fzc2lzdGFudF9hIiwKICAgICAgICAgICAgICAgICJzY29yZV9vZl9hc3Npc3RhbnRfYiIsCiAgICAgICAgICAgICAgICAiZXhwbGFuYXRpb25fb2ZfYXNzaXN0YW50X2IiLAogICAgICAgICAgICBdCiAgICAgICAgKQoKICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oc2FtcGxlX2RmKSk6CiAgICAgICAgICAgIHJlc19kaWMgPSBzZWxmLmNvbXB1dGVfb3Zlcl9vbmVfZGF0YSgKICAgICAgICAgICAgICAgIHNhbXBsZV9kZi5sb2NbaSwgInF1ZXN0aW9uIl0sCiAgICAgICAgICAgICAgICBzYW1wbGVfZGYubG9jW2ksICJhbnN3ZXIiXSwKICAgICAgICAgICAgKQogICAgICAgICAgICByZXNfZGYubG9jW2ldID0gWwogICAgICAgICAgICAgICAgc2FtcGxlX2RmLmxvY1tpLCAicXVlc3Rpb24iXSwKICAgICAgICAgICAgICAgIHNhbXBsZV9kZi5sb2NbaSwgImFuc3dlciJdLAogICAgICAgICAgICAgICAgcmVzX2RpY1siYW5zd2VyQiJdLAogICAgICAgICAgICAgICAgcmVzX2RpY1sic2NvcmVfb2ZfYXNzaXN0YW50X2EiXSwKICAgICAgICAgICAgICAgIHJlc19kaWNbImV4cGxhbmF0aW9uX29mX2Fzc2lzdGFudF9hIl0sCiAgICAgICAgICAgICAgICByZXNfZGljWyJzY29yZV9vZl9hc3Npc3RhbnRfYiJdLAogICAgICAgICAgICAgICAgcmVzX2RpY1siZXhwbGFuYXRpb25fb2ZfYXNzaXN0YW50X2IiXSwKICAgICAgICAgICAgXQoKICAgICAgICByZXR1cm4gcmVzX2RmCgogICAgZGVmIGV4dHJhY3Rfc2NvcmVfZXhwbGFuYXRpb24oc2VsZiwgcmVzcG9uc2UpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEV4dHJhY3QgdGhlIHNjb3JlIGFuZCB0aGUgZXhwbGFuYXRpb24gZnJvbSB0aGUgcmVzcG9uc2UKICAgICAgICA6cGFyYW0gcmVzcG9uc2U6IHRoZSByZXNwb25zZSB0byBleHRyYWN0IHRoZSBzY29yZSBhbmQgdGhlIGV4cGxhbmF0aW9uIGZyb20KICAgICAgICA6cmV0dXJuczogdGhlIHNjb3JlIGFuZCB0aGUgZXhwbGFuYXRpb24KICAgICAgICAiIiIKICAgICAgICAjIEZpbmQgdGhlIHBvc2l0aW9uIG9mIHRoZSAiW091dHB1dF06IiBtYXJrZXIKICAgICAgICBvdXRwdXRfbWFya2VyX2luZGV4ID0gcmVzcG9uc2UuZmluZCgiW091dHB1dF06IikKICAgICAgICBpZiBvdXRwdXRfbWFya2VyX2luZGV4ID09IC0xOgogICAgICAgICAgICByZXR1cm4gIk5vICdbT3V0cHV0XTonIG1hcmtlciBmb3VuZCIKCiAgICAgICAgIyBFeHRyYWN0IHRoZSBwYXJ0IG9mIHRoZSByZXNwb25zZSBhZnRlciB0aGUgIltPdXRwdXRdOiIgbWFya2VyCiAgICAgICAgcmVzcG9uc2VfYWZ0ZXJfb3V0cHV0ID0gcmVzcG9uc2Vbb3V0cHV0X21hcmtlcl9pbmRleCArIGxlbigiW091dHB1dF06IikgOl0KCiAgICAgICAgIyBBZGp1c3RlZCBwYXR0ZXJuIHRvIG1hdGNoIHRoZSB0ZXh0IGZvcm1hdCBhbmQgc2VwYXJhdGUgbGluZXMKICAgICAgICBwYXR0ZXJuID0gciItIHNjb3JlIG9mIGFzc2lzdGFudCAoW2FiQUJdKTogKFxkKVxzKi0gZXhwbGFuYXRpb24gb2YgYXNzaXN0YW50IFwxOiAoLio/KVxzKig/PS0gc2NvcmUgb2YgYXNzaXN0YW50fCQpIgogICAgICAgIG1hdGNoZXMgPSByZS5maW5kYWxsKHBhdHRlcm4sIHJlc3BvbnNlX2FmdGVyX291dHB1dCwgcmUuRE9UQUxMKQoKICAgICAgICBpZiBtYXRjaGVzOgogICAgICAgICAgICByZXN1bHRfZGljdCA9IHt9CiAgICAgICAgICAgIGZvciBtYXRjaCBpbiBtYXRjaGVzOgogICAgICAgICAgICAgICAgYXNzaXN0YW50LCBzY29yZSwgZXhwbGFuYXRpb24gPSBtYXRjaAogICAgICAgICAgICAgICAgcmVzdWx0X2RpY3RbZiJzY29yZV9vZl9hc3Npc3RhbnRfe2Fzc2lzdGFudH0iLmxvd2VyKCldID0gaW50KHNjb3JlKQogICAgICAgICAgICAgICAgcmVzdWx0X2RpY3RbCiAgICAgICAgICAgICAgICAgICAgZiJleHBsYW5hdGlvbl9vZl9hc3Npc3RhbnRfe2Fzc2lzdGFudH0iLmxvd2VyKCkKICAgICAgICAgICAgICAgIF0gPSBleHBsYW5hdGlvbi5zdHJpcCgpCiAgICAgICAgICAgIHJldHVybiByZXN1bHRfZGljdAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCiAgICAgICAgICAgICAgICAiTm8gbWF0Y2hlcyBmb3VuZCBhZnRlciAnW091dHB1dF06JyBtYXJrZXIuICIKICAgICAgICAgICAgICAgICJQbGVhc2UgY2hlY2sgdGhlIGZvcm1hdCBvZiB0aGUgcmVzcG9uc2UuIgogICAgICAgICAgICApCgoKY2xhc3MgTExNSnVkZ2VSZWZlcmVuY2VHcmFkaW5nKExMTUp1ZGdlUGFpcndpc2VHcmFkaW5nKToKICAgICIiIgogICAgTExNIEp1ZGdlIFJlZmVyZW5jZSBHcmFkaW5nIGNsYXNzCiAgICB5b3UgbmVlZCB0byBnaXZlIHRoZSBuYW1lIG9mIHRoZSBtZXRyaWNzLCBnaXZlIHRoZSBncmFkaW5nIHJ1YnJpYyBhbmQgdGhlIGJlbmNoIG1hcmsgbW9kZWwgdG8gdXNlCiAgICBUaGlzIGNsYXNzIHJlcXVyaWUgeW91IGtub3cgdGhlIHlfdHJ1ZSBvZiB0aGUgcmVzcG9uc2UKICAgICIiIgoKICAgIF9kaWN0X2ZpZWxkcyA9IFsKICAgICAgICAibmFtZSIsCiAgICAgICAgIm1vZGVsX2p1ZGdlIiwKICAgICAgICAibW9kZWxfanVkZ2VfY29uZmlnIiwKICAgICAgICAibW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnIiwKICAgICAgICAidG9rZW5pemVyX2p1ZGdlX2NvbmZpZyIsCiAgICAgICAgIm1vZGVsX2JlbmNoX21hcmsiLAogICAgICAgICJtb2RlbF9iZW5jaF9tYXJrX2NvbmZpZyIsCiAgICAgICAgIm1vZGVsX2JlbmNoX21hcmtfaW5mZXJfY29uZmlnIiwKICAgICAgICAidG9rZW5pemVyX2JlbmNoX21hcmtfY29uZmlnIiwKICAgICAgICAicHJvbXB0X3RlbXBsYXRlIiwKICAgICAgICAicHJvbXB0X2NvbmZpZyIsCiAgICBdCiAgICBraW5kID0gImxsbV9qdWRnZV9yZWZlcmVuY2VfZ3JhZGluZyIKCiAgICBkZWYgX19pbml0X18oCiAgICAgICAgc2VsZiwKICAgICAgICBuYW1lOiBzdHIsCiAgICAgICAgbW9kZWxfanVkZ2U6IHN0ciwKICAgICAgICBtb2RlbF9qdWRnZV9jb25maWc6IERpY3Rbc3RyLCBBbnldLAogICAgICAgIG1vZGVsX2p1ZGdlX2luZmVyX2NvbmZpZzogRGljdFtzdHIsIEFueV0sCiAgICAgICAgdG9rZW5pemVyX2p1ZGdlX2NvbmZpZzogRGljdFtzdHIsIEFueV0sCiAgICAgICAgbW9kZWxfYmVuY2hfbWFyazogc3RyLAogICAgICAgIG1vZGVsX2JlbmNoX21hcmtfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwKICAgICAgICB0b2tlbml6ZXJfYmVuY2hfbWFya19jb25maWc6IERpY3Rbc3RyLCBBbnldLAogICAgICAgIG1vZGVsX2JlbmNoX21hcmtfaW5mZXJfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwKICAgICAgICBwcm9tcHRfdGVtcGxhdGU6IHN0ciwKICAgICAgICBwcm9tcHRfY29uZmlnOiBEaWN0W3N0ciwgc3RyXSwKICAgICk6CiAgICAgICAgIiIiCiAgICAgICAgaW5pdCB0aGUgZ3JhZGluZyB3aXRoIHJlZmVyZW5jZSBjbGFzcwogICAgICAgIDpwYXJhbSBuYW1lOiB0aGUgbmFtZSBvZiB0aGUgbWV0cmljcwogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZTogdGhlIG1vZGVsIHRvIHVzZSBmb3IgZ3JhZGluZwogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZV9jb25maWc6IHRoZSBjb25maWcgb2YgdGhlIG1vZGVsIHRvIHVzZSBmb3IgZ3JhZGluZwogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZV9pbmZlcl9jb25maWc6IHRoZSBjb25maWcgb2YgdGhlIG1vZGVsIHRvIHVzZSBmb3IgaW5mZXJlbmNlCiAgICAgICAgOnBhcmFtIHRva2VuaXplcl9qdWRnZV9jb25maWc6IHRoZSBjb25maWcgb2YgdGhlIHRva2VuaXplciB0byB1c2UgZm9yIGdyYWRpbmcKICAgICAgICA6cGFyYW0gbW9kZWxfYmVuY2hfbWFyazogdGhlIG1vZGVsIHRvIHVzZSBmb3IgYmVuY2ggbWFya2luZwogICAgICAgIDpwYXJhbSBtb2RlbF9iZW5jaF9tYXJrX2NvbmZpZzogdGhlIGNvbmZpZyBvZiB0aGUgbW9kZWwgdG8gdXNlIGZvciBiZW5jaCBtYXJraW5nCiAgICAgICAgOnBhcmFtIHRva2VuaXplcl9iZW5jaF9tYXJrX2NvbmZpZzogdGhlIGNvbmZpZyBvZiB0aGUgdG9rZW5pemVyIHRvIHVzZSBmb3IgYmVuY2ggbWFya2luZwogICAgICAgIDpwYXJhbSBtb2RlbF9iZW5jaF9tYXJrX2luZmVyX2NvbmZpZzogdGhlIGNvbmZpZyBvZiB0aGUgbW9kZWwgdG8gdXNlIGZvciBpbmZlcmVuY2UKICAgICAgICA6cGFyYW0gcHJvbXB0X3RlbXBsYXRlOiB0aGUgdGVtcGxhdGUgb2YgdGhlIHByb21wdCB0byB1c2UKICAgICAgICA6cGFyYW0gcHJvbXB0X2NvbmZpZzogdGhlIGNvbmZpZyBvZiB0aGUgcHJvbXB0IHRvIHVzZQogICAgICAgICIiIgogICAgICAgIHN1cGVyKCkuX19pbml0X18oCiAgICAgICAgICAgIG5hbWUsCiAgICAgICAgICAgIG1vZGVsX2p1ZGdlLAogICAgICAgICAgICBtb2RlbF9qdWRnZV9jb25maWcsCiAgICAgICAgICAgIG1vZGVsX2JlbmNoX21hcmssCiAgICAgICAgICAgIG1vZGVsX2JlbmNoX21hcmtfY29uZmlnLAogICAgICAgICAgICBtb2RlbF9iZW5jaF9tYXJrX2luZmVyX2NvbmZpZywKICAgICAgICAgICAgdG9rZW5pemVyX2JlbmNoX21hcmtfY29uZmlnLAogICAgICAgICAgICBwcm9tcHRfdGVtcGxhdGUsCiAgICAgICAgICAgIHByb21wdF9jb25maWcsCiAgICAgICAgICAgIHRva2VuaXplcl9qdWRnZV9jb25maWcsCiAgICAgICAgICAgIG1vZGVsX2p1ZGdlX2luZmVyX2NvbmZpZywKICAgICAgICApCgogICAgZGVmIGNvbXB1dGVfb3Zlcl9vbmVfZGF0YShzZWxmLCBxdWVzdGlvbiwgcmVzcG9uc2UsIHJlZmVyZW5jZSkgLT4gRGljdFtzdHIsIEFueV06CiAgICAgICAgIiIiCiAgICAgICAgQ29tcHV0ZSB0aGUgbWV0cmljcyBvdmVyIG9uZSBkYXRhIHBvaW50CiAgICAgICAgOnBhcmFtIGt3YXJnczogdGhlIGRhdGEgdG8gY29tcHV0ZSB0aGUgbWV0cmljcyBvdmVyCiAgICAgICAgOnJldHVybnM6IHRoZSBtZXRyaWNzIHNjb3JlIGFuZCB0aGUgZXhwbGFuYXRpb24KICAgICAgICAiIiIKICAgICAgICBzZWxmLnByb21wdF9jb25maWdbInJlZmVyZW5jZSJdID0gcmVmZXJlbmNlCiAgICAgICAgcmVzX2RpYyA9IHN1cGVyKCkuY29tcHV0ZV9vdmVyX29uZV9kYXRhKHF1ZXN0aW9uLCByZXNwb25zZSkKICAgICAgICByZXR1cm4gcmVzX2RpYwoKICAgIEBvcGVuX21waV9oYW5kbGVyKHdvcmtlcl9pbnB1dHM9InNhbXBsZV9kZiIpCiAgICBkZWYgY29tcHV0ZV9vdmVyX2RhdGEoCiAgICAgICAgc2VsZiwgc2FtcGxlX2RmOiBwZC5EYXRhRnJhbWUsIHRyYWluX2RmOiBwZC5EYXRhRnJhbWUgPSBOb25lCiAgICApIC0+IHBkLkRhdGFGcmFtZToKICAgICAgICAiIiIKICAgICAgICBDb21wdXRlIHRoZSBtZXRyaWNzIG92ZXIgYSBkYXRhc2V0CiAgICAgICAgOnBhcmFtIHNhbXBsZV9kZjogdGhlIGRhdGEgdG8gY29tcHV0ZSB0aGUgbWV0cmljcyBvdmVyCiAgICAgICAgOnJldHVybnM6IHRoZSBtZXRyaWNzIHNjb3JlIGFuZCB0aGUgZXhwbGFuYXRpb24KICAgICAgICAiIiIKICAgICAgICBzZWxmLnByZXBhcmVfanVkZ2UoKQogICAgICAgIHNlbGYucHJlcGFyZV9iZW5jaF9tYXJrX21vZGVsKCkKICAgICAgICByZXNfZGYgPSBwZC5EYXRhRnJhbWUoCiAgICAgICAgICAgIGNvbHVtbnM9WwogICAgICAgICAgICAgICAgInF1ZXN0aW9uIiwKICAgICAgICAgICAgICAgICJhbnN3ZXJBIiwKICAgICAgICAgICAgICAgICJhbnN3ZXJCIiwKICAgICAgICAgICAgICAgICJyZWZlcmVuY2UiLAogICAgICAgICAgICAgICAgInNjb3JlX29mX2Fzc2lzdGFudF9hIiwKICAgICAgICAgICAgICAgICJleHBsYW5hdGlvbl9vZl9hc3Npc3RhbnRfYSIsCiAgICAgICAgICAgICAgICAic2NvcmVfb2ZfYXNzaXN0YW50X2IiLAogICAgICAgICAgICAgICAgImV4cGxhbmF0aW9uX29mX2Fzc2lzdGFudF9iIiwKICAgICAgICAgICAgXQogICAgICAgICkKCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKHNhbXBsZV9kZikpOgogICAgICAgICAgICByZXNfZGljID0gc2VsZi5jb21wdXRlX292ZXJfb25lX2RhdGEoCiAgICAgICAgICAgICAgICBzYW1wbGVfZGYubG9jW2ksICJxdWVzdGlvbiJdLAogICAgICAgICAgICAgICAgc2FtcGxlX2RmLmxvY1tpLCAiYW5zd2VyIl0sCiAgICAgICAgICAgICAgICBzYW1wbGVfZGYubG9jW2ksICJyZWZlcmVuY2UiXSwKICAgICAgICAgICAgKQogICAgICAgICAgICByZXNfZGYubG9jW2ldID0gWwogICAgICAgICAgICAgICAgc2FtcGxlX2RmLmxvY1tpLCAicXVlc3Rpb24iXSwKICAgICAgICAgICAgICAgIHNhbXBsZV9kZi5sb2NbaSwgImFuc3dlciJdLAogICAgICAgICAgICAgICAgc2FtcGxlX2RmLmxvY1tpLCAicmVmZXJlbmNlIl0sCiAgICAgICAgICAgICAgICByZXNfZGljWyJhbnN3ZXJCIl0sCiAgICAgICAgICAgICAgICByZXNfZGljWyJzY29yZV9vZl9hc3Npc3RhbnRfYSJdLAogICAgICAgICAgICAgICAgcmVzX2RpY1siZXhwbGFuYXRpb25fb2ZfYXNzaXN0YW50X2EiXSwKICAgICAgICAgICAgICAgIHJlc19kaWNbInNjb3JlX29mX2Fzc2lzdGFudF9iIl0sCiAgICAgICAgICAgICAgICByZXNfZGljWyJleHBsYW5hdGlvbl9vZl9hc3Npc3RhbnRfYiJdLAogICAgICAgICAgICBdCgogICAgICAgIHJldHVybiByZXNfZGYKCgpjbGFzcyBPUEVOQUlKdWRnZVNpbmdsZUdyYWRpbmcoTExNSnVkZ2VTaW5nbGVHcmFkaW5nKToKICAgICIiIgogICAgVXNpbmcgQVBJIHRvIGp1ZGdlIHRoZSByZXNwb25zZQogICAgIiIiCgogICAgX2RpY3RfZmllbGRzID0gWwogICAgICAgICJuYW1lIiwKICAgICAgICAibW9kZWxfanVkZ2UiLAogICAgICAgICJtb2RlbF9qdWRnZV9jb25maWciLAogICAgICAgICJwcm9tcHRfdGVtcGxhdGUiLAogICAgICAgICJwcm9tcHRfY29uZmlnIiwKICAgICAgICAibW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnIiwKICAgIF0KICAgIGtpbmQgPSAiT1BFTkFJX2p1ZGdlX3NpbmdsZV9ncmFkaW5nIgoKICAgIGRlZiBfX2luaXRfXygKICAgICAgICBzZWxmLAogICAgICAgIG5hbWU6IHN0ciwKICAgICAgICBtb2RlbF9qdWRnZTogc3RyLAogICAgICAgIG1vZGVsX2p1ZGdlX2NvbmZpZzogRGljdFtzdHIsIEFueV0sCiAgICAgICAgcHJvbXB0X3RlbXBsYXRlOiBzdHIsCiAgICAgICAgcHJvbXB0X2NvbmZpZzogRGljdFtzdHIsIHN0cl0sCiAgICAgICAgbW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnOiBEaWN0W3N0ciwgQW55XSA9IE5vbmUsCiAgICApOgogICAgICAgICIiIgogICAgICAgIGluaXQgdGhlIGdyYWRpbmcgd2l0aCByZWZlcmVuY2UgY2xhc3MKICAgICAgICA6cGFyYW0gbmFtZTogdGhlIG5hbWUgb2YgdGhlIG1ldHJpY3MKICAgICAgICA6cGFyYW0gbW9kZWxfanVkZ2U6IHRoZSBtb2RlbCB0byB1c2UgZm9yIGdyYWRpbmcKICAgICAgICA6cGFyYW0gbW9kZWxfanVkZ2VfY29uZmlnOiB0aGUgY29uZmlnIG9mIHRoZSBtb2RlbCB0byB1c2UgZm9yIGdyYWRpbmcKICAgICAgICA6cGFyYW0gbW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnOiB0aGUgY29uZmlnIG9mIHRoZSBtb2RlbCB0byB1c2UgZm9yIGluZmVyZW5jZQogICAgICAgIDpwYXJhbSBwcm9tcHRfdGVtcGxhdGU6IHRoZSB0ZW1wbGF0ZSBvZiB0aGUgcHJvbXB0IHRvIHVzZQogICAgICAgIDpwYXJhbSBwcm9tcHRfY29uZmlnOiB0aGUgY29uZmlnIG9mIHRoZSBwcm9tcHQgdG8gdXNlCiAgICAgICAgIiIiCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygKICAgICAgICAgICAgbmFtZSwKICAgICAgICAgICAgbW9kZWxfanVkZ2UsCiAgICAgICAgICAgIG1vZGVsX2p1ZGdlX2NvbmZpZywKICAgICAgICAgICAgbW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnLAogICAgICAgICAgICBwcm9tcHRfdGVtcGxhdGUsCiAgICAgICAgICAgIHByb21wdF9jb25maWcsCiAgICAgICAgKQoKICAgIGRlZiBwcmVwYXJlX2p1ZGdlKHNlbGYpIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgUHJlcGFyZSB0aGUganVkZ2UgbW9kZWwKICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbygiUHJlcGFyZSB0aGUgb3BlbkFJIG1vZGVsIGFzIGp1ZGdlIikKICAgICAgICBzZWxmLm1vZGVsID0gb3BlbmFpLk9wZW5BSSgKICAgICAgICAgICAgYXBpX2tleT1zZWxmLm1vZGVsX2p1ZGdlX2NvbmZpZ1siYXBpX2tleSJdLAogICAgICAgICAgICBiYXNlX3VybD1zZWxmLm1vZGVsX2p1ZGdlX2NvbmZpZ1siYmFzZV91cmwiXSwKICAgICAgICApCgogICAgZGVmIGV4dHJhY3Rfc2NvcmVfZXhwbGFuYXRpb24oc2VsZiwgcmVzdWx0OiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIEFic3RyYWN0IHRoZSBzdG9yZSBvZiB0aGUgcmVzdWx0CiAgICAgICAgOnBhcmFtIHJlc3VsdDogdGhlIHJlc3VsdCB0byBzdG9yZQogICAgICAgIDpyZXR1cm5zOiB0aGUgc3RvcmVkIHJlc3VsdAogICAgICAgICIiIgogICAgICAgIGxvZ2dlci5pbmZvKGYiRXh0cmFjdGluZyB0aGUgc2NvcmUgYW5kIGV4cGxhbmF0aW9uIGZyb20ge3Jlc3VsdH0iKQogICAgICAgIHNjb3JlX3BhdHRlcm4gPSByJyJzY29yZSI6XHMqKFxkKyknCiAgICAgICAgZXhwbGFuYXRpb25fcGF0dGVybiA9IHInImV4cGxhbmF0aW9uIjpccyoiKFteIl0rKSInCgogICAgICAgIHNjb3JlX21hdGNoID0gcmUuc2VhcmNoKHNjb3JlX3BhdHRlcm4sIHJlc3VsdCkKICAgICAgICBzY29yZSA9IGludChzY29yZV9tYXRjaC5ncm91cCgxKSkgaWYgc2NvcmVfbWF0Y2ggZWxzZSBOb25lCgogICAgICAgIGV4cGxhbmF0aW9uX21hdGNoID0gcmUuc2VhcmNoKGV4cGxhbmF0aW9uX3BhdHRlcm4sIHJlc3VsdCwgcmUuRE9UQUxMKQogICAgICAgIGV4cGxhbmF0aW9uID0gZXhwbGFuYXRpb25fbWF0Y2guZ3JvdXAoMSkuc3RyaXAoKSBpZiBleHBsYW5hdGlvbl9tYXRjaCBlbHNlIE5vbmUKCiAgICAgICAgcmV0dXJuIHsic2NvcmUiOiBzY29yZSwgImV4cGxhbmF0aW9uIjogZXhwbGFuYXRpb259CgogICAgZGVmIGNvbXB1dGVfb3Zlcl9vbmVfZGF0YShzZWxmLCBxdWVzdGlvbiwgcmVzcG9uc2UpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlciBvbmUgZGF0YSBwb2ludAogICAgICAgIDpwYXJhbSBrd2FyZ3M6IHRoZSBkYXRhIHRvIGNvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlcgogICAgICAgIDpyZXR1cm5zOiB0aGUgbWV0cmljcyBzY29yZSBhbmQgdGhlIGV4cGxhbmF0aW9uCiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oZiJDb21wdXRlIHRoZSBtZXRyaWNzIG92ZXIgb25lIGRhdGEgcG9pbnQgdXNpbmcgb3BlbkFJJ3MgbW9kZWwiKQogICAgICAgIHNlbGYucHJvbXB0X2NvbmZpZ1siYW5zd2VyIl0gPSByZXNwb25zZQogICAgICAgIHNlbGYucHJvbXB0X2NvbmZpZ1sicXVlc3Rpb24iXSA9IHF1ZXN0aW9uCiAgICAgICAgcHJvbXB0ID0gc2VsZi5maWxsX3Byb21wdCgpCiAgICAgICAgcmVzID0gc2VsZi5tb2RlbC5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSgKICAgICAgICAgICAgbW9kZWw9c2VsZi5tb2RlbF9qdWRnZSwgbWVzc2FnZXM9W3sicm9sZSI6ICJ1c2VyIiwgImNvbnRlbnQiOiBwcm9tcHR9XQogICAgICAgICkKICAgICAgICByZXNfZGljID0gc2VsZi5leHRyYWN0X3Njb3JlX2V4cGxhbmF0aW9uKHJlcy5jaG9pY2VzWzBdLm1lc3NhZ2UuY29udGVudCkKICAgICAgICByZXR1cm4gcmVzX2RpYwoKCmNsYXNzIE9QRU5BSUp1ZGdlUGFpcndpc2VHcmFkaW5nKExMTUp1ZGdlUGFpcndpc2VHcmFkaW5nKToKICAgICIiIgogICAgVXNpbmcgQVBJIHRvIGp1ZGdlIHRoZSByZXNwb25zZQogICAgIiIiCgogICAgX2RpY3RfZmllbGRzID0gWwogICAgICAgICJuYW1lIiwKICAgICAgICAibW9kZWxfanVkZ2UiLAogICAgICAgICJtb2RlbF9qdWRnZV9jb25maWciLAogICAgICAgICJtb2RlbF9iZW5jaF9tYXJrIiwKICAgICAgICAibW9kZWxfYmVuY2hfbWFya19jb25maWciLAogICAgICAgICJtb2RlbF9iZW5jaF9tYXJrX2luZmVyX2NvbmZpZyIsCiAgICAgICAgInRva2VuaXplcl9iZW5jaF9tYXJrX2NvbmZpZyIsCiAgICAgICAgInByb21wdF90ZW1wbGF0ZSIsCiAgICAgICAgInByb21wdF9jb25maWciLAogICAgICAgICJtb2RlbF9qdWRnZV9pbmZlcl9jb25maWciLAogICAgXQogICAga2luZCA9ICJPUEVOQUlfanVkZ2VfcGFpcl9ncmFkaW5nIgoKICAgIGRlZiBfX2luaXRfXygKICAgICAgICBzZWxmLAogICAgICAgIG5hbWU6IHN0ciwKICAgICAgICBtb2RlbF9qdWRnZTogc3RyLAogICAgICAgIG1vZGVsX2p1ZGdlX2NvbmZpZzogRGljdFtzdHIsIEFueV0sCiAgICAgICAgbW9kZWxfYmVuY2hfbWFyazogc3RyLAogICAgICAgIG1vZGVsX2JlbmNoX21hcmtfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwKICAgICAgICBtb2RlbF9iZW5jaF9tYXJrX2luZmVyX2NvbmZpZzogRGljdFtzdHIsIEFueV0sCiAgICAgICAgdG9rZW5pemVyX2JlbmNoX21hcmtfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwKICAgICAgICBwcm9tcHRfdGVtcGxhdGU6IHN0ciwKICAgICAgICBwcm9tcHRfY29uZmlnOiBEaWN0W3N0ciwgc3RyXSwKICAgICAgICBtb2RlbF9qdWRnZV9pbmZlcl9jb25maWc6IERpY3Rbc3RyLCBBbnldID0gTm9uZSwKICAgICk6CiAgICAgICAgIiIiCiAgICAgICAgaW5pdCB0aGUgZ3JhZGluZyB3aXRoIHJlZmVyZW5jZSBjbGFzcwogICAgICAgIDpwYXJhbSBuYW1lOiB0aGUgbmFtZSBvZiB0aGUgbWV0cmljcwogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZTogdGhlIG1vZGVsIHRvIHVzZSBmb3IgZ3JhZGluZwogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZV9jb25maWc6IHRoZSBjb25maWcgb2YgdGhlIG1vZGVsIHRvIHVzZSBmb3IgZ3JhZGluZwogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZV9pbmZlcl9jb25maWc6IHRoZSBjb25maWcgb2YgdGhlIG1vZGVsIHRvIHVzZSBmb3IgaW5mZXJlbmNlCiAgICAgICAgOnBhcmFtIHByb21wdF90ZW1wbGF0ZTogdGhlIHRlbXBsYXRlIG9mIHRoZSBwcm9tcHQgdG8gdXNlCiAgICAgICAgOnBhcmFtIHByb21wdF9jb25maWc6IHRoZSBjb25maWcgb2YgdGhlIHByb21wdCB0byB1c2UKICAgICAgICAiIiIKICAgICAgICBzdXBlcigpLl9faW5pdF9fKAogICAgICAgICAgICBuYW1lLAogICAgICAgICAgICBtb2RlbF9qdWRnZSwKICAgICAgICAgICAgbW9kZWxfanVkZ2VfY29uZmlnLAogICAgICAgICAgICBtb2RlbF9iZW5jaF9tYXJrLAogICAgICAgICAgICBtb2RlbF9iZW5jaF9tYXJrX2NvbmZpZywKICAgICAgICAgICAgbW9kZWxfYmVuY2hfbWFya19pbmZlcl9jb25maWcsCiAgICAgICAgICAgIHRva2VuaXplcl9iZW5jaF9tYXJrX2NvbmZpZywKICAgICAgICAgICAgcHJvbXB0X3RlbXBsYXRlLAogICAgICAgICAgICBwcm9tcHRfY29uZmlnLAogICAgICAgICAgICBtb2RlbF9qdWRnZV9pbmZlcl9jb25maWcsCiAgICAgICAgKQoKICAgIGRlZiBwcmVwYXJlX2p1ZGdlKHNlbGYpIC0+IE5vbmU6CiAgICAgICAgIiIiCiAgICAgICAgUHJlcGFyZSB0aGUganVkZ2UgbW9kZWwKICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbygiUHJlcGFyZSB0aGUgb3BlbkFJIG1vZGVsIGFzIGp1ZGdlIikKICAgICAgICBzZWxmLm1vZGVsID0gb3BlbmFpLk9wZW5BSSgKICAgICAgICAgICAgYXBpX2tleT1zZWxmLm1vZGVsX2p1ZGdlX2NvbmZpZ1siYXBpX2tleSJdLAogICAgICAgICAgICBiYXNlX3VybD1zZWxmLm1vZGVsX2p1ZGdlX2NvbmZpZ1siYmFzZV91cmwiXSwKICAgICAgICApCgogICAgZGVmIGNvbXB1dGVfb3Zlcl9vbmVfZGF0YShzZWxmLCBxdWVzdGlvbiwgcmVzcG9uc2UpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgICAgICIiIgogICAgICAgIENvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlciBvbmUgZGF0YSBwb2ludAogICAgICAgIDpwYXJhbSBrd2FyZ3M6IHRoZSBkYXRhIHRvIGNvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlcgogICAgICAgIDpyZXR1cm5zOiB0aGUgbWV0cmljcyBzY29yZSBhbmQgdGhlIGV4cGxhbmF0aW9uCiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oZiJDb21wdXRpbmcgdGhlIG1ldHJpY3Mgb3ZlciB7cXVlc3Rpb259IGFuZCB7cmVzcG9uc2V9IikKICAgICAgICBzZWxmLnByb21wdF9jb25maWdbInF1ZXN0aW9uIl0gPSBxdWVzdGlvbgogICAgICAgIHNlbGYucHJvbXB0X2NvbmZpZ1siYW5zd2VyQSJdID0gcmVzcG9uc2UKICAgICAgICBzZWxmLnByb21wdF9jb25maWdbImFuc3dlckIiXSA9IHNlbGYuY29tcHV0ZV9iZW5jaF9tYXJrX3Jlc3BvbnNlKHF1ZXN0aW9uKQogICAgICAgIHByb21wdCA9IHNlbGYuZmlsbF9wcm9tcHQoKQogICAgICAgIHJlcyA9IHNlbGYubW9kZWwuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUoCiAgICAgICAgICAgIG1vZGVsPXNlbGYubW9kZWxfanVkZ2UsIG1lc3NhZ2VzPVt7InJvbGUiOiAidXNlciIsICJjb250ZW50IjogcHJvbXB0fV0KICAgICAgICApCiAgICAgICAgcmVzX2RpYyA9IHNlbGYuZXh0cmFjdF9zY29yZV9leHBsYW5hdGlvbihyZXMuY2hvaWNlc1swXS5tZXNzYWdlLmNvbnRlbnQpCiAgICAgICAgcmVzX2RpY1siYW5zd2VyQiJdID0gc2VsZi5wcm9tcHRfY29uZmlnWyJhbnN3ZXJCIl0KICAgICAgICByZXR1cm4gcmVzX2RpYwoKICAgIGRlZiBleHRyYWN0X3Njb3JlX2V4cGxhbmF0aW9uKHNlbGYsIHJlc3BvbnNlKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBFeHRyYWN0IHRoZSBzY29yZSBhbmQgdGhlIGV4cGxhbmF0aW9uIGZyb20gdGhlIHJlc3BvbnNlCiAgICAgICAgOnBhcmFtIHJlc3BvbnNlOiB0aGUgcmVzcG9uc2UgdG8gZXh0cmFjdCB0aGUgc2NvcmUgYW5kIHRoZSBleHBsYW5hdGlvbiBmcm9tCiAgICAgICAgOnJldHVybnM6IHRoZSBzY29yZSBhbmQgdGhlIGV4cGxhbmF0aW9uCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXMgPSBqc29uLmxvYWRzKHJlc3BvbnNlKQogICAgICAgICAgICByZXN1bHRfZGljdCA9IHt9CiAgICAgICAgICAgIHJlc3VsdF9kaWN0WyJzY29yZV9vZl9hc3Npc3RhbnRfYSJdID0gcmVzWyJzY29yZSBvZiBhc3Npc3RhbnQgYSJdCiAgICAgICAgICAgIHJlc3VsdF9kaWN0WyJzY29yZV9vZl9hc3Npc3RhbnRfYiJdID0gcmVzWyJzY29yZSBvZiBhc3Npc3RhbnQgYiJdCiAgICAgICAgICAgIHJlc3VsdF9kaWN0WyJleHBsYW5hdGlvbl9vZl9hc3Npc3RhbnRfYSJdID0gcmVzWwogICAgICAgICAgICAgICAgImV4cGxhbmF0aW9uIG9mIGFzc2lzdGFudCBhIgogICAgICAgICAgICBdCiAgICAgICAgICAgIHJlc3VsdF9kaWN0WyJleHBsYW5hdGlvbl9vZl9hc3Npc3RhbnRfYiJdID0gcmVzWwogICAgICAgICAgICAgICAgImV4cGxhbmF0aW9uIG9mIGFzc2lzdGFudCBiIgogICAgICAgICAgICBdCiAgICAgICAgICAgIHJldHVybiByZXN1bHRfZGljdAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgIyBBZGp1c3RlZCBwYXR0ZXJuIHRvIG1hdGNoIHRoZSB0ZXh0IGZvcm1hdCBhbmQgc2VwYXJhdGUgbGluZXMKICAgICAgICAgICAgcGF0dGVybiA9IHIiLSBzY29yZSBvZiBhc3Npc3RhbnQgKFthYkFCXSk6IChcZClccyotIGV4cGxhbmF0aW9uIG9mIGFzc2lzdGFudCBcMTogKC4qPylccyooPz0tIHNjb3JlIG9mIGFzc2lzdGFudHwkKSIKICAgICAgICAgICAgbWF0Y2hlcyA9IHJlLmZpbmRhbGwocGF0dGVybiwgcmVzcG9uc2UsIHJlLkRPVEFMTCkKCiAgICAgICAgICAgIGlmIG1hdGNoZXM6CiAgICAgICAgICAgICAgICByZXN1bHRfZGljdCA9IHt9CiAgICAgICAgICAgICAgICBmb3IgbWF0Y2ggaW4gbWF0Y2hlczoKICAgICAgICAgICAgICAgICAgICBhc3Npc3RhbnQsIHNjb3JlLCBleHBsYW5hdGlvbiA9IG1hdGNoCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0X2RpY3RbZiJzY29yZV9vZl9hc3Npc3RhbnRfe2Fzc2lzdGFudH0iLmxvd2VyKCldID0gaW50KHNjb3JlKQogICAgICAgICAgICAgICAgICAgIHJlc3VsdF9kaWN0WwogICAgICAgICAgICAgICAgICAgICAgICBmImV4cGxhbmF0aW9uX29mX2Fzc2lzdGFudF97YXNzaXN0YW50fSIubG93ZXIoKQogICAgICAgICAgICAgICAgICAgIF0gPSBleHBsYW5hdGlvbi5zdHJpcCgpCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0X2RpY3QKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgIk5vIG1hdGNoZXMgZm91bmQgYWZ0ZXIgJ1tPdXRwdXRdOicgbWFya2VyLiAiCiAgICAgICAgICAgICAgICAgICAgIlBsZWFzZSBjaGVjayB0aGUgZm9ybWF0IG9mIHRoZSByZXNwb25zZS4iCiAgICAgICAgICAgICAgICApCgoKY2xhc3MgT1BFTkFJSnVkZ2VSZWZlcmVuY2VHcmFkaW5nKE9QRU5BSUp1ZGdlUGFpcndpc2VHcmFkaW5nKToKICAgICIiIgogICAgT1BFTkFJIEp1ZGdlIFJlZmVyZW5jZSBHcmFkaW5nIGNsYXNzCiAgICB5b3UgbmVlZCB0byBnaXZlIHRoZSBuYW1lIG9mIHRoZSBtZXRyaWNzLCBnaXZlIHRoZSBncmFkaW5nIHJ1YnJpYyBhbmQgdGhlIGJlbmNoIG1hcmsgbW9kZWwgdG8gdXNlCiAgICBUaGlzIGNsYXNzIHJlcXVyaWUgeW91IGtub3cgdGhlIHlfdHJ1ZSBvZiB0aGUgcmVzcG9uc2UKICAgICIiIgoKICAgIF9kaWN0X2ZpZWxkcyA9IFsKICAgICAgICAibmFtZSIsCiAgICAgICAgIm1vZGVsX2p1ZGdlIiwKICAgICAgICAibW9kZWxfanVkZ2VfY29uZmlnIiwKICAgICAgICAibW9kZWxfYmVuY2hfbWFyayIsCiAgICAgICAgIm1vZGVsX2JlbmNoX21hcmtfY29uZmlnIiwKICAgICAgICAibW9kZWxfYmVuY2hfbWFya19pbmZlcl9jb25maWciLAogICAgICAgICJ0b2tlbml6ZXJfYmVuY2hfbWFya19jb25maWciLAogICAgICAgICJwcm9tcHRfdGVtcGxhdGUiLAogICAgICAgICJwcm9tcHRfY29uZmlnIiwKICAgICAgICAibW9kZWxfanVkZ2VfaW5mZXJfY29uZmlnIiwKICAgIF0KICAgIGtpbmQgPSAiT1BFTkFJX2p1ZGdlX3JlZmVyZW5jZV9ncmFkaW5nIgoKICAgIGRlZiBfX2luaXRfXygKICAgICAgICBzZWxmLAogICAgICAgIG5hbWU6IHN0ciwKICAgICAgICBtb2RlbF9qdWRnZTogc3RyLAogICAgICAgIG1vZGVsX2p1ZGdlX2NvbmZpZzogRGljdFtzdHIsIEFueV0sCiAgICAgICAgbW9kZWxfYmVuY2hfbWFyazogc3RyLAogICAgICAgIG1vZGVsX2JlbmNoX21hcmtfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwKICAgICAgICB0b2tlbml6ZXJfYmVuY2hfbWFya19jb25maWc6IERpY3Rbc3RyLCBBbnldLAogICAgICAgIG1vZGVsX2JlbmNoX21hcmtfaW5mZXJfY29uZmlnOiBEaWN0W3N0ciwgQW55XSwKICAgICAgICBwcm9tcHRfdGVtcGxhdGU6IHN0ciwKICAgICAgICBwcm9tcHRfY29uZmlnOiBEaWN0W3N0ciwgc3RyXSwKICAgICAgICBtb2RlbF9qdWRnZV9pbmZlcl9jb25maWc6IERpY3Rbc3RyLCBBbnldID0gTm9uZSwKICAgICk6CiAgICAgICAgIiIiCiAgICAgICAgaW5pdCB0aGUgZ3JhZGluZyB3aXRoIHJlZmVyZW5jZSBjbGFzcwogICAgICAgIDpwYXJhbSBuYW1lOiB0aGUgbmFtZSBvZiB0aGUgbWV0cmljcwogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZTogdGhlIG1vZGVsIHRvIHVzZSBmb3IgZ3JhZGluZwogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZV9jb25maWc6IHRoZSBjb25maWcgb2YgdGhlIG1vZGVsIHRvIHVzZSBmb3IgZ3JhZGluZwogICAgICAgIDpwYXJhbSBtb2RlbF9qdWRnZV9pbmZlcl9jb25maWc6IHRoZSBjb25maWcgb2YgdGhlIG1vZGVsIHRvIHVzZSBmb3IgaW5mZXJlbmNlCiAgICAgICAgOnBhcmFtIG1vZGVsX2JlbmNoX21hcms6IHRoZSBtb2RlbCB0byB1c2UgZm9yIGJlbmNoIG1hcmtpbmcKICAgICAgICA6cGFyYW0gbW9kZWxfYmVuY2hfbWFya19jb25maWc6IHRoZSBjb25maWcgb2YgdGhlIG1vZGVsIHRvIHVzZSBmb3IgYmVuY2ggbWFya2luZwogICAgICAgIDpwYXJhbSB0b2tlbml6ZXJfYmVuY2hfbWFya19jb25maWc6IHRoZSBjb25maWcgb2YgdGhlIHRva2VuaXplciB0byB1c2UgZm9yIGJlbmNoIG1hcmtpbmcKICAgICAgICA6cGFyYW0gbW9kZWxfYmVuY2hfbWFya19pbmZlcl9jb25maWc6IHRoZSBjb25maWcgb2YgdGhlIG1vZGVsIHRvIHVzZSBmb3IgaW5mZXJlbmNlCiAgICAgICAgOnBhcmFtIHByb21wdF90ZW1wbGF0ZTogdGhlIHRlbXBsYXRlIG9mIHRoZSBwcm9tcHQgdG8gdXNlCiAgICAgICAgOnBhcmFtIHByb21wdF9jb25maWc6IHRoZSBjb25maWcgb2YgdGhlIHByb21wdCB0byB1c2UKICAgICAgICAiIiIKICAgICAgICBzdXBlcigpLl9faW5pdF9fKAogICAgICAgICAgICBuYW1lLAogICAgICAgICAgICBtb2RlbF9qdWRnZSwKICAgICAgICAgICAgbW9kZWxfanVkZ2VfY29uZmlnLAogICAgICAgICAgICBtb2RlbF9iZW5jaF9tYXJrLAogICAgICAgICAgICBtb2RlbF9iZW5jaF9tYXJrX2NvbmZpZywKICAgICAgICAgICAgbW9kZWxfYmVuY2hfbWFya19pbmZlcl9jb25maWcsCiAgICAgICAgICAgIHRva2VuaXplcl9iZW5jaF9tYXJrX2NvbmZpZywKICAgICAgICAgICAgcHJvbXB0X3RlbXBsYXRlLAogICAgICAgICAgICBwcm9tcHRfY29uZmlnLAogICAgICAgICkKCiAgICBkZWYgY29tcHV0ZV9vdmVyX29uZV9kYXRhKHNlbGYsIHF1ZXN0aW9uLCByZXNwb25zZSwgcmVmZXJlbmNlKSAtPiBEaWN0W3N0ciwgQW55XToKICAgICAgICAiIiIKICAgICAgICBDb21wdXRlIHRoZSBtZXRyaWNzIG92ZXIgb25lIGRhdGEgcG9pbnQKICAgICAgICA6cGFyYW0ga3dhcmdzOiB0aGUgZGF0YSB0byBjb21wdXRlIHRoZSBtZXRyaWNzIG92ZXIKICAgICAgICA6cmV0dXJuczogdGhlIG1ldHJpY3Mgc2NvcmUgYW5kIHRoZSBleHBsYW5hdGlvbgogICAgICAgICIiIgogICAgICAgIHNlbGYucHJvbXB0X2NvbmZpZ1sicmVmZXJlbmNlIl0gPSByZWZlcmVuY2UKICAgICAgICByZXNfZGljID0gc3VwZXIoKS5jb21wdXRlX292ZXJfb25lX2RhdGEocXVlc3Rpb24sIHJlc3BvbnNlKQogICAgICAgIHJldHVybiByZXNfZGljCgogICAgQG9wZW5fbXBpX2hhbmRsZXIod29ya2VyX2lucHV0cz0ic2FtcGxlX2RmIikKICAgIGRlZiBjb21wdXRlX292ZXJfZGF0YSgKICAgICAgICBzZWxmLCBzYW1wbGVfZGY6IHBkLkRhdGFGcmFtZSwgdHJhaW5fZGY6IHBkLkRhdGFGcmFtZSA9IE5vbmUKICAgICkgLT4gcGQuRGF0YUZyYW1lOgogICAgICAgICIiIgogICAgICAgIENvbXB1dGUgdGhlIG1ldHJpY3Mgb3ZlciBhIGRhdGFzZXQKICAgICAgICA6cGFyYW0gc2FtcGxlX2RmOiB0aGUgZGF0YSB0byBjb21wdXRlIHRoZSBtZXRyaWNzIG92ZXIKICAgICAgICA6cmV0dXJuczogdGhlIG1ldHJpY3Mgc2NvcmUgYW5kIHRoZSBleHBsYW5hdGlvbgogICAgICAgICIiIgogICAgICAgIHNlbGYucHJlcGFyZV9qdWRnZSgpCiAgICAgICAgc2VsZi5wcmVwYXJlX2JlbmNoX21hcmtfbW9kZWwoKQogICAgICAgIHJlc19kZiA9IHBkLkRhdGFGcmFtZSgKICAgICAgICAgICAgY29sdW1ucz1bCiAgICAgICAgICAgICAgICAicXVlc3Rpb24iLAogICAgICAgICAgICAgICAgImFuc3dlckEiLAogICAgICAgICAgICAgICAgImFuc3dlckIiLAogICAgICAgICAgICAgICAgInJlZmVyZW5jZSIsCiAgICAgICAgICAgICAgICAic2NvcmVfb2ZfYXNzaXN0YW50X2EiLAogICAgICAgICAgICAgICAgImV4cGxhbmF0aW9uX29mX2Fzc2lzdGFudF9hIiwKICAgICAgICAgICAgICAgICJzY29yZV9vZl9hc3Npc3RhbnRfYiIsCiAgICAgICAgICAgICAgICAiZXhwbGFuYXRpb25fb2ZfYXNzaXN0YW50X2IiLAogICAgICAgICAgICBdCiAgICAgICAgKQoKICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oc2FtcGxlX2RmKSk6CiAgICAgICAgICAgIHJlc19kaWMgPSBzZWxmLmNvbXB1dGVfb3Zlcl9vbmVfZGF0YSgKICAgICAgICAgICAgICAgIHNhbXBsZV9kZi5sb2NbaSwgInF1ZXN0aW9uIl0sCiAgICAgICAgICAgICAgICBzYW1wbGVfZGYubG9jW2ksICJhbnN3ZXIiXSwKICAgICAgICAgICAgICAgIHNhbXBsZV9kZi5sb2NbaSwgInJlZmVyZW5jZSJdLAogICAgICAgICAgICApCiAgICAgICAgICAgIHJlc19kZi5sb2NbaV0gPSBbCiAgICAgICAgICAgICAgICBzYW1wbGVfZGYubG9jW2ksICJxdWVzdGlvbiJdLAogICAgICAgICAgICAgICAgc2FtcGxlX2RmLmxvY1tpLCAiYW5zd2VyIl0sCiAgICAgICAgICAgICAgICBzYW1wbGVfZGYubG9jW2ksICJyZWZlcmVuY2UiXSwKICAgICAgICAgICAgICAgIHJlc19kaWNbImFuc3dlckIiXSwKICAgICAgICAgICAgICAgIHJlc19kaWNbInNjb3JlX29mX2Fzc2lzdGFudF9hIl0sCiAgICAgICAgICAgICAgICByZXNfZGljWyJleHBsYW5hdGlvbl9vZl9hc3Npc3RhbnRfYSJdLAogICAgICAgICAgICAgICAgcmVzX2RpY1sic2NvcmVfb2ZfYXNzaXN0YW50X2IiXSwKICAgICAgICAgICAgICAgIHJlc19kaWNbImV4cGxhbmF0aW9uX29mX2Fzc2lzdGFudF9iIl0sCiAgICAgICAgICAgIF0KCiAgICAgICAgcmV0dXJuIHJlc19kZgoKCk1ldHJpY3NUeXBlID0gVHlwZVZhcigiTWV0cmljc1R5cGUiKQoKCmRlZiBfZ2V0X21ldHJpY3MoCiAgICBtZXRyaWNfdHlwZTogVHlwZVtNZXRyaWNzVHlwZV0sCiAgICAqKmt3YXJnczogQW55LAopIC0+IE1ldHJpY3NUeXBlOgogICAgIiIiCiAgICBJbml0IHRoZSBtZXRyaWMgY2xhc3MgYmFzZWQgb24gZGlmZmVyZW50IHR5cGUgb2YgbWV0cmljcwogICAgOnBhcmFtIG1ldHJpY190eXBlOiB0aGUgdHlwZSBvZiB0aGUgbWV0cmljCiAgICA6cGFyYW0ga3dhcmdzOiB0aGUgY29uZmlnIG9mIHRoZSBtZXRyaWMKICAgIDpyZXR1cm5zOiB0aGUgbWV0cmljIG9iagogICAgIiIiCiAgICByZXR1cm4gbWV0cmljX3R5cGUoKiprd2FyZ3MpCgoKZGVmIGxsbV9qdWRnZSgKICAgIGlucHV0X3BhdGg6IFVuaW9uW3N0ciwgcGF0aGxpYi5QYXRoXSwKICAgICoqa3dhcmdzLAopIC0+IHBkLkRhdGFGcmFtZToKICAgICIiIgogICAgQ29tcHV0ZSB0aGUgbWV0cmljcyBvdmVyIGEgZGF0YXNldAoKICAgIDpwYXJhbSBpbnB1dF9wYXRoOiB0aGUgcGF0aCB0byB0aGUgaW5wdXQgZGF0YQogICAgOnBhcmFtIGt3YXJnczogdGhlIGNvbmZpZyBvZiB0aGUgbWV0cmljCgogICAgOnJldHVybnM6IHRoZSBtZXRyaWNzIHNjb3JlIGFuZCB0aGUgZXhwbGFuYXRpb24KICAgICIiIgogICAgbWV0cmljID0gX2dldF9tZXRyaWNzKCoqa3dhcmdzKQogICAgc2FtcGxlX2RmID0gcGQucmVhZF9jc3YoaW5wdXRfcGF0aCkKICAgIHJlc19kZiA9IG1ldHJpYy5jb21wdXRlX292ZXJfZGF0YShzYW1wbGVfZGYpCiAgICByZXR1cm4gcmVzX2RmCg==
    base_image: mlrun/mlrun
    commands: []
    code_origin: ''
    origin_filename: ''
    requirements:
    - pytest==5.2.0
    - pandas
    - openai
    - mlrun==1.4.0
    - auto-gptq
    - openmpi
    - mpi4py
    - transformers
    - torch=2.0.0
    - accelerate
    - einops
    - optimum
  entry_points:
    open_mpi_handler:
      name: open_mpi_handler
      doc: ''
      parameters:
      - name: worker_inputs
        type: str
      outputs:
      - default: ''
      lineno: 144
    decorator:
      name: decorator
      doc: ''
      parameters:
      - name: handler
      outputs:
      - default: ''
      lineno: 150
    wrapper:
      name: wrapper
      doc: ''
      parameters: []
      outputs:
      - default: ''
      lineno: 155
    fill_prompt:
      name: fill_prompt
      doc: Fill the prompt template with the prompt config
      parameters:
      - name: self
      outputs:
      - doc: the filled prompt
        type: str
        default: ''
      lineno: 238
    prepare_judge:
      name: prepare_judge
      doc: Prepare the judge model
      parameters:
      - name: self
      outputs:
      - default: ''
      lineno: 888
    compute_over_one_data:
      name: compute_over_one_data
      doc: Compute the metrics over one data point
      parameters:
      - name: self
      - name: question
      - name: response
      - name: reference
      outputs:
      - doc: the metrics score and the explanation
        default: ''
      lineno: 1014
    compute_over_data:
      name: compute_over_data
      doc: Compute the metrics over a dataset
      parameters:
      - name: self
      - name: sample_df
        type: DataFrame
        doc: the data to compute the metrics over
      - name: train_df
        type: DataFrame
        default: null
      outputs:
      - doc: the metrics score and the explanation
        default: ''
      lineno: 1025
    extract_score_explanation:
      name: extract_score_explanation
      doc: Extract the score and the explanation from the response
      parameters:
      - name: self
      - name: response
        doc: the response to extract the score and the explanation from
      outputs:
      - doc: the score and the explanation
        default: ''
      lineno: 916
    prepare_bench_mark_model:
      name: prepare_bench_mark_model
      doc: Prepare the model that used for bench marking
      parameters:
      - name: self
      outputs:
      - default: ''
      lineno: 493
    compute_bench_mark_response:
      name: compute_bench_mark_response
      doc: Compute the response of the bench mark model
      parameters:
      - name: self
      - name: question
        doc: the question to ask the model
      outputs:
      - doc: the response
        type: str
        default: ''
      lineno: 505
    llm_judge:
      name: llm_judge
      doc: Compute the metrics over a dataset
      parameters:
      - name: input_path
        type: Union[str, Path]
        doc: the path to the input data
      outputs:
      - doc: the metrics score and the explanation
        default: ''
      lineno: 1084
  description: This function is used to compute the metrics using llm as a judge
  default_handler: llm_judge
  disable_auto_mount: false
  clone_target_dir: ''
  env: []
  resources:
    requests:
      memory: 1Mi
      cpu: 25m
    limits:
      memory: 20Gi
      cpu: '2'
  priority_class_name: igz-workload-medium
  preemption_mode: prevent
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: app.iguazio.com/lifecycle
            operator: NotIn
            values:
            - preemptible
          - key: eks.amazonaws.com/capacityType
            operator: NotIn
            values:
            - SPOT
          - key: node-lifecycle
            operator: NotIn
            values:
            - spot
  tolerations: null
  security_context: {}
verbose: false
