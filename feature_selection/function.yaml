kind: job
metadata:
  name: feature-selection
  tag: ''
  hash: 067d66f95c003625ee7f257cdc9ab42e8e21a523
  project: ''
  labels:
    author: orz
  categories:
  - data-prep
  - ml
spec:
  command: ''
  args: []
  image: mlrun/ml-models
  env: []
  default_handler: feature_selection
  entry_points:
    show_values_on_bars:
      name: show_values_on_bars
      doc: ''
      parameters:
      - name: axs
      - name: h_v
        default: v
      - name: space
        default: 0.4
      outputs: []
      lineno: 24
    plot_stat:
      name: plot_stat
      doc: ''
      parameters:
      - name: context
      - name: stat_name
      - name: stat_df
      outputs: []
      lineno: 45
    feature_selection:
      name: feature_selection
      doc: "Applies selected feature selection statistical functions \nor models on\
        \ our 'df_artifact'.\n\nEach statistical function or model will vote for it's\
        \ best K selected features.\nIf a feature has >= 'min_votes' votes, it will\
        \ be selected."
      parameters:
      - name: context
        doc: the function context
      - name: df_artifact
      - name: k
        doc: number of top features to select from each statistical function or model
        default: 2
      - name: min_votes
        doc: minimal number of votes (from a model or by statistical function) needed
          for a feature to be selected. Can be specified by percentage of votes or
          absolute  number of votes
        default: 0.5
      - name: label_column
        type: str
        doc: ground-truth (y) labels
        default: Y
      - name: stat_filters
        doc: statistical functions to apply to the features (from sklearn.feature_selection)
        default:
        - f_classif
        - mutual_info_classif
        - chi2
        - f_regression
      - name: model_filters
        doc: models to use for feature evaluation, can be specified by model name
          (ex. LinearSVC), formalized json (contains 'CLASS',  'FIT', 'META') or a
          path to such json file.
        default:
          LinearSVC: LinearSVC
          LogisticRegression: LogisticRegression
          ExtraTreesClassifier: ExtraTreesClassifier
      - name: max_scaled_scores
        doc: produce feature scores table scaled with max_scaler
        default: true
      outputs: []
      lineno: 67
  description: Select features through multiple Statistical and Model filters
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlciBvbiAyMDIwLTA1LTAxIDIyOjEwCgppbXBvcnQgcGFuZGFzIGFzIHBkCmltcG9ydCBtYXRwbG90bGliLnB5cGxvdCBhcyBwbHQKaW1wb3J0IHNlYWJvcm4gYXMgc25zCmltcG9ydCBudW1weSBhcyBucAppbXBvcnQgb3MKaW1wb3J0IGpzb24KCmZyb20gc2tsZWFybi5mZWF0dXJlX3NlbGVjdGlvbiBpbXBvcnQgU2VsZWN0S0Jlc3QKZnJvbSBza2xlYXJuLmZlYXR1cmVfc2VsZWN0aW9uIGltcG9ydCBTZWxlY3RGcm9tTW9kZWwKCmZyb20gc2tsZWFybi5lbnNlbWJsZSBpbXBvcnQgRXh0cmFUcmVlc0NsYXNzaWZpZXIKZnJvbSBza2xlYXJuLnN2bSBpbXBvcnQgTGluZWFyU1ZDCmZyb20gc2tsZWFybi5saW5lYXJfbW9kZWwgaW1wb3J0IExvZ2lzdGljUmVncmVzc2lvbgoKZnJvbSBza2xlYXJuLnByZXByb2Nlc3NpbmcgaW1wb3J0IE1pbk1heFNjYWxlcgoKZnJvbSBza2xlYXJuLnV0aWxzIGltcG9ydCBhbGxfZXN0aW1hdG9ycwoKZnJvbSBtbHJ1bi5tbHV0aWxzIGltcG9ydCBjcmVhdGVfY2xhc3MsIGdjZl9jbGVhcgpmcm9tIG1scnVuLmFydGlmYWN0cyBpbXBvcnQgUGxvdEFydGlmYWN0CgpkZWYgc2hvd192YWx1ZXNfb25fYmFycyhheHMsIGhfdj0idiIsIHNwYWNlPTAuNCk6CiAgICBkZWYgX3Nob3dfb25fc2luZ2xlX3Bsb3QoYXgpOgogICAgICAgIGlmIGhfdiA9PSAidiI6CiAgICAgICAgICAgIGZvciBwIGluIGF4LnBhdGNoZXM6CiAgICAgICAgICAgICAgICBfeCA9IHAuZ2V0X3goKSArIHAuZ2V0X3dpZHRoKCkgLyAyCiAgICAgICAgICAgICAgICBfeSA9IHAuZ2V0X3koKSArIHAuZ2V0X2hlaWdodCgpCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGludChwLmdldF9oZWlnaHQoKSkKICAgICAgICAgICAgICAgIGF4LnRleHQoX3gsIF95LCB2YWx1ZSwgaGE9ImNlbnRlciIpIAogICAgICAgIGVsaWYgaF92ID09ICJoIjoKICAgICAgICAgICAgZm9yIHAgaW4gYXgucGF0Y2hlczoKICAgICAgICAgICAgICAgIF94ID0gcC5nZXRfeCgpICsgcC5nZXRfd2lkdGgoKSArIGZsb2F0KHNwYWNlKQogICAgICAgICAgICAgICAgX3kgPSBwLmdldF95KCkgKyBwLmdldF9oZWlnaHQoKQogICAgICAgICAgICAgICAgdmFsdWUgPSBpbnQocC5nZXRfd2lkdGgoKSkKICAgICAgICAgICAgICAgIGF4LnRleHQoX3gsIF95LCB2YWx1ZSwgaGE9ImxlZnQiKQoKICAgIGlmIGlzaW5zdGFuY2UoYXhzLCBucC5uZGFycmF5KToKICAgICAgICBmb3IgaWR4LCBheCBpbiBucC5uZGVudW1lcmF0ZShheHMpOgogICAgICAgICAgICBfc2hvd19vbl9zaW5nbGVfcGxvdChheCkKICAgIGVsc2U6CiAgICAgICAgX3Nob3dfb25fc2luZ2xlX3Bsb3QoYXhzKQoKZGVmIHBsb3Rfc3RhdChjb250ZXh0LAogICAgICAgICAgICAgIHN0YXRfbmFtZSwKICAgICAgICAgICAgICBzdGF0X2RmKToKICAgIGdjZl9jbGVhcihwbHQpCiAgICAgICAgCiAgICBheCA9IHBsdC5heGVzKCkKICAgIHN0YXRfY2hhcnQgPSBzbnMuYmFycGxvdCh4PXN0YXRfbmFtZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5PSdpbmRleCcsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YT1zdGF0X2RmLnNvcnRfdmFsdWVzKHN0YXRfbmFtZSwgYXNjZW5kaW5nPUZhbHNlKS5yZXNldF9pbmRleCgpLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF4PWF4KQogICAgcGx0LnRpZ2h0X2xheW91dCgpCgogICAgZm9yIHAgaW4gc3RhdF9jaGFydC5wYXRjaGVzOgogICAgICAgIHdpZHRoID0gcC5nZXRfd2lkdGgoKQogICAgICAgIHBsdC50ZXh0KDUrcC5nZXRfd2lkdGgoKSwgcC5nZXRfeSgpKzAuNTUqcC5nZXRfaGVpZ2h0KCksCiAgICAgICAgICAgICAgICAgJ3s6MS4yZn0nLmZvcm1hdCh3aWR0aCksCiAgICAgICAgICAgICAgICAgaGE9J2NlbnRlcicsIHZhPSdjZW50ZXInKQoKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KFBsb3RBcnRpZmFjdChmJ3tzdGF0X25hbWV9JywgYm9keT1wbHQuZ2NmKCkpLCAKICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX3BhdGg9b3MucGF0aC5qb2luKCdwbG90cycsICdmZWF0dXJlX3NlbGVjdGlvbicsIGYne3N0YXRfbmFtZX0uaHRtbCcpKQogICAgZ2NmX2NsZWFyKHBsdCkKCmRlZiBmZWF0dXJlX3NlbGVjdGlvbihjb250ZXh0LAogICAgICAgICAgICAgICAgICAgICAgZGZfYXJ0aWZhY3QsCiAgICAgICAgICAgICAgICAgICAgICBrPTIsCiAgICAgICAgICAgICAgICAgICAgICBtaW5fdm90ZXM9MC41LAogICAgICAgICAgICAgICAgICAgICAgbGFiZWxfY29sdW1uOiBzdHIgPSAnWScsCiAgICAgICAgICAgICAgICAgICAgICBzdGF0X2ZpbHRlcnMgPSBbJ2ZfY2xhc3NpZicsICdtdXR1YWxfaW5mb19jbGFzc2lmJywgJ2NoaTInLCAnZl9yZWdyZXNzaW9uJ10sCiAgICAgICAgICAgICAgICAgICAgICBtb2RlbF9maWx0ZXJzID0geydMaW5lYXJTVkMnOiAnTGluZWFyU1ZDJywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdMb2dpc3RpY1JlZ3Jlc3Npb24nOiAnTG9naXN0aWNSZWdyZXNzaW9uJywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdFeHRyYVRyZWVzQ2xhc3NpZmllcic6ICdFeHRyYVRyZWVzQ2xhc3NpZmllcid9LAogICAgICAgICAgICAgICAgICAgICAgbWF4X3NjYWxlZF9zY29yZXMgPSBUcnVlKToKICAgICIiIkFwcGxpZXMgc2VsZWN0ZWQgZmVhdHVyZSBzZWxlY3Rpb24gc3RhdGlzdGljYWwgZnVuY3Rpb25zIAogICAgb3IgbW9kZWxzIG9uIG91ciAnZGZfYXJ0aWZhY3QnLgogICAgCiAgICBFYWNoIHN0YXRpc3RpY2FsIGZ1bmN0aW9uIG9yIG1vZGVsIHdpbGwgdm90ZSBmb3IgaXQncyBiZXN0IEsgc2VsZWN0ZWQgZmVhdHVyZXMuCiAgICBJZiBhIGZlYXR1cmUgaGFzID49ICdtaW5fdm90ZXMnIHZvdGVzLCBpdCB3aWxsIGJlIHNlbGVjdGVkLgoKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgICAgdGhlIGZ1bmN0aW9uIGNvbnRleHQKICAgIDpwYXJhbSBrOiAgICAgICAgICAgICAgICAgbnVtYmVyIG9mIHRvcCBmZWF0dXJlcyB0byBzZWxlY3QgZnJvbSBlYWNoIHN0YXRpc3RpY2FsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG9yIG1vZGVsCiAgICA6cGFyYW0gbWluX3ZvdGVzOiAgICAgICAgIG1pbmltYWwgbnVtYmVyIG9mIHZvdGVzIChmcm9tIGEgbW9kZWwgb3IgYnkgc3RhdGlzdGljYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24pIG5lZWRlZCBmb3IgYSBmZWF0dXJlIHRvIGJlIHNlbGVjdGVkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYW4gYmUgc3BlY2lmaWVkIGJ5IHBlcmNlbnRhZ2Ugb2Ygdm90ZXMgb3IgYWJzb2x1dGUgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlciBvZiB2b3RlcwogICAgOnBhcmFtIGxhYmVsX2NvbHVtbjogICAgICBncm91bmQtdHJ1dGggKHkpIGxhYmVscwogICAgOnBhcmFtIHN0YXRfZmlsdGVyczogICAgICBzdGF0aXN0aWNhbCBmdW5jdGlvbnMgdG8gYXBwbHkgdG8gdGhlIGZlYXR1cmVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmcm9tIHNrbGVhcm4uZmVhdHVyZV9zZWxlY3Rpb24pCiAgICA6cGFyYW0gbW9kZWxfZmlsdGVyczogICAgIG1vZGVscyB0byB1c2UgZm9yIGZlYXR1cmUgZXZhbHVhdGlvbiwgY2FuIGJlIHNwZWNpZmllZCBieQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbCBuYW1lIChleC4gTGluZWFyU1ZDKSwgZm9ybWFsaXplZCBqc29uIChjb250YWlucyAnQ0xBU1MnLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZJVCcsICdNRVRBJykgb3IgYSBwYXRoIHRvIHN1Y2gganNvbiBmaWxlLgogICAgOnBhcmFtIG1heF9zY2FsZWRfc2NvcmVzOiBwcm9kdWNlIGZlYXR1cmUgc2NvcmVzIHRhYmxlIHNjYWxlZCB3aXRoIG1heF9zY2FsZXIgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAiIiIKICAgIAogICAgZGZfcGF0aCA9IHN0cihkZl9hcnRpZmFjdCkKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZidpbnB1dCBkYXRhc2V0IHtkZl9wYXRofScpCiAgICBpZiBkZl9wYXRoLmVuZHN3aXRoKCdjc3YnKToKICAgICAgICBkZiA9IHBkLnJlYWRfY3N2KGRmX3BhdGgpCiAgICBlbGlmIGRmX3BhdGguZW5kc3dpdGgoJ3BhcnF1ZXQnKSBvciBkZl9wYXRoLmVuZHN3aXRoKCdwcScpOgogICAgICAgIGRmID0gcGQucmVhZF9wYXJxdWV0KGRmX3BhdGgpCiAgICAKICAgIHkgPSBkZi5wb3AobGFiZWxfY29sdW1uKQogICAgWCA9IGRmCiAgICAKICAgIHN0YXRfZnVuY3Rpb25zX2xpc3QgPSB7c3RhdF9uYW1lOlNlbGVjdEtCZXN0KGNyZWF0ZV9jbGFzcyhmJ3NrbGVhcm4uZmVhdHVyZV9zZWxlY3Rpb24ue3N0YXRfbmFtZX0nKSwgaykgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3Igc3RhdF9uYW1lIGluIHN0YXRfZmlsdGVyc30KICAgIHJlcXVpcmVzX2FicyA9IFsnY2hpMiddCiAgICAKICAgIHNlbGVjdGVkX2ZlYXR1cmVzX2FnZyA9IHt9CiAgICBzdGF0c19kZiA9IHBkLkRhdGFGcmFtZShpbmRleD1YLmNvbHVtbnMpCiAgICBmb3Igc3RhdF9uYW1lLCBzdGF0X2Z1bmMgaW4gc3RhdF9mdW5jdGlvbnNfbGlzdC5pdGVtcygpOgogICAgICAgIHBhcmFtcyA9IChYLCB5KSBpZiBzdGF0X25hbWUgaW4gcmVxdWlyZXNfYWJzIGVsc2UgKGFicyhYKSwgeSkKICAgICAgICBzdGF0ID0gc3RhdF9mdW5jLmZpdCgqcGFyYW1zKQogICAgICAgIAogICAgICAgIHN0YXRfZGYgPSBwZC5EYXRhRnJhbWUoaW5kZXg9WC5jb2x1bW5zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1ucz1bc3RhdF9uYW1lXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE9c3RhdC5zY29yZXNfKQogICAgICAgIHBsb3Rfc3RhdChjb250ZXh0LCBzdGF0X25hbWUsIHN0YXRfZGYpCiAgICAgICAgc3RhdHNfZGYgPSBzdGF0c19kZi5qb2luKHN0YXRfZGYpCiAgICAgICAgCiAgICAgICAgc2VsZWN0ZWRfZmVhdHVyZXMgPSBYLmNvbHVtbnNbc3RhdF9mdW5jLmdldF9zdXBwb3J0KCldCiAgICAgICAgc2VsZWN0ZWRfZmVhdHVyZXNfYWdnW3N0YXRfbmFtZV0gPSBzZWxlY3RlZF9mZWF0dXJlcwogICAgICAgICAgICAgICAgCiAgICBhbGxfc2tsZWFybl9lc3RpbWF0b3JzID0gZGljdChhbGxfZXN0aW1hdG9ycygpKSBpZiBsZW4obW9kZWxfZmlsdGVycykgPiAwIGVsc2Uge30KICAgIHNlbGVjdGVkX21vZGVscyA9IHt9CiAgICBmb3IgbW9kZWxfbmFtZSwgbW9kZWwgaW4gbW9kZWxfZmlsdGVycy5pdGVtcygpOgogICAgICAgIGlmICcuanNvbicgaW4gbW9kZWw6CiAgICAgICAgICAgIGN1cnJlbnRfbW9kZWwgPSBqc29uLmxvYWQob3Blbihtb2RlbCwgJ3InKSkKICAgICAgICAgICAgQ2xhc3NpZmllckNsYXNzID0gY3JlYXRlX2NsYXNzKGN1cnJlbnRfbW9kZWxbIk1FVEEiXVsiY2xhc3MiXSkKICAgICAgICAgICAgc2VsZWN0ZWRfbW9kZWxzW21vZGVsX25hbWVdID0gQ2xhc3NpZmllckNsYXNzKCoqY3VycmVudF9tb2RlbFsiQ0xBU1MiXSkKICAgICAgICBlbGlmIG1vZGVsIGluIGFsbF9za2xlYXJuX2VzdGltYXRvcnM6CiAgICAgICAgICAgIHNlbGVjdGVkX21vZGVsc1ttb2RlbF9uYW1lXSA9IGFsbF9za2xlYXJuX2VzdGltYXRvcnNbbW9kZWxfbmFtZV0oKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGN1cnJlbnRfbW9kZWwgPSBqc29uLmxvYWRzKG1vZGVsKSBpZiBpc2luc3RhbmNlKG1vZGVsLCBzdHIpIGVsc2UgY3VycmVudF9tb2RlbAogICAgICAgICAgICAgICAgQ2xhc3NpZmllckNsYXNzID0gY3JlYXRlX2NsYXNzKGN1cnJlbnRfbW9kZWxbIk1FVEEiXVsiY2xhc3MiXSkKICAgICAgICAgICAgICAgIHNlbGVjdGVkX21vZGVsc1ttb2RlbF9uYW1lXSA9IENsYXNzaWZpZXJDbGFzcygqKmN1cnJlbnRfbW9kZWxbIkNMQVNTIl0pCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZid1bmFibGUgdG8gbG9hZCB7bW9kZWx9JykKICAgICAgICAKICAgIG1vZGVsc19kZiA9IHBkLkRhdGFGcmFtZShpbmRleD1YLmNvbHVtbnMpCiAgICBmb3IgbW9kZWxfbmFtZSwgbW9kZWwgaW4gc2VsZWN0ZWRfbW9kZWxzLml0ZW1zKCk6CiAgICAgICAgc2VsZWN0X2Zyb21fbW9kZWwgPSBTZWxlY3RGcm9tTW9kZWwobW9kZWwpLmZpdChYLHkpCiAgICAgICAgZmVhdHVyZV9pZHggPSBzZWxlY3RfZnJvbV9tb2RlbC5nZXRfc3VwcG9ydCgpCiAgICAgICAgZmVhdHVyZV9uYW1lcyA9IFguY29sdW1uc1tmZWF0dXJlX2lkeF0KICAgICAgICBzZWxlY3RlZF9mZWF0dXJlc19hZ2dbbW9kZWxfbmFtZV0gPSBmZWF0dXJlX25hbWVzLnRvbGlzdCgpCiAgICAgICAgICAgICAgICAKICAgICAgICBpZiBoYXNhdHRyKHNlbGVjdF9mcm9tX21vZGVsLmVzdGltYXRvcl8sICdjb2VmXycpOgogICAgICAgICAgICBzdGF0X2RmID0gc2VsZWN0X2Zyb21fbW9kZWwuZXN0aW1hdG9yXy5jb2VmXwogICAgICAgIGVsaWYgaGFzYXR0cihzZWxlY3RfZnJvbV9tb2RlbC5lc3RpbWF0b3JfLCAnZmVhdHVyZV9pbXBvcnRhbmNlc18nKToKICAgICAgICAgICAgc3RhdF9kZiA9IHNlbGVjdF9mcm9tX21vZGVsLmVzdGltYXRvcl8uZmVhdHVyZV9pbXBvcnRhbmNlc18KICAgICAgICBzdGF0X2RmID0gcGQuRGF0YUZyYW1lKGluZGV4PVguY29sdW1ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbnM9W21vZGVsX25hbWVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YT1zdGF0X2RmWzBdKQogICAgICAgIG1vZGVsc19kZiA9IG1vZGVsc19kZi5qb2luKHN0YXRfZGYpCgogICAgICAgIHBsb3Rfc3RhdChjb250ZXh0LCBtb2RlbF9uYW1lLCBzdGF0X2RmKQogICAgCiAgICByZXN1bHRfbWF0cml4X2RmID0gcGQuY29uY2F0KFtzdGF0c19kZiwgbW9kZWxzX2RmXSwgYXhpcz0xLCBzb3J0PUZhbHNlKQogICAgY29udGV4dC5sb2dfZGF0YXNldChrZXk9J2ZlYXR1cmVfc2NvcmVzJywgCiAgICAgICAgICAgICAgICAgICAgICAgIGRmPXJlc3VsdF9tYXRyaXhfZGYsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX3BhdGg9J2ZlYXR1cmVfc2NvcmVzLnBhcnF1ZXQnLAogICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ9J3BhcnF1ZXQnKQogICAgaWYgbWF4X3NjYWxlZF9zY29yZXM6CiAgICAgICAgbm9ybWFsaXplZF9kZiA9IHJlc3VsdF9tYXRyaXhfZGYucmVwbGFjZShbbnAuaW5mLCAtbnAuaW5mXSwgbnAubmFuKS52YWx1ZXMKICAgICAgICBtaW5fbWF4X3NjYWxlciA9IE1pbk1heFNjYWxlcigpCiAgICAgICAgbm9ybWFsaXplZF9kZiA9IG1pbl9tYXhfc2NhbGVyLmZpdF90cmFuc2Zvcm0obm9ybWFsaXplZF9kZikKICAgICAgICBub3JtYWxpemVkX2RmID0gcGQuRGF0YUZyYW1lKGRhdGE9bm9ybWFsaXplZF9kZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbnM9cmVzdWx0X21hdHJpeF9kZi5jb2x1bW5zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg9cmVzdWx0X21hdHJpeF9kZi5pbmRleCkKICAgICAgICBjb250ZXh0LmxvZ19kYXRhc2V0KGtleT0nbWF4X3NjYWxlZF9zY29yZXNfZmVhdHVyZV9zY29yZXMnLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRmPW5vcm1hbGl6ZWRfZGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9wYXRoPSdtYXhfc2NhbGVkX3Njb3Jlc19mZWF0dXJlX3Njb3Jlcy5wYXJxdWV0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdD0ncGFycXVldCcpCiAgICAKICAgIGZvciB0ZXN0X25hbWUgaW4gc2VsZWN0ZWRfZmVhdHVyZXNfYWdnOgogICAgICAgIHJlc3VsdF9tYXRyaXhfZGZbdGVzdF9uYW1lXSA9IFsxIGlmIHggaW4gc2VsZWN0ZWRfZmVhdHVyZXNfYWdnW3Rlc3RfbmFtZV0gZWxzZSAwIGZvciB4IGluIFguY29sdW1uc10KICAgIHJlc3VsdF9tYXRyaXhfZGYubG9jWzosJ251bV92b3RlcyddID0gcmVzdWx0X21hdHJpeF9kZi5zdW0oYXhpcz0xKQogICAgY29udGV4dC5sb2dfZGF0YXNldChrZXk9J3NlbGVjdGVkX2ZlYXR1cmVzX2NvdW50JywgCiAgICAgICAgICAgICAgICAgICAgICAgIGRmPXJlc3VsdF9tYXRyaXhfZGYsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX3BhdGg9J3NlbGVjdGVkX2ZlYXR1cmVzX2NvdW50LnBhcnF1ZXQnLAogICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ9J3BhcnF1ZXQnKQogICAgCiAgICBpZiBpc2luc3RhbmNlKG1pbl92b3RlcywgaW50KToKICAgICAgICB2b3Rlc19uZWVkZWQgPSBtaW5fdm90ZXMKICAgIGVsc2U6CiAgICAgICAgbnVtX2ZpbHRlcnMgPSBsZW4oc3RhdF9maWx0ZXJzKSArIGxlbihtb2RlbF9maWx0ZXJzKQogICAgICAgIHZvdGVzX25lZWRlZCA9IGludChucC5mbG9vcihudW1fZmlsdGVycyAqIG1heChtaW4obWluX3ZvdGVzLCAxKSwgMCkpKQogICAgY29udGV4dC5sb2dnZXIuaW5mbyhmJ3ZvdGVzIG5lZWRlZCB0byBiZSBzZWxlY3RlZDoge3ZvdGVzX25lZWRlZH0nKQogICAgCiAgICBzZWxlY3RlZF9mZWF0dXJlcyA9IHJlc3VsdF9tYXRyaXhfZGZbcmVzdWx0X21hdHJpeF9kZi5udW1fdm90ZXM+PXZvdGVzX25lZWRlZF0uaW5kZXgudG9saXN0KCkKICAgIGdvb2RfZmVhdHVyZV9kZiA9IGRmLmxvY1s6LCBzZWxlY3RlZF9mZWF0dXJlc10KICAgIGZpbmFsX2RmID0gcGQuY29uY2F0KFtnb29kX2ZlYXR1cmVfZGYseV0sIGF4aXM9MSkKICAgIGNvbnRleHQubG9nX2RhdGFzZXQoa2V5PSdzZWxlY3RlZF9mZWF0dXJlcycsCiAgICAgICAgICAgICAgICAgICAgICAgIGRmPWZpbmFsX2RmLAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9wYXRoPSdzZWxlY3RlZF9mZWF0dXJlcy5wYXJxdWV0JywKICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0PSdwYXJxdWV0JykKCg==
    commands: []
    code_origin: https://github.com/mlrun/functions.git#9ca1e1c57dc6bc9dca79f6fc1c30fc1cbcd6b086:feature_selection.ipynb
