kind: dask
metadata:
  name: sklearn-classifier-dask
  tag: ''
  hash: 2350f2f67ea733ff838f497135d5d0e0a515e9dd
  project: default
spec:
  command: ''
  image: mlrun/ml-models
  env:
  - name: V3IO_API
    value: ''
  - name: V3IO_USERNAME
    value: ''
  - name: V3IO_ACCESS_KEY
    value: ''
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IHdhcm5pbmdzCndhcm5pbmdzLmZpbHRlcndhcm5pbmdzKCdpZ25vcmUnKQoKaW1wb3J0IG9zCmltcG9ydCBqb2JsaWIKaW1wb3J0IG51bXB5IGFzIG5wCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IHNrbGVhcm4KZnJvbSBjbG91ZHBpY2tsZSBpbXBvcnQgZHVtcHMsIGxvYWQsIGR1bXAKZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QsIE9wdGlvbmFsCgpmcm9tIGRhc2suZGlzdHJpYnV0ZWQgaW1wb3J0IENsaWVudApmcm9tIGRhc2sgaW1wb3J0IGRhdGFmcmFtZSBhcyBkZApmcm9tIGRhc2sgaW1wb3J0IGFycmF5IGFzIGRhCmZyb20gZGFzay5kZWxheWVkIGltcG9ydCBkZWxheWVkCmZyb20gZGFza19tbCBpbXBvcnQgbW9kZWxfc2VsZWN0aW9uCmZyb20gZGFza19tbCBpbXBvcnQgbWV0cmljcwpmcm9tIGRhc2tfbWwucHJlcHJvY2Vzc2luZyBpbXBvcnQgU3RhbmRhcmRTY2FsZXIsIExhYmVsRW5jb2RlcgoKZnJvbSBtbHJ1bi5leGVjdXRpb24gaW1wb3J0IE1MQ2xpZW50Q3R4CmZyb20gbWxydW4uZGF0YXN0b3JlIGltcG9ydCBEYXRhSXRlbQpmcm9tIG1scnVuLmFydGlmYWN0cyBpbXBvcnQgUGxvdEFydGlmYWN0CmZyb20gbWxydW4ubWx1dGlscyBpbXBvcnQgKGdlbl9za2xlYXJuX21vZGVsLCBjcmVhdGVfY2xhc3MpCmltcG9ydCBtbHJ1bgoKaW1wb3J0IG1hdHBsb3RsaWIucHlwbG90IGFzIHBsdApmcm9tIHllbGxvd2JyaWNrLmNsYXNzaWZpZXIgaW1wb3J0IFJPQ0FVQywgQ2xhc3NpZmljYXRpb25SZXBvcnQsIENvbmZ1c2lvbk1hdHJpeApmcm9tIHllbGxvd2JyaWNrLm1vZGVsX3NlbGVjdGlvbiBpbXBvcnQgRmVhdHVyZUltcG9ydGFuY2VzCgpkZWYgdHJhaW5fbW9kZWwoY29udGV4dDogTUxDbGllbnRDdHgsCiAgICAgICAgICAgICAgICBkYXRhc2V0OiBEYXRhSXRlbSwKICAgICAgICAgICAgICAgIG1vZGVsX3BrZ19jbGFzczogc3RyLAogICAgICAgICAgICAgICAgbGFiZWxfY29sdW1uOiBzdHIgPSAibGFiZWwiLAogICAgICAgICAgICAgICAgdHJhaW5fdmFsaWRhdGlvbl9zaXplOiBmbG9hdCA9IDAuNzUsCiAgICAgICAgICAgICAgICBzYW1wbGU6IGZsb2F0ID0gMS4wLAogICAgICAgICAgICAgICAgbW9kZWxzX2Rlc3Q6IHN0ciA9ICJtb2RlbHMiLAogICAgICAgICAgICAgICAgdGVzdF9zZXRfa2V5OiBzdHIgPSAidGVzdF9zZXQiLAogICAgICAgICAgICAgICAgcGxvdHNfZGVzdDogc3RyID0gInBsb3RzIiwKICAgICAgICAgICAgICAgIGRhc2tfa2V5OiBzdHIgPSAiZGFza19rZXkiLAogICAgICAgICAgICAgICAgZGFza19wZXJzaXN0OiBib29sID0gRmFsc2UsCiAgICAgICAgICAgICAgICBzY2hlZHVsZXJfa2V5OiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgZmlsZV9leHQ6IHN0ciA9ICJwYXJxdWV0IiwKICAgICAgICAgICAgICAgIHJhbmRvbV9zdGF0ZTogaW50ID0gNDIpIC0+IE5vbmU6CiAgICAKICAgICIiIgogICAgVHJhaW4gYSBza2xlYXJuIGNsYXNzaWZpZXIgd2l0aCBEYXNrCiAgICAKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgICAgICAgICAgRnVuY3Rpb24gY29udGV4dC4KICAgIDpwYXJhbSBkYXRhc2V0OiAgICAgICAgICAgICAgICAgUmF3IGRhdGEgZmlsZS4KICAgIDpwYXJhbSBtb2RlbF9wa2dfY2xhc3M6ICAgICAgICAgTW9kZWwgdG8gdHJhaW4sIGUuZywgInNrbGVhcm4uZW5zZW1ibGUuUmFuZG9tRm9yZXN0Q2xhc3NpZmllciIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBqc29uIG1vZGVsIGNvbmZpZy4KICAgIDpwYXJhbSBsYWJlbF9jb2x1bW46ICAgICAgICAgICAgKGxhYmVsKSBHcm91bmQtdHJ1dGggeSBsYWJlbHMuCiAgICA6cGFyYW0gdHJhaW5fdmFsaWRhdGlvbl9zaXplOiAgICgwLjc1KSBUcmFpbiB2YWxpZGF0aW9uIHNldCBwcm9wb3J0aW9uIG91dCBvZiB0aGUgZnVsbCBkYXRhc2V0LgogICAgOnBhcmFtIHNhbXBsZTogICAgICAgICAgICAgICAgICAoMS4wKSBTZWxlY3Qgc2FtcGxlIGZyb20gZGF0YXNldCAobi1yb3dzLyUgb2YgdG90YWwpLCByYW5kb216aWUgcm93cyBhcyBkZWZhdWx0LgogICAgOnBhcmFtIG1vZGVsc19kZXN0OiAgICAgICAgICAgICAobW9kZWxzKSBNb2RlbHMgc3ViZm9sZGVyIG9uIGFydGlmYWN0IHBhdGguCiAgICA6cGFyYW0gdGVzdF9zZXRfa2V5OiAgICAgICAgICAgICh0ZXN0X3NldCkgTWxydW4gZGIga2V5IG9mIGhlbGQgb3V0IGRhdGEgaW4gYXJ0aWZhY3Qgc3RvcmUuCiAgICA6cGFyYW0gcGxvdHNfZGVzdDogICAgICAgICAgICAgIChwbG90cykgUGxvdCBzdWJmb2xkZXIgb24gYXJ0aWZhY3QgcGF0aC4KICAgIDpwYXJhbSBkYXNrX2tleTogICAgICAgICAgICAgICAgKGRhc2sga2V5KSBLZXkgb2YgZGF0YWZyYW1lIGluIGRhc2sgY2xpZW50ICJkYXRhc2V0cyIgYXR0cmlidXRlLgogICAgOnBhcmFtIGRhc2tfcGVyc2lzdDogICAgICAgICAgICAoRmFsc2UpIFNob3VsZCB0aGUgZGF0YSBiZSBwZXJzaXN0ZWQgKHRocm91Z2ggdGhlIGBjbGllbnQucGVyc2lzdGApCiAgICA6cGFyYW0gc2NoZWR1bGVyX2tleTogICAgICAgICAgIChzY2hlZHVsZXIpIERhc2sgc2NoZWR1bGVyIGNvbmZpZ3VyYXRpb24sIGpzb24gYWxzbyBsb2dnZWQgYXMgYW4gYXJ0aWZhY3QuCiAgICA6cGFyYW0gZmlsZV9leHQ6ICAgICAgICAgICAgICAgIChwYXJxdWV0KSBmb3JtYXQgZm9yIHRlc3Rfc2V0X2tleSBob2xkIG91dCBkYXRhCiAgICA6cGFyYW0gcmFuZG9tX3N0YXRlOiAgICAgICAgICAgICg0Mikgc2tsZWFybiBzZWVkCiAgICAiIiIKICAgIAogICAgaWYgaGFzYXR0cihjb250ZXh0LCAiZGFza19jbGllbnQiKToKICAgICAgICBkYXNrX2NsaWVudCA9IGNvbnRleHQuZGFza19jbGllbnQKICAgICAgICBkYXNrX2NsaWVudC53cml0ZV9zY2hlZHVsZXJfZmlsZSgic2NoZWR1bGVyLmpzb24iKQogICAgICAgIAogICAgZWxpZiBzY2hlZHVsZXJfa2V5ICE9IE5vbmU6CiAgICAgICAgZGFza19jbGllbnQgPSBDbGllbnQoc2NoZWR1bGVyX2ZpbGU9c3RyKHNjaGVkdWxlcl9rZXkpKQogICAgICAgIGRhc2tfY2xpZW50LndyaXRlX3NjaGVkdWxlcl9maWxlKHNjaGVkdWxlcl9rZXkgKyAiLmpzb24iKQogICAgICAgIAogICAgZWxzZToKICAgICAgICBkYXNrX2NsaWVudCA9IENsaWVudCgpCiAgICAgICAgZGFza19jbGllbnQud3JpdGVfc2NoZWR1bGVyX2ZpbGUoInNjaGVkdWxlci5qc29uIikKICAgICAgICAKICAgIGlmIGRhc2tfcGVyc2lzdDoKICAgICAgICBkZiA9IGRhc2tfY2xpZW50LnBlcnNpc3QoZGYpCiAgICAgICAgaWYgZGFza19jbGllbnQuZGF0YXNldHMgYW5kIGRhc2tfa2V5IGluIGRhc2tfY2xpZW50LmRhdGFzZXRzOgogICAgICAgICAgICBkYXNrX2NsaWVudC51bnB1Ymxpc2hfZGF0YXNldChkYXNrX2tleSkKICAgICAgICBkYXNrX2NsaWVudC5wdWJsaXNoX2RhdGFzZXQoZGYsIG5hbWU9ZGFza19rZXkpCiAgICAKICAgIGlmIGNvbnRleHQ6CiAgICAgICAgY29udGV4dC5kYXNrX2NsaWVudCA9IGRhc2tfY2xpZW50CiAgICAKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIlJlYWQgRGF0YSIpCiAgICB0ZW1wID0gZGF0YXNldC5hc19kZigpICMgZml4IGRhc2sgZGYgYWJpbGl0eQogICAgCiAgICBkZiA9IGRkLmZyb21fcGFuZGFzKHRlbXAsIGNodW5rc2l6ZT0xMDAwMDApCiAgICAKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIlByZXAgRGF0YSIpCiAgICBudW1lcmljcyA9IFsnaW50MTYnLCAnaW50MzInLCAnaW50NjQnLCAnZmxvYXQxNicsICdmbG9hdDMyJywgJ2Zsb2F0NjQnXQogICAgZGYgPSBkZi5zZWxlY3RfZHR5cGVzKGluY2x1ZGU9bnVtZXJpY3MpCiAgICAKICAgIGRmID0gZGYuZHJvcChbYyBmb3IgYyBpbiBkZi5jb2x1bW5zIGlmIGRmW2NdLmlzbmEoKS5hbnkoKS5jb21wdXRlKCldLCBheGlzID0gMSkgIyBubyBkcm9wbmEgd2l0aCBheGlzIHBhcmFtIGluIGRhc2sKICAgIGRmX2hlYWRlciA9IGRmLmNvbHVtbnMKICAgIAogICAgZGYgPSBkZi5zYW1wbGUoZnJhYz1zYW1wbGUpLnJlc2V0X2luZGV4KGRyb3A9VHJ1ZSkKICAgIAogICAgZW5jb2RlciA9IExhYmVsRW5jb2RlcigpCiAgICBlbmNvZGVyID0gZW5jb2Rlci5maXQoZGZbbGFiZWxfY29sdW1uXSkKICAgIFggPSBkZi5kcm9wKGxhYmVsX2NvbHVtbiwgYXhpcz0xKS50b19kYXNrX2FycmF5KGxlbmd0aHM9VHJ1ZSkKICAgIHkgPSBlbmNvZGVyLnRyYW5zZm9ybShkZltsYWJlbF9jb2x1bW5dKQoKICAgIGNsYXNzZXMgPSBkZltsYWJlbF9jb2x1bW5dLmRyb3BfZHVwbGljYXRlcygpICMgbm8gdW5pcXVlIHZhbHVlcyBpbiBkYXNrCiAgICBjbGFzc2VzID0gW3N0cihpKSBmb3IgaSBpbiBjbGFzc2VzXQoKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIlNwbGl0IGFuZCBUcmFpbiIpCiAgICBYX3RyYWluLCBYX3Rlc3QsIHlfdHJhaW4sIHlfdGVzdCA9IG1vZGVsX3NlbGVjdGlvbi50cmFpbl90ZXN0X3NwbGl0KFgsIHksIHRyYWluX3NpemU9dHJhaW5fdmFsaWRhdGlvbl9zaXplLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5kb21fc3RhdGU9cmFuZG9tX3N0YXRlKQogICAgCiAgICBzY2FsZXIgPSBTdGFuZGFyZFNjYWxlcigpCiAgICBzY2FsZXIgPSBzY2FsZXIuZml0KFhfdHJhaW4pCiAgICBYX3RyYWluX3RyYW5zZm9ybWVkID0gc2NhbGVyLnRyYW5zZm9ybShYX3RyYWluKQogICAgWF90ZXN0X3RyYW5zZm9ybWVkID0gc2NhbGVyLnRyYW5zZm9ybShYX3Rlc3QpCiAgICAKICAgIG1vZGVsX2NvbmZpZyA9IGdlbl9za2xlYXJuX21vZGVsKG1vZGVsX3BrZ19jbGFzcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQucGFyYW1ldGVycy5pdGVtcygpKQoKICAgIG1vZGVsX2NvbmZpZ1siRklUIl0udXBkYXRlKHsiWCI6IFhfdHJhaW5fdHJhbnNmb3JtZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInkiOiB5X3RyYWlufSkKICAgIAogICAgQ2xhc3NpZmllckNsYXNzID0gY3JlYXRlX2NsYXNzKG1vZGVsX2NvbmZpZ1siTUVUQSJdWyJjbGFzcyJdKQogICAgCiAgICBtb2RlbCA9IENsYXNzaWZpZXJDbGFzcygqKm1vZGVsX2NvbmZpZ1siQ0xBU1MiXSkKICAgIAogICAgd2l0aCBqb2JsaWIucGFyYWxsZWxfYmFja2VuZCgiZGFzayIpOgogICAgICAgIAogICAgICAgIG1vZGVsID0gZGVsYXllZChtb2RlbC5maXQpKCoqbW9kZWxfY29uZmlnWyJGSVQiXSkuY29tcHV0ZSgpCgogICAgYXJ0aWZhY3RfcGF0aCA9IGNvbnRleHQuYXJ0aWZhY3Rfc3VicGF0aChtb2RlbHNfZGVzdCkKICAgIAogICAgcGxvdHNfcGF0aCA9IGNvbnRleHQuYXJ0aWZhY3Rfc3VicGF0aChtb2RlbHNfZGVzdCwgcGxvdHNfZGVzdCkKCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCJFdmFsdWF0ZSIpCiAgICBleHRyYV9kYXRhX2RpY3QgPSB7fQogICAgZm9yIHJlcG9ydCBpbiAoUk9DQVVDLCBDbGFzc2lmaWNhdGlvblJlcG9ydCwgQ29uZnVzaW9uTWF0cml4KToKICAgICAgICAKICAgICAgICByZXBvcnRfbmFtZSA9IHN0cihyZXBvcnQuX19uYW1lX18pCiAgICAgICAgcGx0LmNsYSgpCiAgICAgICAgcGx0LmNsZigpCiAgICAgICAgcGx0LmNsb3NlKCkKICAgICAgICAKICAgICAgICB2aXogPSByZXBvcnQobW9kZWwsIGNsYXNzZXM9Y2xhc3NlcywgcGVyX2NsYXNzPVRydWUsIGlzX2ZpdHRlZD1UcnVlKQogICAgICAgIHZpei5maXQoWF90cmFpbl90cmFuc2Zvcm1lZCwgeV90cmFpbikgICAgICAgICAgICAgICAjIEZpdCB0aGUgdHJhaW5pbmcgZGF0YSB0byB0aGUgdmlzdWFsaXplcgogICAgICAgIHZpei5zY29yZShYX3Rlc3RfdHJhbnNmb3JtZWQsIHlfdGVzdC5jb21wdXRlKCkpICAgICAjIEV2YWx1YXRlIHRoZSBtb2RlbCBvbiB0aGUgdGVzdCBkYXRhCiAgICAgICAgCiAgICAgICAgcGxvdCA9IGNvbnRleHQubG9nX2FydGlmYWN0KFBsb3RBcnRpZmFjdChyZXBvcnRfbmFtZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5PXZpei5maWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZT1yZXBvcnRfbmFtZSksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGJfa2V5PUZhbHNlKQogICAgICAgIGV4dHJhX2RhdGFfZGljdFtzdHIocmVwb3J0KV0gPSBwbG90CiAgICAgICAgCiAgICAgICAgaWYgcmVwb3J0X25hbWUgPT0gJ1JPQ0FVQyc6CiAgICAgICAgICAgIGNvbnRleHQubG9nX3Jlc3VsdHMoeyJtaWNybyI6IHZpei5yb2NfYXVjLmdldCgibWljcm8iKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibWFjcm8iOiB2aXoucm9jX2F1Yy5nZXQoIm1hY3JvIil9KQogICAgICAgICAgICAKICAgICAgICBlbGlmIHJlcG9ydF9uYW1lID09ICdDbGFzc2lmaWNhdGlvblJlcG9ydCc6CiAgICAgICAgICAgIGZvciBzY29yZV9uYW1lIGluIHZpei5zY29yZXNfOgogICAgICAgICAgICAgICAgZm9yIHNjb3JlX2NsYXNzIGluIHZpei5zY29yZXNfW3Njb3JlX25hbWVdOgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnRleHQubG9nX3Jlc3VsdHMoe3Njb3JlX25hbWUgKyAiLSIgKyBzY29yZV9jbGFzcyA6IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpei5zY29yZXNfW3Njb3JlX25hbWVdLmdldChzY29yZV9jbGFzcyl9KQogICAgICAgIAogICAgICAgIHZpei5zaG93KCkKICAgIAogICAgdml6ID0gRmVhdHVyZUltcG9ydGFuY2VzKG1vZGVsLCBjbGFzc2VzPWNsYXNzZXMsIHBlcl9jbGFzcz1UcnVlLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc19maXR0ZWQ9VHJ1ZSwgbGFiZWxzPWRmX2hlYWRlci5kZWxldGUoZGZfaGVhZGVyLmdldF9sb2MobGFiZWxfY29sdW1uKSkpCiAgICB2aXouZml0KFhfdHJhaW5fdHJhbnNmb3JtZWQsIHlfdHJhaW4pIAogICAgdml6LnNjb3JlKFhfdGVzdF90cmFuc2Zvcm1lZCwgeV90ZXN0KQogICAgdml6LnNob3coKQogICAgCiAgICBwbG90ID0gY29udGV4dC5sb2dfYXJ0aWZhY3QoUGxvdEFydGlmYWN0KCJGZWF0dXJlSW1wb3J0YW5jZXMiLCBib2R5PXZpei5maWcsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZT0iRmVhdHVyZUltcG9ydGFuY2VzIiksIGRiX2tleT1GYWxzZSkKICAgIGV4dHJhX2RhdGFfZGljdFtzdHIoIkZlYXR1cmVJbXBvcnRhbmNlcyIpXSA9IHBsb3QKICAgIAogICAgcGx0LmNsYSgpCiAgICBwbHQuY2xmKCkKICAgIHBsdC5jbG9zZSgpCgogICAgY29udGV4dC5sb2dnZXIuaW5mbygiTG9nIGFydGlmYWN0cyIpCiAgICBhcnRpZmFjdF9wYXRoID0gY29udGV4dC5hcnRpZmFjdF9zdWJwYXRoKG1vZGVsc19kZXN0KQogICAgCiAgICBwbG90c19wYXRoID0gY29udGV4dC5hcnRpZmFjdF9zdWJwYXRoKG1vZGVsc19kZXN0LCBwbG90c19kZXN0KQogICAgCiAgICBjb250ZXh0LnNldF9sYWJlbCgnY2xhc3MnLCBtb2RlbF9wa2dfY2xhc3MpCiAgICAKICAgIGNvbnRleHQubG9nX21vZGVsKCJtb2RlbCIsIGJvZHk9ZHVtcHMobW9kZWwpLAogICAgICAgICAgICAgICAgICAgICAgYXJ0aWZhY3RfcGF0aD1hcnRpZmFjdF9wYXRoLAogICAgICAgICAgICAgICAgICAgICAgbW9kZWxfZmlsZT0ibW9kZWwucGtsIiwKICAgICAgICAgICAgICAgICAgICAgIGV4dHJhX2RhdGE9ZXh0cmFfZGF0YV9kaWN0LAogICAgICAgICAgICAgICAgICAgICAgbWV0cmljcz1jb250ZXh0LnJlc3VsdHMsCiAgICAgICAgICAgICAgICAgICAgICBsYWJlbHM9eyJjbGFzcyI6IG1vZGVsX3BrZ19jbGFzc30pCiAgICAKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KCJzdGFuZGFyZF9zY2FsZXIiLCBib2R5PWR1bXBzKHNjYWxlciksCiAgICAgICAgICAgICAgICAgICAgICAgICBhcnRpZmFjdF9wYXRoPWFydGlmYWN0X3BhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbF9maWxlPSJzY2FsZXIuZ3oiLAogICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9InN0YW5kYXJkX3NjYWxlciIpCiAgICAKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KCJsYWJlbF9lbmNvZGVyIiwgYm9keT1kdW1wcyhlbmNvZGVyKSwKICAgICAgICAgICAgICAgICAgICAgICAgIGFydGlmYWN0X3BhdGg9YXJ0aWZhY3RfcGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsX2ZpbGU9ImVuY29kZXIuZ3oiLAogICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9ImxhYmVsX2VuY29kZXIiKQogICAgCiAgICBkZl90b19zYXZlID0gZGVsYXllZChucC5jb2x1bW5fc3RhY2spKChYX3Rlc3QsIHlfdGVzdCkpLmNvbXB1dGUoKQogICAgY29udGV4dC5sb2dfZGF0YXNldCh0ZXN0X3NldF9rZXksIAogICAgICAgICAgICAgICAgICAgICAgICBkZj1wZC5EYXRhRnJhbWUoZGZfdG9fc2F2ZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5zPWRmX2hlYWRlciksICMgaW1wcm92ZSBsb2cgZGF0YXNldCBhYmlsaXR5CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdD1maWxlX2V4dCwgaW5kZXg9RmFsc2UsIAogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbHM9eyJkYXRhLXR5cGUiOiAiaGVsZC1vdXQifSwKICAgICAgICAgICAgICAgICAgICAgICAgYXJ0aWZhY3RfcGF0aD1jb250ZXh0LmFydGlmYWN0X3N1YnBhdGgoJ2RhdGEnKSkKICAgIAogICAgY29udGV4dC5sb2dnZXIuaW5mbygiRG9uZSEiKQoKZHNmID0gbWxydW4uY29kZV90b19mdW5jdGlvbignc2tsZWFybi1jbGFzc2lmaWVyLWRhc2snLCBraW5kPSdkYXNrJywgY29kZV9vdXRwdXQ9Ii4iKSAuYXBwbHkobWxydW4ubW91bnRfdjNpbygpKQoKZHNmLnNwZWMuaW1hZ2UgPSAnbWxydW4vbWwtbW9kZWxzJwpkc2Yuc3BlYy5yZW1vdGUgPSBUcnVlCmRzZi5zcGVjLnJlcGxpY2FzID0gMQpkc2Yuc3BlYy5zZXJ2aWNlX3R5cGUgPSAnTm9kZVBvcnQnCmRzZi5leHBvcnQoImZ1bmN0aW9uLnlhbWwiKQoKYXJ0aWZhY3RfcGF0aCA9IG1scnVuLnNldF9lbnZpcm9ubWVudChhcGlfcGF0aCA9ICdodHRwOi8vbWxydW4tYXBpOjgwODAnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFydGlmYWN0X3BhdGggPSBvcy5wYXRoLmFic3BhdGgoJy4vJykpCgpEQVRBX1VSTCA9ICdodHRwczovL3MzLndhc2FiaXN5cy5jb20vaWd1YXppby9kYXRhL2lyaXMvaXJpc19kYXRhc2V0LmNzdicKCgp0YXNrX3BhcmFtcyA9IHsKICAgICJwYXJhbXMiIDogewogICAgICAgICJzYW1wbGUiICAgICAgICAgICAgIDogMSwKICAgICAgICAidHJhaW5fdmFsX3NwbGl0IiAgICA6IDAuNzUsCiAgICAgICAgInJhbmRvbV9zdGF0ZSIgICAgICAgOiA0MiwKICAgICAgICAibl9qb2JzIiAgICAgICAgICAgICA6IC0xLAogICAgICAgICJwbG90c19kZXN0IiAgICAgICAgIDogInBsb3RzLXAiLAogICAgICAgICJtb2RlbHNfZGVzdCIgICAgICAgIDogJ3NrbGVhcm4tY2xmbW9kZWwnfX0KCgptb2RlbHMgPSBbCiAgICAic2tsZWFybi5lbnNlbWJsZS5SYW5kb21Gb3Jlc3RDbGFzc2lmaWVyIiwKICAgICJza2xlYXJuLmVuc2VtYmxlLkFkYUJvb3N0Q2xhc3NpZmllciIsCiAgICAic2tsZWFybi5saW5lYXJfbW9kZWwuTG9naXN0aWNSZWdyZXNzaW9uIgpdCgpvdXRwdXRzID0gW10KZm9yIG1vZGVsIGluIG1vZGVsczoKICAgIHRhc2tfY29weSA9IHRhc2tfcGFyYW1zLmNvcHkoKQogICAgdGFza19jb3B5LnVwZGF0ZSgKICAgICAgICB7CiAgICAgICAgICAgICJwYXJhbXMiOnsgIm1vZGVsX3BrZ19jbGFzcyIgOiBtb2RlbCwKICAgICAgICAgICAgICAgICAgICAgICAibGFiZWxfY29sdW1uIiAgICA6ICJWZW5kb3JJRCJ9CiAgICAgICAgfQogICAgKQogICAgCiAgICBpZiAiUmFuZG9tRm9yZXN0Q2xhc3NpZmllciIgaW4gbW9kZWw6CiAgICAgICAgdGFza19jb3B5WyJwYXJhbXMiXS51cGRhdGUoeyJDTEFTU19tYXhfZGVwdGgiIDogNX0pCgogICAgaWYgIkxvZ2lzdGljUmVncmVzc2lvbiIgaW4gbW9kZWw6CiAgICAgICAgdGFza19jb3B5WyJwYXJhbXMiXS51cGRhdGUoeyJDTEFTU19zb2x2ZXIiIDogImxpYmxpbmVhciJ9KQogICAgCiAgICBpZiAiQWRhQm9vc3RDbGFzc2lmaWVyIiBpbiBtb2RlbDoKICAgICAgICB0YXNrX2NvcHlbInBhcmFtcyJdLnVwZGF0ZSh7IkNMQVNTX25fZXN0aW1hdG9ycyIgIDogMjAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQ0xBU1NfbGVhcm5pbmdfcmF0ZSIgOiAwLjAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgIAogICAgbmFtZSA9IG1vZGVsLnJlcGxhY2UoJy4nLCAnXycpCiAgICBvdXRwdXQgPSBkc2YucnVuKG1scnVuLk5ld1Rhc2soKip0YXNrX2NvcHkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXI9dHJhaW5fbW9kZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZT1uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0cz17ImRhdGFzZXQiICA6IERBVEFfVVJMfSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJ0aWZhY3RfcGF0aD1vcy5wYXRoLmpvaW4oYXJ0aWZhY3RfcGF0aCwgbW9kZWwpKQogICAgCiAgICBvdXRwdXRzLmFwcGVuZCh7bmFtZTogb3V0cHV0Lm91dHB1dHN9KQoK
    commands: []
    code_origin: https://github.com/mlrun/functions.git#dc150ab093629994eb24f5d81f104859bb959a1c:sklearn-classifier-dask.ipynb
  default_handler: ''
  entry_points:
    train_model:
      name: train_model
      doc: Train a sklearn classifier with Dask
      parameters:
      - name: context
        type: MLClientCtx
        doc: Function context.
        default: ''
      - name: dataset
        type: DataItem
        doc: Raw data file.
        default: ''
      - name: model_pkg_class
        type: str
        doc: Model to train, e.g, "sklearn.ensemble.RandomForestClassifier",  or json
          model config.
        default: ''
      - name: label_column
        type: str
        doc: (label) Ground-truth y labels.
        default: label
      - name: train_validation_size
        type: float
        doc: (0.75) Train validation set proportion out of the full dataset.
        default: 0.75
      - name: sample
        type: float
        doc: (1.0) Select sample from dataset (n-rows/% of total), randomzie rows
          as default.
        default: 1.0
      - name: models_dest
        type: str
        doc: (models) Models subfolder on artifact path.
        default: models
      - name: test_set_key
        type: str
        doc: (test_set) Mlrun db key of held out data in artifact store.
        default: test_set
      - name: plots_dest
        type: str
        doc: (plots) Plot subfolder on artifact path.
        default: plots
      - name: dask_key
        type: str
        doc: (dask key) Key of dataframe in dask client "datasets" attribute.
        default: dask_key
      - name: dask_persist
        type: bool
        doc: (False) Should the data be persisted (through the `client.persist`)
        default: false
      - name: scheduler_key
        type: str
        doc: (scheduler) Dask scheduler configuration, json also logged as an artifact.
        default: null
      - name: file_ext
        type: str
        doc: (parquet) format for test_set_key hold out data
        default: parquet
      - name: random_state
        type: int
        doc: (42) sklearn seed
        default: 42
      outputs:
      - default: ''
      lineno: 32
  description: ''
  replicas: 1
  remote: true
  service_type: NodePort
  nthreads: 1
  min_replicas: 0
  max_replicas: 16
  scheduler_timeout: 60 minutes
