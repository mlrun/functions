metadata:
  tag: ''
  name: silero-vad
  categories:
  - deep-learning
  - audio
verbose: false
kind: job
spec:
  image: ''
  disable_auto_mount: false
  build:
    origin_filename: ''
    functionSourceCode: IyBDb3B5cmlnaHQgMjAyNCBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAojCiMgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQojIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiMgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiMgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAojIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgppbXBvcnQgbG9nZ2luZwpmcm9tIG11bHRpcHJvY2Vzc2luZyBpbXBvcnQgUHJvY2VzcywgUXVldWUKZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmZyb20gdHlwZXMgaW1wb3J0IEZ1bmN0aW9uVHlwZQoKaW1wb3J0IHRvcmNoCmltcG9ydCB0b3JjaGF1ZGlvCmZyb20gdHFkbSBpbXBvcnQgdHFkbQoKCmNsYXNzIEJhc2VUYXNrOgogICAgIiIiCiAgICBBIGJhc2UgY2xhc3MgZm9yIGEgdGFzayB0byBjb21wbGV0ZSBhZnRlciBWQUQuCiAgICAiIiIKCiAgICBkZWYgX19pbml0X18oc2VsZiwgYXVkaW9fZmlsZTogUGF0aCk6CiAgICAgICAgIiIiCiAgICAgICAgSW5pdGlhbGl6ZSB0aGUgYmFzZSB0YXNrLgoKICAgICAgICA6cGFyYW0gYXVkaW9fZmlsZTogVGhlIGF1ZGlvIGZpbGUgYXNzaWduZWQgdG8gdGhlIHRhc2suCiAgICAgICAgIiIiCiAgICAgICAgIyBTdG9yZSB0aGUgYXVkaW8gZmlsZToKICAgICAgICBzZWxmLl9hdWRpb19maWxlID0gYXVkaW9fZmlsZQoKICAgICAgICAjIFByZXBhcmUgdGhlIHJlc3VsdDoKICAgICAgICBzZWxmLl9yZXN1bHQgPSBOb25lCgogICAgQHByb3BlcnR5CiAgICBkZWYgYXVkaW9fZmlsZShzZWxmKSAtPiBQYXRoOgogICAgICAgICIiIgogICAgICAgIEdldCB0aGUgYXVkaW8gZmlsZSBvZiB0aGUgdGFzay4KCiAgICAgICAgOnJldHVybnM6IFRoZSBhdWRpbyBmaWxlIG9mIHRoZSB0YXNrLgogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9hdWRpb19maWxlCgogICAgZGVmIGRvX3Rhc2soCiAgICAgICAgc2VsZiwgc3BlZWNoX3RpbWVzdGFtcHM6IGxpc3RbZGljdFtzdHIsIGludF1dIHwgbGlzdFtsaXN0W2RpY3Rbc3RyLCBpbnRdXV0KICAgICk6CiAgICAgICAgIiIiCiAgICAgICAgRG8gdGhlIHRhc2sgb24gdGhlIGdpdmVuIHNwZWVjaCB0aW1lc3RhbXBzLiBUaGUgYmFzZSB0YXNrIHdpbGwgc2ltcGx5IHNhdmUgdGhlIHNwZWVjaCB0aW1lc3RhbXBzIGFzIHRoZSByZXN1bHQuCgogICAgICAgIDpwYXJhbSBzcGVlY2hfdGltZXN0YW1wczogVGhlIHNwZWVjaCB0aW1lc3RhbXBzIHRvIGRvIHRoZSB0YXNrIG9uIGFzIG91dHB1dHRlZCBmcm9tIHRoZSBWQUQuCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5fcmVzdWx0ID0gc3BlZWNoX3RpbWVzdGFtcHMKCiAgICBkZWYgZ2V0X3Jlc3VsdChzZWxmKSAtPiB0dXBsZVtzdHIsIGxpc3RdOgogICAgICAgICIiIgogICAgICAgIEdldCB0aGUgcmVzdWx0IG9mIHRoZSB0YXNrLiBBIHR1cGxlIG9mIHRoZSBhdWRpbyBmaWxlIG5hbWUgYW5kIHRoZSByZXN1bHQuCgogICAgICAgIDpyZXR1cm5zOiBUaGUgcmVzdWx0IG9mIHRoZSB0YXNrLgogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9hdWRpb19maWxlLm5hbWUsIHNlbGYuX3Jlc3VsdAoKICAgIGRlZiB0b190dXBsZShzZWxmKSAtPiB0dXBsZVtzdHIsIGRpY3RdOgogICAgICAgICIiIgogICAgICAgIENvbnZlcnQgdGhlIHRhc2sgdG8gYSB0dXBsZSB0byByZWNvbnN0cnVjdCBpdCBsYXRlciAodXNlZCBmb3IgbXVsdGlwcm9jZXNzaW5nIHRvIHBhc3MgaW4gcXVldWUpLgoKICAgICAgICA6cmV0dXJuczogVGhlIGNvbnZlcnRlZCB0YXNrLgogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl9fY2xhc3NfXy5fX25hbWVfXywgeyJhdWRpb19maWxlIjogc2VsZi5fYXVkaW9fZmlsZX0KCgpjbGFzcyBTcGVlY2hEaWFyaXphdGlvblRhc2soQmFzZVRhc2spOgogICAgIiIiCiAgICBBIHNwZWVjaCBkaWFyaXphdGlvbiB0YXNrLiBUaGUgdGFzayB3aWxsIGRpYXJpemUgdGhlIFZBRCBzcGVlY2ggdGltZXN0YW1wcyBpbnRvIHNwZWFrZXJzLgogICAgIiIiCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGF1ZGlvX2ZpbGU6IFBhdGgsIHNwZWFrZXJfbGFiZWxzOiBsaXN0W3N0cl0pOgogICAgICAgICIiIgogICAgICAgIEluaXRpYWxpemUgdGhlIHNwZWVjaCBkaWFyaXphdGlvbiB0YXNrLgoKICAgICAgICA6cGFyYW0gYXVkaW9fZmlsZTogICAgIFRoZSBhdWRpbyBmaWxlIGFzc2lnbmVkIHRvIHRoZSB0YXNrLgogICAgICAgIDpwYXJhbSBzcGVha2VyX2xhYmVsczogVGhlIHNwZWFrZXIgbGFiZWxzIHRvIHVzZSBmb3IgdGhlIGRpYXJpemF0aW9uLiBJZiBub3QgZ2l2ZW4sIHRoZSBzcGVha2VycyB3aWxsIGJlIG5hbWVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3BlYWtlcl8wIiwgInNwZWFrZXJfMSIsIGV0Yy4KICAgICAgICAiIiIKICAgICAgICBzdXBlcigpLl9faW5pdF9fKGF1ZGlvX2ZpbGU9YXVkaW9fZmlsZSkKICAgICAgICBzZWxmLl9zcGVha2VyX2xhYmVscyA9IHNwZWFrZXJfbGFiZWxzCgogICAgZGVmIGRvX3Rhc2soc2VsZiwgc3BlZWNoX3RpbWVzdGFtcHM6IGxpc3RbbGlzdFtkaWN0W3N0ciwgaW50XV1dKToKICAgICAgICAiIiIKICAgICAgICBEbyB0aGUgdGFzayBvbiB0aGUgZ2l2ZW4gc3BlZWNoIHRpbWVzdGFtcHMuIFRoZSB0YXNrIHdpbGwgZGlhcml6ZSB0aGUgVkFEIHNwZWVjaCB0aW1lc3RhbXBzIGludG8gc3BlYWtlcnMuCgogICAgICAgIDpwYXJhbSBzcGVlY2hfdGltZXN0YW1wczogVGhlIHNwZWVjaCB0aW1lc3RhbXBzIHBlciBjaGFubmVsIHRvIGRvIHRoZSB0YXNrIG9uIGFzIG91dHB1dHRlZCBmcm9tIHRoZSBWQUQuCiAgICAgICAgIiIiCiAgICAgICAgIyBHZXQgdGhlIHNwZWFrZXIgbGFiZWxzIChzZXQgZGVmYXVsdCBpZiBub3QgZ2l2ZW4pOgogICAgICAgIHNwZWFrZXJfbGFiZWxzID0gc2VsZi5fc3BlYWtlcl9sYWJlbHMgb3IgWwogICAgICAgICAgICBmInNwZWFrZXJfe2l9IiBmb3IgaSBpbiByYW5nZShsZW4oc3BlZWNoX3RpbWVzdGFtcHMpKQogICAgICAgIF0KCiAgICAgICAgIyBEaWFyaXplIC0gb3JnYW5pemUgdGhlIHNwZWVjaCB0aW1lc3RhbXBzIGludG8gYSBzaW5nbGUgbGlzdCBvZiBzcGVha2VycyBhbmQgc29ydCBpdCBieSBzdGFydCB0aW1lOgogICAgICAgIHNwZWVjaF9kaWFyaXphdGlvbiA9IFsKICAgICAgICAgICAgKHNwZWVjaF90aW1lc3RhbXBbInN0YXJ0Il0sIHNwZWVjaF90aW1lc3RhbXBbImVuZCJdLCBzcGVha2VyX2xhYmVsKQogICAgICAgICAgICBmb3Igc3BlYWtlcl9sYWJlbCwgY2hhbm5lbF9zcGVlY2hfdGltZXN0YW1wcyBpbiB6aXAoCiAgICAgICAgICAgICAgICBzcGVha2VyX2xhYmVscywgc3BlZWNoX3RpbWVzdGFtcHMKICAgICAgICAgICAgKQogICAgICAgICAgICBmb3Igc3BlZWNoX3RpbWVzdGFtcCBpbiBjaGFubmVsX3NwZWVjaF90aW1lc3RhbXBzCiAgICAgICAgXQogICAgICAgIHNwZWVjaF9kaWFyaXphdGlvbi5zb3J0KCkKICAgICAgICBzZWxmLl9yZXN1bHQgPSBzcGVlY2hfZGlhcml6YXRpb24KCiAgICBkZWYgdG9fdHVwbGUoc2VsZikgLT4gdHVwbGVbc3RyLCBkaWN0XToKICAgICAgICAiIiIKICAgICAgICBDb252ZXJ0IHRoZSB0YXNrIHRvIGEgdHVwbGUgdG8gcmVjb25zdHJ1Y3QgaXQgbGF0ZXIgKHVzZWQgZm9yIG11bHRpcHJvY2Vzc2luZyB0byBwYXNzIGluIHF1ZXVlKS4KCiAgICAgICAgOnJldHVybnM6IFRoZSBjb252ZXJ0ZWQgdGFzay4KICAgICAgICAiIiIKICAgICAgICB0YXNrX2NsYXNzLCB0YXNrX2t3YXJncyA9IHN1cGVyKCkudG9fdHVwbGUoKQogICAgICAgIHJldHVybiB0YXNrX2NsYXNzLCB7Kip0YXNrX2t3YXJncywgInNwZWFrZXJfbGFiZWxzIjogc2VsZi5fc3BlYWtlcl9sYWJlbHN9CgoKY2xhc3MgVGFza0NyZWF0b3I6CiAgICAiIiIKICAgIEEgdGFzayBjcmVhdG9yIHRvIGNyZWF0ZSBkaWZmZXJlbnQgdGFza3MgdG8gcnVuIGFmdGVyIHRoZSBWQUQuCiAgICAiIiIKCiAgICAjOiBBIG1hcCBmcm9tIHRhc2sgY2xhc3MgbmFtZSB0byB0YXNrIGNsYXNzIHRvIHVzZSBpbiBgZnJvbV90dXBsZWA6CiAgICBfTUFQID0gewogICAgICAgIEJhc2VUYXNrLl9fbmFtZV9fOiBCYXNlVGFzaywKICAgICAgICBTcGVlY2hEaWFyaXphdGlvblRhc2suX19uYW1lX186IFNwZWVjaERpYXJpemF0aW9uVGFzaywKICAgIH0KCiAgICBkZWYgX19pbml0X18oc2VsZiwgdGFza190eXBlOiB0eXBlW0Jhc2VUYXNrXSwgdGFza19rd2FyZ3M6IGRpY3QgPSBOb25lKToKICAgICAgICAiIiIKICAgICAgICBJbml0aWFsaXplIHRoZSB0YXNrIGNyZWF0b3IuCiAgICAgICAgOnBhcmFtIHRhc2tfdHlwZTogVGhlIHRhc2sgdHlwZSAtIGEgYEJhc2VUYXNrYCBzdWJjbGFzcy4KICAgICAgICA6cGFyYW0gdGFza19rd2FyZ3M6IEFkZGl0aW9uYWwga2V5d29yZCBhcmd1bWVudHMgdG8gcGFzcyB0byB0aGUgdG8gYmUgY3JlYXRlZCB0YXNrcy4KICAgICAgICAiIiIKICAgICAgICBzZWxmLl90YXNrX3R5cGUgPSB0YXNrX3R5cGUKICAgICAgICBzZWxmLl90YXNrX2t3YXJncyA9IHRhc2tfa3dhcmdzIG9yIHt9CgogICAgZGVmIGNyZWF0ZV90YXNrKHNlbGYsIGF1ZGlvX2ZpbGU6IFBhdGgpIC0+IEJhc2VUYXNrOgogICAgICAgICIiIgogICAgICAgIENyZWF0ZSBhIHRhc2sgd2l0aCB0aGUgZ2l2ZW4gYXVkaW8gZmlsZS4KCiAgICAgICAgOnBhcmFtIGF1ZGlvX2ZpbGU6IFRoZSBhdWRpbyBmaWxlIHRvIGFzc2lnbiB0byB0aGUgdGFzay4KCiAgICAgICAgOnJldHVybnM6IFRoZSBjcmVhdGVkIHRhc2suCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuX3Rhc2tfdHlwZShhdWRpb19maWxlPWF1ZGlvX2ZpbGUsICoqc2VsZi5fdGFza19rd2FyZ3MpCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgZnJvbV90dXBsZShjbHMsIHRhc2tfdHVwbGU6IHR1cGxlW3N0ciwgZGljdF0pIC0+IEJhc2VUYXNrOgogICAgICAgICIiIgogICAgICAgIENyZWF0ZSBhIHRhc2sgZnJvbSBhIHR1cGxlIG9mIHRoZSBhdWRpbyBmaWxlIG5hbWUgYW5kIHRoZSB0YXNrIGt3YXJncy4KCiAgICAgICAgOnBhcmFtIHRhc2tfdHVwbGU6IFRoZSB0YXNrIHR1cGxlIHRvIGNyZWF0ZSB0aGUgdGFzayBmcm9tLgoKICAgICAgICA6cmV0dXJuczogVGhlIGNyZWF0ZWQgdGFzay4KICAgICAgICAiIiIKICAgICAgICB0YXNrX2NsYXNzLCB0YXNrX2t3YXJncyA9IHRhc2tfdHVwbGUKICAgICAgICByZXR1cm4gY2xzLl9NQVBbdGFza19jbGFzc10oKip0YXNrX2t3YXJncykKCgpjbGFzcyBWb2ljZUFjdGl2aXR5RGV0ZWN0b3I6CiAgICAiIiIKICAgIEEgdm9pY2UgYWN0aXZpdHkgZGV0ZWN0aW9uIHdyYXBwZXIgZm9yIHRoZSBzaWxlcm8gVkFEIG1vZGVsIC0gaHR0cHM6Ly9naXRodWIuY29tL3NuYWtlcnM0L3NpbGVyby12YWQuCiAgICAiIiIKCiAgICBkZWYgX19pbml0X18oCiAgICAgICAgc2VsZiwKICAgICAgICAjIE1vZGVsIGxvYWRpbmcga3dhcmdzOgogICAgICAgIHVzZV9vbm54OiBib29sID0gVHJ1ZSwKICAgICAgICBmb3JjZV9vbm54X2NwdTogYm9vbCA9IFRydWUsCiAgICAgICAgIyBEZXRlY3Rpb24ga3dhcmdzOgogICAgICAgIHRocmVzaG9sZDogZmxvYXQgPSAwLjUsCiAgICAgICAgc2FtcGxpbmdfcmF0ZTogaW50ID0gMTZfMDAwLAogICAgICAgIG1pbl9zcGVlY2hfZHVyYXRpb25fbXM6IGludCA9IDI1MCwKICAgICAgICBtYXhfc3BlZWNoX2R1cmF0aW9uX3M6IGZsb2F0ID0gZmxvYXQoImluZiIpLAogICAgICAgIG1pbl9zaWxlbmNlX2R1cmF0aW9uX21zOiBpbnQgPSAxMDAsCiAgICAgICAgd2luZG93X3NpemVfc2FtcGxlczogaW50ID0gNTEyLAogICAgICAgIHNwZWVjaF9wYWRfbXM6IGludCA9IDMwLAogICAgICAgIHJldHVybl9zZWNvbmRzOiBib29sID0gRmFsc2UsCiAgICAgICAgcGVyX2NoYW5uZWw6IGJvb2wgPSBGYWxzZSwKICAgICk6CiAgICAgICAgIiIiCiAgICAgICAgSW5pdGlhbGl6ZSB0aGUgdm9pY2UgYWN0aXZpdHkgZGV0ZWN0b3IuCgogICAgICAgIDpwYXJhbSB1c2Vfb25ueDogICAgICAgICAgICAgICAgV2hldGhlciB0byB1c2UgT05OWCBmb3IgaW5mZXJlbmNlLiBEZWZhdWx0IGlzIFRydWUuCiAgICAgICAgOnBhcmFtIGZvcmNlX29ubnhfY3B1OiAgICAgICAgICBXaGV0aGVyIHRvIGZvcmNlIE9OTlggdG8gdXNlIENQVSBmb3IgaW5mZXJlbmNlLiBEZWZhdWx0IGlzIFRydWUuCiAgICAgICAgOnBhcmFtIHRocmVzaG9sZDogICAgICAgICAgICAgICBTcGVlY2ggdGhyZXNob2xkLiBTaWxlcm8gVkFEIG91dHB1dHMgc3BlZWNoIHByb2JhYmlsaXRpZXMgZm9yIGVhY2ggYXVkaW8gY2h1bmssCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9iYWJpbGl0aWVzIEFCT1ZFIHRoaXMgdmFsdWUgYXJlIGNvbnNpZGVyZWQgYXMgU1BFRUNILiBJdCBpcyBiZXR0ZXIgdG8gdHVuZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcyBwYXJhbWV0ZXIgZm9yIGVhY2ggZGF0YXNldCBzZXBhcmF0ZWx5LCBidXQgImxhenkiIDAuNSBpcyBwcmV0dHkgZ29vZCBmb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vc3QgZGF0YXNldHMuCiAgICAgICAgOnBhcmFtIHNhbXBsaW5nX3JhdGU6ICAgICAgICAgICBDdXJyZW50bHksIHNpbGVybyBWQUQgbW9kZWxzIHN1cHBvcnQgODAwMCBhbmQgMTYwMDAgc2FtcGxlIHJhdGVzLgogICAgICAgIDpwYXJhbSBtaW5fc3BlZWNoX2R1cmF0aW9uX21zOiAgRmluYWwgc3BlZWNoIGNodW5rcyBzaG9ydGVyIG1pbl9zcGVlY2hfZHVyYXRpb25fbXMgYXJlIHRocm93biBvdXQuCiAgICAgICAgOnBhcmFtIG1heF9zcGVlY2hfZHVyYXRpb25fczogICBNYXhpbXVtIGR1cmF0aW9uIG9mIHNwZWVjaCBjaHVua3MgaW4gc2Vjb25kcy4gQ2h1bmtzIGxvbmdlciB0aGFuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgbWF4X3NwZWVjaF9kdXJhdGlvbl9zYCB3aWxsIGJlIHNwbGl0IGF0IHRoZSB0aW1lc3RhbXAgb2YgdGhlIGxhc3Qgc2lsZW5jZSB0aGF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0cyBtb3JlIHRoYW4gMTAwbXMgKGlmIGFueSksIHRvIHByZXZlbnQgYWdncmVzc2l2ZSBjdXR0aW5nLiBPdGhlcndpc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGV5IHdpbGwgYmUgc3BsaXQgYWdncmVzc2l2ZWx5IGp1c3QgYmVmb3JlIG1heF9zcGVlY2hfZHVyYXRpb25fcy4KICAgICAgICA6cGFyYW0gbWluX3NpbGVuY2VfZHVyYXRpb25fbXM6IEluIHRoZSBlbmQgb2YgZWFjaCBzcGVlY2ggY2h1bmsgd2FpdCBmb3IgbWluX3NpbGVuY2VfZHVyYXRpb25fbXMgYmVmb3JlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXBhcmF0aW5nIGl0LgogICAgICAgIDpwYXJhbSB3aW5kb3dfc2l6ZV9zYW1wbGVzOiAgICAgQXVkaW8gY2h1bmtzIG9mIHdpbmRvd19zaXplX3NhbXBsZXMgc2l6ZSBhcmUgZmVkIHRvIHRoZSBzaWxlcm8gVkFEIG1vZGVsLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV0FSTklORyEgU2lsZXJvIFZBRCBtb2RlbHMgd2VyZSB0cmFpbmVkIHVzaW5nIDUxMiwgMTAyNCwgMTUzNiBzYW1wbGVzIGZvciAxNjAwMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtcGxlIHJhdGUgYW5kIDI1NiwgNTEyLCA3Njggc2FtcGxlcyBmb3IgODAwMCBzYW1wbGUgcmF0ZS4gVmFsdWVzIG90aGVyIHRoYW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZXNlIG1heSBhZmZlY3QgbW9kZWwgcGVyZm9ybWFuY2UhCiAgICAgICAgOnBhcmFtIHNwZWVjaF9wYWRfbXM6ICAgICAgICAgICBGaW5hbCBzcGVlY2ggY2h1bmtzIGFyZSBwYWRkZWQgYnkgc3BlZWNoX3BhZF9tcyBlYWNoIHNpZGUuCiAgICAgICAgOnBhcmFtIHJldHVybl9zZWNvbmRzOiAgICAgICAgICBXaGV0aGVyIHJldHVybiB0aW1lc3RhbXBzIGluIHNlY29uZHMuIEZhbHNlIG1lYW5zIHRvIHJldHVybiB0aW1lc3RhbXBzIGluCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1wbGVzIChkZWZhdWx0IC0gRmFsc2UpLgogICAgICAgIDpwYXJhbSBwZXJfY2hhbm5lbDogICAgICAgICAgICAgV2hldGhlciB0byByZXR1cm4gdGltZXN0YW1wcyBwZXIgY2hhbm5lbCAoZGVmYXVsdCAtIEZhbHNlKS4gVGhpcyB3aWxsIHJ1biBWQUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uIGVhY2ggY2hhbm5lbCBzZXBhcmF0ZWx5IGFuZCByZXR1cm4gYSBsaXN0IG9mIHRpbWVzdGFtcHMgcGVyIGNoYW5uZWwuCiAgICAgICAgIiIiCiAgICAgICAgIyBTdG9yZSBjb25maWd1cmF0aW9uczoKICAgICAgICBzZWxmLl91c2Vfb25ueCA9IHVzZV9vbm54CiAgICAgICAgc2VsZi5fZm9yY2Vfb25ueF9jcHUgPSBmb3JjZV9vbm54X2NwdQogICAgICAgIHNlbGYuX3RocmVzaG9sZCA9IHRocmVzaG9sZAogICAgICAgIHNlbGYuX3NhbXBsaW5nX3JhdGUgPSBzYW1wbGluZ19yYXRlCiAgICAgICAgc2VsZi5fbWluX3NwZWVjaF9kdXJhdGlvbl9tcyA9IG1pbl9zcGVlY2hfZHVyYXRpb25fbXMKICAgICAgICBzZWxmLl9tYXhfc3BlZWNoX2R1cmF0aW9uX3MgPSBtYXhfc3BlZWNoX2R1cmF0aW9uX3MKICAgICAgICBzZWxmLl9taW5fc2lsZW5jZV9kdXJhdGlvbl9tcyA9IG1pbl9zaWxlbmNlX2R1cmF0aW9uX21zCiAgICAgICAgc2VsZi5fd2luZG93X3NpemVfc2FtcGxlcyA9IHdpbmRvd19zaXplX3NhbXBsZXMKICAgICAgICBzZWxmLl9zcGVlY2hfcGFkX21zID0gc3BlZWNoX3BhZF9tcwogICAgICAgIHNlbGYuX3JldHVybl9zZWNvbmRzID0gcmV0dXJuX3NlY29uZHMKICAgICAgICBzZWxmLl9wZXJfY2hhbm5lbCA9IHBlcl9jaGFubmVsCgogICAgICAgICMgUHJlcGFyZSB0aGUgbW9kZWwgdmFyaWFibGVzCiAgICAgICAgc2VsZi5fbW9kZWw6IHRvcmNoLk1vZHVsZSA9IE5vbmUKICAgICAgICBzZWxmLl9nZXRfc3BlZWNoX3RpbWVzdGFtcHM6IEZ1bmN0aW9uVHlwZSA9IE5vbmUKCiAgICBkZWYgbG9hZChzZWxmLCBmb3JjZV9yZWxvYWQ6IGJvb2wgPSBUcnVlKToKICAgICAgICAiIiIKICAgICAgICBMb2FkIHRoZSBWQUQgbW9kZWwuCgogICAgICAgIDpwYXJhbSBmb3JjZV9yZWxvYWQ6IFdoZXRoZXIgdG8gZm9yY2UgcmVsb2FkIHRoZSBtb2RlbCBldmVuIGlmIGl0IHdhcyBhbHJlYWR5IGxvYWRlZC4gRGVmYXVsdCBpcyBUcnVlLgogICAgICAgICIiIgogICAgICAgIG1vZGVsLCB1dGlscyA9IHRvcmNoLmh1Yi5sb2FkKAogICAgICAgICAgICByZXBvX29yX2Rpcj0ic25ha2VyczQvc2lsZXJvLXZhZCIsCiAgICAgICAgICAgIG1vZGVsPSJzaWxlcm9fdmFkIiwKICAgICAgICAgICAgZm9yY2VfcmVsb2FkPWZvcmNlX3JlbG9hZCwKICAgICAgICAgICAgb25ueD1zZWxmLl91c2Vfb25ueCwKICAgICAgICAgICAgZm9yY2Vfb25ueF9jcHU9c2VsZi5fZm9yY2Vfb25ueF9jcHUsCiAgICAgICAgKQogICAgICAgIHNlbGYuX21vZGVsID0gbW9kZWwKICAgICAgICAoCiAgICAgICAgICAgIHNlbGYuX2dldF9zcGVlY2hfdGltZXN0YW1wcywKICAgICAgICAgICAgXywgICMgc2F2ZV9hdWRpbywKICAgICAgICAgICAgXywgICMgcmVhZF9hdWRpbywKICAgICAgICAgICAgXywgICMgVkFESXRlcmF0b3IsCiAgICAgICAgICAgIF8sICAjIGNvbGxlY3RfY2h1bmtzCiAgICAgICAgKSA9IHV0aWxzCgogICAgZGVmIGRldGVjdF92b2ljZSgKICAgICAgICBzZWxmLAogICAgICAgIGF1ZGlvX2ZpbGU6IFBhdGgsCiAgICApIC0+IGxpc3RbZGljdFtzdHIsIGludF1dIHwgbGlzdFtsaXN0W2RpY3Rbc3RyLCBpbnRdXV06CiAgICAgICAgIiIiCiAgICAgICAgSW5mZXIgdGhlIGF1ZGlvIHRocm91Z2ggdGhlIFZBRCBtb2RlbCBhbmQgcmV0dXJuIHRoZSBzcGVlY2ggdGltZXN0YW1wcy4KCiAgICAgICAgOnBhcmFtIGF1ZGlvX2ZpbGU6IFRoZSBhdWRpbyBmaWxlIHRvIGluZmVyLgoKICAgICAgICA6cmV0dXJuczogVGhlIHNwZWVjaCB0aW1lc3RhbXBzIGluIHRoZSBhdWRpby4gQSBsaXN0IG9mIHRpbWVzdGFtcHMgd2hlcmUgZWFjaCB0aW1lc3RhbXAgaXMgYSBkaWN0aW9uYXJ5IHdpdGggdGhlCiAgICAgICAgICAgICAgICAgZm9sbG93aW5nIGtleXM6CgogICAgICAgICAgICAgICAgICogInN0YXJ0IjogVGhlIHN0YXJ0IHNhbXBsZSBpbmRleCBvZiB0aGUgc3BlZWNoIGluIHRoZSBhdWRpby4KICAgICAgICAgICAgICAgICAqICJlbmQiOiAgIFRoZSBlbmQgc2FtcGxlIGluZGV4IG9mIHRoZSBzcGVlY2ggaW4gdGhlIGF1ZGlvLgoKICAgICAgICAgICAgICAgICBJZiBgcGVyX2NoYW5uZWxgIGlzIFRydWUsIGEgbGlzdCBvZiB0aW1lc3RhbXBzIHBlciBjaGFubmVsIHdpbGwgYmUgcmV0dXJuZWQuCiAgICAgICAgIiIiCiAgICAgICAgIyBDYXN0IHRvIGEgbnVtcHkgYXJyYXk6CiAgICAgICAgYXVkaW8gPSBzZWxmLl9yZWFkX2F1ZGlvKGF1ZGlvX2ZpbGUpCgogICAgICAgICMgRGV0ZWN0IHNwZWVjaDoKICAgICAgICBpZiBub3Qgc2VsZi5fcGVyX2NoYW5uZWw6CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9nZXRfc3BlZWNoX3RpbWVzdGFtcHMoCiAgICAgICAgICAgICAgICBhdWRpbywKICAgICAgICAgICAgICAgIHNlbGYuX21vZGVsLAogICAgICAgICAgICAgICAgdGhyZXNob2xkPXNlbGYuX3RocmVzaG9sZCwKICAgICAgICAgICAgICAgIG1pbl9zcGVlY2hfZHVyYXRpb25fbXM9c2VsZi5fbWluX3NwZWVjaF9kdXJhdGlvbl9tcywKICAgICAgICAgICAgICAgIG1heF9zcGVlY2hfZHVyYXRpb25fcz1zZWxmLl9tYXhfc3BlZWNoX2R1cmF0aW9uX3MsCiAgICAgICAgICAgICAgICBtaW5fc2lsZW5jZV9kdXJhdGlvbl9tcz1zZWxmLl9taW5fc2lsZW5jZV9kdXJhdGlvbl9tcywKICAgICAgICAgICAgICAgIHNwZWVjaF9wYWRfbXM9c2VsZi5fc3BlZWNoX3BhZF9tcywKICAgICAgICAgICAgICAgIHNhbXBsaW5nX3JhdGU9c2VsZi5fc2FtcGxpbmdfcmF0ZSwKICAgICAgICAgICAgICAgIHdpbmRvd19zaXplX3NhbXBsZXM9c2VsZi5fd2luZG93X3NpemVfc2FtcGxlcywKICAgICAgICAgICAgICAgIHJldHVybl9zZWNvbmRzPXNlbGYuX3JldHVybl9zZWNvbmRzLAogICAgICAgICAgICApCgogICAgICAgICMgUGVyIGNoYW5uZWw6CiAgICAgICAgc3BlZWNoX3RpbWVzdGFtcHMgPSBbXQogICAgICAgIGZvciBjaGFubmVsIGluIGF1ZGlvOgogICAgICAgICAgICBzcGVlY2hfdGltZXN0YW1wcy5hcHBlbmQoCiAgICAgICAgICAgICAgICBzZWxmLl9nZXRfc3BlZWNoX3RpbWVzdGFtcHMoCiAgICAgICAgICAgICAgICAgICAgY2hhbm5lbCwKICAgICAgICAgICAgICAgICAgICBzZWxmLl9tb2RlbCwKICAgICAgICAgICAgICAgICAgICB0aHJlc2hvbGQ9c2VsZi5fdGhyZXNob2xkLAogICAgICAgICAgICAgICAgICAgIG1pbl9zcGVlY2hfZHVyYXRpb25fbXM9c2VsZi5fbWluX3NwZWVjaF9kdXJhdGlvbl9tcywKICAgICAgICAgICAgICAgICAgICBtYXhfc3BlZWNoX2R1cmF0aW9uX3M9c2VsZi5fbWF4X3NwZWVjaF9kdXJhdGlvbl9zLAogICAgICAgICAgICAgICAgICAgIG1pbl9zaWxlbmNlX2R1cmF0aW9uX21zPXNlbGYuX21pbl9zaWxlbmNlX2R1cmF0aW9uX21zLAogICAgICAgICAgICAgICAgICAgIHNwZWVjaF9wYWRfbXM9c2VsZi5fc3BlZWNoX3BhZF9tcywKICAgICAgICAgICAgICAgICAgICBzYW1wbGluZ19yYXRlPXNlbGYuX3NhbXBsaW5nX3JhdGUsCiAgICAgICAgICAgICAgICAgICAgd2luZG93X3NpemVfc2FtcGxlcz1zZWxmLl93aW5kb3dfc2l6ZV9zYW1wbGVzLAogICAgICAgICAgICAgICAgICAgIHJldHVybl9zZWNvbmRzPXNlbGYuX3JldHVybl9zZWNvbmRzLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApCgogICAgICAgIHJldHVybiBzcGVlY2hfdGltZXN0YW1wcwoKICAgIGRlZiBfcmVhZF9hdWRpbygKICAgICAgICBzZWxmLAogICAgICAgIHBhdGg6IFBhdGgsCiAgICApIC0+IHRvcmNoLlRlbnNvcjoKICAgICAgICAiIiIKICAgICAgICBSZWFkIHRoZSBhdWRpbyBmcm9tIHRoZSBnaXZlbiBwYXRoIGFuZCByZXR1cm4gaXQgYXMgYSB0ZW5zb3IuCgogICAgICAgIDpwYXJhbSBwYXRoOiBUaGUgcGF0aCB0byB0aGUgYXVkaW8gZmlsZS4KCiAgICAgICAgOnJldHVybnM6IFRoZSBhdWRpbyBhcyBhIHRlbnNvci4KICAgICAgICAiIiIKICAgICAgICAjIFJlYWQgdGhlIGF1ZGlvOgogICAgICAgIGF1ZGlvLCBzYW1wbGluZ19yYXRlID0gdG9yY2hhdWRpby5sb2FkKHN0cihwYXRoKSkKCiAgICAgICAgIyBDaGVjayBpZiB0aGUgYXVkaW8gaXMgc3RlcmVvIGFuZCBpZiBzbywgY29udmVydCBpdCB0byBtb25vIChvbmx5IGlmIG5vdCBwZXIgY2hhbm5lbCk6CiAgICAgICAgaWYgYXVkaW8uc2l6ZSgwKSA+IDEgYW5kIG5vdCBzZWxmLl9wZXJfY2hhbm5lbDoKICAgICAgICAgICAgYXVkaW8gPSBhdWRpby5tZWFuKGRpbT0wLCBrZWVwZGltPVRydWUpCgogICAgICAgICMgUmVzYW1wbGUgdGhlIGF1ZGlvIGlmIG5lZWRlZDoKICAgICAgICBpZiBzYW1wbGluZ19yYXRlICE9IHNlbGYuX3NhbXBsaW5nX3JhdGU6CiAgICAgICAgICAgIHRyYW5zZm9ybSA9IHRvcmNoYXVkaW8udHJhbnNmb3Jtcy5SZXNhbXBsZSgKICAgICAgICAgICAgICAgIG9yaWdfZnJlcT1zYW1wbGluZ19yYXRlLCBuZXdfZnJlcT1zZWxmLl9zYW1wbGluZ19yYXRlCiAgICAgICAgICAgICkKICAgICAgICAgICAgYXVkaW8gPSB0cmFuc2Zvcm0oYXVkaW8pCgogICAgICAgICMgUmV0dXJuIHRoZSBhdWRpbyAoc3F1ZWV6ZSBpZiBub3QgcGVyIGNoYW5uZWwpOgogICAgICAgIHJldHVybiBhdWRpbyBpZiBzZWxmLl9wZXJfY2hhbm5lbCBlbHNlIGF1ZGlvLnNxdWVlemUoMCkKCgojOiBUaGUgdmFsdWUgdG8gc2VuZCBpbnRvIG11bHRpcHJvY2Vzc2luZyBxdWV1ZXMgdG8gc3RvcCB0aGUgcHJvY2VzczoKX01VTFRJUFJPQ0VTU0lOR19TVE9QX01BUksgPSAiU1RPUCIKCgpkZWYgX211bHRpcHJvY2Vzc2luZ19jb21wbGV0ZV90YXNrcygKICAgIHZhZF9pbml0X2t3YXJnczogZGljdCwgdGFza3NfcXVldWU6IFF1ZXVlLCByZXN1bHRzX3F1ZXVlOiBRdWV1ZQopOgogICAgIiIiCiAgICBDb21wbGV0ZSB0aGUgdGFza3MgaW4gdGhlIGdpdmVuIHF1ZXVlIGFuZCBwdXQgdGhlIHJlc3VsdHMgaW4gdGhlIGdpdmVuIHJlc3VsdHMgcXVldWUuIFRoZSBmdW5jdGlvbiB3aWxsIHN0b3Agd2hlbgogICAgdGhlIGdpdmVuIHRhc2tzIHF1ZXVlIHdpbGwgcmVjZWl2ZSB0aGUgc3RvcCBtYXJrLiBJdCBpcyBhaW1lZCB0byBiZSB1c2VkIHdpdGggbXVsdGlwcm9jZXNzaW5nIGFzIGEgcHJvY2Vzcy4KCiAgICA6cGFyYW0gdmFkX2luaXRfa3dhcmdzOiBUaGUgVkFEIGluaXRpYWxpemF0aW9uIGt3YXJncy4KICAgIDpwYXJhbSB0YXNrc19xdWV1ZTogICAgIEEgcXVldWUgdG8gZ2V0IHRoZSB0YXNrcyBmcm9tLgogICAgOnBhcmFtIHJlc3VsdHNfcXVldWU6ICAgQSBxdWV1ZSB0byBwdXQgdGhlIHJlc3VsdHMgaW4uCiAgICAiIiIKICAgICMgSW5pdGlhbGl6ZSBhbmQgbG9hZCB0aGUgVkFEOgogICAgdmFkID0gVm9pY2VBY3Rpdml0eURldGVjdG9yKCoqdmFkX2luaXRfa3dhcmdzKQogICAgdmFkLmxvYWQoZm9yY2VfcmVsb2FkPUZhbHNlKQoKICAgICMgU3RhcnQgbGlzdGVuaW5nIHRvIHRoZSB0YXNrcyBxdWV1ZToKICAgIHdoaWxlIFRydWU6CiAgICAgICAgIyBHZXQgdGhlIHRhc2s6CiAgICAgICAgdGFzazogdHVwbGVbc3RyLCBkaWN0XSA9IHRhc2tzX3F1ZXVlLmdldCgpCiAgICAgICAgaWYgdGFzayA9PSBfTVVMVElQUk9DRVNTSU5HX1NUT1BfTUFSSzoKICAgICAgICAgICAgYnJlYWsKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgQ3JlYXRlIHRoZSB0YXNrOgogICAgICAgICAgICB0YXNrID0gVGFza0NyZWF0b3IuZnJvbV90dXBsZSh0YXNrX3R1cGxlPXRhc2spCiAgICAgICAgICAgICMgUnVuIHRoZSBmaWxlIHRocm91Z2ggdGhlIFZBRDoKICAgICAgICAgICAgc3BlZWNoX3RpbWVzdGFtcHMgPSB2YWQuZGV0ZWN0X3ZvaWNlKGF1ZGlvX2ZpbGU9dGFzay5hdWRpb19maWxlKQogICAgICAgICAgICAjIENvbXBsZXRlIHRoZSB0YXNrOgogICAgICAgICAgICB0YXNrLmRvX3Rhc2soc3BlZWNoX3RpbWVzdGFtcHM9c3BlZWNoX3RpbWVzdGFtcHMpCiAgICAgICAgICAgICMgQnVpbGQgdGhlIHJlc3VsdDoKICAgICAgICAgICAgcmVzdWx0ID0gKEZhbHNlLCB0YXNrLmdldF9yZXN1bHQoKSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGV4Y2VwdGlvbjoKICAgICAgICAgICAgIyBCdWlsZCB0aGUgZXJyb3I6CiAgICAgICAgICAgIHJlc3VsdCA9IChUcnVlLCAodGFzay5hdWRpb19maWxlLm5hbWUsIHN0cihleGNlcHRpb24pKSkKICAgICAgICAjIENvbGxlY3QgdGhlIHJlc3VsdCAvIGVycm9yOgogICAgICAgIHJlc3VsdHNfcXVldWUucHV0KHJlc3VsdCkKCiAgICAjIE1hcmsgdGhlIGVuZCBvZiB0aGUgdGFza3M6CiAgICByZXN1bHRzX3F1ZXVlLnB1dChfTVVMVElQUk9DRVNTSU5HX1NUT1BfTUFSSykKCgojIEdldCB0aGUgZ2xvYmFsIGxvZ2dlcjoKdHJ5OgogICAgaW1wb3J0IG1scnVuCgogICAgX0xPR0dFUiA9IG1scnVuLmdldF9vcl9jcmVhdGVfY3R4KCJzaWxlcm9fdmFkIikubG9nZ2VyCmV4Y2VwdCBNb2R1bGVOb3RGb3VuZEVycm9yOgogICAgX0xPR0dFUiA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKCkKCgpkZWYgZGV0ZWN0X3ZvaWNlKAogICAgIyBJbnB1dCBrd2FyZ3M6CiAgICBkYXRhX3BhdGg6IHN0ciB8IFBhdGggfCBsaXN0W3N0ciB8IFBhdGhdLAogICAgIyBNb2RlbCBsb2FkaW5nIGt3YXJnczoKICAgIHVzZV9vbm54OiBib29sID0gVHJ1ZSwKICAgIGZvcmNlX29ubnhfY3B1OiBib29sID0gVHJ1ZSwKICAgICMgRGV0ZWN0aW9uIGt3YXJnczoKICAgIHRocmVzaG9sZDogZmxvYXQgPSAwLjUsCiAgICBzYW1wbGluZ19yYXRlOiBpbnQgPSAxNl8wMDAsCiAgICBtaW5fc3BlZWNoX2R1cmF0aW9uX21zOiBpbnQgPSAyNTAsCiAgICBtYXhfc3BlZWNoX2R1cmF0aW9uX3M6IGZsb2F0ID0gZmxvYXQoImluZiIpLAogICAgbWluX3NpbGVuY2VfZHVyYXRpb25fbXM6IGludCA9IDEwMCwKICAgIHdpbmRvd19zaXplX3NhbXBsZXM6IGludCA9IDUxMiwKICAgIHNwZWVjaF9wYWRfbXM6IGludCA9IDMwLAogICAgcmV0dXJuX3NlY29uZHM6IGJvb2wgPSBGYWxzZSwKICAgIHBlcl9jaGFubmVsOiBib29sID0gRmFsc2UsCiAgICAjIE90aGVyIGt3YXJnczoKICAgIHVzZV9tdWx0aXByb2Nlc3Npbmc6IGludCA9IDAsCiAgICB2ZXJib3NlOiBib29sID0gRmFsc2UsCik6CiAgICAiIiIKICAgIFBlcmZvcm0gdm9pY2UgYWN0aXZpdHkgZGV0ZWN0aW9uIG9uIGdpdmVuIGF1ZGlvIGZpbGVzIHVzaW5nIHRoZSBzaWxlcm8gVkFEIG1vZGVsIC0KICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9zbmFrZXJzNC9zaWxlcm8tdmFkLiBUaGUgZW5kIHJlc3VsdCBpcyBhIGRpY3Rpb25hcnkgd2l0aCB0aGUgZmlsZSBuYW1lcyBhcyBrZXlzIGFuZCB0aGVpcgogICAgVkFEIHRpbWVzdGFtcHMgZGljdGlvbmFyaWVzIGFzIHZhbHVlLgoKICAgIEZvciBleGFtcGxlOjoKCiAgICAgICAgewogICAgICAgICAgICAiZmlsZV8xLndhdiI6IFsKICAgICAgICAgICAgICAgIHsic3RhcnQiOiAwLCAiZW5kIjogMTYwMDB9LAogICAgICAgICAgICAgICAgeyJzdGFydCI6IDE2MDAwLCAiZW5kIjogMzIwMDB9LAogICAgICAgICAgICAgICAgeyJzdGFydCI6IDMyMDAwLCAiZW5kIjogNDgwMDB9LAogICAgICAgICAgICAgICAgLi4uCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJmaWxlXzIud2F2IjogWwogICAgICAgICAgICAgICAgeyJzdGFydCI6IDAsICJlbmQiOiAxNjAwMH0sCiAgICAgICAgICAgICAgICB7InN0YXJ0IjogMTYwMDAsICJlbmQiOiAzMjAwMH0sCiAgICAgICAgICAgICAgICB7InN0YXJ0IjogMzIwMDAsICJlbmQiOiA0ODAwMH0sCiAgICAgICAgICAgICAgICAuLi4KICAgICAgICAgICAgXSwKICAgICAgICAgICAgLi4uCiAgICAgICAgfQoKCiAgICA6cGFyYW0gZGF0YV9wYXRoOiAgICAgICAgICAgICAgIFRoZSBwYXRoIHRvIHRoZSBhdWRpbyBmaWxlcyB0byBkaWFyaXplLiBDYW4gYmUgYSBwYXRoIHRvIGEgc2luZ2xlIGZpbGUsIGEgcGF0aCB0byBhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdG9yeSBvciBhIGxpc3Qgb2YgcGF0aHMgdG8gZmlsZXMuCiAgICA6cGFyYW0gdXNlX29ubng6ICAgICAgICAgICAgICAgIFdoZXRoZXIgdG8gdXNlIE9OTlggZm9yIGluZmVyZW5jZS4gRGVmYXVsdCBpcyBUcnVlLgogICAgOnBhcmFtIGZvcmNlX29ubnhfY3B1OiAgICAgICAgICBXaGV0aGVyIHRvIGZvcmNlIE9OTlggdG8gdXNlIENQVSBmb3IgaW5mZXJlbmNlLiBEZWZhdWx0IGlzIFRydWUuCiAgICA6cGFyYW0gdGhyZXNob2xkOiAgICAgICAgICAgICAgIFNwZWVjaCB0aHJlc2hvbGQuIFNpbGVybyBWQUQgb3V0cHV0cyBzcGVlY2ggcHJvYmFiaWxpdGllcyBmb3IgZWFjaCBhdWRpbyBjaHVuaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmFiaWxpdGllcyBBQk9WRSB0aGlzIHZhbHVlIGFyZSBjb25zaWRlcmVkIGFzIFNQRUVDSC4gSXQgaXMgYmV0dGVyIHRvIHR1bmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcyBwYXJhbWV0ZXIgZm9yIGVhY2ggZGF0YXNldCBzZXBhcmF0ZWx5LCBidXQgImxhenkiIDAuNSBpcyBwcmV0dHkgZ29vZCBmb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9zdCBkYXRhc2V0cy4KICAgIDpwYXJhbSBzYW1wbGluZ19yYXRlOiAgICAgICAgICAgQ3VycmVudGx5LCBzaWxlcm8gVkFEIG1vZGVscyBzdXBwb3J0IDgwMDAgYW5kIDE2MDAwIHNhbXBsZSByYXRlcy4KICAgIDpwYXJhbSBtaW5fc3BlZWNoX2R1cmF0aW9uX21zOiAgRmluYWwgc3BlZWNoIGNodW5rcyBzaG9ydGVyIG1pbl9zcGVlY2hfZHVyYXRpb25fbXMgYXJlIHRocm93biBvdXQuCiAgICA6cGFyYW0gbWF4X3NwZWVjaF9kdXJhdGlvbl9zOiAgIE1heGltdW0gZHVyYXRpb24gb2Ygc3BlZWNoIGNodW5rcyBpbiBzZWNvbmRzLiBDaHVua3MgbG9uZ2VyIHRoYW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYG1heF9zcGVlY2hfZHVyYXRpb25fc2Agd2lsbCBiZSBzcGxpdCBhdCB0aGUgdGltZXN0YW1wIG9mIHRoZSBsYXN0IHNpbGVuY2UgdGhhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0cyBtb3JlIHRoYW4gMTAwbXMgKGlmIGFueSksIHRvIHByZXZlbnQgYWdncmVzc2l2ZSBjdXR0aW5nLiBPdGhlcndpc2UsIHRoZXkgd2lsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZSBzcGxpdCBhZ2dyZXNzaXZlbHkganVzdCBiZWZvcmUgbWF4X3NwZWVjaF9kdXJhdGlvbl9zLgogICAgOnBhcmFtIG1pbl9zaWxlbmNlX2R1cmF0aW9uX21zOiBJbiB0aGUgZW5kIG9mIGVhY2ggc3BlZWNoIGNodW5rIHdhaXQgZm9yIG1pbl9zaWxlbmNlX2R1cmF0aW9uX21zIGJlZm9yZSBzZXBhcmF0aW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0LgogICAgOnBhcmFtIHdpbmRvd19zaXplX3NhbXBsZXM6ICAgICBBdWRpbyBjaHVua3Mgb2Ygd2luZG93X3NpemVfc2FtcGxlcyBzaXplIGFyZSBmZWQgdG8gdGhlIHNpbGVybyBWQUQgbW9kZWwuCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXQVJOSU5HISBTaWxlcm8gVkFEIG1vZGVscyB3ZXJlIHRyYWluZWQgdXNpbmcgNTEyLCAxMDI0LCAxNTM2IHNhbXBsZXMgZm9yIDE2MDAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBsZSByYXRlIGFuZCAyNTYsIDUxMiwgNzY4IHNhbXBsZXMgZm9yIDgwMDAgc2FtcGxlIHJhdGUuIFZhbHVlcyBvdGhlciB0aGFuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZXNlIG1heSBhZmZlY3QgbW9kZWwgcGVyZm9ybWFuY2UhCiAgICA6cGFyYW0gc3BlZWNoX3BhZF9tczogICAgICAgICAgIEZpbmFsIHNwZWVjaCBjaHVua3MgYXJlIHBhZGRlZCBieSBzcGVlY2hfcGFkX21zIGVhY2ggc2lkZS4KICAgIDpwYXJhbSByZXR1cm5fc2Vjb25kczogICAgICAgICAgV2hldGhlciByZXR1cm4gdGltZXN0YW1wcyBpbiBzZWNvbmRzLiBGYWxzZSBtZWFucyB0byByZXR1cm4gdGltZXN0YW1wcyBpbiBzYW1wbGVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkZWZhdWx0IC0gRmFsc2UpLgogICAgOnBhcmFtIHBlcl9jaGFubmVsOiAgICAgICAgICAgICBXaGV0aGVyIHRvIHJldHVybiB0aW1lc3RhbXBzIHBlciBjaGFubmVsIChkZWZhdWx0IC0gRmFsc2UpLiBUaGlzIHdpbGwgcnVuIFZBRCBvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlYWNoIGNoYW5uZWwgc2VwYXJhdGVseSBhbmQgcmV0dXJuIGEgbGlzdCBvZiB0aW1lc3RhbXBzIHBlciBjaGFubmVsLgogICAgOnBhcmFtIHVzZV9tdWx0aXByb2Nlc3Npbmc6ICAgICBUaGUgbnVtYmVyIG9mIHdvcmtlcnMgdG8gdXNlIGZvciBtdWx0aXByb2Nlc3NpbmcuIElmIDAsIG5vIG11bHRpcHJvY2Vzc2luZyB3aWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlIHVzZWQuIERlZmF1bHQgaXMgMC4KICAgIDpwYXJhbSB2ZXJib3NlOiAgICAgICAgICAgICAgICAgVmVyYm9zaXR5LgogICAgIiIiCiAgICBnbG9iYWwgX0xPR0dFUgoKICAgICMgR2V0IHRoZSBpbnB1dCBhdWRpbyBmaWxlcyB0byB0cmFuc2NyaWJlOgogICAgaWYgdmVyYm9zZToKICAgICAgICBfTE9HR0VSLmluZm8oIkNvbGxlY3RpbmcgYXVkaW8gZmlsZXMuIikKICAgIGF1ZGlvX2ZpbGVzID0gX2dldF9hdWRpb19maWxlcyhkYXRhX3BhdGg9ZGF0YV9wYXRoKQogICAgaWYgdmVyYm9zZToKICAgICAgICBfTE9HR0VSLmluZm8oZiJDb2xsZWN0ZWQge2xlbihhdWRpb19maWxlcyl9IGF1ZGlvIGZpbGVzLiIpCgogICAgIyBJbml0aWFsaXplIHRoZSB0cmFuc2NyaXB0aW9uIHBpcGVsaW5lOgogICAgdmFkX2luaXRfa3dhcmdzID0gewogICAgICAgICJ1c2Vfb25ueCI6IHVzZV9vbm54LAogICAgICAgICJmb3JjZV9vbm54X2NwdSI6IGZvcmNlX29ubnhfY3B1LAogICAgICAgICJ0aHJlc2hvbGQiOiB0aHJlc2hvbGQsCiAgICAgICAgInNhbXBsaW5nX3JhdGUiOiBzYW1wbGluZ19yYXRlLAogICAgICAgICJtaW5fc3BlZWNoX2R1cmF0aW9uX21zIjogbWluX3NwZWVjaF9kdXJhdGlvbl9tcywKICAgICAgICAibWF4X3NwZWVjaF9kdXJhdGlvbl9zIjogbWF4X3NwZWVjaF9kdXJhdGlvbl9zLAogICAgICAgICJtaW5fc2lsZW5jZV9kdXJhdGlvbl9tcyI6IG1pbl9zaWxlbmNlX2R1cmF0aW9uX21zLAogICAgICAgICJ3aW5kb3dfc2l6ZV9zYW1wbGVzIjogd2luZG93X3NpemVfc2FtcGxlcywKICAgICAgICAic3BlZWNoX3BhZF9tcyI6IHNwZWVjaF9wYWRfbXMsCiAgICAgICAgInJldHVybl9zZWNvbmRzIjogcmV0dXJuX3NlY29uZHMsCiAgICAgICAgInBlcl9jaGFubmVsIjogcGVyX2NoYW5uZWwsCiAgICB9CgogICAgIyBDcmVhdGUgdGhlIHRhc2sgY3JlYXRvcjoKICAgIHRhc2tfY3JlYXRvciA9IFRhc2tDcmVhdG9yKHRhc2tfdHlwZT1CYXNlVGFzaykKCiAgICAjIFJ1biB0aGUgdHJhbnNjcmlwdGlvbjoKICAgIGlmIHVzZV9tdWx0aXByb2Nlc3Npbmc6CiAgICAgICAgcmVzdWx0cyA9IF9wYXJhbGxlbF9ydW4oCiAgICAgICAgICAgIG5fd29ya2Vycz11c2VfbXVsdGlwcm9jZXNzaW5nLAogICAgICAgICAgICBhdWRpb19maWxlcz1hdWRpb19maWxlcywKICAgICAgICAgICAgZGVzY3JpcHRpb249IkRldGVjdGluZyB2b2ljZSIsCiAgICAgICAgICAgIHZhZF9pbml0X2t3YXJncz12YWRfaW5pdF9rd2FyZ3MsCiAgICAgICAgICAgIHRhc2tfY3JlYXRvcj10YXNrX2NyZWF0b3IsCiAgICAgICAgICAgIHZlcmJvc2U9dmVyYm9zZSwKICAgICAgICApCiAgICBlbHNlOgogICAgICAgIHJlc3VsdHMgPSBfcnVuKAogICAgICAgICAgICBhdWRpb19maWxlcz1hdWRpb19maWxlcywKICAgICAgICAgICAgZGVzY3JpcHRpb249IkRldGVjdGluZyB2b2ljZSIsCiAgICAgICAgICAgIHZhZF9pbml0X2t3YXJncz12YWRfaW5pdF9rd2FyZ3MsCiAgICAgICAgICAgIHRhc2tfY3JlYXRvcj10YXNrX2NyZWF0b3IsCiAgICAgICAgICAgIHZlcmJvc2U9dmVyYm9zZSwKICAgICAgICApCgogICAgIyBQcm9jZXNzIHRoZSByZXN1bHRzOgogICAgcmV0dXJuIF9wcm9jZXNzX3Jlc3VsdHMocmVzdWx0cz1yZXN1bHRzLCB2ZXJib3NlPXZlcmJvc2UpCgoKZGVmIGRpYXJpemUoCiAgICAjIElucHV0IC8gT3V0cHV0IGt3YXJnczoKICAgIGRhdGFfcGF0aDogc3RyIHwgUGF0aCB8IGxpc3Rbc3RyIHwgUGF0aF0sCiAgICAjIE1vZGVsIGxvYWRpbmcga3dhcmdzOgogICAgdXNlX29ubng6IGJvb2wgPSBUcnVlLAogICAgZm9yY2Vfb25ueF9jcHU6IGJvb2wgPSBUcnVlLAogICAgIyBEZXRlY3Rpb24ga3dhcmdzOgogICAgdGhyZXNob2xkOiBmbG9hdCA9IDAuNSwKICAgIHNhbXBsaW5nX3JhdGU6IGludCA9IDE2XzAwMCwKICAgIG1pbl9zcGVlY2hfZHVyYXRpb25fbXM6IGludCA9IDI1MCwKICAgIG1heF9zcGVlY2hfZHVyYXRpb25fczogZmxvYXQgPSBmbG9hdCgiaW5mIiksCiAgICBtaW5fc2lsZW5jZV9kdXJhdGlvbl9tczogaW50ID0gMTAwLAogICAgd2luZG93X3NpemVfc2FtcGxlczogaW50ID0gNTEyLAogICAgc3BlZWNoX3BhZF9tczogaW50ID0gMzAsCiAgICAjIERpYXJpemF0aW9uIGt3YXJnczoKICAgIHNwZWFrZXJfbGFiZWxzOiBsaXN0W3N0cl0gPSBOb25lLAogICAgIyBPdGhlciBrd2FyZ3M6CiAgICB1c2VfbXVsdGlwcm9jZXNzaW5nOiBpbnQgPSAwLAogICAgdmVyYm9zZTogYm9vbCA9IEZhbHNlLAopOgogICAgIiIiCiAgICBQZXJmb3JtIHNwZWVjaCBkaWFyaXphdGlvbiBvbiBnaXZlbiBhdWRpbyBmaWxlcyB1c2luZyB0aGUgc2lsZXJvIFZBRCBtb2RlbCAtIGh0dHBzOi8vZ2l0aHViLmNvbS9zbmFrZXJzNC9zaWxlcm8tdmFkLgogICAgVGhlIHNwZWVjaCBkaWFyaXphdGlvbiBpcyBwZXJmb3JtZWQgcGVyIGNoYW5uZWwgc28gdGhhdCBlYWNoIGNoYW5uZWwgaW4gdGhlIGF1ZGlvIGJlbG9uZyB0byBhIGRpZmZlcmVudCBzcGVha2VyLiBUaGUKICAgIGVuZCByZXN1bHQgaXMgYSBkaWN0aW9uYXJ5IHdpdGggdGhlIGZpbGUgbmFtZXMgYXMga2V5cyBhbmQgdGhlaXIgZGlhcml6YXRpb24gYXMgdmFsdWUuIEEgZGlhcml6YXRpb24gaXMgYSBsaXN0CiAgICBvZiB0dXBsZXM6IChzdGFydCwgZW5kLCBzcGVha2VyX2xhYmVsKS4KCiAgICBGb3IgZXhhbXBsZTo6CgogICAgICAgIHsKICAgICAgICAgICAgImZpbGVfMS53YXYiOiBbCiAgICAgICAgICAgICAgICAoMC4wLCAxLjAsICJzcGVha2VyXzAiKSwKICAgICAgICAgICAgICAgICgxLjAsIDIuMCwgInNwZWFrZXJfMSIpLAogICAgICAgICAgICAgICAgKDIuMCwgMy4wLCAic3BlYWtlcl8wIiksCiAgICAgICAgICAgICAgICAuLi4KICAgICAgICAgICAgXSwKICAgICAgICAgICAgImZpbGVfMi53YXYiOiBbCiAgICAgICAgICAgICAgICAoMC4wLCAxLjAsICJzcGVha2VyXzAiKSwKICAgICAgICAgICAgICAgICgxLjAsIDIuMCwgInNwZWFrZXJfMSIpLAogICAgICAgICAgICAgICAgKDIuMCwgMy4wLCAic3BlYWtlcl8wIiksCiAgICAgICAgICAgICAgICAuLi4KICAgICAgICAgICAgXSwKICAgICAgICAgICAgLi4uCiAgICAgICAgfQoKCiAgICA6cGFyYW0gZGF0YV9wYXRoOiAgICAgICAgICAgICAgIFRoZSBwYXRoIHRvIHRoZSBhdWRpbyBmaWxlcyB0byBkaWFyaXplLiBDYW4gYmUgYSBwYXRoIHRvIGEgc2luZ2xlIGZpbGUsIGEgcGF0aCB0byBhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdG9yeSBvciBhIGxpc3Qgb2YgcGF0aHMgdG8gZmlsZXMuCiAgICA6cGFyYW0gdXNlX29ubng6ICAgICAgICAgICAgICAgIFdoZXRoZXIgdG8gdXNlIE9OTlggZm9yIGluZmVyZW5jZS4gRGVmYXVsdCBpcyBUcnVlLgogICAgOnBhcmFtIGZvcmNlX29ubnhfY3B1OiAgICAgICAgICBXaGV0aGVyIHRvIGZvcmNlIE9OTlggdG8gdXNlIENQVSBmb3IgaW5mZXJlbmNlLiBEZWZhdWx0IGlzIFRydWUuCiAgICA6cGFyYW0gdGhyZXNob2xkOiAgICAgICAgICAgICAgIFNwZWVjaCB0aHJlc2hvbGQuIFNpbGVybyBWQUQgb3V0cHV0cyBzcGVlY2ggcHJvYmFiaWxpdGllcyBmb3IgZWFjaCBhdWRpbyBjaHVuaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvYmFiaWxpdGllcyBBQk9WRSB0aGlzIHZhbHVlIGFyZSBjb25zaWRlcmVkIGFzIFNQRUVDSC4gSXQgaXMgYmV0dGVyIHRvIHR1bmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcyBwYXJhbWV0ZXIgZm9yIGVhY2ggZGF0YXNldCBzZXBhcmF0ZWx5LCBidXQgImxhenkiIDAuNSBpcyBwcmV0dHkgZ29vZCBmb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9zdCBkYXRhc2V0cy4KICAgIDpwYXJhbSBzYW1wbGluZ19yYXRlOiAgICAgICAgICAgQ3VycmVudGx5LCBzaWxlcm8gVkFEIG1vZGVscyBzdXBwb3J0IDgwMDAgYW5kIDE2MDAwIHNhbXBsZSByYXRlcy4KICAgIDpwYXJhbSBtaW5fc3BlZWNoX2R1cmF0aW9uX21zOiAgRmluYWwgc3BlZWNoIGNodW5rcyBzaG9ydGVyIG1pbl9zcGVlY2hfZHVyYXRpb25fbXMgYXJlIHRocm93biBvdXQuCiAgICA6cGFyYW0gbWF4X3NwZWVjaF9kdXJhdGlvbl9zOiAgIE1heGltdW0gZHVyYXRpb24gb2Ygc3BlZWNoIGNodW5rcyBpbiBzZWNvbmRzLiBDaHVua3MgbG9uZ2VyIHRoYW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYG1heF9zcGVlY2hfZHVyYXRpb25fc2Agd2lsbCBiZSBzcGxpdCBhdCB0aGUgdGltZXN0YW1wIG9mIHRoZSBsYXN0IHNpbGVuY2UgdGhhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0cyBtb3JlIHRoYW4gMTAwbXMgKGlmIGFueSksIHRvIHByZXZlbnQgYWdncmVzc2l2ZSBjdXR0aW5nLiBPdGhlcndpc2UsIHRoZXkgd2lsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZSBzcGxpdCBhZ2dyZXNzaXZlbHkganVzdCBiZWZvcmUgbWF4X3NwZWVjaF9kdXJhdGlvbl9zLgogICAgOnBhcmFtIG1pbl9zaWxlbmNlX2R1cmF0aW9uX21zOiBJbiB0aGUgZW5kIG9mIGVhY2ggc3BlZWNoIGNodW5rIHdhaXQgZm9yIG1pbl9zaWxlbmNlX2R1cmF0aW9uX21zIGJlZm9yZSBzZXBhcmF0aW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0LgogICAgOnBhcmFtIHdpbmRvd19zaXplX3NhbXBsZXM6ICAgICBBdWRpbyBjaHVua3Mgb2Ygd2luZG93X3NpemVfc2FtcGxlcyBzaXplIGFyZSBmZWQgdG8gdGhlIHNpbGVybyBWQUQgbW9kZWwuCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXQVJOSU5HISBTaWxlcm8gVkFEIG1vZGVscyB3ZXJlIHRyYWluZWQgdXNpbmcgNTEyLCAxMDI0LCAxNTM2IHNhbXBsZXMgZm9yIDE2MDAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBsZSByYXRlIGFuZCAyNTYsIDUxMiwgNzY4IHNhbXBsZXMgZm9yIDgwMDAgc2FtcGxlIHJhdGUuIFZhbHVlcyBvdGhlciB0aGFuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZXNlIG1heSBhZmZlY3QgbW9kZWwgcGVyZm9ybWFuY2UhCiAgICA6cGFyYW0gc3BlZWNoX3BhZF9tczogICAgICAgICAgIEZpbmFsIHNwZWVjaCBjaHVua3MgYXJlIHBhZGRlZCBieSBzcGVlY2hfcGFkX21zIGVhY2ggc2lkZS4KICAgIDpwYXJhbSBzcGVha2VyX2xhYmVsczogICAgICAgICAgVGhlIHNwZWFrZXIgbGFiZWxzIHRvIHVzZSBmb3IgdGhlIGRpYXJpemF0aW9uLiBJZiBub3QgZ2l2ZW4sIHRoZSBzcGVha2VycyB3aWxsIGJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVkICJzcGVha2VyXzAiLCAic3BlYWtlcl8xIiwgZXRjLgogICAgOnBhcmFtIHVzZV9tdWx0aXByb2Nlc3Npbmc6ICAgICBUaGUgbnVtYmVyIG9mIHdvcmtlcnMgdG8gdXNlIGZvciBtdWx0aXByb2Nlc3NpbmcuIElmIDAsIG5vIG11bHRpcHJvY2Vzc2luZyB3aWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlIHVzZWQuIERlZmF1bHQgaXMgMC4KICAgIDpwYXJhbSB2ZXJib3NlOiAgICAgICAgICAgICAgICAgVmVyYm9zaXR5LgogICAgIiIiCiAgICBnbG9iYWwgX0xPR0dFUgoKICAgICMgR2V0IHRoZSBpbnB1dCBhdWRpbyBmaWxlcyB0byB0cmFuc2NyaWJlOgogICAgaWYgdmVyYm9zZToKICAgICAgICBfTE9HR0VSLmluZm8oIkNvbGxlY3RpbmcgYXVkaW8gZmlsZXMuIikKICAgIGF1ZGlvX2ZpbGVzID0gX2dldF9hdWRpb19maWxlcyhkYXRhX3BhdGg9ZGF0YV9wYXRoKQogICAgaWYgdmVyYm9zZToKICAgICAgICBfTE9HR0VSLmluZm8oZiJDb2xsZWN0ZWQge2xlbihhdWRpb19maWxlcyl9IGF1ZGlvIGZpbGVzLiIpCgogICAgIyBJbml0aWFsaXplIHRoZSB0cmFuc2NyaXB0aW9uIHBpcGVsaW5lOgogICAgdmFkX2luaXRfa3dhcmdzID0gewogICAgICAgICJ1c2Vfb25ueCI6IHVzZV9vbm54LAogICAgICAgICJmb3JjZV9vbm54X2NwdSI6IGZvcmNlX29ubnhfY3B1LAogICAgICAgICJ0aHJlc2hvbGQiOiB0aHJlc2hvbGQsCiAgICAgICAgInNhbXBsaW5nX3JhdGUiOiBzYW1wbGluZ19yYXRlLAogICAgICAgICJtaW5fc3BlZWNoX2R1cmF0aW9uX21zIjogbWluX3NwZWVjaF9kdXJhdGlvbl9tcywKICAgICAgICAibWF4X3NwZWVjaF9kdXJhdGlvbl9zIjogbWF4X3NwZWVjaF9kdXJhdGlvbl9zLAogICAgICAgICJtaW5fc2lsZW5jZV9kdXJhdGlvbl9tcyI6IG1pbl9zaWxlbmNlX2R1cmF0aW9uX21zLAogICAgICAgICJ3aW5kb3dfc2l6ZV9zYW1wbGVzIjogd2luZG93X3NpemVfc2FtcGxlcywKICAgICAgICAic3BlZWNoX3BhZF9tcyI6IHNwZWVjaF9wYWRfbXMsCiAgICAgICAgInJldHVybl9zZWNvbmRzIjogVHJ1ZSwKICAgICAgICAicGVyX2NoYW5uZWwiOiBUcnVlLAogICAgfQoKICAgICMgQ3JlYXRlIHRoZSB0YXNrIGNyZWF0b3I6CiAgICB0YXNrX2NyZWF0b3IgPSBUYXNrQ3JlYXRvcigKICAgICAgICB0YXNrX3R5cGU9U3BlZWNoRGlhcml6YXRpb25UYXNrLCB0YXNrX2t3YXJncz17InNwZWFrZXJfbGFiZWxzIjogc3BlYWtlcl9sYWJlbHN9CiAgICApCgogICAgIyBSdW4gdGhlIHRyYW5zY3JpcHRpb246CiAgICBpZiB1c2VfbXVsdGlwcm9jZXNzaW5nOgogICAgICAgIHJlc3VsdHMgPSBfcGFyYWxsZWxfcnVuKAogICAgICAgICAgICBuX3dvcmtlcnM9dXNlX211bHRpcHJvY2Vzc2luZywKICAgICAgICAgICAgYXVkaW9fZmlsZXM9YXVkaW9fZmlsZXMsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJEaWFyaXppbmciLAogICAgICAgICAgICB2YWRfaW5pdF9rd2FyZ3M9dmFkX2luaXRfa3dhcmdzLAogICAgICAgICAgICB0YXNrX2NyZWF0b3I9dGFza19jcmVhdG9yLAogICAgICAgICAgICB2ZXJib3NlPXZlcmJvc2UsCiAgICAgICAgKQogICAgZWxzZToKICAgICAgICByZXN1bHRzID0gX3J1bigKICAgICAgICAgICAgYXVkaW9fZmlsZXM9YXVkaW9fZmlsZXMsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJEaWFyaXppbmciLAogICAgICAgICAgICB2YWRfaW5pdF9rd2FyZ3M9dmFkX2luaXRfa3dhcmdzLAogICAgICAgICAgICB0YXNrX2NyZWF0b3I9dGFza19jcmVhdG9yLAogICAgICAgICAgICB2ZXJib3NlPXZlcmJvc2UsCiAgICAgICAgKQoKICAgICMgUHJvY2VzcyB0aGUgcmVzdWx0czoKICAgIHJldHVybiBfcHJvY2Vzc19yZXN1bHRzKHJlc3VsdHM9cmVzdWx0cywgdmVyYm9zZT12ZXJib3NlKQoKCmRlZiBfZ2V0X2F1ZGlvX2ZpbGVzKAogICAgZGF0YV9wYXRoOiBQYXRoIHwgc3RyIHwgbGlzdCwKKSAtPiBsaXN0W1BhdGhdOgogICAgIiIiCiAgICBHZXQgdGhlIGF1ZGlvIGZpbGVzIGZyb20gdGhlIGRhdGEgcGF0aC4gSWYgYSBwYXRoIHRvIGEgZGlyZWN0b3J5IGlzIGdpdmVuLCBhbGwgZmlsZXMgaW4gdGhlIGRpcmVjdG9yeSB3aWxsIGJlCiAgICBjb2xsZWN0ZWQuCgogICAgOnBhcmFtIGRhdGFfcGF0aDogVGhlIGRhdGEgcGF0aCB0byBjb2xsZWN0IHRoZSBhdWRpbyBmaWxlcyBmcm9tLgoKICAgIDpyZXR1cm5zOiBUaGUgYXVkaW8gZmlsZXMgbGlzdC4KICAgICIiIgogICAgIyBDaGVjayBpZiBnaXZlbiBhIGxpc3Qgb2YgcGF0aHM6CiAgICBpZiBpc2luc3RhbmNlKGRhdGFfcGF0aCwgbGlzdCk6CiAgICAgICAgYXVkaW9fZmlsZXMgPSBbXQogICAgICAgIGZvciBwYXRoIGluIGRhdGFfcGF0aDoKICAgICAgICAgICAgYXVkaW9fZmlsZXMuZXh0ZW5kKF9nZXRfYXVkaW9fZmlsZXMoZGF0YV9wYXRoPXBhdGgpKQogICAgICAgIHJldHVybiBhdWRpb19maWxlcwoKICAgICMgQ2hlY2sgaWYgZ2l2ZW4gYSBzaW5nbGUgc3RyaW5nIHBhdGggdG8gY2FzdCBpdCB0byBhIGBwYXRobGliLlBhdGhgOgogICAgaWYgaXNpbnN0YW5jZShkYXRhX3BhdGgsIHN0cik6CiAgICAgICAgZGF0YV9wYXRoID0gUGF0aChkYXRhX3BhdGgpLmFic29sdXRlKCkKCiAgICAjIENoZWNrIGlmIHRoZSBwYXRoIGlzIG9mIGEgZGlyZWN0b3J5IG9yIGEgZmlsZToKICAgIGlmIGRhdGFfcGF0aC5pc19kaXIoKToKICAgICAgICAjIEdldCBhbGwgZmlsZXMgaW5zaWRlIHRoZSBkaXJlY3Rvcnk6CiAgICAgICAgYXVkaW9fZmlsZXMgPSBsaXN0KGRhdGFfcGF0aC5nbG9iKCIqLioiKSkKICAgIGVsaWYgZGF0YV9wYXRoLmlzX2ZpbGUoKToKICAgICAgICBhdWRpb19maWxlcyA9IFtkYXRhX3BhdGhdCiAgICBlbHNlOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCiAgICAgICAgICAgIGYiVW5yZWNvZ25pemVkIGRhdGEgcGF0aC4gVGhlIHBhcmFtZXRlciBgZGF0YV9wYXRoYCBtdXN0IGJlIGEgdmFsaWQgcGF0aCB0byBlaXRoZXIgYSBkaXJlY3RvcnkgcGF0aCBvciBhICIKICAgICAgICAgICAgZiJmaWxlLiBHaXZlbjoge3N0cihkYXRhX3BhdGgpfSAiCiAgICAgICAgKQoKICAgIHJldHVybiBhdWRpb19maWxlcwoKCmRlZiBfcnVuKAogICAgYXVkaW9fZmlsZXM6IGxpc3RbUGF0aF0sCiAgICBkZXNjcmlwdGlvbjogc3RyLAogICAgdmFkX2luaXRfa3dhcmdzOiBkaWN0LAogICAgdGFza19jcmVhdG9yOiBUYXNrQ3JlYXRvciwKICAgIHZlcmJvc2U6IGJvb2wsCikgLT4gbGlzdFt0dXBsZVtib29sLCB0dXBsZVtzdHIsIGxpc3RdXV06CiAgICAiIiIKICAgIExvYWQgYSBWQUQgYW5kIHVzZSBpdCB0byBjb21wbGV0ZSB0aGUgdGFza3MgdGhhdCB3aWxsIGJlIGNyZWF0ZWQgb24gdGhlIHByb3ZpZGVkIGZpbGVzIHVzaW5nIHRoZSBnaXZlbiB0YXNrIGNyZWF0b3IuCgogICAgOnBhcmFtIGF1ZGlvX2ZpbGVzOiAgICAgVGhlIGF1ZGlvIGZpbGVzIHRvIHVzZS4KICAgIDpwYXJhbSBkZXNjcmlwdGlvbjogICAgIFRoZSBkZXNjcmlwdGlvbiB0byB1c2UgZm9yIHRoZSBwcm9ncmVzcyBiYXIuCiAgICA6cGFyYW0gdmFkX2luaXRfa3dhcmdzOiBUaGUgVkFEIGluaXRpYWxpemF0aW9uIGtleXdvcmQgYXJndW1lbnRzLgogICAgOnBhcmFtIHRhc2tfY3JlYXRvcjogICAgVGhlIHRhc2sgY3JlYXRvciB0byB1c2UgdG8gY3JlYXRlIHRoZSB0YXNrcy4KICAgIDpwYXJhbSB2ZXJib3NlOiAgICAgICAgIFZlcmJvc2l0eS4KCiAgICA6cmV0dXJuczogVGhlIGNvbGxlY3RlZCByZXN1bHRzLgogICAgIiIiCiAgICAjIExvYWQgdGhlIFZBRDoKICAgIHZhZCA9IFZvaWNlQWN0aXZpdHlEZXRlY3RvcigqKnZhZF9pbml0X2t3YXJncykKICAgIGlmIHZlcmJvc2U6CiAgICAgICAgX0xPR0dFUi5pbmZvKCJMb2FkaW5nIHRoZSBWQUQgbW9kZWwuIikKICAgIHZhZC5sb2FkKCkKICAgIGlmIHZlcmJvc2U6CiAgICAgICAgX0xPR0dFUi5pbmZvKCJWQUQgbW9kZWwgbG9hZGVkLiIpCgogICAgIyBSdW4gdGhlIFZBRCBvbiB0aGUgYXVkaW8gZmlsZXMgYW5kIGNvbGxlY3QgdGhlIHJlc3VsdHM6CiAgICByZXN1bHRzID0gW10KICAgIGZvciBhdWRpb19maWxlIGluIHRxZG0oCiAgICAgICAgYXVkaW9fZmlsZXMsCiAgICAgICAgZGVzYz1kZXNjcmlwdGlvbiwKICAgICAgICB1bml0PSJmaWxlIiwKICAgICAgICB0b3RhbD1sZW4oYXVkaW9fZmlsZXMpLAogICAgICAgIGRpc2FibGU9bm90IHZlcmJvc2UsCiAgICApOgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBDcmVhdGUgdGhlIHRhc2s6CiAgICAgICAgICAgIHRhc2sgPSB0YXNrX2NyZWF0b3IuY3JlYXRlX3Rhc2soYXVkaW9fZmlsZT1hdWRpb19maWxlKQogICAgICAgICAgICAjIFJ1biB0aGUgZmlsZSB0aHJvdWdoIHRoZSBWQUQ6CiAgICAgICAgICAgIHNwZWVjaF90aW1lc3RhbXBzID0gdmFkLmRldGVjdF92b2ljZShhdWRpb19maWxlPWF1ZGlvX2ZpbGUpCiAgICAgICAgICAgICMgQ29tcGxldGUgdGhlIHRhc2s6CiAgICAgICAgICAgIHRhc2suZG9fdGFzayhzcGVlY2hfdGltZXN0YW1wcz1zcGVlY2hfdGltZXN0YW1wcykKICAgICAgICAgICAgIyBDb2xsZWN0IHRoZSByZXN1bHQ6CiAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKChGYWxzZSwgdGFzay5nZXRfcmVzdWx0KCkpKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZXhjZXB0aW9uOgogICAgICAgICAgICAjIENvbGxlY3QgdGhlIGVycm9yOgogICAgICAgICAgICByZXN1bHRzLmFwcGVuZCgoVHJ1ZSwgKGF1ZGlvX2ZpbGUubmFtZSwgc3RyKGV4Y2VwdGlvbikpKSkKCiAgICByZXR1cm4gcmVzdWx0cwoKCmRlZiBfcGFyYWxsZWxfcnVuKAogICAgbl93b3JrZXJzOiBpbnQsCiAgICBhdWRpb19maWxlczogbGlzdFtQYXRoXSwKICAgIGRlc2NyaXB0aW9uOiBzdHIsCiAgICB2YWRfaW5pdF9rd2FyZ3M6IGRpY3QsCiAgICB0YXNrX2NyZWF0b3I6IFRhc2tDcmVhdG9yLAogICAgdmVyYm9zZTogYm9vbCwKKSAtPiBsaXN0W3R1cGxlW2Jvb2wsIHR1cGxlW3N0ciwgbGlzdF1dXToKICAgICIiIgogICAgUnVuIG11bHRpcGxlIFZBRCB3b3JrZXJzIHdpdGggbXVsdGlwcm9jZXNzaW5nIHRvIGNvbXBsZXRlIHRoZSB0YXNrcyB0aGF0IHdpbGwgYmUgY3JlYXRlZCBvbiB0aGUgcHJvdmlkZWQgZmlsZXMgdXNpbmcKICAgIHRoZSBnaXZlbiB0YXNrIGNyZWF0b3IuCgogICAgOnBhcmFtIG5fd29ya2VyczogICAgICAgVGhlIG51bWJlciBvZiB3b3JrZXJzIHRvIHVzZS4KICAgIDpwYXJhbSBhdWRpb19maWxlczogICAgIFRoZSBhdWRpbyBmaWxlcyB0byB1c2UuCiAgICA6cGFyYW0gZGVzY3JpcHRpb246ICAgICBUaGUgZGVzY3JpcHRpb24gdG8gdXNlIGZvciB0aGUgcHJvZ3Jlc3MgYmFyLgogICAgOnBhcmFtIHZhZF9pbml0X2t3YXJnczogVGhlIFZBRCBpbml0aWFsaXphdGlvbiBrZXl3b3JkIGFyZ3VtZW50cy4KICAgIDpwYXJhbSB0YXNrX2NyZWF0b3I6ICAgIFRoZSB0YXNrIGNyZWF0b3IgdG8gdXNlIHRvIGNyZWF0ZSB0aGUgdGFza3MuCiAgICA6cGFyYW0gdmVyYm9zZTogICAgICAgICBWZXJib3NpdHkuCgogICAgOnJldHVybnM6IFRoZSBjb2xsZWN0ZWQgcmVzdWx0cy4KICAgICIiIgogICAgIyBMb2FkIHRoZSBWQUQgKGRvd25sb2FkIG9uY2UsIGFuZCBpdCB3aWxsIGJlIGxvYWRlZCB0aGVuIHBlciBwcm9jZXNzIGxhdGVyIG9uKToKICAgIGlmIHZlcmJvc2U6CiAgICAgICAgX0xPR0dFUi5pbmZvKCJMb2FkaW5nIHRoZSBWQUQgbW9kZWwuIikKICAgIHZhZCA9IFZvaWNlQWN0aXZpdHlEZXRlY3RvcigqKnZhZF9pbml0X2t3YXJncykKICAgIHZhZC5sb2FkKCkKICAgIGlmIHZlcmJvc2U6CiAgICAgICAgX0xPR0dFUi5pbmZvKCJWQUQgbW9kZWwgbG9hZGVkLiIpCgogICAgIyBDaGVjayB0aGUgbnVtYmVyIG9mIHdvcmtlcnM6CiAgICBpZiBuX3dvcmtlcnMgPiBsZW4oYXVkaW9fZmlsZXMpOgogICAgICAgIF9MT0dHRVIud2FybmluZygKICAgICAgICAgICAgZiJUaGUgbnVtYmVyIG9mIHdvcmtlcnMgKHtuX3dvcmtlcnN9KSBpcyBsYXJnZXIgdGhhbiB0aGUgbnVtYmVyIG9mIGF1ZGlvIGZpbGVzICh7bGVuKGF1ZGlvX2ZpbGVzKX0pLiAiCiAgICAgICAgICAgIGYiU2V0dGluZyB0aGUgbnVtYmVyIG9mIHdvcmtlcnMgdG8ge2xlbihhdWRpb19maWxlcyl9LiIKICAgICAgICApCiAgICAgICAgbl93b3JrZXJzID0gbGVuKGF1ZGlvX2ZpbGVzKQoKICAgICMgSW5pdGlhbGl6ZSB0aGUgbXVsdGlwcm9jZXNzaW5nIHF1ZXVlczoKICAgIHRhc2tzX3F1ZXVlID0gUXVldWUoKQogICAgcmVzdWx0c19xdWV1ZSA9IFF1ZXVlKCkKCiAgICAjIEluaXRpYWxpemUgdGhlIG11bHRpcHJvY2Vzc2luZyBwcm9jZXNzZXM6CiAgICB0YXNrX2NvbXBsZXRpb25fcHJvY2Vzc2VzID0gWwogICAgICAgIFByb2Nlc3MoCiAgICAgICAgICAgIHRhcmdldD1fbXVsdGlwcm9jZXNzaW5nX2NvbXBsZXRlX3Rhc2tzLAogICAgICAgICAgICBrd2FyZ3M9ewogICAgICAgICAgICAgICAgInZhZF9pbml0X2t3YXJncyI6IHZhZF9pbml0X2t3YXJncywKICAgICAgICAgICAgICAgICJ0YXNrc19xdWV1ZSI6IHRhc2tzX3F1ZXVlLAogICAgICAgICAgICAgICAgInJlc3VsdHNfcXVldWUiOiByZXN1bHRzX3F1ZXVlLAogICAgICAgICAgICB9LAogICAgICAgICkKICAgICAgICBmb3IgXyBpbiByYW5nZShuX3dvcmtlcnMpCiAgICBdCgogICAgIyBTdGFydCB0aGUgbXVsdGlwcm9jZXNzaW5nIHByb2Nlc3NlczoKICAgIGZvciBwIGluIHRhc2tfY29tcGxldGlvbl9wcm9jZXNzZXM6CiAgICAgICAgcC5zdGFydCgpCgogICAgIyBQdXQgdGhlIHRhc2tzIGluIHRoZSBxdWV1ZToKICAgIGZvciBhdWRpb19maWxlIGluIGF1ZGlvX2ZpbGVzOgogICAgICAgIHRhc2tzX3F1ZXVlLnB1dCh0YXNrX2NyZWF0b3IuY3JlYXRlX3Rhc2soYXVkaW9fZmlsZT1hdWRpb19maWxlKS50b190dXBsZSgpKQoKICAgICMgUHV0IHRoZSBzdG9wIG1hcmtzIGluIHRoZSBxdWV1ZToKICAgIGZvciBfIGluIHJhbmdlKG5fd29ya2Vycyk6CiAgICAgICAgdGFza3NfcXVldWUucHV0KF9NVUxUSVBST0NFU1NJTkdfU1RPUF9NQVJLKQoKICAgICMgQ29sbGVjdCB0aGUgcmVzdWx0czoKICAgIHJlc3VsdHMgPSBbXQogICAgc3RvcF9tYXJrc19jb3VudGVyID0gMAogICAgd2l0aCB0cWRtKAogICAgICAgIGRlc2M9ZGVzY3JpcHRpb24sCiAgICAgICAgdW5pdD0iZmlsZSIsCiAgICAgICAgdG90YWw9bGVuKGF1ZGlvX2ZpbGVzKSwKICAgICAgICBkaXNhYmxlPW5vdCB2ZXJib3NlLAogICAgKSBhcyBwcm9ncmVzc2JhcjoKICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAjIEdldCBhIHJlc3VsdCBmcm9tIHRoZSBxdWV1ZToKICAgICAgICAgICAgcmVzdWx0OiB0dXBsZVtib29sLCB0dXBsZVtzdHIsIGxpc3RdXSA9IHJlc3VsdHNfcXVldWUuZ2V0KCkKICAgICAgICAgICAgaWYgcmVzdWx0ID09IF9NVUxUSVBST0NFU1NJTkdfU1RPUF9NQVJLOgogICAgICAgICAgICAgICAgc3RvcF9tYXJrc19jb3VudGVyICs9IDEKICAgICAgICAgICAgICAgIGlmIHN0b3BfbWFya3NfY291bnRlciA9PSBuX3dvcmtlcnM6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgQ29sbGVjdCB0aGUgcmVzdWx0OgogICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQocmVzdWx0KQogICAgICAgICAgICAgICAgcHJvZ3Jlc3NiYXIudXBkYXRlKDEpCgogICAgIyBXYWl0IGZvciB0aGUgcHJvY2Vzc2VzIHRvIGZpbmlzaDoKICAgIGZvciBwIGluIHRhc2tfY29tcGxldGlvbl9wcm9jZXNzZXM6CiAgICAgICAgcC5qb2luKCkKCiAgICByZXR1cm4gcmVzdWx0cwoKCmRlZiBfcHJvY2Vzc19yZXN1bHRzKAogICAgcmVzdWx0czogbGlzdFt0dXBsZVtib29sLCB0dXBsZVtzdHIsIGxpc3RdXV0sIHZlcmJvc2U6IGJvb2wKKSAtPiB0dXBsZVtkaWN0LCBkaWN0XToKICAgICIiIgogICAgUHJvY2VzcyB0aGUgcmVzdWx0cyBvZiB0aGUgdGFza3MuCgogICAgOnBhcmFtIHJlc3VsdHM6IFRoZSByZXN1bHRzIHRvIHByb2Nlc3MuCiAgICA6cGFyYW0gdmVyYm9zZTogVmVyYm9zaXR5LgoKICAgIDpyZXR1cm5zOiBUaGUgcHJvY2Vzc2VkIHJlc3VsdHMgYXMgYSB0dXBsZSBvZiBzdWNjZXNzZXMgYW5kIGVycm9ycy4KICAgICIiIgogICAgaWYgdmVyYm9zZToKICAgICAgICBfTE9HR0VSLmluZm8oIlN1bW1hcml6aW5nIHRoZSByZXN1bHRzLiIpCiAgICBzdWNjZXNzZXMgPSB7fQogICAgZXJyb3JzID0ge30KICAgIGZvciBpc19lcnJvciwgcmVzdWx0IGluIHJlc3VsdHM6CiAgICAgICAgaWYgaXNfZXJyb3I6CiAgICAgICAgICAgIGVycm9yc1tyZXN1bHRbMF1dID0gcmVzdWx0WzFdCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc3VjY2Vzc2VzW3Jlc3VsdFswXV0gPSByZXN1bHRbMV0KICAgIGlmIHZlcmJvc2U6CiAgICAgICAgX0xPR0dFUi5pbmZvKGYiRG9uZSAoe2xlbihzdWNjZXNzZXMpfS97bGVuKHN1Y2Nlc3NlcykgKyBsZW4oZXJyb3JzKX0pXG4iKQoKICAgIHJldHVybiBzdWNjZXNzZXMsIGVycm9ycwo=
    requirements:
    - torch
    - torchaudio
    - tqdm
    - onnxruntime
    code_origin: ''
    base_image: mlrun/mlrun
  filename: silero_vad.py
  entry_points:
    audio_file:
      outputs:
      - doc: The audio file of the task.
        type: Path
      parameters:
      - name: self
      name: audio_file
      doc: Get the audio file of the task.
      has_kwargs: false
      has_varargs: false
      lineno: 42
    do_task:
      parameters:
      - name: self
      - name: speech_timestamps
        type: list[list[dict[str, int]]]
        doc: The speech timestamps per channel to do the task on as outputted from
          the VAD.
      name: do_task
      doc: Do the task on the given speech timestamps. The task will diarize the VAD
        speech timestamps into speakers.
      has_kwargs: false
      has_varargs: false
      lineno: 93
    get_result:
      outputs:
      - doc: The result of the task.
        type: tuple[str, list]
      parameters:
      - name: self
      name: get_result
      doc: Get the result of the task. A tuple of the audio file name and the result.
      has_kwargs: false
      has_varargs: false
      lineno: 60
    to_tuple:
      outputs:
      - doc: The converted task.
        type: tuple[str, dict]
      parameters:
      - name: self
      name: to_tuple
      doc: Convert the task to a tuple to reconstruct it later (used for multiprocessing
        to pass in queue).
      has_kwargs: false
      has_varargs: false
      lineno: 115
    create_task:
      outputs:
      - doc: The created task.
        type: BaseTask
      parameters:
      - name: self
      - name: audio_file
        type: Path
        doc: The audio file to assign to the task.
      name: create_task
      doc: Create a task with the given audio file.
      has_kwargs: false
      has_varargs: false
      lineno: 145
    from_tuple:
      outputs:
      - doc: The created task.
        type: BaseTask
      parameters:
      - name: cls
      - name: task_tuple
        type: tuple[str, dict]
        doc: The task tuple to create the task from.
      name: from_tuple
      doc: Create a task from a tuple of the audio file name and the task kwargs.
      has_kwargs: false
      has_varargs: false
      lineno: 156
    load:
      parameters:
      - name: self
      - name: force_reload
        type: bool
        doc: Whether to force reload the model even if it was already loaded. Default
          is True.
        default: true
      name: load
      doc: Load the VAD model.
      has_kwargs: false
      has_varargs: false
      lineno: 233
    detect_voice:
      parameters:
      - name: data_path
        doc: The path to the audio files to diarize. Can be a path to a single file,
          a path to a directory or a list of paths to files.
      - name: use_onnx
        type: bool
        doc: Whether to use ONNX for inference. Default is True.
        default: true
      - name: force_onnx_cpu
        type: bool
        doc: Whether to force ONNX to use CPU for inference. Default is True.
        default: true
      - name: threshold
        type: float
        doc: Speech threshold. Silero VAD outputs speech probabilities for each audio
          chunk, probabilities ABOVE this value are considered as SPEECH. It is better
          to tune this parameter for each dataset separately, but "lazy" 0.5 is pretty
          good for most datasets.
        default: 0.5
      - name: sampling_rate
        type: int
        doc: Currently, silero VAD models support 8000 and 16000 sample rates.
        default: 16000
      - name: min_speech_duration_ms
        type: int
        doc: Final speech chunks shorter min_speech_duration_ms are thrown out.
        default: 250
      - name: max_speech_duration_s
        type: float
        doc: Maximum duration of speech chunks in seconds. Chunks longer than `max_speech_duration_s`
          will be split at the timestamp of the last silence that lasts more than
          100ms (if any), to prevent aggressive cutting. Otherwise, they will be split
          aggressively just before max_speech_duration_s.
        default: float('inf')
      - name: min_silence_duration_ms
        type: int
        doc: In the end of each speech chunk wait for min_silence_duration_ms before
          separating it.
        default: 100
      - name: window_size_samples
        type: int
        doc: Audio chunks of window_size_samples size are fed to the silero VAD model.
        default: 512
      - name: speech_pad_ms
        type: int
        doc: Final speech chunks are padded by speech_pad_ms each side.
        default: 30
      - name: return_seconds
        type: bool
        doc: Whether return timestamps in seconds. False means to return timestamps
          in samples (default - False).
        default: false
      - name: per_channel
        type: bool
        doc: Whether to return timestamps per channel (default - False). This will
          run VAD on each channel separately and return a list of timestamps per channel.
        default: false
      - name: use_multiprocessing
        type: int
        doc: The number of workers to use for multiprocessing. If 0, no multiprocessing
          will be used. Default is 0.
        default: 0
      - name: verbose
        type: bool
        doc: Verbosity.
        default: false
      name: detect_voice
      doc: "Perform voice activity detection on given audio files using the silero\
        \ VAD model -\nhttps://github.com/snakers4/silero-vad. The end result is a\
        \ dictionary with the file names as keys and their\nVAD timestamps dictionaries\
        \ as value.\n\nFor example::\n\n    {\n        \"file_1.wav\": [\n       \
        \     {\"start\": 0, \"end\": 16000},\n            {\"start\": 16000, \"end\"\
        : 32000},\n            {\"start\": 32000, \"end\": 48000},\n            ...\n\
        \        ],\n        \"file_2.wav\": [\n            {\"start\": 0, \"end\"\
        : 16000},\n            {\"start\": 16000, \"end\": 32000},\n            {\"\
        start\": 32000, \"end\": 48000},\n            ...\n        ],\n        ...\n\
        \    }"
      has_kwargs: false
      has_varargs: false
      lineno: 392
    diarize:
      parameters:
      - name: data_path
        doc: The path to the audio files to diarize. Can be a path to a single file,
          a path to a directory or a list of paths to files.
      - name: use_onnx
        type: bool
        doc: Whether to use ONNX for inference. Default is True.
        default: true
      - name: force_onnx_cpu
        type: bool
        doc: Whether to force ONNX to use CPU for inference. Default is True.
        default: true
      - name: threshold
        type: float
        doc: Speech threshold. Silero VAD outputs speech probabilities for each audio
          chunk, probabilities ABOVE this value are considered as SPEECH. It is better
          to tune this parameter for each dataset separately, but "lazy" 0.5 is pretty
          good for most datasets.
        default: 0.5
      - name: sampling_rate
        type: int
        doc: Currently, silero VAD models support 8000 and 16000 sample rates.
        default: 16000
      - name: min_speech_duration_ms
        type: int
        doc: Final speech chunks shorter min_speech_duration_ms are thrown out.
        default: 250
      - name: max_speech_duration_s
        type: float
        doc: Maximum duration of speech chunks in seconds. Chunks longer than `max_speech_duration_s`
          will be split at the timestamp of the last silence that lasts more than
          100ms (if any), to prevent aggressive cutting. Otherwise, they will be split
          aggressively just before max_speech_duration_s.
        default: float('inf')
      - name: min_silence_duration_ms
        type: int
        doc: In the end of each speech chunk wait for min_silence_duration_ms before
          separating it.
        default: 100
      - name: window_size_samples
        type: int
        doc: Audio chunks of window_size_samples size are fed to the silero VAD model.
        default: 512
      - name: speech_pad_ms
        type: int
        doc: Final speech chunks are padded by speech_pad_ms each side.
        default: 30
      - name: speaker_labels
        type: list[str]
        doc: The speaker labels to use for the diarization. If not given, the speakers
          will be named "speaker_0", "speaker_1", etc.
        default: null
      - name: use_multiprocessing
        type: int
        doc: The number of workers to use for multiprocessing. If 0, no multiprocessing
          will be used. Default is 0.
        default: 0
      - name: verbose
        type: bool
        doc: Verbosity.
        default: false
      name: diarize
      doc: "Perform speech diarization on given audio files using the silero VAD model\
        \ - https://github.com/snakers4/silero-vad.\nThe speech diarization is performed\
        \ per channel so that each channel in the audio belong to a different speaker.\
        \ The\nend result is a dictionary with the file names as keys and their diarization\
        \ as value. A diarization is a list\nof tuples: (start, end, speaker_label).\n\
        \nFor example::\n\n    {\n        \"file_1.wav\": [\n            (0.0, 1.0,\
        \ \"speaker_0\"),\n            (1.0, 2.0, \"speaker_1\"),\n            (2.0,\
        \ 3.0, \"speaker_0\"),\n            ...\n        ],\n        \"file_2.wav\"\
        : [\n            (0.0, 1.0, \"speaker_0\"),\n            (1.0, 2.0, \"speaker_1\"\
        ),\n            (2.0, 3.0, \"speaker_0\"),\n            ...\n        ],\n\
        \        ...\n    }"
      has_kwargs: false
      has_varargs: false
      lineno: 516
  command: ''
  description: Silero VAD (Voice Activity Detection) functions.
  default_handler: detect_voice
