kind: job
metadata:
  name: transcribe
  tag: ''
  hash: 873da49252d891329d76067df2f628e5810e403c
  project: ''
  labels:
    author: yonatans
  categories:
  - data-preparation
  - machine-learning
spec:
  command: ''
  args: []
  image: mlrun/mlrun
  build:
    functionSourceCode: IyBDb3B5cmlnaHQgMjAxOSBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiMKIyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiMgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKIyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KIyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiMgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiMKaW1wb3J0IG9zCmZyb20gY29sbGVjdGlvbnMgaW1wb3J0IENvdW50ZXIKaW1wb3J0IHBhdGhsaWIKaW1wb3J0IHRlbXBmaWxlCmZyb20gdHlwaW5nIGltcG9ydCBMaXRlcmFsLCBUdXBsZSwgTGlzdAoKaW1wb3J0IGxpYnJvc2EKaW1wb3J0IG1scnVuCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IHdoaXNwZXIKZnJvbSB0cWRtLmF1dG8gaW1wb3J0IHRxZG0KCmZyb20gcHlhbm5vdGUuY29yZSBpbXBvcnQgU2VnbWVudCwgQW5ub3RhdGlvbgppbXBvcnQgcHlkdWIKCgpkZWYgdHJhbnNjcmliZSgKICAgIGNvbnRleHQ6IG1scnVuLk1MQ2xpZW50Q3R4LAogICAgaW5wdXRfcGF0aDogc3RyLAogICAgbW9kZWxfbmFtZTogc3RyID0gImJhc2UiLAogICAgZGV2aWNlOiBMaXRlcmFsWyJjdWRhIiwgImNwdSJdID0gTm9uZSwKICAgIGRlY29kaW5nX29wdGlvbnM6IGRpY3QgPSBOb25lLAogICAgb3V0cHV0X2RpcmVjdG9yeTogc3RyID0gTm9uZSwKICAgIHVybF9wYXRoOiBzdHIgPSBOb25lLCAgIyBwYXRoIHRvIHRoZSBkYXRhZnJhbWUgdGhhdCBjb250YWlucyB0aGUgcmVzdWx0IG9mIHRoZSBzcGVha2VyIGRpYXJpemF0aW9uCikgLT4gVHVwbGVbcGF0aGxpYi5QYXRoLCBwZC5EYXRhRnJhbWUsIGRpY3QsIGxpc3RdOgogICAgIiIiCiAgICBUcmFuc2NyaWJlIGF1ZGlvIGZpbGVzIGludG8gdGV4dCBmaWxlcyBhbmQgY29sbGVjdCBhZGRpdGlvbmFsIGRhdGEuCiAgICBUaGUgZW5kIHJlc3VsdCBpcyBhIGRpcmVjdG9yeSBvZiB0cmFuc2NyaWJlZCB0ZXh0IGZpbGVzCiAgICAgYW5kIGEgZGF0YWZyYW1lIGNvbnRhaW5pbmcgdGhlIGZvbGxvd2luZyBjb2x1bW5zOgoKICAgICogYXVkaW9fZmlsZSAtIFRoZSBvcmlnaW5hbCBhdWRpbyBmaWxlIG5hbWUuCiAgICAqIHRyYW5zY3JpcHRpb25fZmlsZSAtIFRoZSB0cmFuc2NyaWJlZCB0ZXh0IGZpbGUgbmFtZSBpbiB0aGUgb3V0cHV0IGRpcmVjdG9yeS4KICAgICogbGFuZ3VhZ2UgLSBUaGUgZGV0ZWN0ZWQgbGFuZ3VhZ2UgaW4gdGhlIGF1ZGlvIGZpbGUuCiAgICAqIGxlbmd0aCAtIFRoZSBsZW5ndGggb2YgdGhlIGF1ZGlvIGZpbGUuCiAgICAqIHJhdGVfb2Zfc3BlZWNoIC0gVGhlIG51bWJlciBvZiB3b3JkcyBkaXZpZGVkIGJ5IHRoZSBhdWRpbyBmaWxlIGxlbmd0aC4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgICAgICBNTFJ1biBjb250ZXh0LgogICAgOnBhcmFtIGlucHV0X3BhdGg6ICAgICAgICAgICAgQSBkaXJlY3Rvcnkgb2YgdGhlIGF1ZGlvIGZpbGVzIG9yIGEgc2luZ2xlIGZpbGUgdG8gdHJhbnNjcmliZS4KICAgIDpwYXJhbSBvdXRwdXRfZGlyZWN0b3J5OiAgICAgIFBhdGggdG8gYSBkaXJlY3RvcnkgdG8gc2F2ZSBhbGwgdHJhbnNjcmliZWQgYXVkaW8gZmlsZXMuCiAgICA6cGFyYW0gbW9kZWxfbmFtZTogICAgICAgICAgICBPbmUgb2YgdGhlIG9mZmljaWFsIG1vZGVsIG5hbWVzIGxpc3RlZCBieSBgd2hpc3Blci5hdmFpbGFibGVfbW9kZWxzKClgLgogICAgOnBhcmFtIGRldmljZTogICAgICAgICAgICAgICAgRGV2aWNlIHRvIGxvYWQgdGhlIG1vZGVsLiBDYW4gYmUgb25lIG9mIHsiY3VkYSIsICJjcHUifS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgd2lsbCBwcmVmZXIgImN1ZGEiIGlmIGF2YWlsYWJsZS4KICAgIDpwYXJhbSBkZWNvZGluZ19vcHRpb25zOiAgICAgIEEgZGljdGlvbmFyeSBvZiBvcHRpb25zIHRvIGNvbnN0cnVjdCBhIGB3aGlzcGVyLkRlY29kaW5nT3B0aW9uc2AuCiAgICA6cGFyYW0gdXJsX3BhdGg6ICAgICAgICAgICAgICBQYXRoIHRvIHRoZSBkYXRhZnJhbWUgdGhhdCBjb250YWlucyB0aGUgcmVzdWx0IG9mIHRoZSBzcGVha2VyIGRpYXJpemF0aW9uLgoKCiAgICA6cmV0dXJuczogQSB0dXBsZSBvZjoKCiAgICAgICAgICAgICAgKiBQYXRoIHRvIHRoZSBvdXRwdXQgZGlyZWN0b3J5LgogICAgICAgICAgICAgICogQSBkYXRhZnJhbWUgZGF0YXNldCBvZiB0aGUgdHJhbnNjcmliZWQgZmlsZSBuYW1lcy4KICAgICAgICAgICAgICAqIEEgZGljdGlvbmFyeSBvZiBlcnJvcmVkIGZpbGVzIHRoYXQgd2VyZSBub3QgdHJhbnNjcmliZWQuCiAgICAiIiIKICAgICMgU2V0IG91dHB1dCBkaXJlY3Rvcnk6CiAgICBpZiBvdXRwdXRfZGlyZWN0b3J5IGlzIE5vbmU6CiAgICAgICAgb3V0cHV0X2RpcmVjdG9yeSA9IHRlbXBmaWxlLm1rZHRlbXAoKQoKICAgICMgTG9hZCB0aGUgbW9kZWw6CiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYiTG9hZGluZyB3aGlzcGVyIG1vZGVsOiAne21vZGVsX25hbWV9JyIpCiAgICBtb2RlbCA9IHdoaXNwZXIubG9hZF9tb2RlbChtb2RlbF9uYW1lLCBkZXZpY2U9ZGV2aWNlKQogICAgY29udGV4dC5sb2dnZXIuaW5mbygiTW9kZWwgbG9hZGVkLiIpCgogICAgIyBQcmVwYXJlIHRoZSBkYXRhZnJhbWUgYW5kIGVycm9ycyB0byBiZSByZXR1cm5lZDoKICAgIGRmID0gcGQuRGF0YUZyYW1lKAogICAgICAgIGNvbHVtbnM9WwogICAgICAgICAgICAiYXVkaW9fZmlsZSIsCiAgICAgICAgICAgICJ0cmFuc2NyaXB0aW9uX2ZpbGUiLAogICAgICAgICAgICAibGFuZ3VhZ2UiLAogICAgICAgICAgICAibGVuZ3RoIiwKICAgICAgICAgICAgInJhdGVfb2Zfc3BlZWNoIiwKICAgICAgICBdCiAgICApCgogICAgZXJyb3JzID0ge30KCiAgICAjIENyZWF0ZSB0aGUgb3V0cHV0IGRpcmVjdG9yeToKICAgIG91dHB1dF9kaXJlY3RvcnkgPSBwYXRobGliLlBhdGgob3V0cHV0X2RpcmVjdG9yeSkKICAgIGlmIG5vdCBvdXRwdXRfZGlyZWN0b3J5LmV4aXN0cygpOgogICAgICAgIG91dHB1dF9kaXJlY3RvcnkubWtkaXIoKQoKICAgICMgR28gb3ZlciB0aGUgYXVkaW8gZmlsZXMgYW5kIHRyYW5zY3JpYmU6CiAgICBhdWRpb19maWxlc19wYXRoID0gcGF0aGxpYi5QYXRoKGlucHV0X3BhdGgpLmFic29sdXRlKCkKICAgIGlzX2RpciA9IFRydWUKICAgIGlmIGF1ZGlvX2ZpbGVzX3BhdGguaXNfZGlyKCk6CiAgICAgICAgYXVkaW9fZmlsZXMgPSBsaXN0KGF1ZGlvX2ZpbGVzX3BhdGgucmdsb2IoIiouKiIpKQogICAgZWxpZiBhdWRpb19maWxlc19wYXRoLmlzX2ZpbGUoKToKICAgICAgICBpc19kaXIgPSBGYWxzZQogICAgICAgIGF1ZGlvX2ZpbGVzID0gW2F1ZGlvX2ZpbGVzX3BhdGhdCiAgICBlbHNlOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCiAgICAgICAgICAgIGYiYXVkaW9fZmlsZXMge3N0cihhdWRpb19maWxlc19wYXRoKX0gbXVzdCBiZSBlaXRoZXIgYSBkaXJlY3RvcnkgcGF0aCBvciBhIGZpbGUgcGF0aCIKICAgICAgICApCiAgICAjIGNoZWNrIGlmIHRoZSB1c2VyIHdhbnRzIHRvIGFkZCB0aGUgc3BlYWtlciBkaWFyaXphdGlvbiByZXN1bHQgdG8gdGhlIHRyYW5zY3JpcHRpb24KICAgIGlmIHVybF9wYXRoIGlzIG5vdCBOb25lOgogICAgICAgIHRyeToKICAgICAgICAgICAgZGlhcml6YXRpb25fcmVzID0gbWxydW4uZ2V0X2RhdGFpdGVtKHVybF9wYXRoKS5hc19kZigpCiAgICAgICAgICAgIGRpYXJpemF0aW9uX3JlcyA9IGRpYXJpemF0aW9uX3Jlcy5zZXRfaW5kZXgoImF1ZGlvX2ZpbGUiKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigKICAgICAgICAgICAgICAgIGYiQ291bGQgbm90IGxvYWQgc3BlYWtlciBkaWFyaXphdGlvbiByZXN1bHQgZnJvbSB7dXJsX3BhdGh9LCB7ZX0iCiAgICAgICAgICAgICkKCiAgICBmb3IgaSwgYXVkaW9fZmlsZSBpbiBlbnVtZXJhdGUodHFkbShhdWRpb19maWxlcywgZGVzYz0iVHJhbnNjcmliaW5nIiwgdW5pdD0iZmlsZSIpKToKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgR2V0IHRoZSByZXN1bHRzIG9mIHNwZWFrZXIgZGlhcml6YXRpb24KICAgICAgICAgICAgaWYgdXJsX3BhdGggaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBkaXJlY3RvcnkgPSBwYXRobGliLlBhdGgodXJsX3BhdGgpLnBhcmVudAogICAgICAgICAgICAgICAgXywgXywgY29udmVydGVkX3dhdiwgc3BlYWtlcl9zZWdtZW50cyA9IGRpYXJpemF0aW9uX3Jlcy5sb2NbCiAgICAgICAgICAgICAgICAgICAgc3RyKGF1ZGlvX2ZpbGUpCiAgICAgICAgICAgICAgICBdLnRvX2xpc3QoKQogICAgICAgICAgICAgICAgcmVzID0gbWxydW4uZ2V0X2RhdGFpdGVtKAogICAgICAgICAgICAgICAgICAgIHN0cihkaXJlY3RvcnkgLyBmIntzcGVha2VyX3NlZ21lbnRzfS5jc3YiKQogICAgICAgICAgICAgICAgKS5hc19kZigpCiAgICAgICAgICAgICAgICBhbm5vdGF0aW9uID0gQW5ub3RhdGlvbigpCiAgICAgICAgICAgICAgICBmb3IgaSwgcm93IGluIHJlcy5pdGVycm93cygpOgogICAgICAgICAgICAgICAgICAgIGFubm90YXRpb25bU2VnbWVudChyb3dbInN0YXJ0Il0sIHJvd1siZW5kIl0pXSA9IHJvd1sic3BlYWtlciJdCgogICAgICAgICAgICAgICAgc2VnbWVudHMgPSBfc3BsaXRfYXVkaW8oY29udmVydGVkX3dhdiwgYW5ub3RhdGlvbikKCiAgICAgICAgICAgICAgICB0cmFuc2NyaXB0aW9uLCBsZW5ndGgsIHJhdGVfb2Zfc3BlZWNoLCBsYW5ndWFnZSA9IF9zaW5nbGVfdHJhbnNjcmliZSgKICAgICAgICAgICAgICAgICAgICBhdWRpb19maWxlPWNvbnZlcnRlZF93YXYsCiAgICAgICAgICAgICAgICAgICAgc2VnbWVudHM9c2VnbWVudHMsCiAgICAgICAgICAgICAgICAgICAgbW9kZWw9bW9kZWwsCiAgICAgICAgICAgICAgICAgICAgZGVjb2Rpbmdfb3B0aW9ucz1kZWNvZGluZ19vcHRpb25zLAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICMgY2xlYW4gdXAgdGhlIHRlbXBvcmFyeSBmaWxlcwogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGNvbnZlcnRlZF93YXYpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICB0cmFuc2NyaXB0aW9uLCBsZW5ndGgsIHJhdGVfb2Zfc3BlZWNoLCBsYW5ndWFnZSA9IF9zaW5nbGVfdHJhbnNjcmliZSgKICAgICAgICAgICAgICAgICAgICBhdWRpb19maWxlPWF1ZGlvX2ZpbGUsCiAgICAgICAgICAgICAgICAgICAgbW9kZWw9bW9kZWwsCiAgICAgICAgICAgICAgICAgICAgZGVjb2Rpbmdfb3B0aW9ucz1kZWNvZGluZ19vcHRpb25zLAogICAgICAgICAgICAgICAgKQoKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGV4Y2VwdGlvbjoKICAgICAgICAgICAgIyBDb2xsZWN0IHRoZSBleGNlcHRpb246CiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLndhcm4oZiJFcnJvciBpbiBmaWxlOiAne2F1ZGlvX2ZpbGV9JyIpCiAgICAgICAgICAgIGVycm9yc1tzdHIoYXVkaW9fZmlsZSldID0gc3RyKGV4Y2VwdGlvbikKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIFdyaXRlIHRoZSB0cmFuc2NyaXB0aW9uIHRvIGZpbGU6CiAgICAgICAgICAgIHNhdmVkX2ZpbGVuYW1lID0gKAogICAgICAgICAgICAgICAgc3RyKGF1ZGlvX2ZpbGUucmVsYXRpdmVfdG8oYXVkaW9fZmlsZXNfcGF0aCkpLnNwbGl0KCIuIilbMF0KICAgICAgICAgICAgICAgIGlmIGlzX2RpcgogICAgICAgICAgICAgICAgZWxzZSBhdWRpb19maWxlLnN0ZW0KICAgICAgICAgICAgKQogICAgICAgICAgICB0cmFuc2NyaXB0aW9uX2ZpbGUgPSBvdXRwdXRfZGlyZWN0b3J5IC8gZiJ7c2F2ZWRfZmlsZW5hbWV9LnR4dCIKICAgICAgICAgICAgdHJhbnNjcmlwdGlvbl9maWxlLnBhcmVudC5ta2RpcihleGlzdF9vaz1UcnVlLCBwYXJlbnRzPVRydWUpCiAgICAgICAgICAgIHdpdGggb3Blbih0cmFuc2NyaXB0aW9uX2ZpbGUsICJ3IikgYXMgZnA6CiAgICAgICAgICAgICAgICBmcC53cml0ZSh0cmFuc2NyaXB0aW9uKQoKICAgICAgICAgICAgIyBOb3RlIGluIHRoZSBkYXRhZnJhbWU6CiAgICAgICAgICAgIGRmLmxvY1tpIC0gbGVuKGVycm9ycyldID0gWwogICAgICAgICAgICAgICAgc3RyKGF1ZGlvX2ZpbGUucmVsYXRpdmVfdG8oYXVkaW9fZmlsZXNfcGF0aCkpLAogICAgICAgICAgICAgICAgc3RyKHRyYW5zY3JpcHRpb25fZmlsZS5yZWxhdGl2ZV90byhvdXRwdXRfZGlyZWN0b3J5KSksCiAgICAgICAgICAgICAgICBsYW5ndWFnZSwKICAgICAgICAgICAgICAgIGxlbmd0aCwKICAgICAgICAgICAgICAgIHJhdGVfb2Zfc3BlZWNoLAogICAgICAgICAgICBdCgogICAgIyBSZXR1cm4gdGhlIGRhdGFmcmFtZToKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJEb25lOlxue2RmLmhlYWQoKX0iKQoKICAgIHJldHVybiBvdXRwdXRfZGlyZWN0b3J5LCBkZiwgZXJyb3JzCgoKZGVmIF9zaW5nbGVfdHJhbnNjcmliZSgKICAgIGF1ZGlvX2ZpbGU6IHBhdGhsaWIuUGF0aCwKICAgIG1vZGVsOiB3aGlzcGVyLldoaXNwZXIsCiAgICBkZWNvZGluZ19vcHRpb25zOiBkaWN0ID0gTm9uZSwKICAgIHNlZ21lbnRzOiBUdXBsZVtpbnQsIHN0ciwgZmxvYXQsIGZsb2F0LCBzdHJdID0gTm9uZSwKKSAtPiBUdXBsZVtzdHIsIGludCwgZmxvYXQsIHN0cl06CiAgICAiIiIKICAgIFRyYW5zY3JpYmUgYSBzaW5nbGUgYXVkaW8gZmlsZSB3aXRoIHRoZSBzcGVha2VyIHNlZ21lbnRhdGlvbgogICAgYW5kIHJldHVybiB0aGUgdHJhbnNjcmlwdGlvbiwgbGVuZ3RoLCByYXRlIG9mIHNwZWVjaCBhbmQgbGFuZ3VhZ2UuCgogICAgOnBhcmFtIGF1ZGlvX2ZpbGU6ICAgICAgIFBhdGggdG8gdGhlIGF1ZGlvIGZpbGUuCiAgICA6cGFyYW0gc2VnbWVudHM6ICAgICAgICAgQSBsaXN0IG9mIHR1cGxlcyBvZiAoaWR4LCBsYWJlbCwgc3RhcnRfdGltZSwgZW5kX3RpbWUsIGZpbGUpLgogICAgOnBhcmFtIG1vZGVsOiAgICAgICAgICAgIEEgd2hpc3BlciBtb2RlbC4KICAgIDpwYXJhbSBkZWNvZGluZ19vcHRpb25zOiBBIGRpY3Rpb25hcnkgb2Ygb3B0aW9ucyB0byBjb25zdHJ1Y3QgYSBgd2hpc3Blci5EZWNvZGluZ09wdGlvbnNgLgoKICAgIDpyZXR1cm5zOiBBIHR1cGxlIG9mOgogICAgICAgICAgICAqIFRoZSB0cmFuc2NyaXB0aW9uLgogICAgICAgICAgICAqIFRoZSBsZW5ndGggb2YgdGhlIGF1ZGlvIGZpbGUuCiAgICAgICAgICAgICogVGhlIHJhdGUgb2Ygc3BlZWNoLgogICAgICAgICAgICAqIFRoZSBkZXRlY3RlZCBsYW5ndWFnZS4KICAgICIiIgogICAgZGVjb2Rpbmdfb3B0aW9ucyA9IGRlY29kaW5nX29wdGlvbnMgb3IgZGljdCgpCgogICAgIyBpZiBkb24ndCBoYXZlIHRoZSBzcGVha2VyIHNlZ21lbnRhdGlvbiwgdHJhbnNjcmliZSB0aGUgd2hvbGUgYXVkaW8gZmlsZQogICAgaWYgbm90IHNlZ21lbnRzOgogICAgICAgICMgTG9hZCB0aGUgYXVkaW86CiAgICAgICAgYXVkaW8gPSB3aGlzcGVyLmF1ZGlvLmxvYWRfYXVkaW8oZmlsZT1zdHIoYXVkaW9fZmlsZSkpCiAgICAgICAgIyBHZXQgYXVkaW8gbGVuZ3RoOgogICAgICAgIGxlbmd0aCA9IGxpYnJvc2EuZ2V0X2R1cmF0aW9uKHBhdGg9YXVkaW9fZmlsZSkKICAgICAgICAjIFRyYW5zY3JpYmU6CiAgICAgICAgcmVzdWx0ID0gbW9kZWwudHJhbnNjcmliZShhdWRpbz1hdWRpbywgKipkZWNvZGluZ19vcHRpb25zKQogICAgICAgICMgVW5wYWNrIHRoZSBtb2RlbCdzIHJlc3VsdDoKICAgICAgICB0cmFuc2NyaXB0aW9uID0gcmVzdWx0WyJ0ZXh0Il0KICAgICAgICBsYW5ndWFnZSA9IHJlc3VsdC5nZXQoImxhbmd1YWdlIikgb3IgZGVjb2Rpbmdfb3B0aW9ucy5nZXQoImxhbmd1YWdlIiwgIiIpCgogICAgICAgICMgQ2FsY3VsYXRlIHJhdGUgb2Ygc3BlZWNoIChudW1iZXIgb2Ygd29yZHMgLyBhdWRpbyBsZW5ndGgpOgogICAgICAgIHJhdGVfb2Zfc3BlZWNoID0gbGVuKHRyYW5zY3JpcHRpb24uc3BsaXQoKSkgLyBsZW5ndGgKICAgICAgICByZXR1cm4gdHJhbnNjcmlwdGlvbiwgbGVuZ3RoLCByYXRlX29mX3NwZWVjaCwgbGFuZ3VhZ2UKCiAgICAjIGlmIGhhdmUgdGhlIHNwZWFrZXIgc2VnbWVudGF0aW9uLCB0cmFuc2NyaWJlIGVhY2ggc2VnbWVudCBzZXBhcmF0ZWx5CiAgICByZXMgPSBbXQogICAgbGFuZ3MgPSBbXQogICAgZm9yIGlkeCwgbGFiZWwsIHN0YXJ0X3RpbWUsIGVuZF90aW1lLCBmaWxlIGluIHNvcnRlZChzZWdtZW50cywga2V5PWxhbWJkYSB4OiB4WzBdKToKICAgICAgICAjIExvYWQgdGhlIGF1ZGlvOgogICAgICAgIGF1ZGlvID0gd2hpc3Blci5hdWRpby5sb2FkX2F1ZGlvKGZpbGU9c3RyKGZpbGUpKQogICAgICAgICMgVGhlIGluaXRhaWxfcHJvbXB0IGlzIHRoZSBhbGwgdGhlIHByZXZpb3VzIHRyYW5zY3JpcHRpb25zLgogICAgICAgIHJlc3VsdCA9IG1vZGVsLnRyYW5zY3JpYmUoCiAgICAgICAgICAgIGF1ZGlvPWF1ZGlvLCAqKmRlY29kaW5nX29wdGlvbnMsIGluaXRpYWxfcHJvbXB0PSJcbiIuam9pbihyZXNbOiBpZHggKyAxXSkKICAgICAgICApCiAgICAgICAgIyBVbnBhY2sgdGhlIG1vZGVsJ3MgcmVzdWx0OgogICAgICAgIHRyYW5zY3JpcHRpb24gPSBmIntsYWJlbH0gIHtzdGFydF90aW1lfSAge2VuZF90aW1lfTogXG4ge3Jlc3VsdFsndGV4dCddfSIKICAgICAgICBsYW5ncy5hcHBlbmQocmVzdWx0LmdldCgibGFuZ3VhZ2UiKSBvciBkZWNvZGluZ19vcHRpb25zLmdldCgibGFuZ3VhZ2UiLCAiIikpCiAgICAgICAgcmVzLmFwcGVuZCh0cmFuc2NyaXB0aW9uKQogICAgICAgICMgY2xlYW4gdXAgdGhlIHRlbXBvcmFyeSBmaWxlcwogICAgICAgIG9zLnJlbW92ZShmaWxlKQoKICAgICMgR2V0IGF1ZGlvIGxlbmd0aDoKICAgIGxlbmd0aCA9IGxpYnJvc2EuZ2V0X2R1cmF0aW9uKHBhdGg9YXVkaW9fZmlsZSkKICAgIHRyYW5zY3JpcHRpb24gPSAiXG4iLmpvaW4ocmVzKQogICAgIyBDYWxjdWxhdGUgcmF0ZSBvZiBzcGVlY2ggKG51bWJlciBvZiB3b3JkcyAvIGF1ZGlvIGxlbmd0aCk6CiAgICByYXRlX29mX3NwZWVjaCA9IGxlbih0cmFuc2NyaXB0aW9uLnNwbGl0KCkpIC8gbGVuZ3RoCiAgICAjIEdldCB0aGUgbGFuZ3VhZ2U6CiAgICBsYW5ndWFnZSA9IENvdW50ZXIobGFuZ3MpLm1vc3RfY29tbW9uKDEpWzBdWzBdCgogICAgcmV0dXJuIHRyYW5zY3JpcHRpb24sIGxlbmd0aCwgcmF0ZV9vZl9zcGVlY2gsIGxhbmd1YWdlCgoKZGVmIF9zcGxpdF9hdWRpbygKICAgIGF1ZGlvX2ZpbGVfcGF0aDogc3RyLCBhbm5vdGF0aW9uOiBBbm5vdGF0aW9uCikgLT4gTGlzdFtUdXBsZVtpbnQsIHN0ciwgZmxvYXQsIGZsb2F0LCBzdHJdXToKICAgICIiIgogICAgU3BsaXQgYW4gYXVkaW8gZmlsZSBiYXNlZCBvbiBhIHB5YW5ub3RlLmNvcmUuQW5ub3RhdGlvbiBvYmplY3QuCgogICAgOnBhcmFtIGF1ZGlvX2ZpbGVfcGF0aDogcGF0aCB0byB0aGUgYXVkaW8gZmlsZSB0byBzcGxpdC4KICAgIDpwYXJhbSBhbm5vdGF0aW9uOiBweWFubm90ZS5jb3JlLkFubm90YXRpb24gb2JqZWN0IHdpdGggZGlhcml6YXRpb24gcmVzdWx0cy4KCiAgICA6cmV0dXJuczogQSBsaXN0IG9mIHR1cGxlcyB3aXRoIHRoZSBmb2xsb3dpbmcgaXRlbXM6CiAgICAgICAgICAgICAgICAqIFRoZSBpbmRleCBvZiB0aGUgc2VnbWVudC4KICAgICAgICAgICAgICAgICogVGhlIGxhYmVsIG9mIHRoZSBzcGVha2VyLgogICAgICAgICAgICAgICAgKiBUaGUgc3RhcnQgdGltZSBvZiB0aGUgc2VnbWVudC4KICAgICAgICAgICAgICAgICogVGhlIGVuZCB0aW1lIG9mIHRoZSBzZWdtZW50LgogICAgICAgICAgICAgICAgKiBUaGUgcGF0aCB0byB0aGUgdGVtcG9yYXJ5IGF1ZGlvIGZpbGUuCiAgICAiIiIKICAgIGF1ZGlvID0gcHlkdWIuQXVkaW9TZWdtZW50LmZyb21fd2F2KGF1ZGlvX2ZpbGVfcGF0aCkKICAgIHNlZ21lbnRzID0gW10KICAgIGlkeCA9IDAKICAgIGZvciBzZWdtZW50LCBfLCBsYWJlbCBpbiBhbm5vdGF0aW9uLml0ZXJ0cmFja3MoeWllbGRfbGFiZWw9VHJ1ZSk6CiAgICAgICAgIyBDb252ZXJ0IHRvIG1pbGxpc2Vjb25kczoKICAgICAgICBzdGFydF90aW1lID0gc2VnbWVudC5zdGFydCAqIDEwMDAKICAgICAgICBlbmRfdGltZSA9IHNlZ21lbnQuZW5kICogMTAwMAoKICAgICAgICAjIEV4dHJhY3QgdGhlIHNlZ21lbnQ6CiAgICAgICAgc2VnbWVudF9hdWRpbyA9IGF1ZGlvW3N0YXJ0X3RpbWU6ZW5kX3RpbWVdCiAgICAgICAgIyBTYXZlIHRoZSBzZWdtZW50IHRvIGEgdGVtcG9yYXJ5IGZpbGU6CiAgICAgICAgd2l0aCB0ZW1wZmlsZS5OYW1lZFRlbXBvcmFyeUZpbGUoCiAgICAgICAgICAgIHN1ZmZpeD0iLndhdiIsIHByZWZpeD0idG1wXyIsIGRlbGV0ZT1GYWxzZQogICAgICAgICkgYXMgdGVtcF9maWxlOgogICAgICAgICAgICBzZWdtZW50X2F1ZGlvLmV4cG9ydChmInt0ZW1wX2ZpbGUubmFtZX0iLCBmb3JtYXQ9IndhdiIpCiAgICAgICAgc2VnbWVudHMuYXBwZW5kKChpZHgsIGxhYmVsLCBzdGFydF90aW1lLCBlbmRfdGltZSwgdGVtcF9maWxlLm5hbWUpKQogICAgICAgIGlkeCArPSAxCgogICAgcmV0dXJuIHNlZ21lbnRzCg==
    commands:
    - python -m pip install openai-whisper tqdm ffmpeg ffprobe librosa pyannote.core
      torch torchaudio pydub
    code_origin: git@github.com-personal:pengwei715/functions.git#30a8ac8fa813fd1973784599b6dcff167dd3153f:/Users/Peng_Wei/work/mlrun_related/functions/transcribe/transcribe.py
    origin_filename: /Users/Peng_Wei/work/mlrun_related/functions/transcribe/transcribe.py
  entry_points:
    transcribe:
      name: transcribe
      doc: "Transcribe audio files into text files and collect additional data.\n\
        The end result is a directory of transcribed text files\n and a dataframe\
        \ containing the following columns:\n\n* audio_file - The original audio file\
        \ name.\n* transcription_file - The transcribed text file name in the output\
        \ directory.\n* language - The detected language in the audio file.\n* length\
        \ - The length of the audio file.\n* rate_of_speech - The number of words\
        \ divided by the audio file length."
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context.
        default: ''
      - name: input_path
        type: str
        doc: A directory of the audio files or a single file to transcribe.
        default: ''
      - name: model_name
        type: str
        doc: One of the official model names listed by `whisper.available_models()`.
        default: base
      - name: device
        type: Literal[, ]
        doc: Device to load the model. Can be one of {"cuda", "cpu"}. Default will
          prefer "cuda" if available.
        default: null
      - name: decoding_options
        type: dict
        doc: A dictionary of options to construct a `whisper.DecodingOptions`.
        default: null
      - name: output_directory
        type: str
        doc: Path to a directory to save all transcribed audio files.
        default: null
      - name: url_path
        type: str
        doc: Path to the dataframe that contains the result of the speaker diarization.
        default: null
      outputs:
      - default: ''
        doc: 'A tuple of:'
      lineno: 31
  description: Transcribe audio files into text files
  default_handler: transcribe
  disable_auto_mount: false
  env: []
  priority_class_name: ''
  preemption_mode: prevent
  affinity: null
  tolerations: null
  security_context: {}
verbose: false
