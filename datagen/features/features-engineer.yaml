kind: job
metadata:
  name: features-engineer
  tag: ''
  hash: be29081b9a995b0b6e6bcd3f5d2bc53f8168670a
  project: ''
spec:
  command: ''
  args: []
  volumes: []
  volume_mounts: []
  env: []
  description: ''
  build:
    functionSourceCode: IyBDb3B5cmlnaHQgMjAxOSBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAojCiMgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQojIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiMgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiMgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAojIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgppbXBvcnQgb3MKZnJvbSBjbG91ZHBpY2tsZSBpbXBvcnQgZHVtcCwgbG9hZAoKaW1wb3J0IG51bXB5IGFzIG5wCmZyb20gc2tsZWFybi5iYXNlIGltcG9ydCBCYXNlRXN0aW1hdG9yLCBUcmFuc2Zvcm1lck1peGluCgpmcm9tIHR5cGluZyBpbXBvcnQgT3B0aW9uYWwsIFVuaW9uCgpyb20gbWxydW4uZXhlY3V0aW9uIGltcG9ydCBNTENsaWVudEN0eApmcm9tIG1scnVuLmRhdGFzdG9yZSBpbXBvcnQgRGF0YUl0ZW0KZnJvbSBtbHJ1bi5hcnRpZmFjdHMgaW1wb3J0IFRhYmxlQXJ0aWZhY3QsIFBsb3RBcnRpZmFjdAoKaW1wb3J0IHdhcm5pbmdzCndhcm5pbmdzLnNpbXBsZWZpbHRlcihhY3Rpb249Imlnbm9yZSIsIGNhdGVnb3J5PUZ1dHVyZVdhcm5pbmcpCgpjbGFzcyBGZWF0dXJlc0VuZ2luZWVyKEJhc2VFc3RpbWF0b3IsIFRyYW5zZm9ybWVyTWl4aW4pOgogICAgIiIiRW5naW5lZXIgZmVhdHVyZXMgZnJvbSByYXcgaW5wdXQuCiAgICBBIHN0YW5kYXJkIHRyYW5zZm9ybWVyIG1peGluIHRoYXQgY2FuIGJlIGluc2VydGVkIGludG8gYSBzY2lraXQgbGVhcm4gUGlwZWxpbmUuCiAgICAKICAgIFRvIHVzZSwgCiAgICA+Pj4gZmZnID0gRmVhdHVyZXNFbmdpbmVlcigpCiAgICA+Pj4gZmZnLmZpdChYKQogICAgPj4+IHhfdHJhbnNmb3JtZWQgPSBmZmcudHJhbnNmb3JtKFgpCiAgICBvcgogICAgPj4+IGZmZyA9IEZlYXR1cmVzRW5naW5lZXIoKQogICAgPj4+IHhfdHJhbnNmb3JtZWQgPSBmZmcuZml0X3RyYW5zZm9ybShYKQogICAgCiAgICBJbiBhIHBpcGVsaW5lOgogICAgPj4+IGZyb20gc2tsZWFybi5waXBlbGluZSBpbXBvcnQgUGlwZWxpbmUKICAgID4+PiBmcm9tIHNrbGVhcm4ucHJlcHJvY2Vzc2luZyBpbXBvcnQgU3RhbmRhcmRTY2FsZXIKICAgID4+PiB0cmFuc2Zvcm1lcnMgPSBbKCdmZWF0dXJlX2dlbicsIEZlYXR1cmVzRW5naW5lZXJGZWF0dXJlKCkpLCAKICAgICAgICAgICAgICAgICAgICAgICAgKCdzY2FsZXInLCBTdGFuZGFyZFNjYWxlcigpKV0KICAgID4+PiB0cmFuc2Zvcm1lcl9waXBlID0gUGlwZWxpbmUodHJhbnNmb3JtZXJzKQogICAgIiIiCiAgICBkZWYgZml0KHNlbGYsIFgsIHk9Tm9uZSk6CiAgICAgICAgIiIiZml0IGlzIHVudXNlZCBoZXJlLCBidXQgQU5ZIG1vZGVsIGNhbiBiZSBpbnNlcnRlZCBoZXJlCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIHNlbGYKCiAgICBkZWYgdHJhbnNmb3JtKHNlbGYsIFgsIHk9Tm9uZSk6CiAgICAgICAgIiIiVHJhbnNmb3JtIHJhdyBpbnB1dCBkYXRhIGFzIGEgcHJlcHJvY2Vzc2luZyBzdGVwLCAoaWYgZml0CiAgICAgICAgZXN0aW1hdGVzIGEgbW9kZWwsIHRoZW4gcnVuIHRyYW5zZm9ybSBvbmx5IGFmdGVyIGNhbGxpbmcgZml0KS4KICAgICAgICAKICAgICAgICA6cGFyYW0gWDogUmF3IGlucHV0IGZlYXR1cmVzCiAgICAgICAgCiAgICAgICAgUmV0dXJucyBhIERhdGFGcmFtZSBvZiBmZWF0dXJlcy4KICAgICAgICAiIiIKICAgICAgICB4ID0gWC5jb3B5KCkKCiAgICAgICAgIyBkbyBzb21lIGNvb2wgZmVhdHVyZSBlbmdpbmVlcmluZzpoZXJlIHdlIHJlcGxhY2UgYnkgYSBOKDIsMikgc2VyaWVzCiAgICAgICAgbSA9IDIuMAogICAgICAgIHMgPSAyLjAKICAgICAgICBuLCBmID0geC5zaGFwZQoKICAgICAgICBpZiB0eXBlKHgpID09IG5wLm5kYXJyYXk6CiAgICAgICAgICAgIHhbOiwgZiAtIDFdID0gbnAucmFuZG9tLm5vcm1hbChtLCBzLCBuKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHgudmFsdWVzWzosIGYgLSAxXSA9IG5wLnJhbmRvbS5ub3JtYWwobSwgcywgbikKCiAgICAgICAgeCA9IHguYXN0eXBlKCJmbG9hdCIpCgogICAgICAgIHJldHVybiB4CiAgICAKZGVmIGZlYXR1cmVzX2VuZ2luZWVyKAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBYOiBVbmlvbltEYXRhSXRlbSwgc3RyXSwKICAgIHRhcmdldF9wYXRoOiBzdHIgPSAnJywKICAgIG1vZGVsX2tleTogc3RyID0gJ2ZlYXR1cmVzLW1vZGVsJwogICAgZmVhdHVyZXNfa2V5OiBzdHIgPSAnZmVhdHVyZXMnCik6CiAgICAiIiJHZW5lcmF0ZSBmZWF0dXJlcyBmcm9tIGFuIGlucHV0IGFycmF5CiAgICAKICAgIFRoZSBmZWF0dXJlcyBtb2RlbCB3aWxsIGJlIHNhdmVkIGZvciByZXVzZSBpbiBhbiBpbmZlcmVuY2UgcGlwZWxpbmUgb3Igd2hlbgogICAgdGVzdGluZyB0aGUgbW9kZWwuIEluIGFkZGl0aW9uLCB0aGUgdHJhbnNmb3JtZWQgZmVhdHVyZXMgYXJyYXkgaXMgbWFkZSBhdmFpbGFibGUKICAgIHRocm91Z2ggdGhlIGFydGlmYWN0IHN0b3JlLgogICAgCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICB0aGUgZnVuY3Rpb24gY29udGV4dAogICAgOnBhcmFtIFg6ICAgICAgICAgICAgICAgaW5wdXQgYXJyYXkKICAgIDpwYXJhbSB0YXJnZXRfcGF0aDogICAgIGRlc3RpbmF0aW9uIGZvbGRlciBmb3IgYXJ0aWZhY3RzCiAgICA6cGFyYW0gbW9kZWxfa2V5ICAgICAgICBlc3RpbWF0ZWQgbW9kZWxzIGFyZSBzYXZlZCB1bmRlciB0aGlzIGtleSBpbiB0aGUgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnRpZmFjdCBzdG9yZQogICAgOnBhcmFtIGZlYXR1cmVzX2tleTogICAgdHJhbnNmb3JtZWQgZmVhdHVyZXMgbWF0cml4CiAgICAiIiIKICAgIGZlbmcgPSBGZWF0dXJlc0VuZ2luZWVyKCkKICAgIAogICAgWCA9IHBkLnJlYWRfcGFycXVldChzdHIoWCksIGVuZ2luZT0ncHlhcnJvdycpCiAgICAKICAgIGZlbmcuZml0KFgpCiAgICBYdCA9IGZlbmcudHJhbnNmb3JtKFgpCiAgICAKICAgIGZpbGVwYXRoID0gb3MucGF0aC5qb2luKHRhcmdldF9wYXRoLCBtb2RlbF9rZXkrJy5wa2wnKQogICAgZHVtcChmZW5nLCBvcGVuKGZpbGVwYXRoLCAnd2InKSkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KG1vZGVsX2tleSwgdGFyZ2V0X3BhdGg9ZmlsZXBhdGgpCiAgICAKICAgIGZpbGVwYXRoID0gb3MucGF0aC5qb2luKHRhcmdldF9wYXRoLCBmZWF0dXJlc19rZXkrJy5wa2wnKQogICAgZHVtcChmZW5nLCBvcGVuKGZpbGVwYXRoLCAnd2InKSkKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KGZlYXR1cmVzX2tleSwgdGFyZ2V0X3BhdGg9ZmlsZXBhdGgp
    base_image: yjbds/mlrun-ds:latest
    commands: []
    code_origin: https://github.com/yjb-ds/functions.git#9f080fed89f32412dcebe59bb1d248921aa8aad2:/User/repos/functions/datagen/features/features-engineer.py
