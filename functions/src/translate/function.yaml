verbose: false
kind: job
spec:
  command: ''
  build:
    origin_filename: ''
    code_origin: ''
    requirements:
    - transformers
    - sentencepiece
    - torch>=2.6
    - tqdm
    base_image: mlrun/mlrun
    functionSourceCode: IyBDb3B5cmlnaHQgMjAyMyBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAojCiMgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQojIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiMgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiMgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAojIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoKaW1wb3J0IGxvZ2dpbmcKaW1wb3J0IG9wZXJhdG9yCmltcG9ydCBwYXRobGliCmZyb20gZnVuY3Rvb2xzIGltcG9ydCByZWR1Y2UsIHdyYXBzCmZyb20gdHlwaW5nIGltcG9ydCBBbnkKCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IHRyYW5zZm9ybWVycwpmcm9tIHRxZG0gaW1wb3J0IHRxZG0KCiMgR2V0IHRoZSBnbG9iYWwgbG9nZ2VyOgpfTE9HR0VSID0gbG9nZ2luZy5nZXRMb2dnZXIoKQoKCmRlZiBfY2hlY2tfbWxydW5fYW5kX29wZW5fbXBpKCkgLT4gdHVwbGVbIm1scnVuLk1MQ2xpZW50Q3R4IiwgIm1waTRweS5NUEkuSW50cmFjb21tIl06CiAgICBpc19tcGkgPSBGYWxzZQogICAgdHJ5OgogICAgICAgIGltcG9ydCBtbHJ1bgoKICAgICAgICBjb250ZXh0ID0gbWxydW4uZ2V0X29yX2NyZWF0ZV9jdHgobmFtZT0ibWxydW4iKQogICAgICAgIGlzX21waSA9IGNvbnRleHQubGFiZWxzLmdldCgia2luZCIsICJqb2IiKSA9PSAibXBpam9iIgoKICAgICAgICBpZiBpc19tcGk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZyb20gbXBpNHB5IGltcG9ydCBNUEkKCiAgICAgICAgICAgICAgICByZXR1cm4gY29udGV4dCwgTVBJLkNPTU1fV09STEQKICAgICAgICAgICAgZXhjZXB0IE1vZHVsZU5vdEZvdW5kRXJyb3IgYXMgbXBpNHB5X25vdF9mb3VuZDoKICAgICAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmVycm9yKAogICAgICAgICAgICAgICAgICAgICJUbyBkaXN0cmlidXRlIHRoZSBmdW5jdGlvbiB1c2luZyBNTFJ1bidzICdtcGlqb2InIHlvdSBuZWVkIHRvIGhhdmUgYG1waTRweWAgcGFja2FnZSBpbiB5b3VyICIKICAgICAgICAgICAgICAgICAgICAiaW50ZXJwcmV0ZXIuIFBsZWFzZSBydW4gYHBpcCBpbnN0YWxsIG1waTRweWAgYW5kIG1ha2Ugc3VyZSB5b3UgaGF2ZSBvcGVuLW1waS4iCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICByYWlzZSBtcGk0cHlfbm90X2ZvdW5kCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQsIE5vbmUKICAgIGV4Y2VwdCBNb2R1bGVOb3RGb3VuZEVycm9yIGFzIG1vZHVsZV9ub3RfZm91bmQ6CiAgICAgICAgaWYgaXNfbXBpOgogICAgICAgICAgICByYWlzZSBtb2R1bGVfbm90X2ZvdW5kCiAgICByZXR1cm4gTm9uZSwgTm9uZQoKCmRlZiBvcGVuX21waV9oYW5kbGVyKAogICAgd29ya2VyX2lucHV0czogbGlzdFtzdHJdLCByb290X3dvcmtlcl9pbnB1dHM6IGRpY3Rbc3RyLCBBbnldID0gTm9uZQopOgogICAgZ2xvYmFsIF9MT0dHRVIKCiAgICAjIENoZWNrIGZvciBNTFJ1biBhbmQgT3Blbk1QSSBhdmFpbGFiaWxpdHk6CiAgICBjb250ZXh0LCBjb21tID0gX2NoZWNrX21scnVuX2FuZF9vcGVuX21waSgpCgogICAgIyBDaGVjayBpZiBNTFJ1biBpcyBhdmFpbGFibGUsIHNldCB0aGUgZ2xvYmFsIGxvZ2dlciB0byBNTFJ1bidzOgogICAgaWYgY29udGV4dDoKICAgICAgICBfTE9HR0VSID0gY29udGV4dC5sb2dnZXIKCiAgICBkZWYgZGVjb3JhdG9yKGhhbmRsZXIpOgogICAgICAgIGlmIGNvbW0gaXMgTm9uZSBvciBjb21tLkdldF9zaXplKCkgPT0gMToKICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIKCiAgICAgICAgQHdyYXBzKGhhbmRsZXIpCiAgICAgICAgZGVmIHdyYXBwZXIoKiprd2FyZ3MpOgogICAgICAgICAgICAjIEdldCB0aGUgb3BlbiBtcGkgZW52aXJvbm1lbnQgcHJvcGVydGllczoKICAgICAgICAgICAgc2l6ZSA9IGNvbW0uR2V0X3NpemUoKQogICAgICAgICAgICByYW5rID0gY29tbS5HZXRfcmFuaygpCgogICAgICAgICAgICAjIEdpdmUgdGhlIGNvcnJlY3QgY2h1bmsgb2YgdGhlIHdvcmtlcnMgaW5wdXRzOgogICAgICAgICAgICBmb3Igd29ya2VyX2lucHV0IGluIHdvcmtlcl9pbnB1dHM6CiAgICAgICAgICAgICAgICBpbnB1dF9hcmd1bWVudCA9IGt3YXJnc1t3b3JrZXJfaW5wdXRdCiAgICAgICAgICAgICAgICBpZiBpbnB1dF9hcmd1bWVudCBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGlucHV0X2FyZ3VtZW50LCAoc3RyLCBwYXRobGliLlBhdGgpKToKICAgICAgICAgICAgICAgICAgICBpbnB1dF9hcmd1bWVudCA9IF9nZXRfdGV4dF9maWxlcygKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YV9wYXRoPXBhdGhsaWIuUGF0aChpbnB1dF9hcmd1bWVudCkuYWJzb2x1dGUoKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGlmIGxlbihpbnB1dF9hcmd1bWVudCkgPCBzaXplOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgICAgIGYiQ2Fubm90IHNwbGl0IHRoZSBpbnB1dCAne3dvcmtlcl9pbnB1dH0nIG9mIGxlbmd0aCB7bGVuKGlucHV0X2FyZ3VtZW50KX0gdG8ge3NpemV9IHdvcmtlcnMuICIKICAgICAgICAgICAgICAgICAgICAgICAgZiJQbGVhc2UgcmVkdWNlIHRoZSBhbW91bnQgb2Ygd29ya2VycyBmb3IgdGhpcyBpbnB1dC4iCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZXZlbl9jaHVua19zaXplID0gbGVuKGlucHV0X2FyZ3VtZW50KSAvLyBzaXplCiAgICAgICAgICAgICAgICBjaHVua19zdGFydCA9IHJhbmsgKiBldmVuX2NodW5rX3NpemUKICAgICAgICAgICAgICAgIGNodW5rX2VuZCA9ICgKICAgICAgICAgICAgICAgICAgICAocmFuayArIDEpICogZXZlbl9jaHVua19zaXplCiAgICAgICAgICAgICAgICAgICAgaWYgcmFuayArIDEgPCBzaXplCiAgICAgICAgICAgICAgICAgICAgZWxzZSBsZW4oaW5wdXRfYXJndW1lbnQpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKAogICAgICAgICAgICAgICAgICAgIGYiUmFuayAje3Jhbmt9OiBQcm9jZXNzaW5nIGlucHV0IGNodW5rIG9mICd7d29ya2VyX2lucHV0fScgIgogICAgICAgICAgICAgICAgICAgIGYiZnJvbSBpbmRleCB7Y2h1bmtfc3RhcnR9IHRvIHtjaHVua19lbmR9LiIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoaW5wdXRfYXJndW1lbnQsIGxpc3QpOgogICAgICAgICAgICAgICAgICAgIGlucHV0X2FyZ3VtZW50ID0gaW5wdXRfYXJndW1lbnRbY2h1bmtfc3RhcnQ6Y2h1bmtfZW5kXQogICAgICAgICAgICAgICAgZWxpZiBpc2luc3RhbmNlKGlucHV0X2FyZ3VtZW50LCBwZC5EYXRhRnJhbWUpOgogICAgICAgICAgICAgICAgICAgIGlucHV0X2FyZ3VtZW50ID0gaW5wdXRfYXJndW1lbnQuaWxvY1tjaHVua19zdGFydDpjaHVua19lbmQ6LCA6XQogICAgICAgICAgICAgICAga3dhcmdzW3dvcmtlcl9pbnB1dF0gPSBpbnB1dF9hcmd1bWVudAoKICAgICAgICAgICAgIyBTZXQgdGhlIHJvb3Qgd29ya2VyIG9ubHkgYXJndW1lbnRzOgogICAgICAgICAgICBpZiByYW5rID09IDAgYW5kIHJvb3Rfd29ya2VyX2lucHV0czoKICAgICAgICAgICAgICAgIGt3YXJncy51cGRhdGUocm9vdF93b3JrZXJfaW5wdXRzKQoKICAgICAgICAgICAgIyBSdW4gdGhlIHdvcmtlcjoKICAgICAgICAgICAgb3V0cHV0ID0gaGFuZGxlcigqKmt3YXJncykKCiAgICAgICAgICAgICMgU2VuZCB0aGUgb3V0cHV0IHRvIHRoZSByb290IHJhbmsgKHJhbmsgIzApOgogICAgICAgICAgICBvdXRwdXQgPSBjb21tLmdhdGhlcihvdXRwdXQsIHJvb3Q9MCkKICAgICAgICAgICAgaWYgcmFuayA9PSAwOgogICAgICAgICAgICAgICAgIyBKb2luIHRoZSBvdXRwdXRzOgogICAgICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygiQ29sbGVjdGluZyBkYXRhIGZyb20gd29ya2VycyB0byByb290IHdvcmtlci4iKQogICAgICAgICAgICAgICAgb3V0cHV0X2RpcmVjdG9yeSA9IG91dHB1dFswXVswXQogICAgICAgICAgICAgICAgZGF0YWZyYW1lID0gcGQuY29uY2F0KG9ianM9W2RmIGZvciBfLCBkZiwgXyBpbiBvdXRwdXRdLCBheGlzPTApCiAgICAgICAgICAgICAgICBlcnJvcnNfZGljdGlvbmFyeSA9IHJlZHVjZSgKICAgICAgICAgICAgICAgICAgICBvcGVyYXRvci5pb3IsIFtlcnIgZm9yIF8sIF8sIGVyciBpbiBvdXRwdXRdLCB7fQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcmV0dXJuIG91dHB1dF9kaXJlY3RvcnksIGRhdGFmcmFtZSwgZXJyb3JzX2RpY3Rpb25hcnkKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgcmV0dXJuIHdyYXBwZXIKCiAgICByZXR1cm4gZGVjb3JhdG9yCgoKQG9wZW5fbXBpX2hhbmRsZXIod29ya2VyX2lucHV0cz1bImRhdGFfcGF0aCJdLCByb290X3dvcmtlcl9pbnB1dHM9eyJ2ZXJib3NlIjogVHJ1ZX0pCmRlZiB0cmFuc2xhdGUoCiAgICBkYXRhX3BhdGg6IHN0ciB8IGxpc3Rbc3RyXSB8IHBhdGhsaWIuUGF0aCwKICAgIG91dHB1dF9kaXJlY3Rvcnk6IHN0ciwKICAgIG1vZGVsX25hbWU6IHN0ciA9IE5vbmUsCiAgICBzb3VyY2VfbGFuZ3VhZ2U6IHN0ciA9IE5vbmUsCiAgICB0YXJnZXRfbGFuZ3VhZ2U6IHN0ciA9IE5vbmUsCiAgICBkZXZpY2U6IHN0ciA9IE5vbmUsCiAgICBtb2RlbF9rd2FyZ3M6IGRpY3QgPSBOb25lLAogICAgYmF0Y2hfc2l6ZTogaW50ID0gMSwKICAgIHRyYW5zbGF0aW9uX2t3YXJnczogZGljdCA9IE5vbmUsCiAgICB2ZXJib3NlOiBib29sID0gRmFsc2UsCikgLT4gdHVwbGVbc3RyLCBwZC5EYXRhRnJhbWUsIGRpY3RdOgogICAgIiIiCiAgICBUcmFuc2xhdGUgdGV4dCBmaWxlcyB1c2luZyBhIHRyYW5zZm9ybWVyIG1vZGVsIGZyb20gSHVnZ2luZ2ZhY2UncyBodWIgYWNjb3JkaW5nIHRvIHRoZSBzb3VyY2UgYW5kIHRhcmdldCBsYW5ndWFnZXMKICAgIGdpdmVuIChvciB1c2luZyB0aGUgZGlyZWN0bHkgcHJvdmlkZWQgbW9kZWwgbmFtZSkuIFRoZSBlbmQgcmVzdWx0IGlzIGEgZGlyZWN0b3J5IG9mIHRyYW5zbGF0ZWQgdGV4dCBmaWxlcyBhbmQgYQogICAgZGF0YWZyYW1lIGNvbnRhaW5pbmcgdGhlIGZvbGxvd2luZyBjb2x1bW5zOgoKICAgICogdGV4dF9maWxlIC0gVGhlIHRleHQgZmlsZSBwYXRoLgogICAgKiB0cmFuc2xhdGlvbl9maWxlIC0gVGhlIHRyYW5zbGF0aW9uIHRleHQgZmlsZSBuYW1lIGluIHRoZSBvdXRwdXQgZGlyZWN0b3J5LgoKICAgIDpwYXJhbSBkYXRhX3BhdGg6ICAgICAgICAgIEEgZGlyZWN0b3J5IG9mIHRleHQgZmlsZXMgb3IgYSBzaW5nbGUgZmlsZSBvciBhIGxpc3Qgb2YgZmlsZXMgdG8gdHJhbnNsYXRlLgogICAgOnBhcmFtIG91dHB1dF9kaXJlY3Rvcnk6ICAgRGlyZWN0b3J5IHdoZXJlIHRoZSB0cmFuc2xhdGVkIGZpbGVzIHdpbGwgYmUgc2F2ZWQuCiAgICA6cGFyYW0gbW9kZWxfbmFtZTogICAgICAgICBUaGUgbmFtZSBvZiBhIG1vZGVsIHRvIGxvYWQuIElmIE5vbmUsIHRoZSBtb2RlbCBuYW1lIGlzIGNvbnN0cnVjdGVkIHVzaW5nIHRoZSBzb3VyY2UgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQgbGFuZ3VhZ2VzIHBhcmFtZXRlcnMuCiAgICA6cGFyYW0gc291cmNlX2xhbmd1YWdlOiAgICBUaGUgc291cmNlIGxhbmd1YWdlIGNvZGUgKGUuZy4sICdlbicgZm9yIEVuZ2xpc2gpLgogICAgOnBhcmFtIHRhcmdldF9sYW5ndWFnZTogICAgVGhlIHRhcmdldCBsYW5ndWFnZSBjb2RlIChlLmcuLCAnZW4nIGZvciBFbmdsaXNoKS4KICAgIDpwYXJhbSBtb2RlbF9rd2FyZ3M6ICAgICAgIEtleXdvcmQgYXJndW1lbnRzIHRvIHBhc3MgcmVnYXJkaW5nIHRoZSBsb2FkaW5nIG9mIHRoZSBtb2RlbCBpbiBIdWdnaW5nRmFjZSdzIGBwaXBlbGluZWAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uLgogICAgOnBhcmFtIGRldmljZTogICAgICAgICAgICAgVGhlIGRldmljZSBpbmRleCBmb3IgdHJhbnNmb3JtZXJzLiBEZWZhdWx0IHdpbGwgcHJlZmVyIGN1ZGEgaWYgYXZhaWxhYmxlLgogICAgOnBhcmFtIGJhdGNoX3NpemU6ICAgICAgICAgVGhlIG51bWJlciBvZiBiYXRjaGVzIHRvIHVzZSBpbiB0cmFuc2xhdGlvbi4gVGhlIGZpbGVzIGFyZSB0cmFuc2xhdGVkIG9uZSBieSBvbmUsIGJ1dCB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbnRlbmNlcyBjYW4gYmUgYmF0Y2hlZC4KICAgIDpwYXJhbSB0cmFuc2xhdGlvbl9rd2FyZ3M6IEFkZGl0aW9uYWwga2V5d29yZCBhcmd1bWVudHMgdG8gcGFzcyB0byBhIGB0cmFuc2Zvcm1lcnMuVHJhbnNsYXRpb25QaXBlbGluZWAgd2hlbiBkb2luZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIHRyYW5zbGF0aW9uIGluZmVyZW5jZS4gTm90aWNlIHRoZSBiYXRjaCBzaXplIGhlcmUgaXMgYmVpbmcgYWRkZWQgYXV0b21hdGljYWxseS4KICAgIDpwYXJhbSB2ZXJib3NlOiAgICAgICAgICAgIFdoZXRoZXIgdG8gcHJlc2VudCBsb2dzIG9mIGEgcHJvZ3Jlc3MgYmFyIGFuZCBlcnJvcnMuIERlZmF1bHQ6IFRydWUuCgogICAgOnJldHVybnM6IEEgdHVwbGUgb2Y6CgogICAgICAgICAgICAgICogUGF0aCB0byB0aGUgb3V0cHV0IGRpcmVjdG9yeS4KICAgICAgICAgICAgICAqIEEgZGF0YWZyYW1lIGRhdGFzZXQgb2YgdGhlIHRyYW5zbGF0ZWQgZmlsZSBuYW1lcy4KICAgICAgICAgICAgICAqIEEgZGljdGlvbmFyeSBvZiBlcnJvcmVkIGZpbGVzIHRoYXQgd2VyZSBub3QgdHJhbnNsYXRlZC4KICAgICIiIgogICAgZ2xvYmFsIF9MT0dHRVIKCiAgICAjIEdldCB0aGUgaW5wdXQgdGV4dCBmaWxlcyB0byB0cmFuc2xhdGU6CiAgICBpZiB2ZXJib3NlOgogICAgICAgIF9MT0dHRVIuaW5mbygiQ29sbGVjdGluZyB0ZXh0IGZpbGVzLiIpCiAgICBpZiBpc2luc3RhbmNlKGRhdGFfcGF0aCwgc3RyKToKICAgICAgICBkYXRhX3BhdGggPSBwYXRobGliLlBhdGgoZGF0YV9wYXRoKS5hYnNvbHV0ZSgpCiAgICAgICAgdGV4dF9maWxlcyA9IF9nZXRfdGV4dF9maWxlcyhkYXRhX3BhdGg9ZGF0YV9wYXRoKQogICAgZWxzZToKICAgICAgICB0ZXh0X2ZpbGVzID0gZGF0YV9wYXRoCiAgICBpZiB2ZXJib3NlOgogICAgICAgIF9MT0dHRVIuaW5mbyhmIkNvbGxlY3RlZCB7bGVuKHRleHRfZmlsZXMpfSB0ZXh0IGZpbGVzLiIpCgogICAgIyBHZXQgdGhlIHRyYW5zbGF0aW9uIHBpcGVsaW5lOgogICAgaWYgdmVyYm9zZToKICAgICAgICBfTE9HR0VSLmluZm8oZiJMb2FkaW5nIG1vZGVsIC0gdXNpbmcgZGV2aWNlICd7ZGV2aWNlfScuIikKICAgIHRyYW5zbGF0aW9uX3BpcGVsaW5lLCBtb2RlbF9uYW1lID0gX2dldF90cmFuc2xhdGlvbl9waXBlbGluZSgKICAgICAgICBtb2RlbF9uYW1lPW1vZGVsX25hbWUsCiAgICAgICAgc291cmNlX2xhbmd1YWdlPXNvdXJjZV9sYW5ndWFnZSwKICAgICAgICB0YXJnZXRfbGFuZ3VhZ2U9dGFyZ2V0X2xhbmd1YWdlLAogICAgICAgIGRldmljZT1kZXZpY2UsCiAgICAgICAgbW9kZWxfa3dhcmdzPW1vZGVsX2t3YXJncywKICAgICAgICBiYXRjaF9zaXplPWJhdGNoX3NpemUgaWYgYmF0Y2hfc2l6ZSAhPSAxIGVsc2UgTm9uZSwKICAgICkKICAgIGlmIHZlcmJvc2U6CiAgICAgICAgX0xPR0dFUi5pbmZvKGYiTW9kZWwgJ3ttb2RlbF9uYW1lfScgd2FzIGxvYWRlZCBzdWNjZXNzZnVsbHkuIikKCiAgICAjIFByZXBhcmUgdGhlIHN1Y2Nlc3NlcyBkYXRhZnJhbWUgYW5kIGVycm9ycyBkaWN0aW9uYXJ5IHRvIGJlIHJldHVybmVkOgogICAgc3VjY2Vzc2VzID0gW10KICAgIGVycm9ycyA9IHt9CgogICAgIyBDcmVhdGUgdGhlIG91dHB1dCBkaXJlY3Rvcnk6CiAgICBvdXRwdXRfZGlyZWN0b3J5ID0gcGF0aGxpYi5QYXRoKG91dHB1dF9kaXJlY3RvcnkpCiAgICBvdXRwdXRfZGlyZWN0b3J5Lm1rZGlyKHBhcmVudHM9VHJ1ZSwgZXhpc3Rfb2s9VHJ1ZSkKCiAgICAjIFByZXBhcmUgdGhlIHRyYW5zbGF0aW9uIGtleXdvcmQgYXJndW1lbnRzOgogICAgdHJhbnNsYXRpb25fa3dhcmdzID0gdHJhbnNsYXRpb25fa3dhcmdzIG9yIHt9CgogICAgIyBHbyBvdmVyIHRoZSBhdWRpbyBmaWxlcyBhbmQgdHJhbnNjcmliZToKICAgIGZvciB0ZXh0X2ZpbGUgaW4gdHFkbSgKICAgICAgICB0ZXh0X2ZpbGVzLCBkZXNjPSJUcmFuc2xhdGluZyIsIHVuaXQ9ImZpbGUiLCBkaXNhYmxlPW5vdCB2ZXJib3NlCiAgICApOgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUcmFuc2xhdGU6CiAgICAgICAgICAgIHRyYW5zbGF0aW9uID0gX3RyYW5zbGF0ZSgKICAgICAgICAgICAgICAgIHRleHRfZmlsZT10ZXh0X2ZpbGUsCiAgICAgICAgICAgICAgICB0cmFuc2xhdGlvbl9waXBlbGluZT10cmFuc2xhdGlvbl9waXBlbGluZSwKICAgICAgICAgICAgICAgIHRyYW5zbGF0aW9uX2t3YXJncz10cmFuc2xhdGlvbl9rd2FyZ3MsCiAgICAgICAgICAgICkKICAgICAgICAgICAgIyBXcml0ZSB0aGUgdHJhbnNjcmlwdGlvbiB0byBmaWxlOgogICAgICAgICAgICB0cmFuc2xhdGlvbl9maWxlID0gX3NhdmVfdG9fZmlsZSgKICAgICAgICAgICAgICAgIHRyYW5zbGF0aW9uPXRyYW5zbGF0aW9uLAogICAgICAgICAgICAgICAgZmlsZV9uYW1lPXRleHRfZmlsZS5zdGVtLAogICAgICAgICAgICAgICAgb3V0cHV0X2RpcmVjdG9yeT1vdXRwdXRfZGlyZWN0b3J5LAogICAgICAgICAgICApCiAgICAgICAgICAgICMgTm90ZSBhcyBhIHN1Y2Nlc3MgaW4gdGhlIGxpc3Q6CiAgICAgICAgICAgIHN1Y2Nlc3Nlcy5hcHBlbmQoCiAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgdGV4dF9maWxlLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgdHJhbnNsYXRpb25fZmlsZS5uYW1lLAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICApCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBleGNlcHRpb246CiAgICAgICAgICAgICMgTm90ZSB0aGUgZXhjZXB0aW9uIGFzIGVycm9yIGluIHRoZSBkaWN0aW9uYXJ5OgogICAgICAgICAgICBpZiB2ZXJib3NlOgogICAgICAgICAgICAgICAgX0xPR0dFUi53YXJuaW5nKGYiRXJyb3IgaW4gZmlsZTogJ3t0ZXh0X2ZpbGUubmFtZX0nIikKICAgICAgICAgICAgZXJyb3JzW3N0cih0ZXh0X2ZpbGUubmFtZSldID0gc3RyKGV4Y2VwdGlvbikKICAgICAgICAgICAgY29udGludWUKCiAgICAjIENvbnN0cnVjdCB0aGUgdHJhbnNsYXRpb25zIGRhdGFmcmFtZToKICAgIGNvbHVtbnMgPSBbCiAgICAgICAgInRleHRfZmlsZSIsCiAgICAgICAgInRyYW5zbGF0aW9uX2ZpbGUiLAogICAgXQogICAgc3VjY2Vzc2VzID0gcGQuRGF0YUZyYW1lKAogICAgICAgIHN1Y2Nlc3NlcywKICAgICAgICBjb2x1bW5zPWNvbHVtbnMsCiAgICApCgogICAgIyBQcmludCB0aGUgaGVhZCBvZiB0aGUgcHJvZHVjZWQgZGF0YWZyYW1lIGFuZCByZXR1cm46CiAgICBpZiB2ZXJib3NlOgogICAgICAgIF9MT0dHRVIuaW5mbygKICAgICAgICAgICAgZiJEb25lICh7c3VjY2Vzc2VzLnNoYXBlWzBdfS97bGVuKHRleHRfZmlsZXMpfSlcbiIKICAgICAgICAgICAgZiJUcmFuc2xhdGlvbnMgc3VtbWFyeTpcbiIKICAgICAgICAgICAgZiJ7c3VjY2Vzc2VzLmhlYWQoKX0iCiAgICAgICAgKQogICAgcmV0dXJuIHN0cihvdXRwdXRfZGlyZWN0b3J5KSwgc3VjY2Vzc2VzLCBlcnJvcnMKCgpkZWYgX2dldF90ZXh0X2ZpbGVzKAogICAgZGF0YV9wYXRoOiBwYXRobGliLlBhdGgsCikgLT4gbGlzdFtwYXRobGliLlBhdGhdOgogICAgIyBDaGVjayBpZiB0aGUgcGF0aCBpcyBvZiBhIGRpcmVjdG9yeSBvciBhIGZpbGU6CiAgICBpZiBkYXRhX3BhdGguaXNfZGlyKCk6CiAgICAgICAgIyBHZXQgYWxsIGZpbGVzIGluc2lkZSB0aGUgZGlyZWN0b3J5OgogICAgICAgIHRleHRfZmlsZXMgPSBsaXN0KGRhdGFfcGF0aC5nbG9iKCIqLioiKSkKICAgIGVsaWYgZGF0YV9wYXRoLmlzX2ZpbGUoKToKICAgICAgICB0ZXh0X2ZpbGVzID0gW2RhdGFfcGF0aF0KICAgIGVsc2U6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigKICAgICAgICAgICAgZiJVbnJlY29nbml6ZWQgZGF0YSBwYXRoLiBUaGUgcGFyYW1ldGVyIGBkYXRhX3BhdGhgIG11c3QgYmUgZWl0aGVyIGEgZGlyZWN0b3J5IHBhdGggb3IgYSBmaWxlIHBhdGguICIKICAgICAgICAgICAgZiJHaXZlbjoge3N0cihkYXRhX3BhdGgpfSAiCiAgICAgICAgKQoKICAgIHJldHVybiB0ZXh0X2ZpbGVzCgoKZGVmIF9nZXRfdHJhbnNsYXRpb25fcGlwZWxpbmUoCiAgICBtb2RlbF9uYW1lOiBzdHIgPSBOb25lLAogICAgc291cmNlX2xhbmd1YWdlOiBzdHIgPSBOb25lLAogICAgdGFyZ2V0X2xhbmd1YWdlOiBzdHIgPSBOb25lLAogICAgZGV2aWNlOiBzdHIgPSBOb25lLAogICAgbW9kZWxfa3dhcmdzOiBkaWN0ID0gTm9uZSwKICAgIGJhdGNoX3NpemU6IGludCA9IE5vbmUsCikgLT4gdHVwbGVbdHJhbnNmb3JtZXJzLlBpcGVsaW5lLCBzdHJdOgogICAgIyBDb25zdHJ1Y3QgdGhlIG1vZGVsIG5hbWUgLSBpZiBtb2RlbCBuYW1lIGlzIHByb3ZpZGVkIChub3QgTm9uZSkgdGhlbiB3ZSB0YWtlIGl0LCBvdGhlcndpc2Ugd2UgY2hlY2sgYm90aCBzb3VyY2UKICAgICMgYW5kIHRhcmdldCB3ZXJlIHByb3ZpZGVkIHRvIGNvbnN0cnVjdCB0aGUgbW9kZWwgbmFtZToKICAgIGlmIG1vZGVsX25hbWUgaXMgTm9uZSBhbmQgKHNvdXJjZV9sYW5ndWFnZSBpcyBOb25lIG9yIHRhcmdldF9sYW5ndWFnZSBpcyBOb25lKToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKAogICAgICAgICAgICAiTm8gbW9kZWwgbmFtZSB3ZXJlIGdpdmVuIGFuZCBtaXNzaW5nIHNvdXJjZSBhbmQgLyBvciB0YXJnZXQgbGFuZ3VhZ2VzLiBJbiBvcmRlciB0byB0cmFuc2xhdGUgeW91IG11c3QgIgogICAgICAgICAgICAicGFzcyBhIGBtb2RlbF9uYW1lYCBvciBib3RoIGBzb3VyY2VfbGFuZ3VhZ2VgIGFuZCBgdGFyZ2V0X2xhbmd1YWdlYC4iCiAgICAgICAgKQogICAgZWxpZiBtb2RlbF9uYW1lIGlzIE5vbmU6CiAgICAgICAgbW9kZWxfbmFtZSA9IGYiSGVsc2lua2ktTkxQL29wdXMtbXQte3NvdXJjZV9sYW5ndWFnZX0te3RhcmdldF9sYW5ndWFnZX0iCgogICAgIyBJbml0aWFsaXplIHRoZSB0cmFuc2xhdGlvbiBwaXBlbGluZToKICAgIHRyeToKICAgICAgICB0cmFuc2xhdGlvbl9waXBlbGluZSA9IHRyYW5zZm9ybWVycy5waXBlbGluZSgKICAgICAgICAgICAgdGFzaz0idHJhbnNsYXRpb24iLAogICAgICAgICAgICBtb2RlbD1tb2RlbF9uYW1lLAogICAgICAgICAgICB0b2tlbml6ZXI9bW9kZWxfbmFtZSwKICAgICAgICAgICAgZGV2aWNlPWRldmljZSwKICAgICAgICAgICAgbW9kZWxfa3dhcmdzPW1vZGVsX2t3YXJncywKICAgICAgICAgICAgYmF0Y2hfc2l6ZT1iYXRjaF9zaXplLAogICAgICAgICkKICAgIGV4Y2VwdCBPU0Vycm9yIGFzIGxvYWRfZXhjZXB0aW9uOgogICAgICAgIGlmICgKICAgICAgICAgICAgImlzIG5vdCBhIHZhbGlkIG1vZGVsIGlkZW50aWZpZXIgbGlzdGVkIG9uICdodHRwczovL2h1Z2dpbmdmYWNlLmNvL21vZGVscyciCiAgICAgICAgICAgIGluIHN0cihsb2FkX2V4Y2VwdGlvbikKICAgICAgICAgICAgYW5kIHNvdXJjZV9sYW5ndWFnZQogICAgICAgICk6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCiAgICAgICAgICAgICAgICBmIlRoZSBtb2RlbCAne21vZGVsX25hbWV9JyBpcyBub3QgYSB2YWxpZCBtb2RlbCBpZGVudGlmaWVyLiAiCiAgICAgICAgICAgICAgICBmIlRoZSBwYXJhbWV0ZXJzIGBzb3VyY2VfbGFuZ3VhZ2VgIGFuZCBgdGFyZ2V0X2xhbmd1YWdlYCBhcmUgdXNlZCB0byBjb25zdHJ1Y3QgYSBIZWxzaW5raSBtb2RlbCBmb3IgIgogICAgICAgICAgICAgICAgZiJ0ZXh0IHRvIHRleHQgZ2VuZXJhdGlvbiwgYnV0IHRoZSBtb2RlbCBjcmVhdGVkIGZyb20gdGhlIGdpdmVuIGxhbmd1YWdlcyBkb2VzIG5vdCBleGlzdC4gIgogICAgICAgICAgICAgICAgZiJZb3UgbWF5IGNoZWNrIGxhbmd1YWdlIGlkZW50aWZpZXJzIGF0ICIKICAgICAgICAgICAgICAgIGYiaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vYWRtaW4tc2RrL2RpcmVjdG9yeS92MS9sYW5ndWFnZXMsIGFuZCBpZiB0aGUgZXJyb3Igd2FzIG5vdCBmaXhlZCwgb25lICIKICAgICAgICAgICAgICAgIGYib3IgbW9yZSBsYW5ndWFnZSBjb2RlIG1pZ2h0IGJlIHdpdGggMyBsZXR0ZXJzIGFuZCBuZWVkcyB0byBiZSBmb3VuZCBvbmxpbmUuICIKICAgICAgICAgICAgICAgIGYiUmVtZW1iZXIsIHlvdSBjYW4gYWx3YXlzIGNob29zZSBhIG1vZGVsIGRpcmVjdGx5IGZyb20gdGhlIEh1Z2dpbmdmYWNlIGh1YiBieSB1c2luZyB0aGUgYG1vZGVsX25hbWVgICIKICAgICAgICAgICAgICAgIGYicGFyYW1ldGVyLiIKICAgICAgICAgICAgKSBmcm9tIGxvYWRfZXhjZXB0aW9uCiAgICAgICAgcmFpc2UgbG9hZF9leGNlcHRpb24KCiAgICByZXR1cm4gdHJhbnNsYXRpb25fcGlwZWxpbmUsIG1vZGVsX25hbWUKCgpkZWYgX3RyYW5zbGF0ZSgKICAgIHRleHRfZmlsZTogcGF0aGxpYi5QYXRoLAogICAgdHJhbnNsYXRpb25fcGlwZWxpbmU6IHRyYW5zZm9ybWVycy5QaXBlbGluZSwKICAgIHRyYW5zbGF0aW9uX2t3YXJnczogZGljdCwKKSAtPiBzdHI6CiAgICAjIFJlYWQgdGhlIHRleHQgZnJvbSBmaWxlOgogICAgd2l0aCBvcGVuKHRleHRfZmlsZSkgYXMgZnA6CiAgICAgICAgdGV4dCA9IGZwLnJlYWQoKQoKICAgICMgU3BsaXQgdG8gcGFyYWdyYXBocyBhbmQgZWFjaCBwYXJhZ3JhcGggdG8gc2VudGVuY2VzOgogICAgcGFyYWdyYXBocyA9IFtwYXJhZ3JhcGguc3BsaXQoIi4iKSBmb3IgcGFyYWdyYXBoIGluIHRleHQuc3BsaXQoIlxuIildCgogICAgIyBEaXNjb3ZlciB0aGUgbmV3bGluZSBpbmRleGVzIHRvIHJlc3RvcmUgdGhlIGZpbGUgdG8gaXRzIHN0cnVjdHVyZSBwb3N0IHRyYW5zbGF0aW9uOgogICAgbmV3bGluZXNfaW5kZXhlcyA9IFtdCiAgICBmb3IgcGFyYWdyYXBoIGluIHBhcmFncmFwaHNbOi0xXToKICAgICAgICBpZiBsZW4obmV3bGluZXNfaW5kZXhlcykgPT0gMDoKICAgICAgICAgICAgbmV3bGluZXNfaW5kZXhlcy5hcHBlbmQobGVuKHBhcmFncmFwaCkgLSAxKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIG5ld2xpbmVzX2luZGV4ZXMuYXBwZW5kKG5ld2xpbmVzX2luZGV4ZXNbLTFdICsgbGVuKHBhcmFncmFwaCkpCgogICAgIyBQcmVwYXJlIHRoZSBiYXRjaGVzIChlYWNoIHNlbnRlbmNlIGZyb20gdGhlIHBhcmFncmFwaHMpLiBOb3RpY2Ugd2UgYWRkIGEgZG90IG5vdCBvbmx5IHRvIHJlc3RvcmUgdGhlIHNlbnRlbmNlCiAgICAjIHN0cnVjdHVyZSBidXQgdG8gaWdub3JlIGVtcHR5IHN0cmluZ3MgYXMgaXQgd2lsbCBydWluIHRoZSB0cmFuc2xhdGlvbjoKICAgIHNlbnRlbmNlcyA9IFtmIntsaW5lfS4iIGZvciBwYXJhZ3JhcGggaW4gcGFyYWdyYXBocyBmb3IgbGluZSBpbiBwYXJhZ3JhcGhdCgogICAgIyBUcmFuc2xhdGUgdGhlIHNlbnRlbmNlczoKICAgIHRyYW5zbGF0aW9ucyA9IHRyYW5zbGF0aW9uX3BpcGVsaW5lKHNlbnRlbmNlcywgKip0cmFuc2xhdGlvbl9rd2FyZ3MpCgogICAgIyBSZXN0cnVjdHVyZSB0aGUgZnVsbCB0ZXh0IGZyb20gdGhlIHNlbnRlbmNlczoKICAgIHRyYW5zbGF0ZWRfdGV4dCA9IFtdCiAgICBuZXdsaW5lX2luZGV4ID0gbmV3bGluZXNfaW5kZXhlcy5wb3AoMCkgaWYgbmV3bGluZXNfaW5kZXhlcyBlbHNlIE5vbmUKICAgIGZvciBpLCB0cmFuc2xhdGlvbiBpbiBlbnVtZXJhdGUodHJhbnNsYXRpb25zKToKICAgICAgICAjIEdldCB0aGUgdHJhbnNsYXRpb246CiAgICAgICAgdGV4dCA9IHRyYW5zbGF0aW9uWyJ0cmFuc2xhdGlvbl90ZXh0Il0KICAgICAgICAjIFZhbGlkYXRlIGlmIGl0IHdhcyBhbiBlbXB0eSBzZW50ZW5jZSBiZWZvcmU6CiAgICAgICAgaWYgdGV4dCA9PSAiLiI6CiAgICAgICAgICAgIHRleHQgPSAiIgogICAgICAgICMgQ2hlY2sgaWYgbmVlZGVkIHRvIGluc2VydCBhIG5ld2xpbmU6CiAgICAgICAgaWYgbmV3bGluZV9pbmRleCBhbmQgbmV3bGluZV9pbmRleCA9PSBpOgogICAgICAgICAgICB0ZXh0ICs9ICJcbiIKICAgICAgICAgICAgbmV3bGluZV9pbmRleCA9IG5ld2xpbmVzX2luZGV4ZXMucG9wKDApIGlmIG5ld2xpbmVzX2luZGV4ZXMgZWxzZSBOb25lCiAgICAgICAgIyBDb2xsZWN0IGl0OgogICAgICAgIHRyYW5zbGF0ZWRfdGV4dC5hcHBlbmQodGV4dCkKICAgIHRyYW5zbGF0ZWRfdGV4dCA9ICIiLmpvaW4odHJhbnNsYXRlZF90ZXh0KQoKICAgIHJldHVybiB0cmFuc2xhdGVkX3RleHQKCgpkZWYgX3NhdmVfdG9fZmlsZSgKICAgIHRyYW5zbGF0aW9uOiBzdHIsIGZpbGVfbmFtZTogc3RyLCBvdXRwdXRfZGlyZWN0b3J5OiBwYXRobGliLlBhdGgKKSAtPiBwYXRobGliLlBhdGg6CiAgICAjIFByZXBhcmUgdGhlIGZpbGUgZnVsbCBwYXRoIChjaGVja2luZyBmb3Igbm8gZHVwbGljYXRpb25zKToKICAgIHRyYW5zbGF0aW9uX2ZpbGUgPSBvdXRwdXRfZGlyZWN0b3J5IC8gZiJ7ZmlsZV9uYW1lfS50eHQiCiAgICBpID0gMQogICAgd2hpbGUgdHJhbnNsYXRpb25fZmlsZS5leGlzdHMoKToKICAgICAgICBpICs9IDEKICAgICAgICB0cmFuc2xhdGlvbl9maWxlID0gb3V0cHV0X2RpcmVjdG9yeSAvIGYie2ZpbGVfbmFtZX1fe2l9LnR4dCIKCiAgICAjIE1ha2Ugc3VyZSBhbGwgZGlyZWN0b3JpZXMgYXJlIGNyZWF0ZWQ6CiAgICB0cmFuc2xhdGlvbl9maWxlLnBhcmVudC5ta2RpcihleGlzdF9vaz1UcnVlLCBwYXJlbnRzPVRydWUpCgogICAgIyBXcml0ZSB0byBmaWxlOgogICAgd2l0aCBvcGVuKHRyYW5zbGF0aW9uX2ZpbGUsICJ3IikgYXMgZnA6CiAgICAgICAgZnAud3JpdGUodHJhbnNsYXRpb24pCgogICAgcmV0dXJuIHRyYW5zbGF0aW9uX2ZpbGUK
  image: ''
  entry_points:
    open_mpi_handler:
      parameters:
      - name: worker_inputs
        type: list[str]
      - name: root_worker_inputs
        type: dict[str, Any]
        default: null
      doc: ''
      lineno: 56
      name: open_mpi_handler
      has_kwargs: false
      has_varargs: false
    decorator:
      parameters:
      - name: handler
      doc: ''
      lineno: 68
      name: decorator
      has_kwargs: false
      has_varargs: false
    wrapper:
      doc: ''
      lineno: 73
      name: wrapper
      has_kwargs: true
      has_varargs: false
    translate:
      parameters:
      - name: data_path
        doc: A directory of text files or a single file or a list of files to translate.
      - name: output_directory
        type: str
        doc: Directory where the translated files will be saved.
      - name: model_name
        type: str
        doc: The name of a model to load. If None, the model name is constructed using
          the source and target languages parameters.
        default: null
      - name: source_language
        type: str
        doc: The source language code (e.g., 'en' for English).
        default: null
      - name: target_language
        type: str
        doc: The target language code (e.g., 'en' for English).
        default: null
      - name: device
        type: str
        doc: The device index for transformers. Default will prefer cuda if available.
        default: null
      - name: model_kwargs
        type: dict
        doc: Keyword arguments to pass regarding the loading of the model in HuggingFace's
          `pipeline` function.
        default: null
      - name: batch_size
        type: int
        doc: The number of batches to use in translation. The files are translated
          one by one, but the sentences can be batched.
        default: 1
      - name: translation_kwargs
        type: dict
        doc: Additional keyword arguments to pass to a `transformers.TranslationPipeline`
          when doing the translation inference. Notice the batch size here is being
          added automatically.
        default: null
      - name: verbose
        type: bool
        doc: 'Whether to present logs of a progress bar and errors. Default: True.'
        default: false
      doc: 'Translate text files using a transformer model from Huggingface''s hub
        according to the source and target languages

        given (or using the directly provided model name). The end result is a directory
        of translated text files and a

        dataframe containing the following columns:


        * text_file - The text file path.

        * translation_file - The translation text file name in the output directory.'
      outputs:
      - doc: 'A tuple of:'
        type: tuple[str, pd.DataFrame, dict]
      lineno: 135
      name: translate
      has_kwargs: false
      has_varargs: false
  filename: translate.py
  description: Translate text files from one language to another
  default_handler: translate
  disable_auto_mount: false
metadata:
  name: translate
  tag: ''
  categories:
  - genai
  - NLP
