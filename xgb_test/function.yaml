kind: job
metadata:
  name: xgb-test
  tag: ''
  hash: c37c922c415b8bcc936de1894c73c92dcfd9aa67
  project: ''
  labels:
    author: yjb
    framework: xgboost
  categories:
  - ml
  - test
spec:
  command: ''
  args: []
  image: yjbds/ml-models:0.4.8
  env: []
  default_handler: test_model
  entry_points:
    test_model:
      name: test_model
      doc: "Test one or more classifier models against held-out dataset\n\nUsing held-out\
        \ test features, evaluates the peformance of the estimated model\n\nCan be\
        \ part of a kubeflow pipeline as a test step that is run post EDA and \ntraining/validation\
        \ cycles\n\nCalls `log_model` storing only results and pointer to model artifact\
        \ used\nto generate results"
      parameters:
      - name: context
        doc: the function context
      - name: models_path
        type: DataItem
        doc: model artifact to be tested
      - name: test_set
        type: DataItem
        doc: test features and labels
      - name: label_column
        type: str
        doc: column name for ground truth labels
      - name: plots_dest
        type: str
        doc: destination for test plots
        default: plots
      - name: results_key
        type: str
        doc: (xgb-test-results) logged results key
        default: xgb-test-results
      - name: default_model
        type: str
        doc: (model.pkl), default model artifact file name
        default: model.pkl
      outputs: []
      lineno: 32
  description: test an xgb classifier using held-out or new data
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IG9zCmltcG9ydCBwYW5kYXMgYXMgcGQKZnJvbSBtbHJ1bi5kYXRhc3RvcmUgaW1wb3J0IERhdGFJdGVtCmZyb20gbWxydW4uYXJ0aWZhY3RzIGltcG9ydCBnZXRfbW9kZWwKZnJvbSBjbG91ZHBpY2tsZSBpbXBvcnQgbG9hZAoKZnJvbSBtbHV0aWxzIGltcG9ydCBldmFsX2NsYXNzX21vZGVsLCBsb2dfbW9kZWwKCmZyb20gdXJsbGliLnJlcXVlc3QgaW1wb3J0IHVybG9wZW4KCmltcG9ydCB3YXJuaW5ncwp3YXJuaW5ncy5zaW1wbGVmaWx0ZXIoYWN0aW9uPSJpZ25vcmUiLCBjYXRlZ29yeT1GdXR1cmVXYXJuaW5nKQoKZGVmIF9sb2FkX3hnYl9tb2RlbChtb2RlbHNfcGF0aDogRGF0YUl0ZW0sIGRlZmF1bHRfbW9kZWw9Im1vZGVsLnBrbCIpOgogICAgIiIiaGFjayBmdW5jdGlvbiAtIGxvYWQgYSBwaWNrbGVkIHhnYiBtb2RlbAogICAgCiAgICA6cGFyYW0gbW9kZWxzX3BhdGg6ICAgIGxvY2FsLCB1cmwsIG9yIGFydGlmYWN0CiAgICA6cGFyYW0gZGVmYXVsdF9tb2RlbDogIGRlZmF1bHQgZmlsZSBuYW1lLCBjdXJyZW50bHkgYSBwaWNrbGUKICAgICIiIgogICAgdHJ5OgogICAgICAgIG1vZGVsX2ZpbGUsIG1vZGVsX29iaiwgXyA9IGdldF9tb2RlbChtb2RlbHNfcGF0aC51cmwsIHN1ZmZpeD0iLnBrbCIpCiAgICAgICAgbW9kZWxfb2JqID0gbG9hZChvcGVuKG1vZGVsX2ZpbGUsICJyYiIpKQogICAgZXhjZXB0IFZhbHVlRXJyb3IgYXMgdmE6IAogICAgICAgIG1vZGVsX29iaiA9IGxvYWQodXJsb3Blbihvcy5wYXRoLmpvaW4oc3RyKG1vZGVsc19wYXRoKSwgZGVmYXVsdF9tb2RlbCkpKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBhOgogICAgICAgIHJhaXNlIEV4Y2VwdGlvbigibW9kZWwgbG9jYXRpb24gbGlrZWx5IG1pc3NwZWNpZmllZCIpCiAgICAKICAgIHJldHVybiBtb2RlbF9vYmoKCmRlZiB0ZXN0X21vZGVsKAogICAgY29udGV4dCwKICAgIG1vZGVsc19wYXRoOiBEYXRhSXRlbSwgCiAgICB0ZXN0X3NldDogRGF0YUl0ZW0sCiAgICBsYWJlbF9jb2x1bW46IHN0ciwKICAgIHBsb3RzX2Rlc3Q6IHN0ciA9ICJwbG90cyIsCiAgICByZXN1bHRzX2tleTogc3RyID0gInhnYi10ZXN0LXJlc3VsdHMiLAogICAgZGVmYXVsdF9tb2RlbDogc3RyID0gIm1vZGVsLnBrbCIKKSAtPiBOb25lOgogICAgIiIiVGVzdCBvbmUgb3IgbW9yZSBjbGFzc2lmaWVyIG1vZGVscyBhZ2FpbnN0IGhlbGQtb3V0IGRhdGFzZXQKICAgIAogICAgVXNpbmcgaGVsZC1vdXQgdGVzdCBmZWF0dXJlcywgZXZhbHVhdGVzIHRoZSBwZWZvcm1hbmNlIG9mIHRoZSBlc3RpbWF0ZWQgbW9kZWwKICAgIAogICAgQ2FuIGJlIHBhcnQgb2YgYSBrdWJlZmxvdyBwaXBlbGluZSBhcyBhIHRlc3Qgc3RlcCB0aGF0IGlzIHJ1biBwb3N0IEVEQSBhbmQgCiAgICB0cmFpbmluZy92YWxpZGF0aW9uIGN5Y2xlcwogICAgCiAgICBDYWxscyBgbG9nX21vZGVsYCBzdG9yaW5nIG9ubHkgcmVzdWx0cyBhbmQgcG9pbnRlciB0byBtb2RlbCBhcnRpZmFjdCB1c2VkCiAgICB0byBnZW5lcmF0ZSByZXN1bHRzCiAgICAKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0CiAgICA6cGFyYW0gbW9kZWxzX3BhdGg6ICAgICBtb2RlbCBhcnRpZmFjdCB0byBiZSB0ZXN0ZWQKICAgIDpwYXJhbSB0ZXN0X3NldDogICAgICAgIHRlc3QgZmVhdHVyZXMgYW5kIGxhYmVscwogICAgOnBhcmFtIGxhYmVsX2NvbHVtbjogICAgY29sdW1uIG5hbWUgZm9yIGdyb3VuZCB0cnV0aCBsYWJlbHMKICAgIDpwYXJhbSBwbG90c19kZXN0OiAgICAgIGRlc3RpbmF0aW9uIGZvciB0ZXN0IHBsb3RzCiAgICA6cGFyYW0gcmVzdWx0c19rZXk6ICAgICAoeGdiLXRlc3QtcmVzdWx0cykgbG9nZ2VkIHJlc3VsdHMga2V5CiAgICA6cGFyYW0gZGVmYXVsdF9tb2RlbDogICAobW9kZWwucGtsKSwgZGVmYXVsdCBtb2RlbCBhcnRpZmFjdCBmaWxlIG5hbWUKICAgICIiIgogICAgeHRlc3QgPSB0ZXN0X3NldC5hc19kZigpCiAgICB5dGVzdCA9IHh0ZXN0LnBvcChsYWJlbF9jb2x1bW4pCiAgICAgICAgCiAgICBtb2RlbCA9IF9sb2FkX3hnYl9tb2RlbChtb2RlbHNfcGF0aCwgZGVmYXVsdF9tb2RlbCkKICAgIAogICAgZXZhbF9tZXRyaWNzID0gZXZhbF9jbGFzc19tb2RlbChjb250ZXh0LCB4dGVzdCwgeXRlc3QsIG1vZGVsKQogICAgCiAgICBsb2dfbW9kZWwoY29udGV4dCwgTm9uZSwgZXZhbF9tZXRyaWNzLCBwbG90c19kZXN0LCBOb25lKQoK
    commands: []
    code_origin: https://github.com/yjb-ds/functions.git#e31612d99ae3c5e096dbe9e21f50d42105e90066:xgb_test.ipynb
