kind: job
metadata:
  name: arc-to-parquet
  tag: ''
  hash: 251c8e50eb09d09032b4b3accf3c3a3a3c1b467b
  project: ''
spec:
  command: ''
  args: []
  volumes: []
  volume_mounts: []
  env: []
  description: ''
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlciBvbiAyMDIwLTAxLTIxIDA3OjExCgppbXBvcnQgbWxydW4KbWxydW4ubWxjb25mLmRicGF0aCA9ICdodHRwOi8vbWxydW4tYXBpOjgwODAnCgppbXBvcnQgb3MKaW1wb3J0IGpzb24KZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IHB5YXJyb3cucGFycXVldCBhcyBwcQppbXBvcnQgcHlhcnJvdyBhcyBwYQoKZnJvbSBtbHJ1bi5leGVjdXRpb24gaW1wb3J0IE1MQ2xpZW50Q3R4CmZyb20gdHlwaW5nIGltcG9ydCBJTywgQW55U3RyLCBVbmlvbiwgTGlzdCwgT3B0aW9uYWwKCgpkZWYgYXJjX3RvX3BhcnF1ZXQoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIGFyY2hpdmVfdXJsOiBVbmlvbltzdHIsIFBhdGgsIElPW0FueVN0cl1dLAogICAgaGVhZGVyOiBVbmlvbltpbnQsIExpc3Rbc3RyXSwgTm9uZV0gPSAwLAogICAgdGFyZ2V0X3BhdGg6IHN0ciA9ICIiLAogICAgbmFtZTogc3RyID0gIiIsCiAgICBjaHVua3NpemU6IGludCA9IDEwXzAwMCwKICAgIGxvZ19kYXRhOiBib29sID0gVHJ1ZSwKICAgIGFkZF91aWQ6IGJvb2wgPSBGYWxzZSwKICAgIGtleTogc3RyID0gInJhd19kYXRhIiwKKSAtPiBOb25lOgogICAgIiIiT3BlbiBhIGZpbGUvb2JqZWN0IGFyY2hpdmUgYW5kIHNhdmUgYXMgYSBwYXJxdWV0IGZpbGUuCiAgICAKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgZnVuY3Rpb24gY29udGV4dAogICAgOnBhcmFtIGFyY2hpdmVfdXJsOiBhbnkgdmFsaWQgc3RyaW5nIHBhdGggY29uc2lzdGVudCB3aXRoIHRoZSBwYXRoIHZhcmlhYmxlCiAgICAgICAgICAgICAgICAgICAgICAgIG9mIHBhbmRhcy5yZWFkX2NzdiwgaW5jbHVkaW5nIHN0cmluZ3MgYXMgZmlsZSBwYXRocywgYXMgdXJscywgCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhsaWIuUGF0aCBvYmplY3RzLCBldGMuLi4KICAgIDpwYXJhbSBoZWFkZXI6ICAgICAgY29sdW1uIG5hbWVzCiAgICA6cGFyYW0gdGFyZ2V0X3BhdGg6IGRlc3RpbmF0aW9uIGZvbGRlciBvZiB0YWJsZQogICAgOnBhcmFtIG5hbWU6ICAgICAgICBuYW1lIGZpbGUgdG8gYmUgc2F2ZWQgbG9jYWxseSwgYWxzbwogICAgOnBhcmFtIGNodW5rc2l6ZTogICAoMCkgcm93IHNpemUgcmV0cmlldmVkIHBlciBpdGVyYXRpb24KICAgIDpwYXJhbSBsb2dfZGF0YTogICAgKFRydWUpIGlmIFRydWUsIGxvZyB0aGUgZGF0YSBzbyB0aGF0IGl0IGlzIGF2YWlsYWJsZQogICAgICAgICAgICAgICAgICAgICAgICBhdCB0aGUgbmV4dCBzdGVwCiAgICA6cGFyYW0gYWRkX3VpZDogICAgIChGYWxzZSkgYWRkIHRoZSBtZXRhZGF0YSB1aWQgdG8gdGhlIHRhcmdldF9wYXRoIHNvIHRoYXQgCiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bnMgY2FuIGJlIGlkZW50aWZpZWQKICAgIDpwYXJhbSBrZXk6ICAgICAgICAga2V5IGluIGFydGlmYWN0IHN0b3JlICh3aGVuIGxvZ19kYXRhPVRydWUpCiAgICAiIiIKICAgIGlmIG5vdCBuYW1lLmVuZHN3aXRoKCIucGFycXVldCIpOgogICAgICAgIG5hbWUgKz0gIi5wYXJxdWV0IgoKICAgIGlmIG5vdCBhZGRfdWlkOgogICAgICAgIHVpZCA9ICIiCiAgICBlbHNlOgogICAgICAgIHVpZCA9IGNvbnRleHQudWlkCgogICAgZGVzdF9wYXRoID0gb3MucGF0aC5qb2luKHRhcmdldF9wYXRoLCB1aWQsIG5hbWUpCiAgICBvcy5tYWtlZGlycyhvcy5wYXRoLmpvaW4odGFyZ2V0X3BhdGgsIHVpZCksIGV4aXN0X29rPVRydWUpCiAgICBpZiBoZWFkZXIgPT0gMDoKICAgICAgICBoZWFkZXIgPSBwZC5yZWFkX2NzdihhcmNoaXZlX3VybCwgaGVhZGVyPU5vbmUsIG5yb3dzPTEpLmlsb2NbMF0udmFsdWVzCiAgICBoZWFkZXIgPSBbeC5yZXBsYWNlKCcgJywgJ18nKSBmb3IgeCBpbiBoZWFkZXJdCiAgICBpZiBub3Qgb3MucGF0aC5pc2ZpbGUoZGVzdF9wYXRoKToKICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCJkZXN0aW5hdGlvbiBmaWxlIGRvZXMgbm90IGV4aXN0LCBkb3dubG9hZGluZyIpCiAgICAgICAgcHF3cml0ZXIgPSBOb25lCiAgICAgICAgZm9yIGksIGRmIGluIGVudW1lcmF0ZShwZC5yZWFkX2NzdihhcmNoaXZlX3VybCwgY2h1bmtzaXplPWNodW5rc2l6ZSwgbmFtZXM9aGVhZGVyKSk6CiAgICAgICAgICAgIHRhYmxlID0gcGEuVGFibGUuZnJvbV9wYW5kYXMoZGYpCiAgICAgICAgICAgIGlmIGkgPT0gMDoKICAgICAgICAgICAgICAgIHBxd3JpdGVyID0gcHEuUGFycXVldFdyaXRlcihkZXN0X3BhdGgsIHRhYmxlLnNjaGVtYSkKICAgICAgICAgICAgcHF3cml0ZXIud3JpdGVfdGFibGUodGFibGUpCgogICAgICAgIGlmIHBxd3JpdGVyOgogICAgICAgICAgICBwcXdyaXRlci5jbG9zZSgpCgogICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJzYXZlZCB0YWJsZSB0byB7ZGVzdF9wYXRofSIpCiAgICBlbHNlOgogICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oImRlc3RpbmF0aW9uIGZpbGUgYWxyZWFkeSBleGlzdHMiKQoKICAgIGlmIGxvZ19kYXRhOgogICAgICAgIGNvbnRleHQubG9nX2FydGlmYWN0KGtleSwgdGFyZ2V0X3BhdGg9ZGVzdF9wYXRoKQogICAgICAgIGZpbGVwYXRoID0gb3MucGF0aC5qb2luKHRhcmdldF9wYXRoLCAnaGVhZGVyLmpzb24nKQogICAgICAgIGpzb24uZHVtcChoZWFkZXIsIG9wZW4oZmlsZXBhdGgsICd3JykpCiAgICAgICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoJ2hlYWRlcicsIHRhcmdldF9wYXRoPWZpbGVwYXRoKQoK
    commands:
    - python -m pip uninstall mlrun
    - python -m pip install -U -q mlrun
    - python -m pip install -U -q pandas
    - python -m pip install -U -q pyarrow
    - python -m pip install -U -q numpy==1.17.4
    code_origin: https://github.com/yjb-ds/functions.git#db8da20c32124015e26f0b6b9911814493c5d5de:arc
      to parquet.ipynb
