# Copyright 2019 Iguazio
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
kind: job
metadata:
  name: feature-selection
  tag: ''
  hash: 2edce38d8b7359dc3bdab530dc1abb197335d33c
  project: ''
  labels:
    author: orz
  categories:
  - data-preparation
  - machine-learning
spec:
  command: ''
  args: []
  image: mlrun/ml-models
  env: []
  default_handler: feature_selection
  entry_points:
    show_values_on_bars:
      name: show_values_on_bars
      doc: ''
      parameters:
      - name: axs
        default: ''
      - name: h_v
        default: v
      - name: space
        default: 0.4
      outputs:
      - default: ''
      lineno: 28
    plot_stat:
      name: plot_stat
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: stat_name
        default: ''
      - name: stat_df
        default: ''
      outputs:
      - default: ''
      lineno: 50
    feature_selection:
      name: feature_selection
      doc: 'Applies selected feature selection statistical functions

        or models on our ''df_artifact''.


        Each statistical function or model will vote for it''s best K selected features.

        If a feature has >= ''min_votes'' votes, it will be selected.'
      parameters:
      - name: context
        doc: the function context.
        default: ''
      - name: df_artifact
        default: ''
      - name: k
        type: int
        doc: 'number of top features to select from each statistical function or model. '
        default: 5
      - name: min_votes
        type: float
        doc: 'minimal number of votes (from a model or by statistical function) needed
          for a feature to be selected. Can be specified by percentage of votes or
          absolute number of votes. '
        default: 0.5
      - name: label_column
        type: str
        doc: ground-truth (y) labels.
        default: null
      - name: stat_filters
        type: list
        doc: 'statistical functions to apply to the features (from sklearn.feature_selection). '
        default:
        - f_classif
        - mutual_info_classif
        - chi2
        - f_regression
      - name: model_filters
        type: dict
        doc: 'models to use for feature evaluation, can be specified by model name
          (ex. LinearSVC), formalized json (contains ''CLASS'', ''FIT'', ''META'')
          or a path to such json file. '
        default:
          LinearSVC: LinearSVC
          LogisticRegression: LogisticRegression
          ExtraTreesClassifier: ExtraTreesClassifier
      - name: max_scaled_scores
        type: bool
        doc: produce feature scores table scaled with max_scaler.
        default: true
      - name: sample_ratio
        type: float
        doc: percentage of the dataset the user whishes to compute the feature selection
          process on.
        default: null
      - name: output_vector_name
        type: float
        doc: creates a new feature vector containing only the identifies features.
        default: null
      - name: ignore_type_errors
        type: bool
        doc: skips datatypes that are neither float or int within the feature vector.
        default: false
      - name: is_feature_vector
        type: bool
        doc: bool stating if the data is passed as a feature vector.
        default: false
      outputs:
      - default: ''
      lineno: 74
  description: Select features through multiple Statistical and Model filters
  build:
    functionSourceCode: aW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgbWF0cGxvdGxpYi5weXBsb3QgYXMgcGx0CmltcG9ydCBtbHJ1bi5mZWF0dXJlX3N0b3JlIGFzIGZzCmltcG9ydCBzZWFib3JuIGFzIHNucwppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCBtbHJ1bgoKIyBGZWF0dXJlIHNlbGVjdGlvbiBzdHJhdGVnaWVzCmZyb20gc2tsZWFybi5mZWF0dXJlX3NlbGVjdGlvbiBpbXBvcnQgU2VsZWN0S0Jlc3QKZnJvbSBza2xlYXJuLmZlYXR1cmVfc2VsZWN0aW9uIGltcG9ydCBTZWxlY3RGcm9tTW9kZWwKZnJvbSBza2xlYXJuLmxpbmVhcl9tb2RlbCBpbXBvcnQgTG9naXN0aWNSZWdyZXNzaW9uCgojIFNjYWxlIGZlYXR1cmUgc2NvcmVzCmZyb20gc2tsZWFybi5wcmVwcm9jZXNzaW5nIGltcG9ydCBNaW5NYXhTY2FsZXIKCiMgU0tMZWFybiBlc3RpbWF0b3JzIGxpc3QKZnJvbSBza2xlYXJuLnV0aWxzIGltcG9ydCBhbGxfZXN0aW1hdG9ycwoKIyBNTFJ1biB1dGlscwpmcm9tIG1scnVuLm1sdXRpbHMucGxvdHMgaW1wb3J0IGdjZl9jbGVhcgpmcm9tIG1scnVuLnV0aWxzLmhlbHBlcnMgaW1wb3J0IGNyZWF0ZV9jbGFzcwpmcm9tIG1scnVuLmFydGlmYWN0cyBpbXBvcnQgUGxvdEFydGlmYWN0CmZyb20gbWxydW4uZGF0YXN0b3JlLnRhcmdldHMgaW1wb3J0IFBhcnF1ZXRUYXJnZXQKCgpkZWYgc2hvd192YWx1ZXNfb25fYmFycyhheHMsIGhfdj0idiIsIHNwYWNlPTAuNCk6CiAgICBkZWYgX3Nob3dfb25fc2luZ2xlX3Bsb3QoYXgpOgogICAgICAgIGlmIGhfdiA9PSAidiI6CiAgICAgICAgICAgIGZvciBwIGluIGF4LnBhdGNoZXM6CiAgICAgICAgICAgICAgICBfeCA9IHAuZ2V0X3goKSArIHAuZ2V0X3dpZHRoKCkgLyAyCiAgICAgICAgICAgICAgICBfeSA9IHAuZ2V0X3koKSArIHAuZ2V0X2hlaWdodCgpCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGludChwLmdldF9oZWlnaHQoKSkKICAgICAgICAgICAgICAgIGF4LnRleHQoX3gsIF95LCB2YWx1ZSwgaGE9ImNlbnRlciIpCiAgICAgICAgZWxpZiBoX3YgPT0gImgiOgogICAgICAgICAgICBmb3IgcCBpbiBheC5wYXRjaGVzOgogICAgICAgICAgICAgICAgX3ggPSBwLmdldF94KCkgKyBwLmdldF93aWR0aCgpICsgZmxvYXQoc3BhY2UpCiAgICAgICAgICAgICAgICBfeSA9IHAuZ2V0X3koKSArIHAuZ2V0X2hlaWdodCgpCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGludChwLmdldF93aWR0aCgpKQogICAgICAgICAgICAgICAgYXgudGV4dChfeCwgX3ksIHZhbHVlLCBoYT0ibGVmdCIpCgogICAgaWYgaXNpbnN0YW5jZShheHMsIG5wLm5kYXJyYXkpOgogICAgICAgIGZvciBpZHgsIGF4IGluIG5wLm5kZW51bWVyYXRlKGF4cyk6CiAgICAgICAgICAgIF9zaG93X29uX3NpbmdsZV9wbG90KGF4KQogICAgZWxzZToKICAgICAgICBfc2hvd19vbl9zaW5nbGVfcGxvdChheHMpCgoKZGVmIHBsb3Rfc3RhdChjb250ZXh0LAogICAgICAgICAgICAgIHN0YXRfbmFtZSwKICAgICAgICAgICAgICBzdGF0X2RmKToKICAgIGdjZl9jbGVhcihwbHQpCgogICAgIyBBZGQgY2hhcnQKICAgIGF4ID0gcGx0LmF4ZXMoKQogICAgc3RhdF9jaGFydCA9IHNucy5iYXJwbG90KHg9c3RhdF9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk9J2luZGV4JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhPXN0YXRfZGYuc29ydF92YWx1ZXMoc3RhdF9uYW1lLCBhc2NlbmRpbmc9RmFsc2UpLnJlc2V0X2luZGV4KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXg9YXgpCiAgICBwbHQudGlnaHRfbGF5b3V0KCkKCiAgICBmb3IgcCBpbiBzdGF0X2NoYXJ0LnBhdGNoZXM6CiAgICAgICAgd2lkdGggPSBwLmdldF93aWR0aCgpCiAgICAgICAgcGx0LnRleHQoNSArIHAuZ2V0X3dpZHRoKCksIHAuZ2V0X3koKSArIDAuNTUgKiBwLmdldF9oZWlnaHQoKSwKICAgICAgICAgICAgICAgICAnezoxLjJmfScuZm9ybWF0KHdpZHRoKSwKICAgICAgICAgICAgICAgICBoYT0nY2VudGVyJywgdmE9J2NlbnRlcicpCgogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoUGxvdEFydGlmYWN0KGYne3N0YXRfbmFtZX0nLCBib2R5PXBsdC5nY2YoKSksCiAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9wYXRoPW9zLnBhdGguam9pbigncGxvdHMnLCAnZmVhdHVyZV9zZWxlY3Rpb24nLCBmJ3tzdGF0X25hbWV9Lmh0bWwnKSkKICAgIGdjZl9jbGVhcihwbHQpCgoKZGVmIGZlYXR1cmVfc2VsZWN0aW9uKGNvbnRleHQsCiAgICAgICAgICAgICAgICAgICAgICBkZl9hcnRpZmFjdCwKICAgICAgICAgICAgICAgICAgICAgIGs6IGludCA9IDUsCiAgICAgICAgICAgICAgICAgICAgICBtaW5fdm90ZXM6IGZsb2F0ID0gMC41LAogICAgICAgICAgICAgICAgICAgICAgbGFiZWxfY29sdW1uOiBzdHIgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgc3RhdF9maWx0ZXJzOiBsaXN0ID0gWydmX2NsYXNzaWYnLCAnbXV0dWFsX2luZm9fY2xhc3NpZicsICdjaGkyJywgJ2ZfcmVncmVzc2lvbiddLAogICAgICAgICAgICAgICAgICAgICAgbW9kZWxfZmlsdGVyczogZGljdCA9IHsnTGluZWFyU1ZDJzogJ0xpbmVhclNWQycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdMb2dpc3RpY1JlZ3Jlc3Npb24nOiAnTG9naXN0aWNSZWdyZXNzaW9uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0V4dHJhVHJlZXNDbGFzc2lmaWVyJzogJ0V4dHJhVHJlZXNDbGFzc2lmaWVyJ30sCiAgICAgICAgICAgICAgICAgICAgICBtYXhfc2NhbGVkX3Njb3JlczogYm9vbCA9IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICBzYW1wbGVfcmF0aW86IGZsb2F0ID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgIG91dHB1dF92ZWN0b3JfbmFtZTogZmxvYXQgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgaWdub3JlX3R5cGVfZXJyb3JzOiBib29sID0gRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICBpc19mZWF0dXJlX3ZlY3RvcjogYm9vbCA9IEZhbHNlKToKICAgICIiIkFwcGxpZXMgc2VsZWN0ZWQgZmVhdHVyZSBzZWxlY3Rpb24gc3RhdGlzdGljYWwgZnVuY3Rpb25zCiAgICBvciBtb2RlbHMgb24gb3VyICdkZl9hcnRpZmFjdCcuCgogICAgRWFjaCBzdGF0aXN0aWNhbCBmdW5jdGlvbiBvciBtb2RlbCB3aWxsIHZvdGUgZm9yIGl0J3MgYmVzdCBLIHNlbGVjdGVkIGZlYXR1cmVzLgogICAgSWYgYSBmZWF0dXJlIGhhcyA+PSAnbWluX3ZvdGVzJyB2b3RlcywgaXQgd2lsbCBiZSBzZWxlY3RlZC4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgIHRoZSBmdW5jdGlvbiBjb250ZXh0LgogICAgCiAgICA6cGFyYW0gazogICAgICAgICAgICAgICAgIG51bWJlciBvZiB0b3AgZmVhdHVyZXMgdG8gc2VsZWN0IGZyb20gZWFjaCBzdGF0aXN0aWNhbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBvciBtb2RlbC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICA6cGFyYW0gbWluX3ZvdGVzOiAgICAgICAgIG1pbmltYWwgbnVtYmVyIG9mIHZvdGVzIChmcm9tIGEgbW9kZWwgb3IgYnkgc3RhdGlzdGljYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24pIG5lZWRlZCBmb3IgYSBmZWF0dXJlIHRvIGJlIHNlbGVjdGVkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYW4gYmUgc3BlY2lmaWVkIGJ5IHBlcmNlbnRhZ2Ugb2Ygdm90ZXMgb3IgYWJzb2x1dGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyIG9mIHZvdGVzLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgIDpwYXJhbSBsYWJlbF9jb2x1bW46ICAgICAgZ3JvdW5kLXRydXRoICh5KSBsYWJlbHMuCiAgICAKICAgIDpwYXJhbSBzdGF0X2ZpbHRlcnM6ICAgICAgc3RhdGlzdGljYWwgZnVuY3Rpb25zIHRvIGFwcGx5IHRvIHRoZSBmZWF0dXJlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZnJvbSBza2xlYXJuLmZlYXR1cmVfc2VsZWN0aW9uKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICA6cGFyYW0gbW9kZWxfZmlsdGVyczogICAgIG1vZGVscyB0byB1c2UgZm9yIGZlYXR1cmUgZXZhbHVhdGlvbiwgY2FuIGJlIHNwZWNpZmllZCBieQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbCBuYW1lIChleC4gTGluZWFyU1ZDKSwgZm9ybWFsaXplZCBqc29uIChjb250YWlucyAnQ0xBU1MnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRklUJywgJ01FVEEnKSBvciBhIHBhdGggdG8gc3VjaCBqc29uIGZpbGUuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgOnBhcmFtIG1heF9zY2FsZWRfc2NvcmVzOiBwcm9kdWNlIGZlYXR1cmUgc2NvcmVzIHRhYmxlIHNjYWxlZCB3aXRoIG1heF9zY2FsZXIuCgogICAgOnBhcmFtIHNhbXBsZV9yYXRpbzogcGVyY2VudGFnZSBvZiB0aGUgZGF0YXNldCB0aGUgdXNlciB3aGlzaGVzIHRvIGNvbXB1dGUgdGhlIGZlYXR1cmUgc2VsZWN0aW9uIHByb2Nlc3Mgb24uCiAgICAKICAgIDpwYXJhbSBvdXRwdXRfdmVjdG9yX25hbWU6IGNyZWF0ZXMgYSBuZXcgZmVhdHVyZSB2ZWN0b3IgY29udGFpbmluZyBvbmx5IHRoZSBpZGVudGlmaWVzIGZlYXR1cmVzLgogICAgCiAgICA6cGFyYW0gaWdub3JlX3R5cGVfZXJyb3JzOiBza2lwcyBkYXRhdHlwZXMgdGhhdCBhcmUgbmVpdGhlciBmbG9hdCBvciBpbnQgd2l0aGluIHRoZSBmZWF0dXJlIHZlY3Rvci4KICAgIAogICAgOnBhcmFtIGlzX2ZlYXR1cmVfdmVjdG9yOiBib29sIHN0YXRpbmcgaWYgdGhlIGRhdGEgaXMgcGFzc2VkIGFzIGEgZmVhdHVyZSB2ZWN0b3IuCiAgICAiIiIKCiAgICAjIENoZWNrIGlmIGRmLm1ldGEgaXMgdmFsaWQsIGlmIGl0IGlzLCBsb29rIGZvciBhIGZlYXR1cmUgdmVjdG9yCiAgICBpZiBkZl9hcnRpZmFjdC5tZXRhOgogICAgICAgIGlmIGRmX2FydGlmYWN0Lm1ldGEua2luZCA9PSBtbHJ1bi5hcGkuc2NoZW1hcy5PYmplY3RLaW5kLmZlYXR1cmVfdmVjdG9yOgogICAgICAgICAgICBpc19mZWF0dXJlX3ZlY3RvciA9IFRydWUKCiAgICAjIExvb2sgaW5zaWRlIG1ldGEuc3BlYy5sYWJlbF9mZWF0dXJlIHRvIGlkZW50aWZ5IHRoZSBsYWJlbF9jb2x1bW4gaWYgdGhlIHVzZXIgZGlkIG5vdCBzcGVjaWZ5IGl0CiAgICBpZiBsYWJlbF9jb2x1bW4gaXMgTm9uZToKICAgICAgICBpZiBpc19mZWF0dXJlX3ZlY3RvcjoKICAgICAgICAgICAgbGFiZWxfY29sdW1uID0gZGZfYXJ0aWZhY3QubWV0YS5zcGVjLmxhYmVsX2ZlYXR1cmUuc3BsaXQoJy4nKVsxXQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ05vIGxhYmVsX2NvbHVtbiB3YXMgZ2l2ZW4sIHBsZWFzZSBhZGQgYSBsYWJlbF9jb2x1bW4uJykKCiAgICAjIFVzZSB0aGUgZmVhdHVyZSB2ZWN0b3IgYXMgZGF0YWZyYW1lCiAgICBkZiA9IGRmX2FydGlmYWN0LmFzX2RmKCkKCiAgICAjIEVuc3VyZSBrIGlzIG5vdCBiaWdnZXIgdGhhbiB0aGUgdGhlIHRvdGFsIG51bWJlciBvZiBmZWF0dXJlcwogICAgaWYgayA+IGRmLnNoYXBlWzFdOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCiAgICAgICAgICAgIGYnSyBjYW5ub3QgYmUgYmlnZ2VyIHRoYW4gdGhlIHRvdGFsIG51bWJlciBvZiBmZWF0dXJlcyAoe2RmLnNoYXBlWzFdfSkuIFBsZWFzZSBjaG9vc2UgYSBzbWFsbGVyIEsuJykKICAgIGVsaWYgayA8IDE6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmJ0sgY2Fubm90IGJlIHNtYWxsZXIgdGhhbiAxLiBQbGVhc2UgY2hvb3NlIGEgYmlnZ2VyIEsuJykKCiAgICAjIENyZWF0ZSBhIHNhbXBsZSBkYXRhZnJhbWUgb2YgdGhlIG9yaWdpbmFsIGZlYXR1cmUgdmVjdG9yCiAgICBpZiBzYW1wbGVfcmF0aW86CiAgICAgICAgZGYgPSBkZi5ncm91cGJ5KGxhYmVsX2NvbHVtbikuYXBwbHkobGFtYmRhIHg6IHguc2FtcGxlKGZyYWM9c2FtcGxlX3JhdGlvKSkucmVzZXRfaW5kZXgoZHJvcD1UcnVlKQogICAgICAgIGRmID0gZGYuZHJvcG5hKCkKCiAgICAjIFNldCBmZWF0dXJlIHZlY3RvciBhbmQgbGFiZWxzCiAgICB5ID0gZGYucG9wKGxhYmVsX2NvbHVtbikKICAgIFggPSBkZgoKICAgIGlmIG5wLm9iamVjdCBpbiBsaXN0KFguZHR5cGVzKSBhbmQgaWdub3JlX3R5cGVfZXJyb3JzIGlzIEZhbHNlOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoZiJ7ZGYuc2VsZWN0X2R0eXBlcyhpbmNsdWRlPVsnb2JqZWN0J10pLmNvbHVtbnMudG9saXN0KCl9IGFyZSBuZWl0aGVyIGZsb2F0IG9yIGludC4iKQoKICAgICMgQ3JlYXRlIHNlbGVjdGVkIHN0YXRpc3RpY2FsIGVzdGltYXRvcnMKICAgIHN0YXRfZnVuY3Rpb25zX2xpc3QgPSB7CiAgICAgICAgc3RhdF9uYW1lOiBTZWxlY3RLQmVzdChzY29yZV9mdW5jPWNyZWF0ZV9jbGFzcyhmJ3NrbGVhcm4uZmVhdHVyZV9zZWxlY3Rpb24ue3N0YXRfbmFtZX0nKSwgaz1rKQogICAgICAgIGZvciBzdGF0X25hbWUgaW4gc3RhdF9maWx0ZXJzfQogICAgcmVxdWlyZXNfYWJzID0gWydjaGkyJ10KCiAgICAjIFJ1biBzdGF0aXN0aWMgZmlsdGVycwogICAgc2VsZWN0ZWRfZmVhdHVyZXNfYWdnID0ge30KICAgIHN0YXRzX2RmID0gcGQuRGF0YUZyYW1lKGluZGV4PVguY29sdW1ucykuZHJvcG5hKCkKCiAgICBmb3Igc3RhdF9uYW1lLCBzdGF0X2Z1bmMgaW4gc3RhdF9mdW5jdGlvbnNfbGlzdC5pdGVtcygpOgogICAgICAgIHRyeToKICAgICAgICAgICAgcGFyYW1zID0gKFgsIHkpIGlmIHN0YXRfbmFtZSBpbiByZXF1aXJlc19hYnMgZWxzZSAoYWJzKFgpLCB5KQogICAgICAgICAgICBzdGF0ID0gc3RhdF9mdW5jLmZpdCgqcGFyYW1zKQoKICAgICAgICAgICAgIyBDb2xsZWN0IHN0YXQgZnVuY3Rpb24gcmVzdWx0cwogICAgICAgICAgICBzdGF0X2RmID0gcGQuRGF0YUZyYW1lKGluZGV4PVguY29sdW1ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5zPVtzdGF0X25hbWVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE9c3RhdC5zY29yZXNfKQogICAgICAgICAgICBwbG90X3N0YXQoY29udGV4dCwgc3RhdF9uYW1lLCBzdGF0X2RmKQogICAgICAgICAgICBzdGF0c19kZiA9IHN0YXRzX2RmLmpvaW4oc3RhdF9kZikKCiAgICAgICAgICAgICMgU2VsZWN0IEsgQmVzdCBmZWF0dXJlcwogICAgICAgICAgICBzZWxlY3RlZF9mZWF0dXJlcyA9IFguY29sdW1uc1tzdGF0X2Z1bmMuZ2V0X3N1cHBvcnQoKV0KICAgICAgICAgICAgc2VsZWN0ZWRfZmVhdHVyZXNfYWdnW3N0YXRfbmFtZV0gPSBzZWxlY3RlZF9mZWF0dXJlcwoKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJDb3VsZG4ndCBjYWxjdWxhdGUge3N0YXRfbmFtZX0gYmVjYXVzZSBvZjoge2V9IikKCiAgICAjIENyZWF0ZSBtb2RlbHMgZnJvbSBjbGFzcyBuYW1lIC8ganNvbiBmaWxlIC8ganNvbiBwYXJhbXMKICAgIGFsbF9za2xlYXJuX2VzdGltYXRvcnMgPSBkaWN0KGFsbF9lc3RpbWF0b3JzKCkpIGlmIGxlbihtb2RlbF9maWx0ZXJzKSA+IDAgZWxzZSB7fQogICAgc2VsZWN0ZWRfbW9kZWxzID0ge30KICAgIGZvciBtb2RlbF9uYW1lLCBtb2RlbCBpbiBtb2RlbF9maWx0ZXJzLml0ZW1zKCk6CiAgICAgICAgaWYgJy5qc29uJyBpbiBtb2RlbDoKICAgICAgICAgICAgY3VycmVudF9tb2RlbCA9IGpzb24ubG9hZChvcGVuKG1vZGVsLCAncicpKQogICAgICAgICAgICBDbGFzc2lmaWVyQ2xhc3MgPSBjcmVhdGVfY2xhc3MoY3VycmVudF9tb2RlbFsiTUVUQSJdWyJjbGFzcyJdKQogICAgICAgICAgICBzZWxlY3RlZF9tb2RlbHNbbW9kZWxfbmFtZV0gPSBDbGFzc2lmaWVyQ2xhc3MoKipjdXJyZW50X21vZGVsWyJDTEFTUyJdKQogICAgICAgIGVsaWYgbW9kZWwgaW4gYWxsX3NrbGVhcm5fZXN0aW1hdG9yczoKICAgICAgICAgICAgc2VsZWN0ZWRfbW9kZWxzW21vZGVsX25hbWVdID0gYWxsX3NrbGVhcm5fZXN0aW1hdG9yc1ttb2RlbF9uYW1lXSgpCgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGN1cnJlbnRfbW9kZWwgPSBqc29uLmxvYWRzKG1vZGVsKSBpZiBpc2luc3RhbmNlKG1vZGVsLCBzdHIpIGVsc2UgY3VycmVudF9tb2RlbAogICAgICAgICAgICAgICAgQ2xhc3NpZmllckNsYXNzID0gY3JlYXRlX2NsYXNzKGN1cnJlbnRfbW9kZWxbIk1FVEEiXVsiY2xhc3MiXSkKICAgICAgICAgICAgICAgIHNlbGVjdGVkX21vZGVsc1ttb2RlbF9uYW1lXSA9IENsYXNzaWZpZXJDbGFzcygqKmN1cnJlbnRfbW9kZWxbIkNMQVNTIl0pCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZid1bmFibGUgdG8gbG9hZCB7bW9kZWx9JykKCiAgICAjIFJ1biBtb2RlbCBmaWx0ZXJzCiAgICBtb2RlbHNfZGYgPSBwZC5EYXRhRnJhbWUoaW5kZXg9WC5jb2x1bW5zKQogICAgZm9yIG1vZGVsX25hbWUsIG1vZGVsIGluIHNlbGVjdGVkX21vZGVscy5pdGVtcygpOgoKICAgICAgICBpZiBtb2RlbF9uYW1lID09ICdMb2dpc3RpY1JlZ3Jlc3Npb24nOgogICAgICAgICAgICBtb2RlbC5zZXRfcGFyYW1zKHNvbHZlcj0nbGlibGluZWFyJykKCiAgICAgICAgIyBUcmFpbiBtb2RlbCBhbmQgZ2V0IGZlYXR1cmUgaW1wb3J0YW5jZQogICAgICAgIHNlbGVjdF9mcm9tX21vZGVsID0gU2VsZWN0RnJvbU1vZGVsKG1vZGVsKS5maXQoWCwgeSkKICAgICAgICBmZWF0dXJlX2lkeCA9IHNlbGVjdF9mcm9tX21vZGVsLmdldF9zdXBwb3J0KCkKICAgICAgICBmZWF0dXJlX25hbWVzID0gWC5jb2x1bW5zW2ZlYXR1cmVfaWR4XQogICAgICAgIHNlbGVjdGVkX2ZlYXR1cmVzX2FnZ1ttb2RlbF9uYW1lXSA9IGZlYXR1cmVfbmFtZXMudG9saXN0KCkKCiAgICAgICAgIyBDb2xsZWN0IG1vZGVsIGZlYXR1cmUgaW1wb3J0YW5jZQogICAgICAgIGlmIGhhc2F0dHIoc2VsZWN0X2Zyb21fbW9kZWwuZXN0aW1hdG9yXywgJ2NvZWZfJyk6CiAgICAgICAgICAgIHN0YXRfZGYgPSBzZWxlY3RfZnJvbV9tb2RlbC5lc3RpbWF0b3JfLmNvZWZfCiAgICAgICAgZWxpZiBoYXNhdHRyKHNlbGVjdF9mcm9tX21vZGVsLmVzdGltYXRvcl8sICdmZWF0dXJlX2ltcG9ydGFuY2VzXycpOgogICAgICAgICAgICBzdGF0X2RmID0gc2VsZWN0X2Zyb21fbW9kZWwuZXN0aW1hdG9yXy5mZWF0dXJlX2ltcG9ydGFuY2VzXwoKICAgICAgICBzdGF0X2RmID0gcGQuRGF0YUZyYW1lKGluZGV4PVguY29sdW1ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbnM9W21vZGVsX25hbWVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YT1zdGF0X2RmWzBdKQogICAgICAgIG1vZGVsc19kZiA9IG1vZGVsc19kZi5qb2luKHN0YXRfZGYpCgogICAgICAgIHBsb3Rfc3RhdChjb250ZXh0LCBtb2RlbF9uYW1lLCBzdGF0X2RmKQoKICAgICMgQ3JlYXRlIGZlYXR1cmVfc2NvcmVzIERGIHdpdGggc3RhdCAmIG1vZGVsIGZpbHRlcnMgc2NvcmVzCiAgICByZXN1bHRfbWF0cml4X2RmID0gcGQuY29uY2F0KFtzdGF0c19kZiwgbW9kZWxzX2RmXSwgYXhpcz0xLCBzb3J0PUZhbHNlKQogICAgY29udGV4dC5sb2dfZGF0YXNldChrZXk9J2ZlYXR1cmVfc2NvcmVzJywKICAgICAgICAgICAgICAgICAgICAgICAgZGY9cmVzdWx0X21hdHJpeF9kZiwKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfcGF0aD0nZmVhdHVyZV9zY29yZXMucGFycXVldCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdD0ncGFycXVldCcpCiAgICBpZiBtYXhfc2NhbGVkX3Njb3JlczoKICAgICAgICBub3JtYWxpemVkX2RmID0gcmVzdWx0X21hdHJpeF9kZi5yZXBsYWNlKFtucC5pbmYsIC1ucC5pbmZdLCBucC5uYW4pLnZhbHVlcwogICAgICAgIG1pbl9tYXhfc2NhbGVyID0gTWluTWF4U2NhbGVyKCkKICAgICAgICBub3JtYWxpemVkX2RmID0gbWluX21heF9zY2FsZXIuZml0X3RyYW5zZm9ybShub3JtYWxpemVkX2RmKQogICAgICAgIG5vcm1hbGl6ZWRfZGYgPSBwZC5EYXRhRnJhbWUoZGF0YT1ub3JtYWxpemVkX2RmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1ucz1yZXN1bHRfbWF0cml4X2RmLmNvbHVtbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleD1yZXN1bHRfbWF0cml4X2RmLmluZGV4KQogICAgICAgIGNvbnRleHQubG9nX2RhdGFzZXQoa2V5PSdtYXhfc2NhbGVkX3Njb3Jlc19mZWF0dXJlX3Njb3JlcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZj1ub3JtYWxpemVkX2RmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfcGF0aD0nbWF4X3NjYWxlZF9zY29yZXNfZmVhdHVyZV9zY29yZXMucGFycXVldCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ9J3BhcnF1ZXQnKQoKICAgICMgQ3JlYXRlIGZlYXR1cmUgY291bnQgRGF0YUZyYW1lCiAgICBmb3IgdGVzdF9uYW1lIGluIHNlbGVjdGVkX2ZlYXR1cmVzX2FnZzoKICAgICAgICByZXN1bHRfbWF0cml4X2RmW3Rlc3RfbmFtZV0gPSBbMSBpZiB4IGluIHNlbGVjdGVkX2ZlYXR1cmVzX2FnZ1t0ZXN0X25hbWVdIGVsc2UgMCBmb3IgeCBpbiBYLmNvbHVtbnNdCiAgICByZXN1bHRfbWF0cml4X2RmLmxvY1s6LCAnbnVtX3ZvdGVzJ10gPSByZXN1bHRfbWF0cml4X2RmLnN1bShheGlzPTEpCiAgICBjb250ZXh0LmxvZ19kYXRhc2V0KGtleT0nc2VsZWN0ZWRfZmVhdHVyZXNfY291bnQnLAogICAgICAgICAgICAgICAgICAgICAgICBkZj1yZXN1bHRfbWF0cml4X2RmLAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9wYXRoPSdzZWxlY3RlZF9mZWF0dXJlc19jb3VudC5wYXJxdWV0JywKICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0PSdwYXJxdWV0JykKCiAgICAjIEhvdyBtYW55IHZvdGVzIGFyZSBuZWVkZWQgZm9yIGEgZmVhdHVyZSB0byBiZSBzZWxlY3RlZD8KICAgIGlmIGlzaW5zdGFuY2UobWluX3ZvdGVzLCBpbnQpOgogICAgICAgIHZvdGVzX25lZWRlZCA9IG1pbl92b3RlcwogICAgZWxzZToKICAgICAgICBudW1fZmlsdGVycyA9IGxlbihzdGF0X2ZpbHRlcnMpICsgbGVuKG1vZGVsX2ZpbHRlcnMpCiAgICAgICAgdm90ZXNfbmVlZGVkID0gaW50KG5wLmZsb29yKG51bV9maWx0ZXJzICogbWF4KG1pbihtaW5fdm90ZXMsIDEpLCAwKSkpCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYndm90ZXMgbmVlZGVkIHRvIGJlIHNlbGVjdGVkOiB7dm90ZXNfbmVlZGVkfScpCgogICAgIyBDcmVhdGUgZmluYWwgZmVhdHVyZSBkYXRhZnJhbWUKICAgIHNlbGVjdGVkX2ZlYXR1cmVzID0gcmVzdWx0X21hdHJpeF9kZltyZXN1bHRfbWF0cml4X2RmLm51bV92b3RlcyA+PSB2b3Rlc19uZWVkZWRdLmluZGV4LnRvbGlzdCgpCiAgICBnb29kX2ZlYXR1cmVfZGYgPSBkZi5sb2NbOiwgc2VsZWN0ZWRfZmVhdHVyZXNdCiAgICBmaW5hbF9kZiA9IHBkLmNvbmNhdChbZ29vZF9mZWF0dXJlX2RmLCB5XSwgYXhpcz0xKQogICAgY29udGV4dC5sb2dfZGF0YXNldChrZXk9J3NlbGVjdGVkX2ZlYXR1cmVzJywKICAgICAgICAgICAgICAgICAgICAgICAgZGY9ZmluYWxfZGYsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX3BhdGg9J3NlbGVjdGVkX2ZlYXR1cmVzLnBhcnF1ZXQnLAogICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ9J3BhcnF1ZXQnKQoKICAgICMgQ3JlYXRpbmcgYSBuZXcgZmVhdHVyZSB2ZWN0b3IgY29udGFpbmluZyBvbmx5IHRoZSBpZGVudGlmaWVkIHRvcCBmZWF0dXJlcwogICAgaWYgaXNfZmVhdHVyZV92ZWN0b3IgYW5kIGRmX2FydGlmYWN0Lm1ldGEuc3BlYy5mZWF0dXJlcyBhbmQgb3V0cHV0X3ZlY3Rvcl9uYW1lOgogICAgICAgICMgU2VsZWN0aW5nIHRoZSB0b3AgSyBmZWF0dXJlcyBmcm9tIG91ciB0b3AgZmVhdHVyZSBkYXRhZnJhbWUKICAgICAgICBzZWxlY3RlZF9mZWF0dXJlcyA9IHJlc3VsdF9tYXRyaXhfZGYuaGVhZChrKS5pbmRleAoKICAgICAgICAjIE1hdGNoIHRoZSBzZWxlY3RlZCBmZWF0dXJlIG5hbWVzIHRvIHRoZSBGUyBGZWF0dXJlIGFubm90YXRpb25zCiAgICAgICAgbWF0Y2hlZF9zZWxlY3Rpb25zID0gW2ZlYXR1cmUgZm9yIGZlYXR1cmUgaW4gbGlzdChkZl9hcnRpZmFjdC5tZXRhLnNwZWMuZmVhdHVyZXMpIGZvciBzZWxlY3RlZCBpbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0KHNlbGVjdGVkX2ZlYXR1cmVzKSBpZiBmZWF0dXJlLmVuZHN3aXRoKHNlbGVjdGVkKV0KCiAgICAgICAgIyBEZWZpbmluZyBvdXIgbmV3IGZlYXR1cmUgdmVjdG9yCiAgICAgICAgdG9wX2ZlYXR1cmVzX2Z2ID0gZnMuRmVhdHVyZVZlY3RvcihvdXRwdXRfdmVjdG9yX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVkX3NlbGVjdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9mZWF0dXJlPSJsYWJlbHMubGFiZWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb249J2ZlYXR1cmUgdmVjdG9yIGNvbXBvc2VkIHN0cmljdGx5IG9mIG91ciB0b3AgZmVhdHVyZXMnKQoKICAgICAgICAjIFNhdmluZwogICAgICAgIHRvcF9mZWF0dXJlc19mdi5zYXZlKCkKICAgICAgICBmcy5nZXRfb2ZmbGluZV9mZWF0dXJlcyh0b3BfZmVhdHVyZXNfZnYsIHRhcmdldD1QYXJxdWV0VGFyZ2V0KCkpCgogICAgICAgICMgTG9nZ2luZyBvdXIgbmV3IGZlYXR1cmUgdmVjdG9yIFVSSQogICAgICAgIGNvbnRleHQubG9nX3Jlc3VsdCgndG9wX2ZlYXR1cmVzX3ZlY3RvcicsIHRvcF9mZWF0dXJlc19mdi51cmkpCg==
    commands: []
    code_origin: https://github.com/aviaIguazio/functions.git#a362fc7df970c9e91b046a9b4932567f91a2712b:/Users/aviasulin/PycharmProjects/mlrun/functions/feature_selection/feature_selection.py
    origin_filename: /Users/aviasulin/PycharmProjects/mlrun/functions/feature_selection/feature_selection.py
  disable_auto_mount: false
  priority_class_name: ''
  affinity: null
verbose: false
