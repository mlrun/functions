kind: job
metadata:
  name: question-answering
  tag: ''
  hash: d6d333441278ae474cf2b79b90d74cb78f120a2f
  project: ''
  labels:
    author: yonish
  categories:
  - machine-learning
spec:
  command: ''
  args: []
  image: ''
  build:
    functionSourceCode: IyBDb3B5cmlnaHQgMjAxOSBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiMKIyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiMgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKIyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KIyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiMgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiMKaW1wb3J0IG9zCmltcG9ydCBwYXRobGliCmZyb20gdHlwaW5nIGltcG9ydCBMaXN0LCBUdXBsZQoKaW1wb3J0IG1scnVuCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IHRyYW5zZm9ybWVycwpmcm9tIGFiYyBpbXBvcnQgQUJDLCBhYnN0cmFjdG1ldGhvZApmcm9tIGxhbmdjaGFpbi5jaGF0X21vZGVscyBpbXBvcnQgQ2hhdE9wZW5BSQpmcm9tIHRxZG0uYXV0byBpbXBvcnQgdHFkbQoKCmRlZiBhbnN3ZXJfcXVlc3Rpb25zKAogICAgY29udGV4dDogbWxydW4uTUxDbGllbnRDdHgsCiAgICBpbnB1dF9wYXRoOiBzdHIsCiAgICBtb2RlbDogc3RyLAogICAgcXVlc3Rpb25zOiBMaXN0W3N0cl0sCiAgICB0b2tlbml6ZXI6IHN0ciA9IE5vbmUsCiAgICBtb2RlbF9rd2FyZ3M6IGRpY3QgPSBOb25lLAogICAgdGV4dF93cmFwcGVyOiBzdHIgPSAiIiwKICAgIHF1ZXN0aW9uc193cmFwcGVyOiBzdHIgPSAiIiwKICAgIGFuc3dlcl9wcmVhbWJsZTogc3RyID0gIiIsCiAgICBnZW5lcmF0aW9uX2NvbmZpZzogZGljdCA9IE5vbmUsCiAgICBxdWVzdGlvbnNfY29sdW1uczogTGlzdFtzdHJdID0gTm9uZSwKICAgIG1vZGVsX2Fuc3dlcmluZ190cnlvdXRzOiBpbnQgPSAyLAogICAgbGxtX3NvdXJjZTogc3RyID0gImxvY2FsIiwKICAgIHdpdGhfaW5kZXhlZF9saXN0X3N0YXJ0OiBib29sID0gVHJ1ZSwKKSAtPiBUdXBsZVtwZC5EYXRhRnJhbWUsIGRpY3RdOgogICAgIiIiCiAgICBBbnN3ZXIgcXVlc3Rpb25zIHdpdGggY29udGV4dCB0byB0aGUgZ2l2ZW4gdGV4dCBmaWxlcyBieSBhIHByZXRyYWluZWQgTExNIG1vZGVsLgoKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgICAgICAgICAgTUxSdW4gY29udGV4dC4KICAgIDpwYXJhbSBpbnB1dF9wYXRoOiAgICAgICAgICAgICAgQSBwYXRoIHRvIGEgZGlyZWN0b3J5IG9mIHRleHQgZmlsZXMgb3IgYSBwYXRoIHRvIGEgdGV4dCBmaWxlIHRvIGFzayBxdWVzdGlvbnMgYWJvdXQuCiAgICA6cGFyYW0gbW9kZWw6ICAgICAgICAgICAgICAgICAgIFRoZSBwcmUtdHJhaW5lZCBtb2RlbCB0byB1c2UgZm9yIGFza2luZyBxdWVzdGlvbnMuCiAgICA6cGFyYW0gcXVlc3Rpb25zOiAgICAgICAgICAgICAgIFRoZSBxdWVzdGlvbnMgdG8gYXNrLgogICAgOnBhcmFtIHRva2VuaXplcjogICAgICAgICAgICAgICBUaGUgcHJlLXRyYWluZWQgdG9rZW5pemVyIHRvIHVzZS4gRGVmYXVsdGVkIHRvIHRoZSBtb2RlbCBnaXZlbi4KICAgIDpwYXJhbSBtb2RlbF9rd2FyZ3M6ICAgICAgICAgICAgS2V5d29yZCBhcmd1bWVudHMgdG8gcGFzcyByZWdhcmRpbmcgdGhlIGxvYWRpbmcgb2YgdGhlIG1vZGVsIGluIEh1Z2dpbmdGYWNlJ3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYHBpcGVsaW5lYCBmdW5jdGlvbi4KICAgIDpwYXJhbSB0ZXh0X3dyYXBwZXI6ICAgICAgICAgICAgQSB3cmFwcGVyIGZvciB0aGUgdGV4dCBwYXJ0LiBXaWxsIGJlIGFkZGVkIGF0IHRoZSBzdGFydCBvZiB0aGUgcHJvbXB0LiBNdXN0IGhhdmUgYQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlciAoJ3t9JykgZm9yIHRoZSBxdWVzdGlvbnMuCiAgICA6cGFyYW0gcXVlc3Rpb25zX3dyYXBwZXI6ICAgICAgIEEgd3JhcHBlciBmb3IgdGhlIHF1ZXN0aW9ucyByZWNlaXZlZC4gV2lsbCBiZSBhZGRlZCBhZnRlciB0aGUgdGV4dCBwbGFjZWhvbGRlciBpbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgcHJvbXB0IHRlbXBsYXRlLiBNdXN0IGhhdmUgYSBwbGFjZWhvbGRlciAoJ3t9JykgZm9yIHRoZSBxdWVzdGlvbnMuCiAgICA6cGFyYW0gYW5zd2VyX3ByZWFtYmxlOiAgICAgICAgIEEgcHJlZml4IGZvciB0aGUgYW5zd2VyIHBhcnQuIFdpbGwgYmUgYWRkZWQgYXQgdGhlIGVuZCBvZiB0aGUgcHJvbXB0IHRlbXBsYXRlLgogICAgOnBhcmFtIGdlbmVyYXRpb25fY29uZmlnOiAgICAgICBIdWdnaW5nRmFjZSdzIGBHZW5lcmF0aW9uQ29uZmlnYCBrZXl3b3JkIGFyZ3VtZW50cyB0byBwYXNzIHRvIHRoZSBgZ2VuZXJhdGVgIG1ldGhvZC4KICAgIDpwYXJhbSBxdWVzdGlvbnNfY29sdW1uczogICAgICAgQ29sdW1ucyB0byB1c2UgZm9yIHRoZSBkYXRhZnJhbWUgcmV0dXJuZWQuCiAgICA6cGFyYW0gbW9kZWxfYW5zd2VyaW5nX3RyeW91dHM6IEFtb3VudCBvZiBpbmZlcnJpbmcgdG8gZG8gcGVyIHRleHQgYmVmb3JlIHJhaXNpbmcgYW4gZXJyb3IgZHVlIHRvIG1pc3Npbmcgb3IgZW1wdHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5zd2Vycy4KICAgIDpwYXJhbSBsbG1fc291cmNlOiAgICAgICAgICAgICAgSW5kaWNhdGVzIHdoaWNoIG1vZGVsIHRvIHVzZQogICAgOnBhcmFtIHdpdGhfaW5kZXhlZF9saXN0X3N0YXJ0OiBXaGV0aGVyIHRvIGFkZCBhICcxLiAnIGluIHRoZSBlbmQgb2YgdGhlIHByb21wdC4KCiAgICA6cmV0dXJuczogQSB0dXBsZSBvZjoKCiAgICAgICAgICAgICAgKiBBIGRhdGFmcmFtZSBkYXRhc2V0IG9mIHRoZSBxdWVzdGlvbnMgYW5zd2Vycy4KICAgICAgICAgICAgICAqIEEgZGljdGlvbmFyeSBvZiBlcnJvcmVkIGZpbGVzIHRoYXQgd2VyZSBub3QgaW5mZXJyZWQgb3Igd2VyZSBub3QgYW5zd2VyZWQgcHJvcGVybHkuCiAgICAiIiIKICAgICMgR2V0IHRoZSBwcm9tcHQgdGVtcGxhdGU6CiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCJDcmVhdGluZyBwcm9tcHQgdGVtcGxhdGUiKQogICAgcHJvbXB0X3RlbXBsYXRlLCBhbnN3ZXJfcHJlYW1ibGUgPSBfZ2V0X3Byb21wdF90ZW1wbGF0ZSgKICAgICAgICB0ZXh0X3dyYXBwZXI9dGV4dF93cmFwcGVyLAogICAgICAgIHF1ZXN0aW9uc193cmFwcGVyPXF1ZXN0aW9uc193cmFwcGVyLAogICAgICAgIHF1ZXN0aW9ucz1xdWVzdGlvbnMsCiAgICAgICAgYW5zd2VyX3ByZWFtYmxlPWFuc3dlcl9wcmVhbWJsZSwKICAgICAgICB3aXRoX2luZGV4ZWRfbGlzdF9zdGFydD13aXRoX2luZGV4ZWRfbGlzdF9zdGFydCwKICAgICkKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJQcm9tcHQgdGVtcGxhdGUgY3JlYXRlZDpcblxue3Byb21wdF90ZW1wbGF0ZX1cbiIpCgogICAgIyBHZXQgdGhlIHF1ZXN0aW9ucyBjb2x1bW5zOgogICAgcXVlc3Rpb25zX2NvbHVtbnMgPSBxdWVzdGlvbnNfY29sdW1ucyBvciBbCiAgICAgICAgZiJxe2l9IiBmb3IgaSBpbiByYW5nZSgxLCBsZW4ocXVlc3Rpb25zKSArIDEpCiAgICBdCiAgICBpZiBsZW4ocXVlc3Rpb25zX2NvbHVtbnMpICE9IGxlbihxdWVzdGlvbnMpOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCiAgICAgICAgICAgIGYiVGhlIHByb3ZpZGVkIHF1ZXN0aW9ucyBjb2x1bW5zIGxlbmd0aCAoe2xlbihxdWVzdGlvbnNfY29sdW1ucyl9KSAiCiAgICAgICAgICAgIGYiZG9lcyBub3QgbWF0Y2ggdGhlIHF1ZXN0aW9ucyBhbW91bnQgKHtsZW4ocXVlc3Rpb25zKX0pIgogICAgICAgICkKCiAgICAjIFByZXBhcmUgdGhlIGRhdGFmcmFtZSBhbmQgZXJyb3JzIHRvIGJlIHJldHVybmVkOgogICAgZGYgPSBwZC5EYXRhRnJhbWUoY29sdW1ucz1bInRleHRfZmlsZSIsICpxdWVzdGlvbnNfY29sdW1uc10pCiAgICBlcnJvcnMgPSB7fQoKICAgIGxsbSA9IF9nZXRfbW9kZWwoCiAgICAgICAgY29udGV4dD1jb250ZXh0LAogICAgICAgIGxsbV9zb3VyY2U9bGxtX3NvdXJjZSwKICAgICAgICBtb2RlbD1tb2RlbCwKICAgICAgICB0b2tlbml6ZXI9dG9rZW5pemVyLAogICAgICAgIG1vZGVsX2t3YXJncz1tb2RlbF9rd2FyZ3MsCiAgICAgICAgZ2VuZXJhdGlvbl9jb25maWc9Z2VuZXJhdGlvbl9jb25maWcsCiAgICAgICAgYW5zd2VyX3ByZWFtYmxlPWFuc3dlcl9wcmVhbWJsZSwKICAgICkKCiAgICAjIEdvIG92ZXIgdGhlIGF1ZGlvIGZpbGVzIGFuZCBpbmZlciB0aHJvdWdoIHRoZSBtb2RlbDoKICAgIGlmIHBhdGhsaWIuUGF0aChpbnB1dF9wYXRoKS5pc19maWxlKCk6CiAgICAgICAgaW5wdXRfcGF0aCA9IFtpbnB1dF9wYXRoXQogICAgZWxzZToKICAgICAgICB0ZXh0X2ZpbGVzX2RpcmVjdG9yeSA9IHBhdGhsaWIuUGF0aChpbnB1dF9wYXRoKS5hYnNvbHV0ZSgpCiAgICAgICAgaW5wdXRfcGF0aCA9IGxpc3QodGV4dF9maWxlc19kaXJlY3Rvcnkucmdsb2IoIiouKiIpKQoKICAgIGZvciBpLCB0ZXh0X2ZpbGUgaW4gZW51bWVyYXRlKAogICAgICAgIHRxZG0oaW5wdXRfcGF0aCwgZGVzYz0iR2VuZXJhdGluZyBhbnN3ZXJzIiwgdW5pdD0iZmlsZSIpCiAgICApOgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBSZWFkIHRoZSB0ZXh0OgogICAgICAgICAgICB3aXRoIG9wZW4odGV4dF9maWxlLCAiciIpIGFzIGZwOgogICAgICAgICAgICAgICAgdGV4dCA9IGZwLnJlYWQoKQogICAgICAgICAgICAjIEZvciBlYWNoIHRleHQsIHRyeSBtdWx0aXBsZSB0aW1lcyBhcyB0aGUgbGxtIG1pZ2h0IGV4cGVyaWVuY2UgemVybyBhbnN3ZXJzOgogICAgICAgICAgICB0cnlvdXQgPSAwCiAgICAgICAgICAgIGFuc3dlcnMgPSAiIgogICAgICAgICAgICBmb3IgdHJ5b3V0IGluIHJhbmdlKG1vZGVsX2Fuc3dlcmluZ190cnlvdXRzKToKICAgICAgICAgICAgICAgICMgSW5mZXIgdGhyb3VnaCB0aGUgbGxtOgogICAgICAgICAgICAgICAgYW5zd2VycyA9IGxsbS5fZ2VuZXJhdGUocHJvbXB0X3RlbXBsYXRlLmZvcm1hdCh0ZXh0KSkKICAgICAgICAgICAgICAgICMgVmFsaWRhdGUgdGhlIGFuc3dlcnM6CiAgICAgICAgICAgICAgICBpZiBsZW4oYW5zd2VycykgIT0gbGVuKHF1ZXN0aW9ucyk6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIGFuc3dlcnMgPSBbCiAgICAgICAgICAgICAgICAgICAgYW5zd2VyWzM6XSBmb3IgYW5zd2VyIGluIGFuc3dlcnMKICAgICAgICAgICAgICAgIF0gICMgV2l0aG91dCB0aGUgcXVlc3Rpb25zIGluZGV4IHByZWZpeCAnaS4gJwogICAgICAgICAgICAgICAgaWYgYWxsKGxlbihhbnN3ZXIpID09IDAgZm9yIGFuc3dlciBpbiBhbnN3ZXJzKToKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgIyBOb3RlIGluIHRoZSBkYXRhZnJhbWU6CiAgICAgICAgICAgICAgICBkZi5sb2NbaSAtIGxlbihlcnJvcnMpXSA9IFsKICAgICAgICAgICAgICAgICAgICBwYXRobGliLlBhdGgodGV4dF9maWxlKS5uYW1lLAogICAgICAgICAgICAgICAgICAgICphbnN3ZXJzLAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgaWYgdHJ5b3V0ID09IG1vZGVsX2Fuc3dlcmluZ190cnlvdXRzOgogICAgICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgIGYiVGhlIExMTSBkaWQgbm90IGFuc3dlciBjb3JyZWN0bHkgLSBvbmUgb3IgbW9yZSBhbnN3ZXJzIGFyZSBtaXNzaW5nOiB7YW5zd2Vyc30iCiAgICAgICAgICAgICAgICApCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBleGNlcHRpb246CiAgICAgICAgICAgICMgQ29sbGVjdCB0aGUgZXhjZXB0aW9uOgogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5lcnJvcihmIkVycm9yIGluIGZpbGU6ICd7dGV4dF9maWxlfSciKQogICAgICAgICAgICBlcnJvcnNbc3RyKHRleHRfZmlsZSldID0gc3RyKGV4Y2VwdGlvbikKCiAgICByZXR1cm4gZGYsIGVycm9ycwoKCmRlZiBfZ2V0X21vZGVsKGNvbnRleHQsIGxsbV9zb3VyY2UsIG1vZGVsLCB0b2tlbml6ZXIsIG1vZGVsX2t3YXJncywgZ2VuZXJhdGlvbl9jb25maWcsIGFuc3dlcl9wcmVhbWJsZSk6CiAgICBpZiBsbG1fc291cmNlID09IExMTVNvdXJjZXMub3Blbl9haToKICAgICAgICBsbG0gPSBPcGVuQUlNb2RlbChjb250ZXh0LCBtb2RlbCkKICAgIGVsaWYgbGxtX3NvdXJjZSA9PSBMTE1Tb3VyY2VzLmxvY2FsOgogICAgICAgIGxsbSA9IEh1Z2dpbmdGYWNlTW9kZWwoCiAgICAgICAgICAgIGNvbnRleHQ9Y29udGV4dCwKICAgICAgICAgICAgbW9kZWw9bW9kZWwsCiAgICAgICAgICAgIHRva2VuaXplcj10b2tlbml6ZXIsCiAgICAgICAgICAgIG1vZGVsX2t3YXJncz1tb2RlbF9rd2FyZ3MsCiAgICAgICAgICAgIGdlbmVyYXRpb25fY29uZmlnPWdlbmVyYXRpb25fY29uZmlnLAogICAgICAgICAgICBhbnN3ZXJfcHJlYW1ibGU9YW5zd2VyX3ByZWFtYmxlLAogICAgICAgICkKICAgIGVsc2U6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmImxsbSBzb3VyY2UgJ3tsbG1fc291cmNlfScgbm90IHN1cHBvcnRlZC4gUGxlYXNlIHVzZSBvbmUgb2YgTExNU291cmNlIHZhbHVlcyIpCgogICAgcmV0dXJuIGxsbQoKCmNsYXNzIExMTW9kZWwoQUJDKToKICAgIEBhYnN0cmFjdG1ldGhvZAogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHBhc3MKCiAgICBAYWJzdHJhY3RtZXRob2QKICAgIGRlZiBfZ2VuZXJhdGUoc2VsZiwgKiprd2FyZ3MpOgogICAgICAgIHBhc3MKCgpjbGFzcyBIdWdnaW5nRmFjZU1vZGVsKExMTW9kZWwpOgogICAgZGVmIF9faW5pdF9fKAogICAgICAgIHNlbGYsCiAgICAgICAgY29udGV4dDogbWxydW4uTUxDbGllbnRDdHgsCiAgICAgICAgbW9kZWw6IHN0ciwKICAgICAgICB0b2tlbml6ZXI6IHN0ciwKICAgICAgICBtb2RlbF9rd2FyZ3M6IGRpY3QsCiAgICAgICAgZ2VuZXJhdGlvbl9jb25maWc6IGRpY3QsCiAgICAgICAgYW5zd2VyX3ByZWFtYmxlOiBzdHIsCiAgICApOgogICAgICAgIHNlbGYuYW5zd2VyX3ByZWFtYmxlID0gYW5zd2VyX3ByZWFtYmxlCiAgICAgICAgIyBMb2FkIHRoZSBnZW5lcmF0aW9uIGNvbmZpZzoKICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCJMb2FkaW5nIGdlbmVyYXRpb24gY29uZmlndXJhdGlvbiIpCiAgICAgICAgc2VsZi5nZW5lcmF0aW9uX2NvbmZpZyA9IHRyYW5zZm9ybWVycy5HZW5lcmF0aW9uQ29uZmlnKCoqKGdlbmVyYXRpb25fY29uZmlnIG9yIHt9KSkKICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCJHZW5lcmF0aW9uIGNvbmZpZ3VyYXRpb24gbG9hZGVkLiIpCgogICAgICAgICMgTG9hZCB0aGUgdG9rZW5pemVyOgogICAgICAgIHRva2VuaXplciA9IHRva2VuaXplciBvciBtb2RlbAogICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJMb2FkaW5nIHRva2VuaXplcjoge3Rva2VuaXplcn0iKQogICAgICAgIHNlbGYudG9rZW5pemVyID0gdHJhbnNmb3JtZXJzLkF1dG9Ub2tlbml6ZXIuZnJvbV9wcmV0cmFpbmVkKHRva2VuaXplcikKICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCJUb2tlbml6ZXIgbG9hZGVkIikKCiAgICAgICAgIyBMb2FkIHRoZSBtb2RlbCBhbmQgdG9rZW5pemVyIGludG8gYSBwaXBlbGluZSBvYmplY3Q6CiAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbyhmIkxvYWRpbmcgbW9kZWwgJ3ttb2RlbH0nIGFuZCB0b2tlbml6ZXIgaW50byBhIHBpcGVsaW5lIikKICAgICAgICBzZWxmLm1vZGVsID0gdHJhbnNmb3JtZXJzLnBpcGVsaW5lKAogICAgICAgICAgICB0YXNrPSJ0ZXh0LWdlbmVyYXRpb24iLAogICAgICAgICAgICBtb2RlbD1tb2RlbCwKICAgICAgICAgICAgdG9rZW5pemVyPXNlbGYudG9rZW5pemVyLAogICAgICAgICAgICB0cnVzdF9yZW1vdGVfY29kZT1UcnVlLAogICAgICAgICAgICBtb2RlbF9rd2FyZ3M9bW9kZWxfa3dhcmdzLAogICAgICAgICkKICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCJNb2RlbCBsb2FkZWQsIHBpcGVsaW5lIGNyZWF0ZWQiKQoKICAgIGRlZiBfZ2VuZXJhdGUoc2VsZiwgdGV4dDogc3RyKToKICAgICAgICBzZXF1ZW5jZXMgPSBzZWxmLm1vZGVsKAogICAgICAgICAgICB0ZXh0LAogICAgICAgICAgICBnZW5lcmF0aW9uX2NvbmZpZz1zZWxmLmdlbmVyYXRpb25fY29uZmlnLAogICAgICAgICAgICBudW1fcmV0dXJuX3NlcXVlbmNlcz0xLAogICAgICAgICAgICBlb3NfdG9rZW5faWQ9c2VsZi50b2tlbml6ZXIuZW9zX3Rva2VuX2lkLAogICAgICAgICkKICAgICAgICByZXR1cm4gc2VsZi5fcG9zdHByb2Nlc3Moc2VxdWVuY2VzWzBdWyJnZW5lcmF0ZWRfdGV4dCJdKQoKICAgIGRlZiBfcG9zdHByb2Nlc3Moc2VsZiwgYW5zd2Vyczogc3RyKToKICAgICAgICBhbnN3ZXJzID0gYW5zd2Vycy5zcGxpdCgKICAgICAgICAgICAgZiJ7c2VsZi5hbnN3ZXJfcHJlYW1ibGV9XG4iLCAxCiAgICAgICAgKVsxXQogICAgICAgIHJldHVybiBhbnN3ZXJzLnNwbGl0KCJcbiIpCgoKY2xhc3MgT3BlbkFJTW9kZWwoTExNb2RlbCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgY29udGV4dCwgbW9kZWwpOgogICAgICAgICMgU2V0dGluZyBPcGVuQUkgc2VjcmV0cyBpbiBlbnZpcm9ubWVudDoKICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCJTZXR0aW5nIE9wZW5BSSBjcmVkZW50aWFscyBpbiBlbnZpcm9ubWVudCIpCiAgICAgICAgX3NldF9zZWNyZXQoIk9QRU5BSV9BUElfS0VZIikKICAgICAgICBfc2V0X3NlY3JldCgiT1BFTkFJX0FQSV9CQVNFIikKICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCJPcGVuQUkgY3JlZGVudGlhbHMgYXJlIHNldCIpCgogICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIkNvbm5lY3RpbmcgdG8gT3BlbkFJIikKICAgICAgICBzZWxmLm1vZGVsID0gQ2hhdE9wZW5BSShtb2RlbD1tb2RlbCkKICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCJDb25uZWN0aW9uIHRvIE9wZW5BSSBzdWNjZWVkZWQiKQoKICAgIGRlZiBfZ2VuZXJhdGUoc2VsZiwgdGV4dCk6CiAgICAgICAgYW5zd2VycyA9IHNlbGYubW9kZWwucHJlZGljdCh0ZXh0KQogICAgICAgIHJldHVybiBzZWxmLl9wb3N0cHJvY2VzcyhhbnN3ZXJzKQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBfcG9zdHByb2Nlc3MoYW5zd2Vyczogc3RyKToKICAgICAgICByZXR1cm4gYW5zd2Vycy5zcGxpdCgiXG4iKQoKCmNsYXNzIExMTVNvdXJjZXM6CiAgICBsb2NhbCA9ICJsb2NhbCIKICAgIG9wZW5fYWkgPSAib3Blbi1haSIKCgpkZWYgX3NldF9zZWNyZXQoa2V5OiBzdHIpOgogICAgc2VjcmV0ID0gbWxydW4uZ2V0X3NlY3JldF9vcl9lbnYoa2V5PWtleSkKICAgIGlmIG5vdCBzZWNyZXQ6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmIk1pc3Npbmcgc2VjcmV0OiB7a2V5fSwgcGxlYXNlIHBhc3MgYXMgc2VjcmV0IG9yIHNldCBhcyBlbnZpcm9ubWVudCB2YXJpYWJsZSIpCiAgICBvcy5lbnZpcm9uW2tleV0gPSBzZWNyZXQKCgpkZWYgX2dldF9wcm9tcHRfdGVtcGxhdGUoCiAgICB0ZXh0X3dyYXBwZXI6IHN0ciwKICAgIHF1ZXN0aW9uc193cmFwcGVyOiBzdHIsCiAgICBxdWVzdGlvbnM6IExpc3Rbc3RyXSwKICAgIGFuc3dlcl9wcmVhbWJsZTogc3RyLAogICAgd2l0aF9pbmRleGVkX2xpc3Rfc3RhcnQ6IGJvb2wsCikgLT4gVHVwbGVbc3RyLCBzdHJdOgogICAgIyBWYWxpZGF0ZSBhbmQgYnVpbGQgdGhlIHRleHQgd3JhcHBlcjoKICAgIHRleHRfd3JhcHBlciA9IHRleHRfd3JhcHBlciBvciAoCiAgICAgICAgIkdpdmVuIHRoZSBmb2xsb3dpbmcgdGV4dDpcbiIgIi0tLS0tXG4iICJ7fVxuIiAiLS0tLS0iCiAgICApCiAgICBpZiB0ZXh0X3dyYXBwZXIuY291bnQoInt9IikgIT0gMToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKAogICAgICAgICAgICAiVGhlIGB0ZXh0X3dyYXBwZXJgIG11c3QgaW5jbHVkZSBvbmUgcGxhY2Vob2xkZXIgJ3t9JyBmb3IgdGhlIHRleHQuIgogICAgICAgICkKCiAgICAjIFZhbGlkYXRlIGFuZCBidWlsZCB0aGUgcXVlc3Rpb24gd3JhcHBlcjoKICAgIHF1ZXN0aW9uc193cmFwcGVyID0gcXVlc3Rpb25zX3dyYXBwZXIgb3IgIkFuc3dlciB0aGUgcXVlc3Rpb25zOlxuIiAie30iCiAgICBpZiBxdWVzdGlvbnNfd3JhcHBlci5jb3VudCgie30iKSAhPSAxOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCiAgICAgICAgICAgICJUaGUgYHF1ZXN0aW9uc193cmFwcGVyYCBtdXN0IGluY2x1ZGUgb25lIHBsYWNlaG9sZGVyICd7fScgZm9yIHRoZSB0ZXh0LiIKICAgICAgICApCgogICAgIyBWYWxpZGF0ZSBhbmQgcGFyc2UgdGhlIHF1ZXN0aW9uczoKICAgIGlmIGxlbihxdWVzdGlvbnMpID09IDA6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiUGxlYXNlIGluY2x1ZGUgYXQgbGVhc3Qgb25lIHF1ZXN0aW9uLiIpCiAgICBxdWVzdGlvbnMgPSAiXG4iLmpvaW4oCiAgICAgICAgW2Yie2l9LiB7cXVlc3Rpb259IiBmb3IgaSwgcXVlc3Rpb24gaW4gZW51bWVyYXRlKHF1ZXN0aW9ucywgMSldCiAgICApCgogICAgIyBWYWxpZGF0ZSBhbmQgYnVpbGQgdGhlIGFuc3dlciB3cmFwcGVyOgogICAgYW5zd2VyX3ByZWFtYmxlID0gYW5zd2VyX3ByZWFtYmxlIG9yICJBbnN3ZXI6IgogICAgaWYgYW5zd2VyX3ByZWFtYmxlLmNvdW50KCJ7fSIpICE9IDA6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiVGhlIGBhbnN3ZXJfcHJlYW1ibGVgIG11c3Qgbm90IGhhdmUgYSBwbGFjZWhvbGRlciAne30nLiIpCgogICAgaWYgd2l0aF9pbmRleGVkX2xpc3Rfc3RhcnQ6CiAgICAgICAgIyBBZGRpdGlvbiBmb3IgYmV0dGVyIGFuc3dlcnMgaW4gZ2VuZXJhbC4KICAgICAgICBpbmRleGVkX2xpc3Rfc3RhcnQgPSAiMS4gIgogICAgZWxzZToKICAgICAgICBpbmRleGVkX2xpc3Rfc3RhcnQgPSAiIgogICAgIyBDb25zdHJ1Y3QgdGhlIHRlbXBsYXRlOgogICAgcmV0dXJuICgKICAgICAgICBmInt0ZXh0X3dyYXBwZXJ9XG4iCiAgICAgICAgZiJ7cXVlc3Rpb25zX3dyYXBwZXIuZm9ybWF0KHF1ZXN0aW9ucyl9XG4iCiAgICAgICAgIlxuIgogICAgICAgIGYie2Fuc3dlcl9wcmVhbWJsZX1cbiIKICAgICAgICBmIntpbmRleGVkX2xpc3Rfc3RhcnR9IgogICAgKSwgYW5zd2VyX3ByZWFtYmxlCg==
    base_image: mlrun/mlrun
    commands: []
    code_origin: https://github.com/yonishelach/functions.git#da90a20560ddedaebcfdd900a43c76d070041a61:/Users/Yonatan_Shelach/projects/functions/question_answering/question_answering.py
    origin_filename: /Users/Yonatan_Shelach/projects/functions/question_answering/question_answering.py
    requirements:
    - transformers torch tqdm
  entry_points:
    answer_questions:
      name: answer_questions
      doc: Answer questions with context to the given text files by a pretrained LLM
        model.
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context.
        default: ''
      - name: input_path
        type: str
        doc: A path to a directory of text files or a path to a text file to ask questions
          about.
        default: ''
      - name: model
        type: str
        doc: The pre-trained model to use for asking questions.
        default: ''
      - name: questions
        type: List[str]
        doc: The questions to ask.
        default: ''
      - name: tokenizer
        type: str
        doc: The pre-trained tokenizer to use. Defaulted to the model given.
        default: null
      - name: model_kwargs
        type: dict
        doc: Keyword arguments to pass regarding the loading of the model in HuggingFace's
          `pipeline` function.
        default: null
      - name: text_wrapper
        type: str
        doc: A wrapper for the text part. Will be added at the start of the prompt.
          Must have a placeholder ('{}') for the questions.
        default: ''
      - name: questions_wrapper
        type: str
        doc: A wrapper for the questions received. Will be added after the text placeholder
          in the prompt template. Must have a placeholder ('{}') for the questions.
        default: ''
      - name: answer_preamble
        type: str
        doc: A prefix for the answer part. Will be added at the end of the prompt
          template.
        default: ''
      - name: generation_config
        type: dict
        doc: HuggingFace's `GenerationConfig` keyword arguments to pass to the `generate`
          method.
        default: null
      - name: questions_columns
        type: List[str]
        doc: Columns to use for the dataframe returned.
        default: null
      - name: model_answering_tryouts
        type: int
        doc: Amount of inferring to do per text before raising an error due to missing
          or empty answers.
        default: 2
      - name: llm_source
        type: str
        doc: Indicates which model to use
        default: local
      - name: with_indexed_list_start
        type: bool
        doc: Whether to add a '1. ' in the end of the prompt.
        default: true
      outputs:
      - default: ''
        doc: 'A tuple of:'
      lineno: 27
  description: GenAI approach of question answering on a given data
  default_handler: answer_questions
  disable_auto_mount: false
  clone_target_dir: ''
  env: []
  priority_class_name: ''
  preemption_mode: prevent
  affinity: null
  tolerations: null
  security_context: {}
verbose: false
