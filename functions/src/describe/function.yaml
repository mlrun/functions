kind: job
verbose: false
spec:
  image: mlrun/mlrun
  default_handler: analyze
  build:
    code_origin: ''
    functionSourceCode: IyBDb3B5cmlnaHQgMjAxOSBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiMKIyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiMgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKIyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KIyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiMgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiMKIyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IHdhcm5pbmdzCgppbXBvcnQgbWxydW4KaW1wb3J0IG51bXB5IGFzIG5wCgp3YXJuaW5ncy5zaW1wbGVmaWx0ZXIoYWN0aW9uPSJpZ25vcmUiLCBjYXRlZ29yeT1GdXR1cmVXYXJuaW5nKQoKaW1wb3J0IG1scnVuLmZlYXR1cmVfc3RvcmUgYXMgZnN0b3JlCmltcG9ydCBwYW5kYXMgYXMgcGQKaW1wb3J0IHBsb3RseS5leHByZXNzIGFzIHB4CmltcG9ydCBwbG90bHkuZmlndXJlX2ZhY3RvcnkgYXMgZmYKaW1wb3J0IHBsb3RseS5ncmFwaF9vYmplY3RzIGFzIGdvCmZyb20gbWxydW4uYXJ0aWZhY3RzIGltcG9ydCAoCiAgICBBcnRpZmFjdCwKICAgIERhdGFzZXRBcnRpZmFjdCwKICAgIFBsb3RseUFydGlmYWN0LAogICAgVGFibGVBcnRpZmFjdCwKICAgIHVwZGF0ZV9kYXRhc2V0X21ldGEsCikKZnJvbSBtbHJ1bi5kYXRhc3RvcmUgaW1wb3J0IERhdGFJdGVtCmZyb20gbWxydW4uZXhlY3V0aW9uIGltcG9ydCBNTENsaWVudEN0eApmcm9tIG1scnVuLmZlYXR1cmVfc3RvcmUgaW1wb3J0IEZlYXR1cmVTZXQKZnJvbSBwbG90bHkuc3VicGxvdHMgaW1wb3J0IG1ha2Vfc3VicGxvdHMKCnBkLnNldF9vcHRpb24oImRpc3BsYXkuZmxvYXRfZm9ybWF0IiwgbGFtYmRhIHg6ICIlLjJmIiAlIHgpCk1BWF9TSVpFX09GX0RGID0gNTAwMDAwCgoKZGVmIGFuYWx5emUoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIG5hbWU6IHN0ciA9ICJkYXRhc2V0IiwKICAgIHRhYmxlOiBGZWF0dXJlU2V0IHwgRGF0YUl0ZW0gPSBOb25lLAogICAgbGFiZWxfY29sdW1uOiBzdHIgPSBOb25lLAogICAgcGxvdHNfZGVzdDogc3RyID0gInBsb3RzIiwKICAgIHJhbmRvbV9zdGF0ZTogaW50ID0gMSwKICAgIHByb2JsZW1fdHlwZTogc3RyID0gImNsYXNzaWZpY2F0aW9uIiwKICAgIGRhc2tfa2V5OiBzdHIgPSAiZGFza19rZXkiLAogICAgZGFza19mdW5jdGlvbjogc3RyID0gTm9uZSwKICAgIGRhc2tfY2xpZW50PU5vbmUsCikgLT4gTm9uZToKICAgICIiIgogICAgVGhlIGZ1bmN0aW9uIHdpbGwgb3V0cHV0IHRoZSBmb2xsb3dpbmcgYXJ0aWZhY3RzIHBlcgogICAgY29sdW1uIHdpdGhpbiB0aGUgZGF0YSBmcmFtZSAoYmFzZWQgb24gZGF0YSB0eXBlcykKICAgIElmIHRoZSBkYXRhIGhhcyBtb3JlIHRoYW4gNTAwLDAwMCBzYW1wbGUgd2UKICAgIHNhbXBsZSByYW5kb21seSA1MDAsMDAwIHNhbXBsZXM6CgogICAgZGVzY3JpYmUgY3N2CiAgICBoaXN0b2dyYW1zCiAgICBzY2F0dGVyLTJkCiAgICB2aW9saW4gY2hhcnQKICAgIGNvcnJlbGF0aW9uLW1hdHJpeCBjaGFydAogICAgY29ycmVsYXRpb24tbWF0cml4IGNzdgogICAgaW1iYWxhbmNlIHBpZSBjaGFydAogICAgaW1iYWxhbmNlLXdlaWdodHMtdmVjIGNzdgoKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgICAgICAgICAgVGhlIGZ1bmN0aW9uIGNvbnRleHQKICAgIDpwYXJhbSBuYW1lOiAgICAgICAgICAgICAgICAgICAgS2V5IG9mIGRhdGFzZXQgdG8gZGF0YWJhc2UgKCJkYXRhc2V0IiBmb3IgZGVmYXVsdCkKICAgIDpwYXJhbSB0YWJsZTogICAgICAgICAgICAgICAgICAgTUxSdW4gaW5wdXQgcG9pbnRpbmcgdG8gcGFuZGFzIGRhdGFmcmFtZSAoY3N2L3BhcnF1ZXQgZmlsZSBwYXRoKSBvciBGZWF0dXJlU2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzIHBhcmFtCiAgICA6cGFyYW0gbGFiZWxfY29sdW1uOiAgICAgICAgICAgIEdyb3VuZCB0cnV0aCBjb2x1bW4gbGFiZWwKICAgIDpwYXJhbSBwbG90c19kZXN0OiAgICAgICAgICAgICAgRGVzdGluYXRpb24gZm9sZGVyIG9mIHN1bW1hcnkgcGxvdHMgKHJlbGF0aXZlIHRvIGFydGlmYWN0X3BhdGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgicGxvdHMiIGZvciBkZWZhdWx0KQogICAgOnBhcmFtIHJhbmRvbV9zdGF0ZTogICAgICAgICAgICBXaGVuIHRoZSB0YWJsZSBoYXMgbW9yZSB0aGFuIDUwMCwwMDAgc2FtcGxlcywgd2Ugc2FtcGxlIHJhbmRvbWx5IDUwMCwwMDAgc2FtcGxlcwogICAgOnBhcmFtIHByb2JsZW1fdHlwZSAgICAgICAgICAgICBUaGUgdHlwZSBvZiB0aGUgTUwgcHJvYmxlbSB0aGUgZGF0YSBmYWNpbmcgLSByZWdyZXNzaW9uLCBjbGFzc2lmaWNhdGlvbiBvciBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjbGFzc2lmaWNhdGlvbiBmb3IgZGVmYXVsdCkKICAgIDpwYXJhbSBkYXNrX2tleTogICAgICAgICAgICAgICAgS2V5IG9mIGRhdGFmcmFtZSBpbiBkYXNrIGNsaWVudCAiZGF0YXNldHMiIGF0dHJpYnV0ZQogICAgOnBhcmFtIGRhc2tfZnVuY3Rpb246ICAgICAgICAgICBEYXNrIGZ1bmN0aW9uIHVybCAoZGI6Ly8uLikKICAgIDpwYXJhbSBkYXNrX2NsaWVudDogICAgICAgICAgICAgRGFzayBjbGllbnQgb2JqZWN0CiAgICAiIiIKICAgIGRhdGFfaXRlbSwgZmVhdHVyZXNldCwgY3JlYXQsIHVwZGF0ZSA9IEZhbHNlLCBGYWxzZSwgRmFsc2UsIEZhbHNlCiAgICBnZXRfZnJvbV90YWJsZSA9IFRydWUKICAgIGlmIGRhc2tfZnVuY3Rpb24gb3IgZGFza19jbGllbnQ6CiAgICAgICAgZGF0YV9pdGVtLCBjcmVhdCA9IFRydWUsIFRydWUKICAgICAgICBpZiBkYXNrX2Z1bmN0aW9uOgogICAgICAgICAgICBjbGllbnQgPSBtbHJ1bi5pbXBvcnRfZnVuY3Rpb24oZGFza19mdW5jdGlvbikuY2xpZW50CiAgICAgICAgZWxpZiBkYXNrX2NsaWVudDoKICAgICAgICAgICAgY2xpZW50ID0gZGFza19jbGllbnQKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJkYXNrIGNsaWVudCB3YXMgbm90IHByb3ZpZGVkIikKCiAgICAgICAgaWYgZGFza19rZXkgaW4gY2xpZW50LmRhdGFzZXRzOgogICAgICAgICAgICBkZiA9IGNsaWVudC5nZXRfZGF0YXNldChkYXNrX2tleSkKICAgICAgICAgICAgZGF0YV9pdGVtLCBjcmVhdCwgZ2V0X2Zyb21fdGFibGUgPSBUcnVlLCBUcnVlLCBGYWxzZQogICAgICAgIGVsaWYgdGFibGU6CiAgICAgICAgICAgIGdldF9mcm9tX3RhYmxlID0gVHJ1ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oCiAgICAgICAgICAgICAgICBmIm9ubHkgdGhlc2UgZGF0YXNldHMgYXJlIGF2YWlsYWJsZSB7Y2xpZW50LmRhdGFzZXRzfSBpbiBjbGllbnQge2NsaWVudH0iCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJkYXRhc2V0IG5vdCBmb3VuZCBvbiBkYXNrIGNsdXN0ZXIiKQoKICAgIGlmIGdldF9mcm9tX3RhYmxlOgogICAgICAgIGlmIHR5cGUodGFibGUpID09IERhdGFJdGVtOgogICAgICAgICAgICBpZiB0YWJsZS5tZXRhIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBkYXRhX2l0ZW0sIGNyZWF0LCB1cGRhdGUgPSBUcnVlLCBUcnVlLCBGYWxzZQogICAgICAgICAgICBlbGlmIHRhYmxlLm1ldGEua2luZCA9PSAiZGF0YXNldCI6CiAgICAgICAgICAgICAgICBkYXRhX2l0ZW0sIGNyZWF0LCB1cGRhdGUgPSBUcnVlLCBGYWxzZSwgVHJ1ZQogICAgICAgICAgICBlbGlmIHRhYmxlLm1ldGEua2luZCA9PSAiRmVhdHVyZVZlY3RvciI6CiAgICAgICAgICAgICAgICBkYXRhX2l0ZW0sIGNyZWF0LCB1cGRhdGUgPSBUcnVlLCBGYWxzZSwgRmFsc2UKICAgICAgICAgICAgZWxpZiB0YWJsZS5tZXRhLmtpbmQgPT0gIkZlYXR1cmVTZXQiOgogICAgICAgICAgICAgICAgZmVhdHVyZXNldCwgY3JlYXQsIHVwZGF0ZSA9IFRydWUsIEZhbHNlLCBGYWxzZQoKICAgICAgICBpZiBkYXRhX2l0ZW06CiAgICAgICAgICAgIGRmID0gdGFibGUuYXNfZGYoKQogICAgICAgIGVsaWYgZmVhdHVyZXNldDoKICAgICAgICAgICAgcHJvamVjdF9uYW1lLCBzZXRfbmFtZSA9ICgKICAgICAgICAgICAgICAgIHRhYmxlLl9wYXRoLnNwbGl0KCIvIilbMl0sCiAgICAgICAgICAgICAgICB0YWJsZS5fcGF0aC5zcGxpdCgiLyIpWzRdLAogICAgICAgICAgICApCiAgICAgICAgICAgIGZlYXR1cmVfc2V0ID0gZnN0b3JlLmdldF9mZWF0dXJlX3NldCgKICAgICAgICAgICAgICAgIGYic3RvcmU6Ly9mZWF0dXJlLXNldHMve3Byb2plY3RfbmFtZX0ve3NldF9uYW1lfSIKICAgICAgICAgICAgKQogICAgICAgICAgICBkZiA9IGZlYXR1cmVfc2V0LnRvX2RhdGFmcmFtZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuZXJyb3IoIldyb25nIHRhYmxlIHR5cGUuIikKICAgICAgICAgICAgcmV0dXJuCgogICAgaWYgZGYuc2l6ZSA+IE1BWF9TSVpFX09GX0RGOgogICAgICAgIGRmID0gZGYuc2FtcGxlKG49aW50KE1BWF9TSVpFX09GX0RGIC8gZGYuc2hhcGVbMV0pLCByYW5kb21fc3RhdGU9cmFuZG9tX3N0YXRlKQogICAgZXh0cmFfZGF0YSA9IHt9CgogICAgaWYgbGFiZWxfY29sdW1uIG5vdCBpbiBkZi5jb2x1bW5zOgogICAgICAgIGxhYmVsX2NvbHVtbiA9IE5vbmUKCiAgICBleHRyYV9kYXRhWyJkZXNjcmliZSBjc3YiXSA9IGNvbnRleHQubG9nX2FydGlmYWN0KAogICAgICAgIFRhYmxlQXJ0aWZhY3QoImRlc2NyaWJlLWNzdiIsIGRmPWRmLmRlc2NyaWJlKCkpLAogICAgICAgIGxvY2FsX3BhdGg9ZiJ7cGxvdHNfZGVzdH0vZGVzY3JpYmUuY3N2IiwKICAgICkKCiAgICB0cnk6CiAgICAgICAgX2NyZWF0ZV9oaXN0b2dyYW1fbWF0X2FydGlmYWN0KAogICAgICAgICAgICBjb250ZXh0LCBkZiwgZXh0cmFfZGF0YSwgbGFiZWxfY29sdW1uLCBwbG90c19kZXN0CiAgICAgICAgKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGNvbnRleHQubG9nZ2VyLndhcm4oZiJGYWlsZWQgdG8gY3JlYXRlIGhpc3RvZ3JhbSBtYXRyaXggYXJ0aWZhY3QgZHVlIHRvOiB7ZX0iKQogICAgdHJ5OgogICAgICAgIF9jcmVhdGVfZmVhdHVyZXNfaGlzdG9ncmFtX2FydGlmYWN0cygKICAgICAgICAgICAgY29udGV4dCwgZGYsIGV4dHJhX2RhdGEsIGxhYmVsX2NvbHVtbiwgcGxvdHNfZGVzdCwgcHJvYmxlbV90eXBlCiAgICAgICAgKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGNvbnRleHQubG9nZ2VyLndhcm4oZiJGYWlsZWQgdG8gY3JlYXRlIHBhaXJwbG90IGhpc3RvZ3JhbXMgZHVlIHRvOiB7ZX0iKQogICAgdHJ5OgogICAgICAgIF9jcmVhdGVfZmVhdHVyZXNfMmRfc2NhdHRlcl9hcnRpZmFjdHMoCiAgICAgICAgICAgIGNvbnRleHQsIGRmLCBleHRyYV9kYXRhLCBsYWJlbF9jb2x1bW4sIHBsb3RzX2Rlc3QsIHByb2JsZW1fdHlwZQogICAgICAgICkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBjb250ZXh0LmxvZ2dlci53YXJuKGYiRmFpbGVkIHRvIGNyZWF0ZSBwYWlycGxvdCAyZF9zY2F0dGVyIGR1ZSB0bzoge2V9IikKICAgIHRyeToKICAgICAgICBfY3JlYXRlX3Zpb2xpbl9hcnRpZmFjdChjb250ZXh0LCBkZiwgZXh0cmFfZGF0YSwgcGxvdHNfZGVzdCkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBjb250ZXh0LmxvZ2dlci53YXJuKGYiRmFpbGVkIHRvIGNyZWF0ZSB2aW9saW4gZGlzdHJpYnV0aW9uIHBsb3RzIGR1ZSB0bzoge2V9IikKICAgIHRyeToKICAgICAgICBfY3JlYXRlX2ltYmFsYW5jZV9hcnRpZmFjdCgKICAgICAgICAgICAgY29udGV4dCwgZGYsIGV4dHJhX2RhdGEsIGxhYmVsX2NvbHVtbiwgcGxvdHNfZGVzdCwgcHJvYmxlbV90eXBlCiAgICAgICAgKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGNvbnRleHQubG9nZ2VyLndhcm4oZiJGYWlsZWQgdG8gY3JlYXRlIGNsYXNzIGltYmFsYW5jZSBwbG90IGR1ZSB0bzoge2V9IikKICAgIHRyeToKICAgICAgICBfY3JlYXRlX2NvcnJfYXJ0aWZhY3QoY29udGV4dCwgZGYsIGV4dHJhX2RhdGEsIGxhYmVsX2NvbHVtbiwgcGxvdHNfZGVzdCkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBjb250ZXh0LmxvZ2dlci53YXJuKGYiRmFpbGVkIHRvIGNyZWF0ZSBmZWF0dXJlcyBjb3JyZWxhdGlvbiBwbG90IGR1ZSB0bzoge2V9IikKCiAgICBpZiBub3QgZGF0YV9pdGVtOgogICAgICAgIHJldHVybgoKICAgIGFydGlmYWN0ID0gdGFibGUuYXJ0aWZhY3RfdXJsCiAgICBpZiBjcmVhdDogICMgZGF0YXNldCBub3Qgc3RvcmVkCiAgICAgICAgYXJ0aWZhY3QgPSBEYXRhc2V0QXJ0aWZhY3QoCiAgICAgICAgICAgIGtleT0iZGF0YXNldCIsIHN0YXRzPVRydWUsIGRmPWRmLCBleHRyYV9kYXRhPWV4dHJhX2RhdGEKICAgICAgICApCiAgICAgICAgYXJ0aWZhY3QgPSBjb250ZXh0LmxvZ19hcnRpZmFjdChhcnRpZmFjdCwgZGJfa2V5PW5hbWUpCiAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbyhmIlRoZSBkYXRhIHNldCBpcyBsb2dnZWQgdG8gdGhlIHByb2plY3QgdW5kZXIge25hbWV9IG5hbWUiKQoKICAgIGlmIHVwZGF0ZToKICAgICAgICB1cGRhdGVfZGF0YXNldF9tZXRhKGFydGlmYWN0LCBleHRyYV9kYXRhPWV4dHJhX2RhdGEpCiAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbyhmIlRoZSBkYXRhIHNldCBuYW1lZCB7bmFtZX0gaXMgdXBkYXRlZCIpCgogICAgIyBUT0RPIDogMy1EIHBsb3Qgb24gb24gc2VsZWN0ZWQgZmVhdHVyZXMuCiAgICAjIFRPRE8gOiBSZWludGVncmF0aW9uIHBsb3Qgb24gb24gc2VsZWN0ZWQgZmVhdHVyZXMuCiAgICAjIFRPRE8gOiBQQ0EgcGxvdCAod2l0aCBvcHRpb25zKQoKCmRlZiBfY3JlYXRlX2hpc3RvZ3JhbV9tYXRfYXJ0aWZhY3QoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIGRmOiBwZC5EYXRhRnJhbWUsCiAgICBleHRyYV9kYXRhOiBkaWN0LAogICAgbGFiZWxfY29sdW1uOiBzdHIsCiAgICBwbG90c19kZXN0OiBzdHIsCik6CiAgICAiIiIKICAgIENyZWF0ZSBhbmQgbG9nIGEgaGlzdG9ncmFtIG1hdHJpeCBhcnRpZmFjdAogICAgIiIiCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdCgKICAgICAgICBpdGVtPUFydGlmYWN0KAogICAgICAgICAgICBrZXk9Imhpc3QiLAogICAgICAgICAgICBib2R5PWIiPGI+IERlcHJlY2F0ZWQsIHNlZSB0aGUgYXJ0aWZhY3RzIHNjYXR0ZXItMmQgIgogICAgICAgICAgICBiImFuZCBoaXN0b2dyYW1zIGluc3RlYWQ8Yj4iLAogICAgICAgICksCiAgICAgICAgbG9jYWxfcGF0aD1mIntwbG90c19kZXN0fS9oaXN0Lmh0bWwiLAogICAgKQoKCmRlZiBfY3JlYXRlX2ZlYXR1cmVzX2hpc3RvZ3JhbV9hcnRpZmFjdHMoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIGRmOiBwZC5EYXRhRnJhbWUsCiAgICBleHRyYV9kYXRhOiBkaWN0LAogICAgbGFiZWxfY29sdW1uOiBzdHIsCiAgICBwbG90c19kZXN0OiBzdHIsCiAgICBwcm9ibGVtX3R5cGU6IHN0ciwKKToKICAgICIiIgogICAgQ3JlYXRlIGFuZCBsb2cgYSBoaXN0b2dyYW0gYXJ0aWZhY3QgZm9yIGVhY2ggZmVhdHVyZQogICAgIiIiCgogICAgZmlncyA9IGRpY3QoKQogICAgZmlyc3RfZmVhdHVyZV9uYW1lID0gIiIKICAgIGlmIGxhYmVsX2NvbHVtbiBpcyBub3QgTm9uZSBhbmQgcHJvYmxlbV90eXBlID09ICJjbGFzc2lmaWNhdGlvbiI6CiAgICAgICAgYWxsX2xhYmVscyA9IGRmW2xhYmVsX2NvbHVtbl0udW5pcXVlKCkKICAgIHZpc2libGUgPSBUcnVlCiAgICBmb3IgY29sdW1uX25hbWUgaW4gZGYuY29sdW1uczoKICAgICAgICBpZiBjb2x1bW5fbmFtZSA9PSBsYWJlbF9jb2x1bW46CiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIGlmIGxhYmVsX2NvbHVtbiBpcyBub3QgTm9uZSBhbmQgcHJvYmxlbV90eXBlID09ICJjbGFzc2lmaWNhdGlvbiI6CiAgICAgICAgICAgIGZvciBsYWJlbCBpbiBhbGxfbGFiZWxzOgogICAgICAgICAgICAgICAgc3ViX2ZpZyA9IGdvLkhpc3RvZ3JhbSgKICAgICAgICAgICAgICAgICAgICBoaXN0ZnVuYz0iY291bnQiLAogICAgICAgICAgICAgICAgICAgIHg9ZGYubG9jW2RmW2xhYmVsX2NvbHVtbl0gPT0gbGFiZWxdW2NvbHVtbl9uYW1lXSwKICAgICAgICAgICAgICAgICAgICBuYW1lPXN0cihsYWJlbCksCiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZT12aXNpYmxlLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZmlnc1tmIntjb2x1bW5fbmFtZX1AP0B7bGFiZWx9Il0gPSBzdWJfZmlnCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc3ViX2ZpZyA9IGdvLkhpc3RvZ3JhbShoaXN0ZnVuYz0iY291bnQiLCB4PWRmW2NvbHVtbl9uYW1lXSwgdmlzaWJsZT12aXNpYmxlKQogICAgICAgICAgICBmaWdzW2Yie2NvbHVtbl9uYW1lfUA/QHsxfSJdID0gc3ViX2ZpZwogICAgICAgIGlmIHZpc2libGU6CiAgICAgICAgICAgIGZpcnN0X2ZlYXR1cmVfbmFtZSA9IGNvbHVtbl9uYW1lCiAgICAgICAgdmlzaWJsZSA9IEZhbHNlCgogICAgZmlnID0gZ28uRmlndXJlKCkKICAgIGZvciBrIGluIGZpZ3Mua2V5cygpOgogICAgICAgIGZpZy5hZGRfdHJhY2UoZmlnc1trXSkKCiAgICBmaWcudXBkYXRlX2xheW91dCgKICAgICAgICB1cGRhdGVtZW51cz1bCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJidXR0b25zIjogWwogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgImxhYmVsIjogY29sdW1uX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJtZXRob2QiOiAidXBkYXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3MiOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZpc2libGUiOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleS5zcGxpdCgiQD9AIilbMF0gPT0gY29sdW1uX25hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGtleSBpbiBmaWdzLmtleXMoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInhheGlzIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicmFuZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW4oZGZbY29sdW1uX25hbWVdKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heChkZltjb2x1bW5fbmFtZV0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7InRpdGxlIjogZiI8aT48Yj5IaXN0b2dyYW0gb2Yge2NvbHVtbl9uYW1lfTwvYj48L2k+In0sCiAgICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGZvciBjb2x1bW5fbmFtZSBpbiBkZi5jb2x1bW5zCiAgICAgICAgICAgICAgICAgICAgaWYgY29sdW1uX25hbWUgIT0gbGFiZWxfY29sdW1uCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImRpcmVjdGlvbiI6ICJkb3duIiwKICAgICAgICAgICAgICAgICJwYWQiOiB7InIiOiAxMCwgInQiOiAxMH0sCiAgICAgICAgICAgICAgICAic2hvd2FjdGl2ZSI6IFRydWUsCiAgICAgICAgICAgICAgICAieCI6IDAuMjUsCiAgICAgICAgICAgICAgICAieGFuY2hvciI6ICJsZWZ0IiwKICAgICAgICAgICAgICAgICJ5IjogMS4xLAogICAgICAgICAgICAgICAgInlhbmNob3IiOiAidG9wIiwKICAgICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgYW5ub3RhdGlvbnM9WwogICAgICAgICAgICBkaWN0KAogICAgICAgICAgICAgICAgdGV4dD0iU2VsZWN0IEZlYXR1cmUgTmFtZSAiLAogICAgICAgICAgICAgICAgc2hvd2Fycm93PUZhbHNlLAogICAgICAgICAgICAgICAgeD0wLAogICAgICAgICAgICAgICAgeT0xLjA1LAogICAgICAgICAgICAgICAgeXJlZj0icGFwZXIiLAogICAgICAgICAgICAgICAgeHJlZj0icGFwZXIiLAogICAgICAgICAgICAgICAgYWxpZ249ImxlZnQiLAogICAgICAgICAgICAgICAgeGFuY2hvcj0ibGVmdCIsCiAgICAgICAgICAgICAgICB5YW5jaG9yPSJ0b3AiLAogICAgICAgICAgICAgICAgZm9udD17CiAgICAgICAgICAgICAgICAgICAgImNvbG9yIjogImJsdWUiLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKQogICAgICAgIF0sCiAgICApCgogICAgZmlnLnVwZGF0ZV9sYXlvdXQoCiAgICAgICAgd2lkdGg9NjAwLAogICAgICAgIGhlaWdodD00MDAsCiAgICAgICAgYXV0b3NpemU9RmFsc2UsCiAgICAgICAgbWFyZ2luPWRpY3QodD0xMDAsIGI9MCwgbD0wLCByPTApLAogICAgICAgIHRlbXBsYXRlPSJwbG90bHlfd2hpdGUiLAogICAgKQoKICAgIGZpZy51cGRhdGVfbGF5b3V0KHRpdGxlX3RleHQ9ZiI8aT48Yj5IaXN0b2dyYW1zIG9mIHtmaXJzdF9mZWF0dXJlX25hbWV9PC9iPjwvaT4iKQogICAgZXh0cmFfZGF0YVsiaGlzdG9ncmFtcyJdID0gY29udGV4dC5sb2dfYXJ0aWZhY3QoCiAgICAgICAgUGxvdGx5QXJ0aWZhY3Qoa2V5PSJoaXN0b2dyYW1zIiwgZmlndXJlPWZpZyksCiAgICAgICAgbG9jYWxfcGF0aD1mIntwbG90c19kZXN0fS9oaXN0b2dyYW1zLmh0bWwiLAogICAgKQoKCmRlZiBfY3JlYXRlX2ZlYXR1cmVzXzJkX3NjYXR0ZXJfYXJ0aWZhY3RzKAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBkZjogcGQuRGF0YUZyYW1lLAogICAgZXh0cmFfZGF0YTogZGljdCwKICAgIGxhYmVsX2NvbHVtbjogc3RyLAogICAgcGxvdHNfZGVzdDogc3RyLAogICAgcHJvYmxlbV90eXBlOiBzdHIsCik6CiAgICAiIiIKICAgIENyZWF0ZSBhbmQgbG9nIGEgc2NhdHRlci0yZCBhcnRpZmFjdCBmb3IgZWFjaCBjb3VwbGUgb2YgZmVhdHVyZXMKICAgICIiIgogICAgZmVhdHVyZXMgPSBbCiAgICAgICAgY29sdW1uX25hbWUgZm9yIGNvbHVtbl9uYW1lIGluIGRmLmNvbHVtbnMgaWYgY29sdW1uX25hbWUgIT0gbGFiZWxfY29sdW1uCiAgICBdCiAgICBtYXhfZmVhdHVyZV9sZW4gPSBmbG9hdChtYXgobGVuKGVsZW0pIGZvciBlbGVtIGluIGZlYXR1cmVzKSkKICAgIGlmIGxhYmVsX2NvbHVtbiBpcyBub3QgTm9uZToKICAgICAgICBsYWJlbHMgPSBzb3J0ZWQoZGZbbGFiZWxfY29sdW1uXS51bmlxdWUoKSkKICAgIGVsc2U6CiAgICAgICAgbGFiZWxzID0gW05vbmVdCiAgICBmaWcgPSBnby5GaWd1cmUoKQogICAgaWYgbGFiZWxfY29sdW1uIGlzIG5vdCBOb25lIGFuZCBwcm9ibGVtX3R5cGUgPT0gImNsYXNzaWZpY2F0aW9uIjoKICAgICAgICBmb3IgbCBpbiBsYWJlbHM6CiAgICAgICAgICAgIGZpZy5hZGRfdHJhY2UoCiAgICAgICAgICAgICAgICBnby5TY2F0dGVyKAogICAgICAgICAgICAgICAgICAgIHg9ZGYubG9jW2RmW2xhYmVsX2NvbHVtbl0gPT0gbF1bZmVhdHVyZXNbMF1dLAogICAgICAgICAgICAgICAgICAgIHk9ZGYubG9jW2RmW2xhYmVsX2NvbHVtbl0gPT0gbF1bZmVhdHVyZXNbMF1dLAogICAgICAgICAgICAgICAgICAgIG1vZGU9Im1hcmtlcnMiLAogICAgICAgICAgICAgICAgICAgIHZpc2libGU9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzaG93bGVnZW5kPVRydWUsCiAgICAgICAgICAgICAgICAgICAgbmFtZT1zdHIobCksCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICkKICAgIGVsaWYgbGFiZWxfY29sdW1uIGlzIE5vbmU6CiAgICAgICAgZmlnLmFkZF90cmFjZSgKICAgICAgICAgICAgZ28uU2NhdHRlcigKICAgICAgICAgICAgICAgIHg9ZGZbZmVhdHVyZXNbMF1dLAogICAgICAgICAgICAgICAgeT1kZltmZWF0dXJlc1swXV0sCiAgICAgICAgICAgICAgICBtb2RlPSJtYXJrZXJzIiwKICAgICAgICAgICAgICAgIHZpc2libGU9VHJ1ZSwKICAgICAgICAgICAgKQogICAgICAgICkKICAgIGVsaWYgcHJvYmxlbV90eXBlID09ICJyZWdyZXNzaW9uIjoKICAgICAgICBmaWcuYWRkX3RyYWNlKAogICAgICAgICAgICBnby5TY2F0dGVyKAogICAgICAgICAgICAgICAgeD1kZltmZWF0dXJlc1swXV0sCiAgICAgICAgICAgICAgICB5PWRmW2ZlYXR1cmVzWzBdXSwKICAgICAgICAgICAgICAgIG1vZGU9Im1hcmtlcnMiLAogICAgICAgICAgICAgICAgbWFya2VyPWRpY3QoCiAgICAgICAgICAgICAgICAgICAgY29sb3I9ZGZbbGFiZWxfY29sdW1uXSwgY29sb3JzY2FsZT0iVmlyaWRpcyIsIHNob3dzY2FsZT1UcnVlCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgdmlzaWJsZT1UcnVlLAogICAgICAgICAgICApCiAgICAgICAgKQoKICAgIHhfYnV0dG9ucyA9IFtdCiAgICB5X2J1dHRvbnMgPSBbXQoKICAgIGZvciBuY29sIGluIGZlYXR1cmVzOgogICAgICAgIGlmIHByb2JsZW1fdHlwZSA9PSAiY2xhc3NpZmljYXRpb24iIGFuZCBsYWJlbF9jb2x1bW4gaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHhfYnV0dG9ucy5hcHBlbmQoCiAgICAgICAgICAgICAgICBkaWN0KAogICAgICAgICAgICAgICAgICAgIG1ldGhvZD0idXBkYXRlIiwKICAgICAgICAgICAgICAgICAgICBsYWJlbD1uY29sLAogICAgICAgICAgICAgICAgICAgIGFyZ3M9WwogICAgICAgICAgICAgICAgICAgICAgICB7IngiOiBbZGYubG9jW2RmW2xhYmVsX2NvbHVtbl0gPT0gbF1bbmNvbF0gZm9yIGwgaW4gbGFiZWxzXX0sCiAgICAgICAgICAgICAgICAgICAgICAgIG5wLmFyYW5nZShsZW4obGFiZWxzKSkudG9saXN0KCksCiAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKQoKICAgICAgICAgICAgeV9idXR0b25zLmFwcGVuZCgKICAgICAgICAgICAgICAgIGRpY3QoCiAgICAgICAgICAgICAgICAgICAgbWV0aG9kPSJ1cGRhdGUiLAogICAgICAgICAgICAgICAgICAgIGxhYmVsPW5jb2wsCiAgICAgICAgICAgICAgICAgICAgYXJncz1bCiAgICAgICAgICAgICAgICAgICAgICAgIHsieSI6IFtkZi5sb2NbZGZbbGFiZWxfY29sdW1uXSA9PSBsXVtuY29sXSBmb3IgbCBpbiBsYWJlbHNdfSwKICAgICAgICAgICAgICAgICAgICAgICAgbnAuYXJhbmdlKGxlbihsYWJlbHMpKS50b2xpc3QoKSwKICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgeF9idXR0b25zLmFwcGVuZCgKICAgICAgICAgICAgICAgIGRpY3QobWV0aG9kPSJ1cGRhdGUiLCBsYWJlbD1uY29sLCBhcmdzPVt7IngiOiBbZGZbbmNvbF1dfV0pCiAgICAgICAgICAgICkKCiAgICAgICAgICAgIHlfYnV0dG9ucy5hcHBlbmQoCiAgICAgICAgICAgICAgICBkaWN0KG1ldGhvZD0idXBkYXRlIiwgbGFiZWw9bmNvbCwgYXJncz1beyJ5IjogW2RmW25jb2xdXX1dKQogICAgICAgICAgICApCgogICAgIyBQYXNzIGJ1dHRvbnMgdG8gdGhlIHVwZGF0ZW1lbnVzIGFyZ3VtZW50CiAgICBmaWcudXBkYXRlX2xheW91dCgKICAgICAgICB1cGRhdGVtZW51cz1bCiAgICAgICAgICAgIGRpY3QoYnV0dG9ucz14X2J1dHRvbnMsIGRpcmVjdGlvbj0idXAiLCB4PTAuNSwgeT0tMC4xKSwKICAgICAgICAgICAgZGljdChidXR0b25zPXlfYnV0dG9ucywgZGlyZWN0aW9uPSJkb3duIiwgeD0tbWF4X2ZlYXR1cmVfbGVuIC8gMTAwLCB5PTAuNSksCiAgICAgICAgXQogICAgKQoKICAgIGZpZy51cGRhdGVfbGF5b3V0KAogICAgICAgIHdpZHRoPTYwMCwKICAgICAgICBoZWlnaHQ9NDAwLAogICAgICAgIGF1dG9zaXplPUZhbHNlLAogICAgICAgIG1hcmdpbj1kaWN0KHQ9MTAwLCBiPTAsIGw9MCwgcj0wKSwKICAgICAgICB0ZW1wbGF0ZT0icGxvdGx5X3doaXRlIiwKICAgICkKCiAgICBmaWcudXBkYXRlX2xheW91dCh0aXRsZV90ZXh0PSI8aT48Yj5TY2F0dGVyLTJkPC9iPjwvaT4iKQogICAgZXh0cmFfZGF0YVsic2NhdHRlci0yZCJdID0gY29udGV4dC5sb2dfYXJ0aWZhY3QoCiAgICAgICAgUGxvdGx5QXJ0aWZhY3Qoa2V5PSJzY2F0dGVyLTJkIiwgZmlndXJlPWZpZyksCiAgICAgICAgbG9jYWxfcGF0aD1mIntwbG90c19kZXN0fS9zY2F0dGVyLTJkLmh0bWwiLAogICAgKQoKCmRlZiBfY3JlYXRlX3Zpb2xpbl9hcnRpZmFjdCgKICAgIGNvbnRleHQ6IE1MQ2xpZW50Q3R4LCBkZjogcGQuRGF0YUZyYW1lLCBleHRyYV9kYXRhOiBkaWN0LCBwbG90c19kZXN0OiBzdHIKKToKICAgICIiIgogICAgQ3JlYXRlIGFuZCBsb2cgYSB2aW9saW4gYXJ0aWZhY3QKICAgICIiIgogICAgY29scyA9IDUKICAgIHJvd3MgPSAoZGYuc2hhcGVbMV0gLy8gY29scykgKyAxCiAgICBmaWcgPSBtYWtlX3N1YnBsb3RzKHJvd3M9cm93cywgY29scz1jb2xzKQoKICAgIHBsb3RfbnVtID0gMAoKICAgIGZvciBjb2x1bW5fbmFtZSBpbiBkZi5jb2x1bW5zOgogICAgICAgIGNvbHVtbl9kYXRhID0gZGZbY29sdW1uX25hbWVdCiAgICAgICAgdmlvbGluID0gZ28uVmlvbGluKAogICAgICAgICAgICB4PVtjb2x1bW5fbmFtZV0gKiBjb2x1bW5fZGF0YS5zaGFwZVswXSwKICAgICAgICAgICAgeT1jb2x1bW5fZGF0YSwKICAgICAgICAgICAgbmFtZT1jb2x1bW5fbmFtZSwKICAgICAgICApCgogICAgICAgIGZpZy5hZGRfdHJhY2UoCiAgICAgICAgICAgIHZpb2xpbiwKICAgICAgICAgICAgcm93PShwbG90X251bSAvLyBjb2xzKSArIDEsCiAgICAgICAgICAgIGNvbD0ocGxvdF9udW0gJSBjb2xzKSArIDEsCiAgICAgICAgKQoKICAgICAgICBwbG90X251bSArPSAxCgogICAgZmlnWyJsYXlvdXQiXS51cGRhdGUoCiAgICAgICAgaGVpZ2h0PShyb3dzICsgMSkgKiAyMDAsCiAgICAgICAgd2lkdGg9KGNvbHMgKyAxKSAqIDIwMCwKICAgICAgICB0aXRsZT0iPGk+PGI+VmlvbGluIFBsb3RzPC9iPjwvaT4iLAogICAgKQoKICAgIGZpZy51cGRhdGVfbGF5b3V0KHNob3dsZWdlbmQ9RmFsc2UpCiAgICBleHRyYV9kYXRhWyJ2aW9saW4iXSA9IGNvbnRleHQubG9nX2FydGlmYWN0KAogICAgICAgIFBsb3RseUFydGlmYWN0KGtleT0idmlvbGluIiwgZmlndXJlPWZpZyksCiAgICAgICAgbG9jYWxfcGF0aD1mIntwbG90c19kZXN0fS92aW9saW4uaHRtbCIsCiAgICApCgoKZGVmIF9jcmVhdGVfaW1iYWxhbmNlX2FydGlmYWN0KAogICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICBkZjogcGQuRGF0YUZyYW1lLAogICAgZXh0cmFfZGF0YTogZGljdCwKICAgIGxhYmVsX2NvbHVtbjogc3RyLAogICAgcGxvdHNfZGVzdDogc3RyLAogICAgcHJvYmxlbV90eXBlOiBzdHIsCik6CiAgICAiIiIKICAgIENyZWF0ZSBhbmQgbG9nIGFuIGltYmFsYW5jZSBjbGFzcyBhcnRpZmFjdCAoY3N2ICsgcGxvdCkKICAgICIiIgogICAgaWYgbGFiZWxfY29sdW1uOgogICAgICAgIGlmIHByb2JsZW1fdHlwZSA9PSAiY2xhc3NpZmljYXRpb24iOgogICAgICAgICAgICB2YWx1ZXNfY29sdW1uID0gImNvdW50IgogICAgICAgICAgICBsYWJlbHNfY291bnQgPSBkZltsYWJlbF9jb2x1bW5dLnZhbHVlX2NvdW50cygpLnNvcnRfaW5kZXgoKQogICAgICAgICAgICBkZl9sYWJlbHNfY291bnQgPSBwZC5EYXRhRnJhbWUobGFiZWxzX2NvdW50KQogICAgICAgICAgICBkZl9sYWJlbHNfY291bnRbbGFiZWxfY29sdW1uXSA9IGxhYmVsc19jb3VudC5pbmRleAogICAgICAgICAgICBkZl9sYWJlbHNfY291bnQucmVuYW1lKGNvbHVtbnM9eyIiOiB2YWx1ZXNfY29sdW1ufSwgaW5wbGFjZT1UcnVlKQogICAgICAgICAgICBkZl9sYWJlbHNfY291bnRbdmFsdWVzX2NvbHVtbl0gPSBkZl9sYWJlbHNfY291bnRbdmFsdWVzX2NvbHVtbl0gLyBzdW0oCiAgICAgICAgICAgICAgICBkZl9sYWJlbHNfY291bnRbdmFsdWVzX2NvbHVtbl0KICAgICAgICAgICAgKQogICAgICAgICAgICBmaWcgPSBweC5waWUoZGZfbGFiZWxzX2NvdW50LCBuYW1lcz1sYWJlbF9jb2x1bW4sIHZhbHVlcz12YWx1ZXNfY29sdW1uKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGZpZyA9IHB4Lmhpc3RvZ3JhbSgKICAgICAgICAgICAgICAgIGhpc3RmdW5jPSJjb3VudCIsCiAgICAgICAgICAgICAgICB4PWRmW2xhYmVsX2NvbHVtbl0sCiAgICAgICAgICAgICkKICAgICAgICAgICAgaGlzdCA9IG5wLmhpc3RvZ3JhbShkZltsYWJlbF9jb2x1bW5dKQogICAgICAgICAgICBkZl9sYWJlbHNfY291bnQgPSBwZC5EYXRhRnJhbWUoCiAgICAgICAgICAgICAgICB7Im1pbl92YWwiOiBoaXN0WzFdLCAiY291bnQiOiBoaXN0WzBdLnRvbGlzdCgpICsgWzBdfQogICAgICAgICAgICApCiAgICAgICAgZmlnLnVwZGF0ZV9sYXlvdXQodGl0bGVfdGV4dD0iPGk+PGI+TGFiZWxzIEltYmFsYW5jZTwvYj48L2k+IikKICAgICAgICBleHRyYV9kYXRhWyJpbWJhbGFuY2UiXSA9IGNvbnRleHQubG9nX2FydGlmYWN0KAogICAgICAgICAgICBQbG90bHlBcnRpZmFjdChrZXk9ImltYmFsYW5jZSIsIGZpZ3VyZT1maWcpLAogICAgICAgICAgICBsb2NhbF9wYXRoPWYie3Bsb3RzX2Rlc3R9L2ltYmFsYW5jZS5odG1sIiwKICAgICAgICApCiAgICAgICAgZXh0cmFfZGF0YVsiaW1iYWxhbmNlLWNzdiJdID0gY29udGV4dC5sb2dfYXJ0aWZhY3QoCiAgICAgICAgICAgIFRhYmxlQXJ0aWZhY3QoImltYmFsYW5jZS13ZWlnaHRzLXZlYyIsIGRmPWRmX2xhYmVsc19jb3VudCksCiAgICAgICAgICAgIGxvY2FsX3BhdGg9ZiJ7cGxvdHNfZGVzdH0vaW1iYWxhbmNlLXdlaWdodHMtdmVjLmNzdiIsCiAgICAgICAgKQoKCmRlZiBfY3JlYXRlX2NvcnJfYXJ0aWZhY3QoCiAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgIGRmOiBwZC5EYXRhRnJhbWUsCiAgICBleHRyYV9kYXRhOiBkaWN0LAogICAgbGFiZWxfY29sdW1uOiBzdHIsCiAgICBwbG90c19kZXN0OiBzdHIsCik6CiAgICAiIiIKICAgIENyZWF0ZSBhbmQgbG9nIGFuIGNvcnJlbGF0aW9uLW1hdHJpeCBhcnRpZmFjdCAoY3N2ICsgcGxvdCkKICAgICIiIgogICAgaWYgbGFiZWxfY29sdW1uIGlzIG5vdCBOb25lOgogICAgICAgIGRmID0gZGYuZHJvcChbbGFiZWxfY29sdW1uXSwgYXhpcz0xKQogICAgdGJsY29yciA9IGRmLmNvcnIobnVtZXJpY19vbmx5PVRydWUpCiAgICBleHRyYV9kYXRhWyJjb3JyZWxhdGlvbi1tYXRyaXgtY3N2Il0gPSBjb250ZXh0LmxvZ19hcnRpZmFjdCgKICAgICAgICBUYWJsZUFydGlmYWN0KCJjb3JyZWxhdGlvbi1tYXRyaXgtY3N2IiwgZGY9dGJsY29yciwgdmlzaWJsZT1UcnVlKSwKICAgICAgICBsb2NhbF9wYXRoPWYie3Bsb3RzX2Rlc3R9L2NvcnJlbGF0aW9uLW1hdHJpeC5jc3YiLAogICAgKQoKICAgIHogPSB0Ymxjb3JyLnZhbHVlcy50b2xpc3QoKQogICAgel90ZXh0ID0gW1tmInt5Oi4yZn0iIGZvciB5IGluIHhdIGZvciB4IGluIHpdCiAgICBmaWcgPSBmZi5jcmVhdGVfYW5ub3RhdGVkX2hlYXRtYXAoCiAgICAgICAgeiwKICAgICAgICB4PWxpc3QodGJsY29yci5jb2x1bW5zKSwKICAgICAgICB5PWxpc3QodGJsY29yci5jb2x1bW5zKSwKICAgICAgICBhbm5vdGF0aW9uX3RleHQ9el90ZXh0LAogICAgICAgIGNvbG9yc2NhbGU9ImFnc3Vuc2V0IiwKICAgICkKICAgIGZpZ1sibGF5b3V0Il1bInlheGlzIl1bImF1dG9yYW5nZSJdID0gInJldmVyc2VkIiAgIyBsIC0+IHIKICAgIGZpZy51cGRhdGVfbGF5b3V0KHRpdGxlX3RleHQ9IjxpPjxiPkNvcnJlbGF0aW9uIG1hdHJpeDwvYj48L2k+IikKICAgIGZpZ1siZGF0YSJdWzBdWyJzaG93c2NhbGUiXSA9IFRydWUKCiAgICBleHRyYV9kYXRhWyJjb3JyZWxhdGlvbiJdID0gY29udGV4dC5sb2dfYXJ0aWZhY3QoCiAgICAgICAgUGxvdGx5QXJ0aWZhY3Qoa2V5PSJjb3JyZWxhdGlvbiIsIGZpZ3VyZT1maWcpLAogICAgICAgIGxvY2FsX3BhdGg9ZiJ7cGxvdHNfZGVzdH0vY29ycmVsYXRpb24uaHRtbCIsCiAgICApCg==
    origin_filename: ''
  command: ''
  filename: describe.py
  entry_points:
    analyze:
      lineno: 45
      has_varargs: false
      has_kwargs: false
      outputs:
      - type: None
      parameters:
      - name: context
        type: MLClientCtx
        doc: The function context
      - name: name
        type: str
        doc: Key of dataset to database ("dataset" for default)
        default: dataset
      - name: table
        doc: MLRun input pointing to pandas dataframe (csv/parquet file path) or FeatureSet
          as param
        default: null
      - name: label_column
        type: str
        doc: Ground truth column label
        default: null
      - name: plots_dest
        type: str
        doc: Destination folder of summary plots (relative to artifact_path) ("plots"
          for default)
        default: plots
      - name: random_state
        type: int
        doc: When the table has more than 500,000 samples, we sample randomly 500,000
          samples
        default: 1
      - name: problem_type
        type: str
        default: classification
      - name: dask_key
        type: str
        doc: Key of dataframe in dask client "datasets" attribute
        default: dask_key
      - name: dask_function
        type: str
        doc: Dask function url (db://..)
        default: null
      - name: dask_client
        doc: Dask client object
        default: null
      name: analyze
      doc: 'The function will output the following artifacts per

        column within the data frame (based on data types)

        If the data has more than 500,000 sample we

        sample randomly 500,000 samples:


        describe csv

        histograms

        scatter-2d

        violin chart

        correlation-matrix chart

        correlation-matrix csv

        imbalance pie chart

        imbalance-weights-vec csv'
  disable_auto_mount: false
  description: describe and visualizes dataset stats
metadata:
  categories:
  - data-analysis
  tag: ''
  name: describe
